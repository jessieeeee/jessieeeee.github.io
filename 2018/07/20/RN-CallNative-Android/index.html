<!DOCTYPE html>





<html lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="我的开源项目高仿韩寒的one一个，打算长期维护并借此机会学习react-native相关的技术，感兴趣的可以戳这里，此项目不是标准的react-native项目结构，而是在android studio工程项目下引入react-native的混合式开发结构，其中不少地方调用了原生的模块和原生封装的ui组件，相信在react-native跨平台还不成熟的阶段，调用原生完成开发需求是不可避免的，打算在">
<meta name="keywords" content="open source project">
<meta property="og:type" content="article">
<meta property="og:title" content="react-native调android原生">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2018&#x2F;07&#x2F;20&#x2F;RN-CallNative-Android&#x2F;index.html">
<meta property="og:site_name" content="JessieK&#39;s blog">
<meta property="og:description" content="我的开源项目高仿韩寒的one一个，打算长期维护并借此机会学习react-native相关的技术，感兴趣的可以戳这里，此项目不是标准的react-native项目结构，而是在android studio工程项目下引入react-native的混合式开发结构，其中不少地方调用了原生的模块和原生封装的ui组件，相信在react-native跨平台还不成熟的阶段，调用原生完成开发需求是不可避免的，打算在">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-08-25T06:24:24.427Z">
<meta name="twitter:card" content="summary">
  <link rel="canonical" href="http://yoursite.com/2018/07/20/RN-CallNative-Android/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>react-native调android原生 | JessieK's blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JessieK's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">My Technical sharing</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      
    
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/RN-CallNative-Android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="程序的世界，比你牛逼的人更比你努力。<br /> hello，I'm an Android developer～ <br /> My hobbies tag &#58; <br /> - Coding  <br /> - Sports   <br /> - Game">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            react-native调android原生
            

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2018-07-20 11:03:00" itemprop="dateCreated datePublished" datetime="2018-07-20T11:03:00+08:00">2018-07-20</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-08-25 14:24:24" itemprop="dateModified" datetime="2018-08-25T14:24:24+08:00">2018-08-25</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ReactNative/" itemprop="url" rel="index">
                    <span itemprop="name">ReactNative</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <hr>
<p>我的开源项目高仿韩寒的one一个，打算长期维护并借此机会学习react-native相关的技术，感兴趣的可以<a href="https://github.com/jessieeeee/SimpleOne" target="_blank" rel="noopener">戳这里</a>，此项目不是标准的react-native项目结构，而是在android studio工程项目下引入react-native的混合式开发结构，其中不少地方调用了原生的模块和原生封装的ui组件，相信在react-native跨平台还不成熟的阶段，调用原生完成开发需求是不可避免的，打算在这里对react-native调用原生的相关技术做一个总结．如果有不正确的地方还望指正，或者您有更好的解决方案也欢迎提出一起讨论</p>
<hr>
<h1 id="调用原生模块"><a href="#调用原生模块" class="headerlink" title="调用原生模块"></a>调用原生模块</h1><p>react-native调用原生模块应该是经常会用到的，我们在android studio项目中引入react-native实质上就是设置ReactRootView为activity的布局视图，初始化mReactInstanceManager进行react-native的相关配置，添加自定义的原生组件包，MainReactPackage主组件包，这个是默认添加的，在activity的生命周期中对react-native做相关配置，同时继承DefaultHardwareBackBtnHandler接口，这个接口只有invokeDefaultOnBackPressed的方法，对于android back按键，是在onBackPressed中，把所有的back事件都发到js端，如果js端没监听，或者监听都返回了false，那么就会回到invokeDefaultOnBackPressed的Activity处理。</p>
<h2 id="调用原生的场景"><a href="#调用原生的场景" class="headerlink" title="调用原生的场景"></a>调用原生的场景</h2><p>比如我们需要在react-native 的ui中加入toast提示，调用音乐播放等多媒体相关的系统api支持，调用第三方分享和登录授权……不可避免的要调用原生代码，接下来详细记录react-native js端与原生android端之间的通信方式</p>
<h2 id="react-native调用android原生"><a href="#react-native调用android原生" class="headerlink" title="react-native调用android原生"></a>react-native调用android原生</h2><p>以加入toast提示为例：</p>
<h3 id="先定义一个ReactContextBaseJavaModule"><a href="#先定义一个ReactContextBaseJavaModule" class="headerlink" title="先定义一个ReactContextBaseJavaModule"></a>先定义一个ReactContextBaseJavaModule</h3><p>自定义一个ToastModule继承ReactContextBaseJavaModule，重写其中的getName方法，返回react-native中调用时的组件名，重写getConstants方法，返回一个常量map，定义常量值的key，将所有可供调用的常量值put进去，通过对象.常量值key使用模块常量，使用｀@ReactMethod｀注解可供react-native调用的方法，@ReactMethod注解的方法返回类型一定是void，这里的回调可以有两种方式实现，第一种是callback的方式，第二种是promise的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToastModule</span> <span class="keyword">extends</span> <span class="title">ReactContextBaseJavaModule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DURATION_SHORT_KEY = <span class="string">"SHORT"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DURATION_LONG_KEY = <span class="string">"LONG"</span>;</span><br><span class="line">    <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">100000</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ToastModule</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(reactContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复写方法，返回react-native中调用的组件名</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ToastNative"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复写方法，返回常量</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getConstants</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, Object&gt; constants = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        constants.put(DURATION_SHORT_KEY, Toast.LENGTH_SHORT);</span><br><span class="line">        constants.put(DURATION_LONG_KEY, Toast.LENGTH_LONG);</span><br><span class="line">        <span class="keyword">return</span> constants;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用 @ReactMethod注解返回react-native中可调用的方法（使用callback的方式）</span></span><br><span class="line">    <span class="meta">@ReactMethod</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String message, <span class="keyword">int</span> duration ,Callback successCallback, Callback errorCallback)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(getReactApplicationContext(), message, duration).show();</span><br><span class="line">        <span class="comment">// 通过invoke调用，随便你传参</span></span><br><span class="line">        <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">            successCallback.invoke(<span class="string">"success"</span>, ++count);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            errorCallback.invoke(<span class="string">"error"</span>, ++count);</span><br><span class="line">        &#125;</span><br><span class="line">        flag = !flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">　  <span class="comment">//  使用 @ReactMethod注解返回react-native中可调用的方法（使用promise的方式）</span></span><br><span class="line">    <span class="meta">@ReactMethod</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMsg</span><span class="params">(String msg, Promise promise)</span> </span>&#123;</span><br><span class="line">        String result = <span class="string">"处理结果："</span> + msg;</span><br><span class="line">        Toast.makeText(getReactApplicationContext(), result, Toast.LENGTH_SHORT).show();</span><br><span class="line">        promise.resolve(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 @ReactMethod注解返回react-native中可调用的 方法</span></span><br><span class="line">    <span class="meta">@ReactMethod</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMsg</span><span class="params">(String message, <span class="keyword">int</span> duration)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(getReactApplicationContext(), message, duration).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">　</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注册ReactContextBaseJavaModule"><a href="#注册ReactContextBaseJavaModule" class="headerlink" title="注册ReactContextBaseJavaModule"></a>注册ReactContextBaseJavaModule</h3><p>在自定义的组件包中MyReactPackage注册这个ReactContextBaseJavaModule,其中createViewManagers方法用于注册原生ui组件，而createNativeModules方法用于注册原生模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReactPackage</span> <span class="keyword">implements</span> <span class="title">ReactPackage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引入原生的模块</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> reactContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;NativeModule&gt; <span class="title">createNativeModules</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            ReactApplicationContext reactContext)</span> </span>&#123;</span><br><span class="line">        List&lt;NativeModule&gt; modules = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        modules.add(<span class="keyword">new</span> UShareModule(reactContext));</span><br><span class="line">        modules.add(<span class="keyword">new</span> ULoginModule(reactContext));</span><br><span class="line">        modules.add(<span class="keyword">new</span> ToastModule(reactContext));</span><br><span class="line">        modules.add(<span class="keyword">new</span> MediaPlayerModule(reactContext));</span><br><span class="line">        <span class="keyword">return</span> modules;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个MyReactPackage是我们自定义的组件包，我们需要添加到配置中</p>
<h3 id="在react-native工程结构下添加自定义的ReactPackage"><a href="#在react-native工程结构下添加自定义的ReactPackage" class="headerlink" title="在react-native工程结构下添加自定义的ReactPackage"></a>在react-native工程结构下添加自定义的ReactPackage</h3><p>修改android工程中的Application类，重写ReactNativeHost中的getPackages方法，在返回的数组中添加自定义的组件包对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> <span class="keyword">implements</span> <span class="title">ReactApplication</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MyReactPackage myReactPackage=<span class="keyword">new</span> MyReactPackage();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactNativeHost mReactNativeHost = <span class="keyword">new</span> ReactNativeHost(<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getUseDeveloperSupport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BuildConfig.DEBUG;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> List&lt;ReactPackage&gt; <span class="title">getPackages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class="line">                    <span class="keyword">new</span> MainReactPackage(),</span><br><span class="line">                    myReactPackage</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ReactNativeHost <span class="title">getReactNativeHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mReactNativeHost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="在android-studio工程结构下添加自定义的ReactPackage"><a href="#在android-studio工程结构下添加自定义的ReactPackage" class="headerlink" title="在android studio工程结构下添加自定义的ReactPackage"></a>在android studio工程结构下添加自定义的ReactPackage</h3><p>找到ReactActivity或者继承DefaultHardwareBackBtnHandler接口的activity中的mReactInstanceManager，添加一个自定义的组件包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ReactRootView mReactRootView;</span><br><span class="line"><span class="keyword">private</span> ReactInstanceManager mReactInstanceManager;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    ...</span><br><span class="line">    mReactRootView = <span class="keyword">new</span> ReactRootView(<span class="keyword">this</span>);</span><br><span class="line">    mReactInstanceManager = ReactInstanceManager.builder()</span><br><span class="line">            .setApplication(getApplication())</span><br><span class="line">            .setBundleAssetName(<span class="string">"index.android.bundle"</span>)</span><br><span class="line">            .setJSMainModuleName(<span class="string">"index.android"</span>)</span><br><span class="line">            .addPackage(<span class="keyword">new</span> MainReactPackage())</span><br><span class="line">            .addPackage(<span class="keyword">new</span> MyReactPackage())</span><br><span class="line">            .addPackage(<span class="keyword">new</span> ImagePickerPackage())</span><br><span class="line">            .setUseDeveloperSupport(BuildConfig.DEBUG)</span><br><span class="line">            .setInitialLifecycleState(mLifecycleState)</span><br><span class="line">            .build();</span><br><span class="line">    mReactRootView.startReactApplication(mReactInstanceManager,</span><br><span class="line">            <span class="string">"SimpleOne"</span>, <span class="keyword">null</span>);</span><br><span class="line">    mReactInstanceManager.getDevSupportManager().showDevOptionsDialog();</span><br><span class="line">    setContentView(mReactRootView);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以只要实现了ReactPackage和ReactContextBaseJavaModule，将它注册到ReactNativeHost或者ReactInstanceManager，就可以在React Native中调用原生模块了。</p>
<h3 id="在react-native中使用"><a href="#在react-native中使用" class="headerlink" title="在react-native中使用"></a>在react-native中使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NativeModules &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="keyword">let</span> toast = NativeModules.ToastNative;</span><br><span class="line">toast.show(<span class="string">'Toast message'</span>,toast.SHORT,(message,count)=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"success"</span>,message,count)&#125;,(message,count)=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"error"</span>,message,count)&#125;)</span><br><span class="line">toast.showMsg(<span class="string">'今晚22:30主播在这里等你'</span>,toast.SHORT);</span><br></pre></td></tr></table></figure>
<p>这里需要注意的是，callback／promise 在执行invoke／（reject、resolve）之后，都会在js的消息队列中被销毁。callback／promise只能用于一次返回，也就是说不能多次调用callback／promise来与react-native的组件进行通信，在一些场景下这种callback／promise的通信方式是不实用的，比如说我们调用android系统api来播放音乐，我们需要监听音乐的播放状态和进度，这里需要原生模块主动与react-native通信而且是多次通信，我们需要采用另一种通信方式，就是emit，有点类似android的广播，发送一条消息给js端，js端注册监听接收这条消息</p>
<h1 id="Android原生调react-native"><a href="#Android原生调react-native" class="headerlink" title="Android原生调react-native"></a>Android原生调react-native</h1><p>以实现播放音乐，监听音乐的播放状态和进度为例，我们需要让android主动向react-native多次发送消息，我们同样需要定义一个ReactContextBaseJavaModule，并且在自定义的组件包MyReactPackage中的createNativeModules方法里注册，跟前面的做法完全一样就不再赘述了，这里我们需要关心的是如何主动发送消息</p>
<h2 id="Android端主动发消息"><a href="#Android端主动发消息" class="headerlink" title="Android端主动发消息"></a>Android端主动发消息</h2><p>reactContext在我们注册ReactContextBaseJavaModule的时候由MyReactPackage中的createNativeModules方法传入，通过reactContext得到当前的JSModule调用它的emit方法，可以传两个参数，一个事件名称和一个WritableMap对象，事件名称需要与react-native注册监听的事件名称参数对应起来，而这个WritableMap对象存放的就是所有需要传递的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendEvent</span><span class="params">(ReactContext reactContext, String eventName, WritableMap map)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"reactContext="</span>+reactContext);</span><br><span class="line">    reactContext</span><br><span class="line">                .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)</span><br><span class="line">                .emit(eventName,map);</span><br><span class="line">&#125;</span><br><span class="line">WritableMap map=Arguments.createMap();</span><br><span class="line">map.putString(<span class="string">"state"</span>,LOADING_MEDIA_SUCCESS);</span><br><span class="line">sendEvent(mContext,PLAY_STATE,map);</span><br></pre></td></tr></table></figure>

<h2 id="react-native注册监听接收消息"><a href="#react-native注册监听接收消息" class="headerlink" title="react-native注册监听接收消息"></a>react-native注册监听接收消息</h2><p>这里我们需要对发送的事件名称注册监听，与发送消息时事件名称的传参保持一致，在回调中处理接收到消息以后的逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.listener = <span class="function">(<span class="params">reminder</span>) =&gt;</span> &#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">'当前状态'</span> + reminder.state);</span><br><span class="line">           <span class="keyword">if</span>(<span class="keyword">this</span>.props.isVisible)&#123;</span><br><span class="line">               <span class="keyword">if</span> (reminder.state === constants.STOP_PLAY_MEDIA || reminder.state === constants.PLAY_EXCEPTION || reminder.state == constants.PLAY_COMPLETE) &#123;</span><br><span class="line">                   <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                       isPlay: <span class="literal">false</span>,</span><br><span class="line">                   &#125;);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">DeviceEventEmitter.addListener(constants.PLAY_STATE, <span class="keyword">this</span>.listener)</span><br></pre></td></tr></table></figure>
<p>如果你在这个回调逻辑中刷新了ui，然而这个页面当前并没绘制，react-native会发出警告，对应的还有取消监听的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DeviceEventEmitter.removeAllListeners(constants.PLAY_STATE);　<span class="comment">//移除该事件所有监听</span></span><br><span class="line">DeviceEventEmitter.removeListener(constants.PLAY_STATE,listener); <span class="comment">//移除该事件的指定监听</span></span><br></pre></td></tr></table></figure>
<p>这里我们需要注意的是一旦调用了DeviceEventEmitter.removeAllListeners方法，影响的不只有当前页面的监听，所有页面的监听都被移除了，移除当前页面的监听是第二个</p>
<h1 id="调原生ui组件"><a href="#调原生ui组件" class="headerlink" title="调原生ui组件"></a>调原生ui组件</h1><p>由于react-native官方提供的滚轮组件可定制性比较低，DatePickerIOS和DatePickerAndroid，调用的都是原生的日期滚轮选择器，也没找到合适的第三方库，无法达到设计的效果，所以采用了自定义原生ui组件的方案，给react-native暴露接口，让react-native调用原生的ui组件，这里我们以自定义日期选择滚轮为例，记录一下react-native调用原生ui组件的过程。</p>
<h2 id="封装组件"><a href="#封装组件" class="headerlink" title="封装组件"></a>封装组件</h2><h3 id="绘制单个滚轮"><a href="#绘制单个滚轮" class="headerlink" title="绘制单个滚轮"></a>绘制单个滚轮</h3><p>常规方式继承View，在onDraw中用canvas直接绘制，监听手势，根据手指滑动的距离对当前滚轮选项进行刷新。注意一下边界判断，当前选择项下标小于0时，选择最后一项，当前项下标大于最后一项下标，选择第一项。手指抬起时滚动到当前选择项的中间位置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WheelView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"WheelView"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动回滚到中间的速度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> SPEED = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 除选中item外，上下各需要显示的备选项数目</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_SIZE = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; itemList;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> itemCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * item高度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> itemHeight = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 选中的位置，这个位置是mDataList的中心位置，一直不变</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentItem;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Paint selectPaint;</span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;</span><br><span class="line">    <span class="comment">// 画背景图中单独的画笔</span></span><br><span class="line">    <span class="keyword">private</span> Paint centerLinePaint;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> centerY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> centerX;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mLastDownY;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 滑动的距离</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mMoveLen = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isInit = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> SelectListener mSelectListener;</span><br><span class="line">    <span class="keyword">private</span> Timer timer;</span><br><span class="line">    <span class="keyword">private</span> MyTimerTask mTask;</span><br><span class="line"></span><br><span class="line">    Handler updateHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (Math.abs(mMoveLen) &lt; SPEED) &#123;</span><br><span class="line">                <span class="comment">// 如果偏移量少于最少偏移量</span></span><br><span class="line">                mMoveLen = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> != timer) &#123;</span><br><span class="line">                    timer.cancel();</span><br><span class="line">                    timer.purge();</span><br><span class="line">                    timer = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (mTask != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mTask.cancel();</span><br><span class="line">                    mTask = <span class="keyword">null</span>;</span><br><span class="line">                    performSelect();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 这里mMoveLen / Math.abs(mMoveLen)是为了保有mMoveLen的正负号，以实现上滚或下滚</span></span><br><span class="line">                mMoveLen = mMoveLen - mMoveLen / Math.abs(mMoveLen) * SPEED;</span><br><span class="line">            &#125;</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WheelView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WheelView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnSelectListener</span><span class="params">(SelectListener listener)</span> </span>&#123;</span><br><span class="line">        mSelectListener = listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWheelStyle</span><span class="params">(<span class="keyword">int</span> style)</span> </span>&#123;</span><br><span class="line">        itemList = WheelStyle.getItemList(context, style);</span><br><span class="line">        <span class="keyword">if</span> (itemList != <span class="keyword">null</span>) &#123;</span><br><span class="line">            itemCount = itemList.size();</span><br><span class="line">            resetCurrentSelect();</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.i(TAG, <span class="string">"item is null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWheelItemList</span><span class="params">(List&lt;String&gt; itemList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.itemList = itemList;</span><br><span class="line">        <span class="keyword">if</span> (itemList != <span class="keyword">null</span>) &#123;</span><br><span class="line">            itemCount = itemList.size();</span><br><span class="line">            resetCurrentSelect();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.i(TAG, <span class="string">"item is null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resetCurrentSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentItem &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            currentItem = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (currentItem &gt;= itemCount) &#123;</span><br><span class="line">            currentItem--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (currentItem &gt;= <span class="number">0</span> &amp;&amp; currentItem &lt; itemCount) &#123;</span><br><span class="line">            invalidate();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.i(TAG, <span class="string">"current item is invalid"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> itemCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 选择选中的item的index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentItem</span><span class="params">(String selected)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;itemList.size();i++)&#123;</span><br><span class="line">            String item=itemList.get(i);</span><br><span class="line">            <span class="keyword">if</span>(item.equals(selected))&#123;</span><br><span class="line">                currentItem = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        resetCurrentSelect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCurrentItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> currentItem;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> mViewHeight = getMeasuredHeight();</span><br><span class="line">        <span class="keyword">int</span> mViewWidth = getMeasuredWidth();</span><br><span class="line">        centerX = (<span class="keyword">float</span>) (mViewWidth / <span class="number">2.0</span>);</span><br><span class="line">        centerY = (<span class="keyword">float</span>) (mViewHeight / <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line">        isInit = <span class="keyword">true</span>;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line"></span><br><span class="line">        timer = <span class="keyword">new</span> Timer();</span><br><span class="line">        itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mPaint.setStyle(Style.FILL);</span><br><span class="line">        mPaint.setTextAlign(Align.CENTER);</span><br><span class="line">        mPaint.setColor(getResources().getColor(R.color.wheel_unselect_text));</span><br><span class="line">        mPaint.setTextSize(SizeConvertUtil.spTopx(context, <span class="number">15</span>));</span><br><span class="line"></span><br><span class="line">        selectPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        selectPaint.setStyle(Style.FILL);</span><br><span class="line">        selectPaint.setTextAlign(Align.CENTER);</span><br><span class="line">        selectPaint.setColor(getResources().getColor(R.color.wheel_select));</span><br><span class="line">        selectPaint.setTextSize(SizeConvertUtil.spTopx(context, <span class="number">17</span>));</span><br><span class="line"></span><br><span class="line">        centerLinePaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        centerLinePaint.setStyle(Style.FILL);</span><br><span class="line">        centerLinePaint.setTextAlign(Align.CENTER);</span><br><span class="line">        centerLinePaint.setColor(getResources().getColor(R.color.wheel_unselect_text));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="keyword">if</span> (isInit) &#123;</span><br><span class="line">            drawData(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawData</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先绘制选中的text再往上往下绘制其余的text</span></span><br><span class="line">        <span class="keyword">if</span> (!itemList.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 绘制中间data</span></span><br><span class="line">            drawCenterText(canvas);</span><br><span class="line">            <span class="comment">// 绘制上方data</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SHOW_SIZE + <span class="number">1</span>; i++) &#123;</span><br><span class="line">                drawOtherText(canvas, i, -<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 绘制下方data</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SHOW_SIZE + <span class="number">1</span>; i++) &#123;</span><br><span class="line">                drawOtherText(canvas, i, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawCenterText</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// text居中绘制，注意baseline的计算才能达到居中，y值是text中心坐标</span></span><br><span class="line">        <span class="keyword">float</span> y = centerY + mMoveLen;</span><br><span class="line">        FontMetricsInt fmi = selectPaint.getFontMetricsInt();</span><br><span class="line">        <span class="keyword">float</span> baseline = (<span class="keyword">float</span>) (y - (fmi.bottom / <span class="number">2.0</span> + fmi.top / <span class="number">2.0</span>));</span><br><span class="line">        canvas.drawText(itemList.get(currentItem), centerX, baseline, selectPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> canvas   画布</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> position 距离mCurrentSelected的差值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     1表示向下绘制，-1表示向上绘制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawOtherText</span><span class="params">(Canvas canvas, <span class="keyword">int</span> position, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = currentItem + type * position;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= itemCount) &#123;</span><br><span class="line">            index = index - itemCount;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            index = index + itemCount;</span><br><span class="line">        &#125;</span><br><span class="line">        String text = itemList.get(index);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> itemHeight = getHeight() / (SHOW_SIZE * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">float</span> d = itemHeight * position + type * mMoveLen;</span><br><span class="line">        <span class="keyword">float</span> y = centerY + type * d;</span><br><span class="line"></span><br><span class="line">        FontMetricsInt fmi = mPaint.getFontMetricsInt();</span><br><span class="line">        <span class="keyword">float</span> baseline = (<span class="keyword">float</span>) (y - (fmi.bottom / <span class="number">2.0</span> + fmi.top / <span class="number">2.0</span>));</span><br><span class="line">        canvas.drawText(text, centerX, baseline, mPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlpha</span><span class="params">(<span class="keyword">int</span> alpha)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColorFilter</span><span class="params">(ColorFilter cf)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOpacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">super</span>.setBackground(background);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getActionMasked()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                doDown(event);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                doMove(event);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                doUp();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doDown</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mTask != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mTask.cancel();</span><br><span class="line">            mTask = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mLastDownY = event.getY();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doMove</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        mMoveLen += (event.getY() - mLastDownY);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mMoveLen &gt; itemHeight / <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">// 往下滑超过离开距离</span></span><br><span class="line">            mMoveLen = mMoveLen - itemHeight;</span><br><span class="line">            currentItem--;</span><br><span class="line">            <span class="keyword">if</span> (currentItem &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                currentItem = itemCount - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mMoveLen &lt; -itemHeight / <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">// 往上滑超过离开距离</span></span><br><span class="line">            mMoveLen = mMoveLen + itemHeight;</span><br><span class="line">            currentItem++;</span><br><span class="line">            <span class="keyword">if</span> (currentItem &gt;= itemCount) &#123;</span><br><span class="line">                currentItem = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mLastDownY = event.getY();</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 抬起手后mCurrentSelected的位置由当前位置move到中间选中位置</span></span><br><span class="line">        <span class="keyword">if</span> (Math.abs(mMoveLen) &lt; <span class="number">0.0001</span>) &#123;</span><br><span class="line">            mMoveLen = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mTask != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mTask.cancel();</span><br><span class="line">            mTask = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == timer) &#123;</span><br><span class="line">            timer = <span class="keyword">new</span> Timer();</span><br><span class="line">        &#125;</span><br><span class="line">        mTask = <span class="keyword">new</span> MyTimerTask(updateHandler);</span><br><span class="line">        timer.schedule(mTask, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyTimerTask</span> <span class="keyword">extends</span> <span class="title">TimerTask</span> </span>&#123;</span><br><span class="line">        Handler handler;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyTimerTask</span><span class="params">(Handler handler)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.handler = handler;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            handler.sendMessage(handler.obtainMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">performSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mSelectListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mSelectListener.onSelect(currentItem, itemList.get(currentItem));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.i(TAG, <span class="string">"null listener"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SelectListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onSelect</span><span class="params">(<span class="keyword">int</span> index, String text)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生成日期数据源"><a href="#生成日期数据源" class="headerlink" title="生成日期数据源"></a>生成日期数据源</h3><p>封装一个工具类用于生成日期滚轮选择器的数据源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WheelStyle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> minYear = <span class="number">1980</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> maxYear = <span class="number">2020</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Wheel Style Hour</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_HOUR = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Wheel Style Minute</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_MINUTE = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Wheel Style Year</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_YEAR = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Wheel Style Month</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_MONTH = <span class="number">4</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Wheel Style Day</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_DAY = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Wheel Style Light Time</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_LIGHT_TIME = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">WheelStyle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getItemList</span><span class="params">(Context context, <span class="keyword">int</span> Style)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Style == STYLE_HOUR) &#123;</span><br><span class="line">            <span class="keyword">return</span> createHourString();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_MINUTE) &#123;</span><br><span class="line">            <span class="keyword">return</span> createMinuteString();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_YEAR) &#123;</span><br><span class="line">            <span class="keyword">return</span> createYearString();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_MONTH) &#123;</span><br><span class="line">            <span class="keyword">return</span> createMonthString();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_DAY) &#123;</span><br><span class="line">            <span class="keyword">return</span> createDayString();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_LIGHT_TIME) &#123;</span><br><span class="line">            <span class="keyword">return</span> createWeekString(context);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"style is illegal"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createHourString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</span><br><span class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wheelString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createMinuteString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">60</span>; i++) &#123;</span><br><span class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wheelString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createYearString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = minYear; i &lt;= maxYear; i++) &#123;</span><br><span class="line">            wheelString.add(Integer.toString(i)+<span class="string">'年'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wheelString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createMonthString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++) &#123;</span><br><span class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i)+<span class="string">'月'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wheelString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createDayString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">31</span>; i++) &#123;</span><br><span class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wheelString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createWeekString</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        String[] timeString = context.getResources().getStringArray(R.array.weeks);</span><br><span class="line">        <span class="keyword">for</span> (String week : timeString) &#123;</span><br><span class="line">            wheelString.add(week);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wheelString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createDayString</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> size;</span><br><span class="line">        <span class="keyword">if</span> (isLeapMonth(month)) &#123;</span><br><span class="line">            size = <span class="number">31</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (month == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isLeapYear(year)) &#123;</span><br><span class="line">                size = <span class="number">29</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                size = <span class="number">28</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            size = <span class="number">30</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= size; i++) &#123;</span><br><span class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wheelString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算闰月</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> month</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isLeapMonth</span><span class="params">(<span class="keyword">int</span> month)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> month == <span class="number">1</span> || month == <span class="number">3</span> || month == <span class="number">5</span> || month == <span class="number">7</span></span><br><span class="line">                || month == <span class="number">8</span> || month == <span class="number">10</span> || month == <span class="number">12</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算闰年</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> year</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isLeapYear</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (year % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; year % <span class="number">100</span> != <span class="number">0</span>) || year % <span class="number">400</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义LinearLayout绘制整个滚轮视图"><a href="#自定义LinearLayout绘制整个滚轮视图" class="headerlink" title="自定义LinearLayout绘制整个滚轮视图"></a>自定义LinearLayout绘制整个滚轮视图</h3><p>由2个滚轮组成的滚轮视图</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PickDateView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"PickDateView原生Tag"</span>;</span><br><span class="line">    CallBack callBack;</span><br><span class="line">    WheelView yearWheel;</span><br><span class="line">    WheelView monthWheel;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CallBack</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">changeYear</span><span class="params">(<span class="keyword">int</span> year)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">changeMonth</span><span class="params">(<span class="keyword">int</span> month)</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onSure</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">long</span> time)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallBack</span><span class="params">(CallBack callBack)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.callBack = callBack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickDateView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">       addCustomLayout(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setYear</span><span class="params">(String year)</span></span>&#123;</span><br><span class="line">        yearWheel.setCurrentItem(year);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMonth</span><span class="params">(String month)</span></span>&#123;</span><br><span class="line">        monthWheel.setCurrentItem(month);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addCustomLayout</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">        LayoutInflater mInflater = LayoutInflater.from(context);</span><br><span class="line">        View contentView = mInflater.inflate(R.layout.wheel_select_date, <span class="keyword">null</span>);</span><br><span class="line">        yearWheel = (WheelView) contentView.findViewById(R.id.select_date_wheel_year_wheel);</span><br><span class="line">        monthWheel = (WheelView) contentView.findViewById(R.id.select_date_month_wheel);</span><br><span class="line"></span><br><span class="line">        yearWheel.setWheelStyle(WheelStyle.STYLE_YEAR);</span><br><span class="line">        yearWheel.setOnSelectListener(<span class="keyword">new</span> WheelView.SelectListener() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSelect</span><span class="params">(<span class="keyword">int</span> index, String text)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> selectYear = index + WheelStyle.minYear;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (callBack != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    callBack.changeYear(selectYear);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        monthWheel.setWheelStyle(WheelStyle.STYLE_MONTH);</span><br><span class="line">        monthWheel.setOnSelectListener(<span class="keyword">new</span> WheelView.SelectListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSelect</span><span class="params">(<span class="keyword">int</span> index, String text)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> selectMonth = index + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (callBack != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    callBack.changeMonth(selectMonth);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Button sureBt = (Button) contentView.findViewById(R.id.select_date_sure);</span><br><span class="line">        sureBt.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> year = yearWheel.getCurrentItem() + WheelStyle.minYear;</span><br><span class="line">                <span class="keyword">int</span> month = monthWheel.getCurrentItem();</span><br><span class="line"></span><br><span class="line">                Calendar calendar = Calendar.getInstance();</span><br><span class="line">                calendar.set(Calendar.YEAR, year);</span><br><span class="line">                calendar.set(Calendar.MONTH, month);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">long</span> setTime = calendar.getTimeInMillis();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (callBack != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    callBack.onSure(year, month, setTime);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        addView(contentView);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="给react-native暴露接口"><a href="#给react-native暴露接口" class="headerlink" title="给react-native暴露接口"></a>给react-native暴露接口</h3><p>自定义ViewManager，继承SimpleViewManager设置需要暴露的ui组件类PickDateView，重写实例化方法createViewInstance在方法内实例化ui组件类，同时在回调被调用时通知js端，发送事件消息，也是通过WritableMap传递参数列表，用<code>@ReactProp</code>注解标注的方法在react-native中作为属性传入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PickDateViewManager</span> <span class="keyword">extends</span> <span class="title">SimpleViewManager</span>&lt;<span class="title">PickDateView</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REACT_CLASS = <span class="string">"PickDateView"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"PickDateViewManger原生Tag"</span>;</span><br><span class="line">    <span class="keyword">private</span> PickDateView pickDateView;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> REACT_CLASS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> PickDateView <span class="title">createViewInstance</span><span class="params">(<span class="keyword">final</span> ThemedReactContext reactContext)</span> </span>&#123;</span><br><span class="line">        pickDateView=<span class="keyword">new</span> PickDateView(reactContext);</span><br><span class="line">        pickDateView.setCallBack(<span class="keyword">new</span> PickDateView.CallBack() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeYear</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">                WritableMap map = Arguments.createMap();</span><br><span class="line">                map.putInt(<span class="string">"target"</span>, pickDateView.getId());</span><br><span class="line">                map.putString(<span class="string">"msg"</span>, <span class="string">"year: "</span> + year);</span><br><span class="line">                reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(</span><br><span class="line">                        pickDateView.getId(), <span class="string">"topChange"</span>, map</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeMonth</span><span class="params">(<span class="keyword">int</span> month)</span> </span>&#123;</span><br><span class="line">                WritableMap map = Arguments.createMap();</span><br><span class="line">                map.putInt(<span class="string">"target"</span>, pickDateView.getId());</span><br><span class="line">                map.putString(<span class="string">"msg"</span>, <span class="string">"month: "</span> + month);</span><br><span class="line">                reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(</span><br><span class="line">                        pickDateView.getId(), <span class="string">"topChange"</span>, map</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSure</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">                WritableMap map = Arguments.createMap();</span><br><span class="line">                map.putInt(<span class="string">"target"</span>, pickDateView.getId());</span><br><span class="line"></span><br><span class="line">                WritableMap params=Arguments.createMap();</span><br><span class="line">                params.putInt(<span class="string">"year"</span>,year);</span><br><span class="line">                params.putInt(<span class="string">"month"</span>,month);</span><br><span class="line">                params.putString(<span class="string">"time"</span>,time+<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//                String paramsStr=jsonEnclose(params).toString();</span></span><br><span class="line">                map.putMap(<span class="string">"msg"</span>, params);</span><br><span class="line">                reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(</span><br><span class="line">                        pickDateView.getId(), <span class="string">"topChange"</span>, map</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> pickDateView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReactProp</span>(name = <span class="string">"setYear"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setYear</span><span class="params">(PickDateView pickDateView,String year)</span> </span>&#123;</span><br><span class="line">        pickDateView.setYear(year);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReactProp</span>(name = <span class="string">"setMonth"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMonth</span><span class="params">(PickDateView pickDateView,String month)</span> </span>&#123;</span><br><span class="line">        pickDateView.setMonth(month);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注册自定义的ViewManager"><a href="#注册自定义的ViewManager" class="headerlink" title="注册自定义的ViewManager"></a>注册自定义的ViewManager</h3><p>同样需要在自定义的组件包MyReactPackage的createViewManagers方法中注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReactPackage</span> <span class="keyword">implements</span> <span class="title">ReactPackage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引入原生的view</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> reactContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ViewManager&gt; <span class="title">createViewManagers</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</span><br><span class="line">        List&lt;ViewManager&gt; viewManagers=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        viewManagers.add(<span class="keyword">new</span> PickDateViewManager());</span><br><span class="line">        viewManagers.add(<span class="keyword">new</span> ShowPlayViewManager());</span><br><span class="line">        <span class="keyword">return</span> viewManagers;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="在react-native中使用-1"><a href="#在react-native中使用-1" class="headerlink" title="在react-native中使用"></a>在react-native中使用</h3><h4 id="在react-native中声明原生组件"><a href="#在react-native中声明原生组件" class="headerlink" title="在react-native中声明原生组件"></a>在react-native中声明原生组件</h4><p>定义原生中也声明了的组件属性和统一接收回调消息的onChange方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;requireNativeComponent, View&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iface = &#123;</span><br><span class="line">    name: <span class="string">'PickDateView'</span>,</span><br><span class="line">    propTypes: &#123;</span><br><span class="line">        setYear: PropTypes.string,</span><br><span class="line">        setMonth: PropTypes.string,</span><br><span class="line">        <span class="comment">//回调</span></span><br><span class="line">        onChange: PropTypes.func,</span><br><span class="line">        ...View.propTypes  <span class="comment">//支持View组件的所有属性</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> RCTPickDateView = requireNativeComponent(<span class="string">'PickDateView'</span>, iface);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RCTPickDateView;</span><br></pre></td></tr></table></figure>
<h4 id="在react-native中使用原生组件"><a href="#在react-native中使用原生组件" class="headerlink" title="在react-native中使用原生组件"></a>在react-native中使用原生组件</h4><p>绘制一个弹窗，弹窗内部使用原生的日期滚轮选择器，在弹窗弹出时加入一个展开动画，在onChange方法中接收参数obj.nativeEvent.参数名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    AppRegistry,</span><br><span class="line">    StyleSheet,</span><br><span class="line">    Text,</span><br><span class="line">    View,</span><br><span class="line">    Modal,</span><br><span class="line">    Animated,</span><br><span class="line">    TouchableOpacity</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="keyword">import</span> PickDateView <span class="keyword">from</span> <span class="string">'../view/PickDate'</span>;</span><br><span class="line"><span class="keyword">import</span> constants <span class="keyword">from</span> <span class="string">'../Constants'</span>;</span><br><span class="line"><span class="keyword">let</span> &#123;width, height&#125; = constants.ScreenWH;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PullPickDate</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.onLayout=<span class="keyword">this</span>.onLayout.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.state=&#123;</span><br><span class="line">            expanded: <span class="literal">false</span>,</span><br><span class="line">            animation : <span class="keyword">new</span> Animated.Value()</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    showAnimation(height)&#123;</span><br><span class="line">        <span class="keyword">let</span> maxHeight=height;</span><br><span class="line">        <span class="keyword">let</span> minHeight=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> initialValue = <span class="keyword">this</span>.state.expanded ? maxHeight + minHeight : minHeight,</span><br><span class="line">            finalValue= <span class="keyword">this</span>.state.expanded ? minHeight : maxHeight + minHeight;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            expanded: !<span class="keyword">this</span>.state.expanded <span class="comment">//Step 2</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'最大高度'</span>+maxHeight);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'初始值'</span>+initialValue+<span class="string">'最终值'</span>+finalValue);</span><br><span class="line">        <span class="keyword">this</span>.state.animation.setValue(initialValue); <span class="comment">//Step 3</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.timer = setTimeout(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">                <span class="keyword">this</span>.toggle(finalValue);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="number">5000</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    toggle(finalValue) &#123;</span><br><span class="line">        Animated.spring(</span><br><span class="line">            <span class="keyword">this</span>.state.animation,</span><br><span class="line">            &#123;</span><br><span class="line">                toValue: finalValue</span><br><span class="line">            &#125;</span><br><span class="line">        ).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Modal</span><br><span class="line">                animationType=&#123;<span class="string">'none'</span>&#125;</span><br><span class="line">                transparent=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">                visible=&#123;<span class="keyword">this</span>.props.onShow&#125;</span><br><span class="line">                onRequestClose=&#123;() =&gt; &#123;</span><br><span class="line">                    <span class="keyword">this</span>.props.onCancel();</span><br><span class="line">                &#125;&#125;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;View style=&#123;&#123;<span class="attr">width</span>: width, <span class="attr">flex</span>: <span class="number">1</span>, <span class="attr">marginTop</span>: height * <span class="number">0.08</span> + <span class="number">0.12</span> * width,<span class="attr">backgroundColor</span>: <span class="string">'rgba(0, 0, 0, 0.7)'</span>&#125;&#125;&gt;</span><br><span class="line">                    &lt;PickDateView</span><br><span class="line">                        setYear=&#123;<span class="keyword">this</span>.props.year&#125;</span><br><span class="line">                        setMonth=&#123;<span class="keyword">this</span>.props.month&#125;</span><br><span class="line">                        onLayout=&#123;<span class="keyword">this</span>.onLayout&#125;</span><br><span class="line">                        onChange=&#123;(obj) =&gt; &#123;</span><br><span class="line">                            <span class="built_in">console</span>.log(<span class="string">'onSure收到事件'</span> + obj.nativeEvent.msg + <span class="string">"目标id"</span> + obj.nativeEvent.msg.year);</span><br><span class="line">                            <span class="comment">//当此回调被onSure调用时</span></span><br><span class="line">                            <span class="keyword">let</span> year = obj.nativeEvent.msg.year + <span class="string">''</span>;</span><br><span class="line">                            <span class="keyword">let</span> month = obj.nativeEvent.msg.month + <span class="string">''</span>;</span><br><span class="line">                            <span class="keyword">let</span> time= obj.nativeEvent.msg.time + <span class="string">''</span>;</span><br><span class="line">                            <span class="keyword">if</span> (year !== <span class="string">'undefined'</span> &amp;&amp; month !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">                                <span class="keyword">this</span>.props.onCancel();</span><br><span class="line">                            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                <span class="keyword">this</span>.props.onSure(year,month,time);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;&#125;</span><br><span class="line">                        style=&#123;&#123;<span class="attr">width</span>: <span class="string">'100%'</span>, <span class="attr">flex</span>: <span class="number">0.42</span>,&#125;&#125;/&gt;</span><br><span class="line">                    &lt;TouchableOpacity style=&#123;&#123;<span class="attr">flex</span>:<span class="number">0.58</span>&#125;&#125; onPress=&#123;() =&gt; <span class="keyword">this</span>.props.onCancel()&#125;/&gt;</span><br><span class="line">                &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Modal&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onLayout(event)&#123;</span><br><span class="line">        <span class="keyword">this</span>.showAnimation(event.nativeEvent.layout.height);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> PullPickDate;</span><br></pre></td></tr></table></figure>




    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/open-source-project/" rel="tag"># open source project</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2018/07/09/RN-NumberScroll/" rel="next" title="react-native 实现数字滚动动画">
                  <i class="fa fa-chevron-left"></i> react-native 实现数字滚动动画
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2018/08/25/PuppeteerStart/" rel="prev" title="nodejs爬虫-puppeteer入门">
                  nodejs爬虫-puppeteer入门 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#调用原生模块"><span class="nav-number">1.</span> <span class="nav-text">调用原生模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#调用原生的场景"><span class="nav-number">1.1.</span> <span class="nav-text">调用原生的场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-native调用android原生"><span class="nav-number">1.2.</span> <span class="nav-text">react-native调用android原生</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#先定义一个ReactContextBaseJavaModule"><span class="nav-number">1.2.1.</span> <span class="nav-text">先定义一个ReactContextBaseJavaModule</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册ReactContextBaseJavaModule"><span class="nav-number">1.2.2.</span> <span class="nav-text">注册ReactContextBaseJavaModule</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在react-native工程结构下添加自定义的ReactPackage"><span class="nav-number">1.2.3.</span> <span class="nav-text">在react-native工程结构下添加自定义的ReactPackage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在android-studio工程结构下添加自定义的ReactPackage"><span class="nav-number">1.2.4.</span> <span class="nav-text">在android studio工程结构下添加自定义的ReactPackage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在react-native中使用"><span class="nav-number">1.2.5.</span> <span class="nav-text">在react-native中使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android原生调react-native"><span class="nav-number">2.</span> <span class="nav-text">Android原生调react-native</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Android端主动发消息"><span class="nav-number">2.1.</span> <span class="nav-text">Android端主动发消息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-native注册监听接收消息"><span class="nav-number">2.2.</span> <span class="nav-text">react-native注册监听接收消息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#调原生ui组件"><span class="nav-number">3.</span> <span class="nav-text">调原生ui组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#封装组件"><span class="nav-number">3.1.</span> <span class="nav-text">封装组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#绘制单个滚轮"><span class="nav-number">3.1.1.</span> <span class="nav-text">绘制单个滚轮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成日期数据源"><span class="nav-number">3.1.2.</span> <span class="nav-text">生成日期数据源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义LinearLayout绘制整个滚轮视图"><span class="nav-number">3.1.3.</span> <span class="nav-text">自定义LinearLayout绘制整个滚轮视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#给react-native暴露接口"><span class="nav-number">3.1.4.</span> <span class="nav-text">给react-native暴露接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册自定义的ViewManager"><span class="nav-number">3.1.5.</span> <span class="nav-text">注册自定义的ViewManager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在react-native中使用-1"><span class="nav-number">3.1.6.</span> <span class="nav-text">在react-native中使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在react-native中声明原生组件"><span class="nav-number">3.1.6.1.</span> <span class="nav-text">在react-native中声明原生组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在react-native中使用原生组件"><span class="nav-number">3.1.6.2.</span> <span class="nav-text">在react-native中使用原生组件</span></a></li></ol></li></ol></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jessie Kate</p>
  <div class="site-description" itemprop="description">程序的世界，比你牛逼的人更比你努力。<br /> hello，I'm an Android developer～ <br /> My hobbies tag &#58; <br /> - Coding  <br /> - Sports   <br /> - Game</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jessie Kate</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">
      
    Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.1
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>
<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'aedb4031c50b7b9201d6',
      clientSecret: 'f77b152663ed74c8570f87e2483c2eb12cdd252c',
      repo: 'jessieeeee.github.io',
      owner: 'jessieeeee',
      admin: ['jessieeeee'],
      id: 'a3dce02e5b4f8d746f46611863e123f4',
        language: window.navigator.language || window.navigator.userLanguage,
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
