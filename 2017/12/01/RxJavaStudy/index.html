<!DOCTYPE html>





<html lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="RxJava 的异步实现，是通过一种扩展的观察者模式来实现的。免除了业务逻辑代码的频繁回调，增加了逻辑代码的可读性。 观察者模式：A 对象（观察者）对 B 对象（被观察者）的某种变化高度敏感，需要在 B 变化的一瞬间做出反应。观察者不需要时刻盯着被观察者（例如 A 不需要每过 2ms 就检查一次 B 的状态），而是采用注册(Register)或者称为订阅(Subscribe)的方式  观察者接口定">
<meta name="keywords" content="RxJava">
<meta property="og:type" content="article">
<meta property="og:title" content="RxJava学习">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2017&#x2F;12&#x2F;01&#x2F;RxJavaStudy&#x2F;index.html">
<meta property="og:site_name" content="JessieK&#39;s blog">
<meta property="og:description" content="RxJava 的异步实现，是通过一种扩展的观察者模式来实现的。免除了业务逻辑代码的频繁回调，增加了逻辑代码的可读性。 观察者模式：A 对象（观察者）对 B 对象（被观察者）的某种变化高度敏感，需要在 B 变化的一瞬间做出反应。观察者不需要时刻盯着被观察者（例如 A 不需要每过 2ms 就检查一次 B 的状态），而是采用注册(Register)或者称为订阅(Subscribe)的方式  观察者接口定">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2021-05-23T09:30:07.000Z">
<meta name="twitter:card" content="summary">
  <link rel="canonical" href="http://yoursite.com/2017/12/01/RxJavaStudy/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>RxJava学习 | JessieK's blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JessieK's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">My Technical sharing</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      
    
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/01/RxJavaStudy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="程序的世界，比你牛逼的人更比你努力。<br /> hello，I'm an Android developer～ <br /> My hobbies tag &#58; <br /> - Coding  <br /> - Sports   <br /> - Game">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            RxJava学习
            

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2017-12-01 20:07:55" itemprop="dateCreated datePublished" datetime="2017-12-01T20:07:55+08:00">2017-12-01</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-23 17:30:07" itemprop="dateModified" datetime="2021-05-23T17:30:07+08:00">2021-05-23</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>RxJava 的异步实现，是通过一种扩展的观察者模式来实现的。免除了业务逻辑代码的频繁回调，增加了逻辑代码的可读性。</p>
<h2 id="观察者模式："><a href="#观察者模式：" class="headerlink" title="观察者模式："></a>观察者模式：</h2><p>A 对象（观察者）对 B 对象（被观察者）的某种变化高度敏感，需要在 B 变化的一瞬间做出反应。<br>观察者不需要时刻盯着被观察者（例如 A 不需要每过 2ms 就检查一次 B 的状态），而是采用注册(Register)或者称为订阅(Subscribe)的方式</p>
<ul>
<li>观察者接口定义<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Object value)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>观察者实现<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>,name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object value)</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.message = (String) value;</span><br><span class="line">         readMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(name + <span class="string">"收到推送消息"</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>被观察者接口定义<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushMessage</span><span class="params">(String message)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>被观察者实现<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatServerObservable</span> <span class="keyword">implements</span> <span class="title">Observable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> ArrayList&lt;&gt;(); <span class="comment">// 缓存多个观察者</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">         observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer observer)</span></span>&#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>&#123;</span><br><span class="line">         <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">              observer.update(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>,message = message;</span><br><span class="line">         notifyObservers();</span><br><span class="line">        System.out.println(name + <span class="string">"发送推送消息"</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>使用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个被观察者，微信服务</span></span><br><span class="line">Observable observable =<span class="keyword">new</span> WeChatServerObservable();</span><br><span class="line"><span class="comment">//创建多个观察者，用户</span></span><br><span class="line">Observer user1 =<span class="keyword">new</span> UserPerson(<span class="string">"小方"</span>);</span><br><span class="line">Observer user2 =<span class="keyword">new</span> UserPerson(<span class="string">"小明"</span>);</span><br><span class="line">observable.addObserver(user1);</span><br><span class="line">observable.addObserver(user2);</span><br><span class="line"><span class="comment">//推送消息</span></span><br><span class="line">observable.pushMessage(<span class="string">"开始抢票！"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="RxJava-基本概念："><a href="#RxJava-基本概念：" class="headerlink" title="RxJava 基本概念："></a>RxJava 基本概念：</h2>Observable (可观察者，即被观察者)也称作上游<br>Observer (观察者)也称作下游<br>subscribe (订阅)、事件<br>Observable 和 Observer 通过 subscribe() 方法实现订阅关系，从而 Observable 可以在需要的时候发出事件来通知 Observer。</li>
</ul>
<p>与传统观察者模式不同， RxJava 的事件回调方法除了普通事件 onNext() （相当于 onClick() / onEvent()）之外，还定义了两个特殊的事件：onCompleted() 和 onError()。</p>
<p>onCompleted(): 事件队列完结。RxJava 不仅把每个事件单独处理，还会把它们看做一个队列。RxJava 规定，当不会再有新的 onNext() 发出时，需要触发 onCompleted() 方法作为标志。<br>onError(): 事件队列异常。在事件处理过程中出异常时，onError() 会被触发，同时队列自动终止，不允许再有事件发出。<br>在一个正确运行的事件序列中, onCompleted() 和 onError() 有且只有一个，并且是事件序列中的最后一个。需要注意的是，onCompleted() 和 onError() 二者也是互斥的，即在队列中调用了其中一个，就不应该再调用另一个。</p>
<p>对于Android本身有一套现成的框架，复杂的逻辑操作在服务端较多，客户端出现的场景较少，长时间不怎么使用，很容易让人忘记那些理论知识，所以根据一些实战例子来进行学习效果更佳。</p>
<h2 id="map操作符"><a href="#map操作符" class="headerlink" title="map操作符"></a>map操作符</h2><p>常用于数据列表类型转换<br>上游读取数据源并发送到下游，Utils.getApiUserList()模拟从服务端获得的dto类型为ApiUser的数据列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Observable&lt;List&lt;ApiUser&gt;&gt; getObservable() &#123;</span><br><span class="line">    <span class="keyword">return</span> Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;List&lt;ApiUser&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;List&lt;ApiUser&gt;&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">//上游未被切断</span></span><br><span class="line">            <span class="keyword">if</span> (!e.isDisposed()) &#123;</span><br><span class="line">                <span class="comment">//发送到下游,执行下游对应逻辑</span></span><br><span class="line">                e.onNext(Utils.getApiUserList());</span><br><span class="line">                <span class="comment">//上游发送完毕，执行下游对应逻辑</span></span><br><span class="line">                e.onComplete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;ApiUser&gt; <span class="title">getApiUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;ApiUser&gt; apiUserList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    ApiUser apiUserOne = <span class="keyword">new</span> ApiUser();</span><br><span class="line">    apiUserOne.firstname = <span class="string">"Amit"</span>;</span><br><span class="line">    apiUserOne.lastname = <span class="string">"Shekhar"</span>;</span><br><span class="line">    apiUserList.add(apiUserOne);</span><br><span class="line"></span><br><span class="line">    ApiUser apiUserTwo = <span class="keyword">new</span> ApiUser();</span><br><span class="line">    apiUserTwo.firstname = <span class="string">"Manish"</span>;</span><br><span class="line">    apiUserTwo.lastname = <span class="string">"Kumar"</span>;</span><br><span class="line">    apiUserList.add(apiUserTwo);</span><br><span class="line"></span><br><span class="line">    ApiUser apiUserThree = <span class="keyword">new</span> ApiUser();</span><br><span class="line">    apiUserThree.firstname = <span class="string">"Sumit"</span>;</span><br><span class="line">    apiUserThree.lastname = <span class="string">"Kumar"</span>;</span><br><span class="line">    apiUserList.add(apiUserThree);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> apiUserList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>建立订阅关系，通过map操作符将ApiUser类型的dto转化成User类型的dto，再执行下游的处理逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//上游处理逻辑</span></span><br><span class="line">    getObservable()</span><br><span class="line">            .map(<span class="keyword">new</span> Function&lt;List&lt;ApiUser&gt;, List&lt;User&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">apply</span><span class="params">(List&lt;ApiUser&gt; apiUsers)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">//转化操作</span></span><br><span class="line">                    <span class="keyword">return</span> Utils.convertApiUserListToUserList(apiUsers);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 在子线程中运行</span></span><br><span class="line">            .subscribeOn(Schedulers.io())</span><br><span class="line">            <span class="comment">// 切换到主线程</span></span><br><span class="line">            .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">            <span class="comment">// 下游处理逻辑</span></span><br><span class="line">            .subscribe(getObserver());</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; <span class="title">convertApiUserListToUserList</span><span class="params">(List&lt;ApiUser&gt; apiUserList)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ApiUser apiUser : apiUserList) &#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.firstname = apiUser.firstname;</span><br><span class="line">        user.lastname = apiUser.lastname;</span><br><span class="line">        userList.add(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下游获取到数据源，进行数据打印：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Observer&lt;List&lt;User&gt;&gt; getObserver() &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Observer&lt;List&lt;User&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">               Log.d(TAG, <span class="string">" onSubscribe : "</span> + d.isDisposed());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(List&lt;User&gt; userList)</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onNext"</span>);</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">                   textView.append(<span class="string">" firstname : "</span> + user.firstname);</span><br><span class="line">                   textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               &#125;</span><br><span class="line">               Log.d(TAG, <span class="string">" onNext : "</span> + userList.size());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onComplete"</span>);</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onComplete"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="flatMap操作符"><a href="#flatMap操作符" class="headerlink" title="flatMap操作符"></a>flatMap操作符</h2><p>常用于遍历数据列表，按条件进行过滤<br>与它相同的是concatMap，但是flatMap可能会乱序，concatMap可保证下游的获取到的数据源与上游发送顺序一致<br>此处上游数据源与map操作符相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">getObservable()</span><br><span class="line">               .subscribeOn(Schedulers.io())</span><br><span class="line">               .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">               .flatMap(<span class="keyword">new</span> Function&lt;List&lt;ApiUser&gt;, ObservableSource&lt;ApiUser&gt;&gt;() &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="function"><span class="keyword">public</span> ObservableSource&lt;ApiUser&gt; <span class="title">apply</span><span class="params">(List&lt;ApiUser&gt; apiUsers)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                       <span class="keyword">return</span> Observable.fromIterable(apiUsers);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">               .filter(<span class="keyword">new</span> Predicate&lt;ApiUser&gt;() &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(ApiUser apiUser)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                       <span class="keyword">return</span> apiUser.lastname.substring(<span class="number">0</span>,<span class="number">1</span>).equals(<span class="string">"K"</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">               .subscribe(getObserver());</span><br></pre></td></tr></table></figure>
<p>下游获取到数据源，进行数据打印：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Observer&lt;ApiUser&gt; <span class="title">getObserver</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Observer&lt;ApiUser&gt;() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(ApiUser apiUser)</span> </span>&#123;</span><br><span class="line">               Log.d(TAG, <span class="string">"user : "</span> + apiUser.toString());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="zip操作符"><a href="#zip操作符" class="headerlink" title="zip操作符"></a>zip操作符</h2><p>常用于对两个数据源列表进行处理，并返回一个结果数据列表<br>上游读取两个数据源并发送到下游：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Observable&lt;List&lt;User&gt;&gt; getCricketFansObservable() &#123;</span><br><span class="line">      <span class="keyword">return</span> Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;List&lt;User&gt;&gt;() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;List&lt;User&gt;&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">              <span class="comment">//上游未被切断</span></span><br><span class="line">              <span class="keyword">if</span> (!e.isDisposed()) &#123;</span><br><span class="line">                  <span class="comment">//发送到下游,执行下游对应逻辑</span></span><br><span class="line">                  e.onNext(Utils.getUserListWhoLovesCricket());</span><br><span class="line">                  <span class="comment">//上游发送完毕，执行下游对应逻辑</span></span><br><span class="line">                  e.onComplete();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Observable&lt;List&lt;User&gt;&gt; getFootballFansObservable() &#123;</span><br><span class="line">      <span class="keyword">return</span> Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;List&lt;User&gt;&gt;() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;List&lt;User&gt;&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">              <span class="comment">//上游未被切断</span></span><br><span class="line">              <span class="keyword">if</span> (!e.isDisposed()) &#123;</span><br><span class="line">                  <span class="comment">//发送到下游,执行下游对应逻辑</span></span><br><span class="line">                  e.onNext(Utils.getUserListWhoLovesFootball());</span><br><span class="line">                  <span class="comment">//上游发送完毕，执行下游对应逻辑</span></span><br><span class="line">                  e.onComplete();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//模拟数据源1</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; <span class="title">getUserListWhoLovesCricket</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      User userOne = <span class="keyword">new</span> User();</span><br><span class="line">      userOne.id = <span class="number">1</span>;</span><br><span class="line">      userOne.firstname = <span class="string">"Amit"</span>;</span><br><span class="line">      userOne.lastname = <span class="string">"Shekhar"</span>;</span><br><span class="line">      userList.add(userOne);</span><br><span class="line"></span><br><span class="line">      User userTwo = <span class="keyword">new</span> User();</span><br><span class="line">      userTwo.id = <span class="number">2</span>;</span><br><span class="line">      userTwo.firstname = <span class="string">"Manish"</span>;</span><br><span class="line">      userTwo.lastname = <span class="string">"Kumar"</span>;</span><br><span class="line">      userList.add(userTwo);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> userList;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//模拟数据源2</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; <span class="title">getUserListWhoLovesFootball</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      User userOne = <span class="keyword">new</span> User();</span><br><span class="line">      userOne.id = <span class="number">1</span>;</span><br><span class="line">      userOne.firstname = <span class="string">"Amit"</span>;</span><br><span class="line">      userOne.lastname = <span class="string">"Shekhar"</span>;</span><br><span class="line">      userList.add(userOne);</span><br><span class="line"></span><br><span class="line">      User userTwo = <span class="keyword">new</span> User();</span><br><span class="line">      userTwo.id = <span class="number">3</span>;</span><br><span class="line">      userTwo.firstname = <span class="string">"Sumit"</span>;</span><br><span class="line">      userTwo.lastname = <span class="string">"Kumar"</span>;</span><br><span class="line">      userList.add(userTwo);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> userList;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>建立订阅关系，通过zip操作符过滤两个数据源都有的数据，返回结果数据列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Observable.zip(getCricketFansObservable(), getFootballFansObservable(),</span><br><span class="line">                <span class="keyword">new</span> BiFunction&lt;List&lt;User&gt;, List&lt;User&gt;, List&lt;User&gt;&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">apply</span><span class="params">(List&lt;User&gt; cricketFans, List&lt;User&gt; footballFans)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">//过滤两个数据表都有的数据，返回结果数据列表</span></span><br><span class="line">                        <span class="keyword">return</span> Utils.filterUserWhoLovesBoth(cricketFans, footballFans);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// 在子线程中运行</span></span><br><span class="line">                .subscribeOn(Schedulers.io())</span><br><span class="line">                <span class="comment">// 切到主线程</span></span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                <span class="comment">// 下游逻辑处理</span></span><br><span class="line">                .subscribe(getObserver());</span><br><span class="line">                </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; <span class="title">filterUserWhoLovesBoth</span><span class="params">(List&lt;User&gt; cricketFans, List&lt;User&gt; footballFans)</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userWhoLovesBoth = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">        <span class="keyword">for</span> (User cricketFan : cricketFans) &#123;</span><br><span class="line">            <span class="keyword">for</span> (User footballFan : footballFans) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cricketFan.id == footballFan.id) &#123;</span><br><span class="line">                    userWhoLovesBoth.add(cricketFan);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userWhoLovesBoth;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>下游获取到数据源进行数据打印</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Observer&lt;List&lt;User&gt;&gt; getObserver() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Observer&lt;List&lt;User&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">            Log.d(TAG, <span class="string">" onSubscribe : "</span> + d.isDisposed());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(List&lt;User&gt; userList)</span> </span>&#123;</span><br><span class="line">            textView.append(<span class="string">" onNext"</span>);</span><br><span class="line">            textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">            <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">                textView.append(<span class="string">" firstname : "</span> + user.firstname);</span><br><span class="line">                textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(TAG, <span class="string">" onNext : "</span> + userList.size());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">            textView.append(<span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">            textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">            Log.d(TAG, <span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            textView.append(<span class="string">" onComplete"</span>);</span><br><span class="line">            textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">            Log.d(TAG, <span class="string">" onComplete"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Interval操作符"><a href="#Interval操作符" class="headerlink" title="Interval操作符"></a>Interval操作符</h2><p>常用于周期性的处理逻辑（每隔多少时间后执行）<br>上游11秒延迟后，每隔2秒，发送long型数据源到下游，从0开始逐渐递增</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Observable&lt;? extends Long&gt; getObservable() &#123;</span><br><span class="line">       <span class="keyword">return</span> Observable.interval(<span class="number">11</span>, <span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>建立订阅关系，CompositeDisposable统一存放水管，也就是被观察者，为防止内存泄漏，在activity被destory时切断所有的水管</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CompositeDisposable disposables = <span class="keyword">new</span> CompositeDisposable();</span><br><span class="line"> disposables.add(getObservable()</span><br><span class="line">                <span class="comment">// 上游运行在子线程</span></span><br><span class="line">                .subscribeOn(Schedulers.io())</span><br><span class="line">                <span class="comment">// 切换到主线程</span></span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                <span class="comment">// 下游逻辑处理</span></span><br><span class="line">                .subscribeWith(getObserver()));</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        disposables.clear();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>下游获取到数据源进行数据打印：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> DisposableObserver&lt;Long&gt; <span class="title">getObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DisposableObserver&lt;Long&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Long value)</span> </span>&#123;</span><br><span class="line">                textView.append(<span class="string">" onNext : value : "</span> + value);</span><br><span class="line">                textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">                Log.d(TAG, <span class="string">" onNext : value : "</span> + value);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">                textView.append(<span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">                textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">                Log.d(TAG, <span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                textView.append(<span class="string">" onComplete"</span>);</span><br><span class="line">                textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">                Log.d(TAG, <span class="string">" onComplete"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Timer操作符"><a href="#Timer操作符" class="headerlink" title="Timer操作符"></a>Timer操作符</h2><p>常用于计时器的处理逻辑（多少时间后执行）<br>上游延迟2秒发送long型数据0到下游，只发送一次</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Observable&lt;? extends Long&gt; getObservable() &#123;</span><br><span class="line">    <span class="keyword">return</span> Observable.timer(<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>建立订阅关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getObservable()</span><br><span class="line">             <span class="comment">// 上游在子线程运行</span></span><br><span class="line">             .subscribeOn(Schedulers.io())</span><br><span class="line">             <span class="comment">// 切换到主线程</span></span><br><span class="line">             .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">             .subscribe(getObserver());</span><br></pre></td></tr></table></figure>
<p>下游进行打印输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Observer&lt;Long&gt; <span class="title">getObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Observer&lt;Long&gt;() &#123;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">               Log.d(TAG, <span class="string">" onSubscribe : "</span> + d.isDisposed());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Long value)</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onNext : value : "</span> + value);</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onNext : value : "</span> + value);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onComplete"</span>);</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onComplete"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Flowable背压式"><a href="#Flowable背压式" class="headerlink" title="Flowable背压式"></a>Flowable背压式</h2><p>Rxjava在处理异步操作时，会先将上游的数据放入一个缓存池中，这里称作水缸，一旦下游不能及时处理就会出现内存溢出的问题，抛出MissingBackpressureException<br>解决方式</p>
<ol>
<li>放慢上游的发送速度</li>
<li>减少发送的数据<br>Flowable在设计的时候采用了一种新的思路也就是响应式拉取的方式来更好的解决上下游流速不均衡的问题，<br>在同一线程中下游没有调用request, 上游就认为下游没有处理事件的能力，抛出MissingBackpressureException，当上下游工作在不同的线程中时,  只有当下游调用request时, 才从水缸里取出事件发给下游。 <h3 id="背压策略"><a href="#背压策略" class="headerlink" title="背压策略"></a>背压策略</h3><h4 id="BackpressureStrategy-ERROR："><a href="#BackpressureStrategy-ERROR：" class="headerlink" title="BackpressureStrategy.ERROR："></a>BackpressureStrategy.ERROR：</h4>默认策略，有一个大小为128的水缸<h4 id="BackpressureStrategy-BUFFER"><a href="#BackpressureStrategy-BUFFER" class="headerlink" title="BackpressureStrategy.BUFFER"></a>BackpressureStrategy.BUFFER</h4>增大水缸的容量，仍有内存溢出问题<h4 id="BackpressureStrategy-DROP"><a href="#BackpressureStrategy-DROP" class="headerlink" title="BackpressureStrategy.DROP"></a>BackpressureStrategy.DROP</h4>水缸存不下时，直接把存不下的事件丢弃<h4 id="BackpressureStrategy-LATEST"><a href="#BackpressureStrategy-LATEST" class="headerlink" title="BackpressureStrategy.LATEST"></a>BackpressureStrategy.LATEST</h4>水缸存不下时，只保留最新的事件<h2 id="reduce操作符"><a href="#reduce操作符" class="headerlink" title="reduce操作符"></a>reduce操作符</h2>遍历list，第一次将第一个元素和第二个元素作为入参，返回一个结果值，以后将上一次返回的结果和当前遍历的元素作为入参，返回一个结果值。<br>与它相同的是scan操作符，但是scan操作符会返回上一次的结果<br>上游创建数据源，发送到下游<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Observable&lt;Integer&gt; <span class="title">getObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
建立订阅关系，将上一次返回的结果和当前遍历的元素作为入参，最后返回一个累加值<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">getObservable()</span><br><span class="line">                .reduce(<span class="keyword">new</span> BiFunction&lt;Integer, Integer, Integer&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Integer <span class="title">apply</span><span class="params">(Integer t1, Integer t2)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> t1 + t2;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .subscribe(getObserver());</span><br></pre></td></tr></table></figure>
下游进行打印输出<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> MaybeObserver&lt;Integer&gt; <span class="title">getObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MaybeObserver&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">            Log.d(TAG, <span class="string">" onSubscribe : "</span> + d.isDisposed());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Integer value)</span> </span>&#123;</span><br><span class="line">            textView.append(<span class="string">" onSuccess : value : "</span> + value);</span><br><span class="line">            textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">            Log.d(TAG, <span class="string">" onSuccess : value : "</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">            textView.append(<span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">            textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">            Log.d(TAG, <span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            textView.append(<span class="string">" onComplete"</span>);</span><br><span class="line">            textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">            Log.d(TAG, <span class="string">" onComplete"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Filter操作符"><a href="#Filter操作符" class="headerlink" title="Filter操作符"></a>Filter操作符</h2>遍历list中的每个元素，按条件过滤<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">               .filter(<span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                       <span class="keyword">return</span> integer % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">               .subscribe(getObserver());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Observer&lt;Integer&gt; <span class="title">getObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Observer&lt;Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">               Log.d(TAG, <span class="string">" onSubscribe : "</span> + d.isDisposed());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Integer value)</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onNext : "</span>);</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               textView.append(<span class="string">" value : "</span> + value);</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onNext "</span>);</span><br><span class="line">               Log.d(TAG, <span class="string">" value : "</span> + value);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               textView.append(<span class="string">" onComplete"</span>);</span><br><span class="line">               textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">               Log.d(TAG, <span class="string">" onComplete"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Contact操作符"><a href="#Contact操作符" class="headerlink" title="Contact操作符"></a>Contact操作符</h2>将多个数据源结合成一个数据源并发送数据，并且严格按照先后顺序发射数据<br>与它相同的有merge，但是merge是无序的且是并发的<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">String[] aStrings = &#123;<span class="string">"A1"</span>, <span class="string">"A2"</span>, <span class="string">"A3"</span>, <span class="string">"A4"</span>&#125;;</span><br><span class="line">String[] bStrings = &#123;<span class="string">"B1"</span>, <span class="string">"B2"</span>, <span class="string">"B3"</span>&#125;;</span><br><span class="line"></span><br><span class="line">Observable&lt;String&gt; aObservable = Observable.fromArray(aStrings);</span><br><span class="line">Observable&lt;String&gt; bObservable = Observable.fromArray(bStrings);</span><br><span class="line"></span><br><span class="line">Observable.concat(aObservable, bObservable)</span><br><span class="line">              .subscribe(getObserver());</span><br><span class="line">              </span><br><span class="line"><span class="function"><span class="keyword">private</span> Observer&lt;String&gt; <span class="title">getObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Observer&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">              Log.d(TAG, <span class="string">" onSubscribe : "</span> + d.isDisposed());</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">              textView.append(<span class="string">" onNext : value : "</span> + value);</span><br><span class="line">              textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">              Log.d(TAG, <span class="string">" onNext : value : "</span> + value);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">              textView.append(<span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">              textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">              Log.d(TAG, <span class="string">" onError : "</span> + e.getMessage());</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">              textView.append(<span class="string">" onComplete"</span>);</span><br><span class="line">              textView.append(AppConstant.LINE_SEPARATOR);</span><br><span class="line">              Log.d(TAG, <span class="string">" onComplete"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Rxbus的使用"><a href="#Rxbus的使用" class="headerlink" title="Rxbus的使用"></a>Rxbus的使用</h2>定义Rxbus<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxBus</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RxBus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PublishSubject&lt;Object&gt; bus = PublishSubject.create();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送event</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        bus.onNext(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取bus对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Observable&lt;Object&gt; <span class="title">toObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bus.hasObservers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在Application中初始化Rxbus，做事件的统一管理<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> RxBus bus;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        bus = <span class="keyword">new</span> RxBus();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RxBus <span class="title">bus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bus;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在activity中发送事件，CompositeDisposable统一存放水管，为避免内存泄漏，destory时切断水管<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CompositeDisposable disposables = <span class="keyword">new</span> CompositeDisposable();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        disposables.clear();</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">//上游是MyApplication的bus，建立订阅关系，绑定下游事件接收回调处理</span></span><br><span class="line"> disposables.add(((MyApplication) getApplication())</span><br><span class="line">                .bus()</span><br><span class="line">                .toObservable()</span><br><span class="line">                .subscribeOn(Schedulers.io())</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                .subscribe(<span class="keyword">new</span> Consumer&lt;Object&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (object <span class="keyword">instanceof</span> Events.TapEvent) &#123;</span><br><span class="line">                            textView.setText(<span class="string">"Tap Event Received"</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;));</span><br><span class="line">                </span><br><span class="line">    <span class="comment">//发送事件到MyApplication的bus</span></span><br><span class="line">    ((MyApplication) getApplication())</span><br><span class="line">                        .bus()</span><br><span class="line">                        .send(<span class="keyword">new</span> Events.TapEvent());</span><br></pre></td></tr></table></figure>
<h2 id="操作符组合使用"><a href="#操作符组合使用" class="headerlink" title="操作符组合使用"></a>操作符组合使用</h2>android搜索功能的实现<br>绑定searchview的监听<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxSearchObservable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Observable&lt;String&gt; <span class="title">fromView</span><span class="params">(SearchView searchView)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> PublishSubject&lt;String&gt; subject = PublishSubject.create();</span><br><span class="line"></span><br><span class="line">        searchView.setOnQueryTextListener(<span class="keyword">new</span> SearchView.OnQueryTextListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onQueryTextSubmit</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                subject.onComplete();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onQueryTextChange</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">                subject.onNext(text);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
建立订阅关系，上游输入文字监听，下游显示结果<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//上游绑定SearchView输入文字监听</span></span><br><span class="line">    RxSearchObservable.fromView(searchView)</span><br><span class="line">            <span class="comment">//每隔300毫秒执行</span></span><br><span class="line">            .debounce(<span class="number">300</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">            <span class="comment">//过滤输入文字不为空</span></span><br><span class="line">            .filter(<span class="keyword">new</span> Predicate&lt;String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(String text)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (text.isEmpty()) &#123;</span><br><span class="line">                        textViewResult.setText(<span class="string">""</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//与上次的数据对比有变化</span></span><br><span class="line">            .distinctUntilChanged()</span><br><span class="line">            <span class="comment">//只发射最近的一次observable</span></span><br><span class="line">            .switchMap(<span class="keyword">new</span> Function&lt;String, ObservableSource&lt;String&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> ObservableSource&lt;String&gt; <span class="title">apply</span><span class="params">(String query)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    <span class="comment">//从网络获取数据</span></span><br><span class="line">                    <span class="keyword">return</span> dataFromNetwork(query);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//在子线程中运行</span></span><br><span class="line">            .subscribeOn(Schedulers.io())</span><br><span class="line">            <span class="comment">//切到主线程</span></span><br><span class="line">            .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">            <span class="comment">//下游显示结果</span></span><br><span class="line">            .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String result)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    textViewResult.setText(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line"><span class="comment">//模拟网络请求</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Observable&lt;String&gt; <span class="title">dataFromNetwork</span><span class="params">(<span class="keyword">final</span> String query)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Observable.just(<span class="keyword">true</span>)</span><br><span class="line">            .delay(<span class="number">2</span>, TimeUnit.SECONDS)</span><br><span class="line">            .map(<span class="keyword">new</span> Function&lt;Boolean, String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(@NonNull Boolean value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> query;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="封装线程切换"><a href="#封装线程切换" class="headerlink" title="封装线程切换"></a>封装线程切换</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> &lt;UD&gt; ObservableTransformer &lt;UD, UD&gt; rxud()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ObservableTransformer&lt;UD,UD&gt;()&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> ObservableSource&lt;UD&gt; <span class="title">apply</span> <span class="params">(Observable&lt;UD&gt; upstream)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> upstream.subscribeOn(Schedulers,io())</span><br><span class="line">                       .observableOn(AndroidSchedulers.mainThread());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Observable.from(getObservable())  </span><br><span class="line">    .map(data -&gt; dealwith(data))</span><br><span class="line">    .compose(rxud())</span><br><span class="line">    .subscribe(getObserver());</span><br></pre></td></tr></table></figure>
<h2 id="切子线程切主线程再切子线程切主线程"><a href="#切子线程切主线程再切子线程切主线程" class="headerlink" title="切子线程切主线程再切子线程切主线程"></a>切子线程切主线程再切子线程切主线程</h2>doOnNext 替代subscribeOn连接两次请求之间的切换<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">api.registerAction()</span><br><span class="line">     .subscribeOn(Schedulers.io())</span><br><span class="line">     .observableOn(AndroidSchedulers.mainThread())</span><br><span class="line">     .doOnNext(<span class="keyword">new</span> Consumer&lt;RegisterResponse&gt;()&#123;</span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(RegisterResponse registerResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">             </span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">     .observableOn(Schedulers.io())</span><br><span class="line">     .flatMap(<span class="keyword">new</span> Function&lt;RegisterResponse, ObservableSource&lt;LoginResponse&gt;&gt;()&#123;</span><br><span class="line">         <span class="function"><span class="keyword">public</span> ObservableSource&lt;LoginResponse&gt;  <span class="title">apply</span><span class="params">(RegisterResponse registerResponse)</span></span>&#123;</span><br><span class="line">             Observable&lt;LoginResponse&gt; loginResponse = api.loginAction();</span><br><span class="line">             <span class="keyword">return</span> loginResponse;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">     .observableOn(AndroidSchedulers.mainThread())</span><br><span class="line">     .subscribe(<span class="keyword">new</span> Observable&lt;LoginResponse&gt;&#123;</span><br><span class="line"></span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="封装RXView"><a href="#封装RXView" class="headerlink" title="封装RXView"></a>封装RXView</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxView</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TAG = RxView.class.getSimpleName();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Observable&lt;Object&gt; <span class="title">clicks</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> ViewClickObservable(view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewClickObservable</span> <span class="keyword">extends</span> <span class="title">Observable</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> View view;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object EVENT = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object EVENT2;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewClickObservable</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.view = view;</span><br><span class="line">        EVENT2 = view;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> Object&gt; observer)</span></span>&#123;</span><br><span class="line">          MyListener myListener = <span class="keyword">new</span> MyListener(view, observer);</span><br><span class="line">          observer.onSubscribe(myListener)</span><br><span class="line">        </span><br><span class="line">          <span class="keyword">this</span>.view.setOnClickListener(myListener)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">Disposable</span></span>&#123;</span><br><span class="line">           <span class="keyword">private</span> <span class="keyword">final</span> View view;</span><br><span class="line">           <span class="keyword">private</span> Observer&lt;Object&gt; observer;</span><br><span class="line">           <span class="keyword">private</span> <span class="keyword">final</span> AtomicBoolean isDisposable = <span class="keyword">new</span> AtomicBoolean(); <span class="comment">// 是否中断</span></span><br><span class="line"></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="title">MyListener</span><span class="params">(View view, Observer&lt;Object&gt; observer)</span></span>&#123;</span><br><span class="line">                 <span class="keyword">this</span>.view = view;</span><br><span class="line">                 <span class="keyword">this</span>.observer  = observer;</span><br><span class="line">           &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span>&#123;</span><br><span class="line">                <span class="comment">// 继续分发</span></span><br><span class="line">                 <span class="keyword">if</span> (isDisposed() == <span class="keyword">false</span>)&#123;</span><br><span class="line">                      observer.onNext(EVENT);</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="comment">// 之前没有中断，设置为中断</span></span><br><span class="line">                  <span class="keyword">if</span> (isDisposable.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>))&#123;</span><br><span class="line">                      <span class="comment">// 主线程取消监听逻辑</span></span><br><span class="line">                      <span class="keyword">if</span> (Looper.myLoop() == Looper.getMainLooper())&#123;</span><br><span class="line">                            view.setOnClickListener(<span class="keyword">null</span>)</span><br><span class="line">                      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                         AndroidSchedulers.mainThread().schedulerDirect(<span class="keyword">new</span> Runnable())&#123;</span><br><span class="line">                                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">                                     view.setOnClickListener(<span class="keyword">null</span>)</span><br><span class="line">                               &#125;</span><br><span class="line">                         &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDisposed</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> isDisposable;</span><br><span class="line">            &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RxView.clicks(button)</span><br><span class="line">             .throttleFirst(<span class="number">2000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">             .subscribe(<span class="keyword">new</span> Consumer&lt;Object&gt;()&#123;</span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                     Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;()&#123;</span><br><span class="line">                         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">                             e.onNext(<span class="string">"click"</span>);</span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125;)</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;)</span><br><span class="line">             .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;()&#123;</span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                     Log.d(<span class="string">"RxView"</span>,<span class="string">"accept:"</span> + s)</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;)</span><br></pre></td></tr></table></figure></li>
</ol>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/RxJava/" rel="tag"># RxJava</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2017/11/12/Java8-NewFeatures/" rel="next" title="java8新特性学习">
                  <i class="fa fa-chevron-left"></i> java8新特性学习
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2018/01/03/SimpleOne/" rel="prev" title="SimpleOne-one一个高仿开源项目">
                  SimpleOne-one一个高仿开源项目 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#观察者模式："><span class="nav-number">1.</span> <span class="nav-text">观察者模式：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RxJava-基本概念："><span class="nav-number">2.</span> <span class="nav-text">RxJava 基本概念：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#map操作符"><span class="nav-number">3.</span> <span class="nav-text">map操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flatMap操作符"><span class="nav-number">4.</span> <span class="nav-text">flatMap操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zip操作符"><span class="nav-number">5.</span> <span class="nav-text">zip操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interval操作符"><span class="nav-number">6.</span> <span class="nav-text">Interval操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Timer操作符"><span class="nav-number">7.</span> <span class="nav-text">Timer操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Flowable背压式"><span class="nav-number">8.</span> <span class="nav-text">Flowable背压式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#背压策略"><span class="nav-number">8.1.</span> <span class="nav-text">背压策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BackpressureStrategy-ERROR："><span class="nav-number">8.1.1.</span> <span class="nav-text">BackpressureStrategy.ERROR：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BackpressureStrategy-BUFFER"><span class="nav-number">8.1.2.</span> <span class="nav-text">BackpressureStrategy.BUFFER</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BackpressureStrategy-DROP"><span class="nav-number">8.1.3.</span> <span class="nav-text">BackpressureStrategy.DROP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BackpressureStrategy-LATEST"><span class="nav-number">8.1.4.</span> <span class="nav-text">BackpressureStrategy.LATEST</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reduce操作符"><span class="nav-number">9.</span> <span class="nav-text">reduce操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Filter操作符"><span class="nav-number">10.</span> <span class="nav-text">Filter操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Contact操作符"><span class="nav-number">11.</span> <span class="nav-text">Contact操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rxbus的使用"><span class="nav-number">12.</span> <span class="nav-text">Rxbus的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#操作符组合使用"><span class="nav-number">13.</span> <span class="nav-text">操作符组合使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#封装线程切换"><span class="nav-number">14.</span> <span class="nav-text">封装线程切换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#切子线程切主线程再切子线程切主线程"><span class="nav-number">15.</span> <span class="nav-text">切子线程切主线程再切子线程切主线程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#封装RXView"><span class="nav-number">16.</span> <span class="nav-text">封装RXView</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jessie Kate</p>
  <div class="site-description" itemprop="description">程序的世界，比你牛逼的人更比你努力。<br /> hello，I'm an Android developer～ <br /> My hobbies tag &#58; <br /> - Coding  <br /> - Sports   <br /> - Game</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jessie Kate</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">
      
    Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.1
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>
<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'aedb4031c50b7b9201d6',
      clientSecret: 'f77b152663ed74c8570f87e2483c2eb12cdd252c',
      repo: 'jessieeeee.github.io',
      owner: 'jessieeeee',
      admin: ['jessieeeee'],
      id: '6f1829283fe09d0349b29170674fdcad',
        language: window.navigator.language || window.navigator.userLanguage,
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
