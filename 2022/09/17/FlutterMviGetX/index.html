<!DOCTYPE html>





<html lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="今年的互联网寒冬真是冰冷刺骨，高温+限电+地震+疫情让所有人都感觉到2022年活下来就好，既然疫情下的经济衰退无法避免，那就只能多准备点保暖的装备过冬了，作为菜鸟的我焦虑是无法避免的而学习可以平复心中的不安，大环境无法改变只能抓紧时间充电了，期待破局的那一天。 移动端开发趋近于饱和已经很久了，传统的开发方式需要ios和Android的两端的人力，为了达到双端一致的效果少不了沟通和UI交互校对的">
<meta name="keywords" content="Architecture">
<meta property="og:type" content="article">
<meta property="og:title" content="MVI+GetX打造Flutter开发架构">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2022&#x2F;09&#x2F;17&#x2F;FlutterMviGetX&#x2F;index.html">
<meta property="og:site_name" content="JessieK&#39;s blog">
<meta property="og:description" content="今年的互联网寒冬真是冰冷刺骨，高温+限电+地震+疫情让所有人都感觉到2022年活下来就好，既然疫情下的经济衰退无法避免，那就只能多准备点保暖的装备过冬了，作为菜鸟的我焦虑是无法避免的而学习可以平复心中的不安，大环境无法改变只能抓紧时间充电了，期待破局的那一天。 移动端开发趋近于饱和已经很久了，传统的开发方式需要ios和Android的两端的人力，为了达到双端一致的效果少不了沟通和UI交互校对的">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;flutter_arch.jpg">
<meta property="og:updated_time" content="2022-10-03T14:12:27.197Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;flutter_arch.jpg">
  <link rel="canonical" href="http://yoursite.com/2022/09/17/FlutterMviGetX/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>MVI+GetX打造Flutter开发架构 | JessieK's blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JessieK's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">My Technical sharing</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      
    
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/09/17/FlutterMviGetX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="程序的世界，比你牛逼的人更比你努力。<br /> hello，I'm an Android developer～ <br /> My hobbies tag &#58; <br /> - Coding  <br /> - Sports   <br /> - Game">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            MVI+GetX打造Flutter开发架构
            

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2022-09-17 19:58:08" itemprop="dateCreated datePublished" datetime="2022-09-17T19:58:08+08:00">2022-09-17</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-10-03 22:12:27" itemprop="dateModified" datetime="2022-10-03T22:12:27+08:00">2022-10-03</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <hr>
<ul>
<li>今年的互联网寒冬真是冰冷刺骨，高温+限电+地震+疫情让所有人都感觉到2022年活下来就好，既然疫情下的经济衰退无法避免，那就只能多准备点保暖的装备过冬了，作为菜鸟的我焦虑是无法避免的而学习可以平复心中的不安，大环境无法改变只能抓紧时间充电了，期待破局的那一天。</li>
<li>移动端开发趋近于饱和已经很久了，传统的开发方式需要ios和Android的两端的人力，为了达到双端一致的效果少不了沟通和UI交互校对的成本，如果项目以UI交互为主利用跨平台开发是有优势的，一套代码打造各端UI一致的体验，性能接近原生，提升人效受各大企业青睐，可能这是客户端最终的归宿吧，前有facebook的React后有google的flutter，连compose都有跨平台发展的迹象，随着flutter3.0的发布已经稳定支持所有终端，作为Android开发者面对这种强大的开发框架必须要赶紧学习起来，保持新技术的学习热情，顺应互联网时代的快速发展。</li>
<li>公司的项目中已经用上了flutter，对于二级页面采用混合式的开发方式，集成flutter到原生的项目当中，目前性能和稳定性表现都是非常不错的，由于hot reload开发效率也提升了不少，开发了一段时间后，我利用Android开发中的MVI架构思想和GetX状态管理封装了flutter的开发架构，目前集成到项目中在线上稳定运行，欢迎交流和讨论～</li>
</ul>
<hr>
<h1 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h1><p><img src="/images/flutter_arch.jpg" alt="效果图"></p>
<ul>
<li>先放上一张整体的架构图～</li>
<li>借鉴Android的MVI架构思想，整理一下大概思路：</li>
</ul>
<ol>
<li>ViewModel 会存储并公开界面要使用的状态。界面状态是经过 ViewModel 转换的应用数据</li>
<li>界面会向 ViewModel 发送用户事件通知</li>
<li>ViewModel 会处理用户操作并更新状态</li>
<li>更新后的状态将反馈给界面呈现</li>
<li>ViewModel的数据源是两种，本地数据源和服务端数据源，本地数据源来自于文件和数据库，服务端数据源是web服务端接口提供的数据</li>
</ol>
<h1 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h1><h2 id="LocalDataSource本地存储"><a href="#LocalDataSource本地存储" class="headerlink" title="LocalDataSource本地存储"></a>LocalDataSource本地存储</h2><p>引入shared_preferences到pubspec.yaml</p>
<h3 id="工具类封装"><a href="#工具类封装" class="headerlink" title="工具类封装"></a>工具类封装</h3><p>对shared_preferences进行封装，调用shared_preferences</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">bool</span>&gt; saveString2Sp(<span class="built_in">String</span> key, <span class="built_in">String</span> value) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> prefs = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">  <span class="keyword">return</span> prefs.setString(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">String</span>?&gt; getStringFromSp(<span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> prefs = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">  <span class="keyword">return</span> prefs.getString(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">bool</span>&gt; saveBool2Sp(<span class="built_in">String</span> key, <span class="built_in">bool</span> value) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> prefs = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">  <span class="keyword">return</span> prefs.setBool(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">bool</span>?&gt; getBoolFromSp(<span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> prefs = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">  <span class="keyword">return</span> prefs.getBool(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">bool</span>&gt; removeSp(<span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> prefs = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">  <span class="keyword">return</span> prefs.remove(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="本地存储基类"><a href="#本地存储基类" class="headerlink" title="本地存储基类"></a>本地存储基类</h3><p>调用封装的工具类实现本地数据的操作</p>
<ul>
<li>本地数据缓存</li>
<li>本地数据获取</li>
<li>删除本地数据<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseLocalDataSource</span> </span>&#123;</span><br><span class="line">  Future&lt;<span class="built_in">bool</span>&gt; saveCache(<span class="built_in">String</span> cacheData, <span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> saveString2Sp(key, cacheData);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="built_in">String</span>?&gt; readCache(<span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getStringFromSp(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="built_in">bool</span>?&gt; deleteCache(<span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> removeSp(key);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="网络请求基类"><a href="#网络请求基类" class="headerlink" title="网络请求基类"></a>网络请求基类</h3>引入dio到pubspec.yaml，初始化网络请求DioManager对象供实现类使用，封装了网络请求的Dio API<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseRemoteDataSource</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> DioManager dioManager = DioManager.getInstance()!;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Repository基类"><a href="#Repository基类" class="headerlink" title="Repository基类"></a>Repository基类</h3>暴露本地数据操作接口</li>
<li>本地数据缓存</li>
<li>本地数据获取</li>
<li>删除本地数据<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseRepository</span> </span>&#123;</span><br><span class="line">  Future&lt;<span class="built_in">bool</span>&gt; saveCache(<span class="built_in">String</span> cacheData, <span class="built_in">String</span> key);</span><br><span class="line">  Future&lt;<span class="built_in">String</span>?&gt; readCache(<span class="built_in">String</span> key);</span><br><span class="line">  Future&lt;<span class="built_in">bool</span>?&gt; deleteCache(<span class="built_in">String</span> key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Repository基础实现类"><a href="#Repository基础实现类" class="headerlink" title="Repository基础实现类"></a>Repository基础实现类</h3></li>
<li>需外部传入本地数据，网络请求操作对象</li>
<li>方便外部自定义BaseLocalDataSource，替换shared_preferences，实现本地数据操作方法</li>
<li>方便外部自定义BaseRemoteDataSource， 定义网络请求的相关接口</li>
<li>网络请求的相关接口在外部Repository实现类中实现<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseRepositoryImp</span>&lt;<span class="title">Local</span> <span class="keyword">extends</span> <span class="title">BaseLocalDataSource</span>,</span></span><br><span class="line"><span class="class">    <span class="title">Remote</span> <span class="keyword">extends</span> <span class="title">BaseRemoteDataSource</span>&gt; <span class="keyword">implements</span> <span class="title">BaseRepository</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Local? localDataSource;</span><br><span class="line">  <span class="keyword">final</span> Remote remoteDataSource;</span><br><span class="line"></span><br><span class="line">  BaseRepositoryImp(&#123;<span class="keyword">this</span>.localDataSource, required <span class="keyword">this</span>.remoteDataSource&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;<span class="built_in">bool</span>&gt; saveCache(<span class="built_in">String</span> cacheData, <span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isSuccess = <span class="keyword">await</span> localDataSource?.saveCache(cacheData, key);</span><br><span class="line">    <span class="keyword">return</span> isSuccess ?? <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;<span class="built_in">String</span>?&gt; readCache(<span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> localDataSource?.readCache(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;<span class="built_in">bool</span>?&gt; deleteCache(<span class="built_in">String</span> key) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isSuccess = <span class="keyword">await</span> localDataSource?.deleteCache(key);</span><br><span class="line">    <span class="keyword">return</span> isSuccess ?? <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Binding基类"><a href="#Binding基类" class="headerlink" title="Binding基类"></a>Binding基类</h1>注入repository实现类<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 页面binding封装，注入repository</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseBinding</span>&lt;<span class="title">R</span> <span class="keyword">extends</span> <span class="title">BaseRepository</span>&gt; <span class="keyword">extends</span> <span class="title">Bindings</span> </span>&#123;</span><br><span class="line">  R provideRepository();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="封装页面基类"><a href="#封装页面基类" class="headerlink" title="封装页面基类"></a>封装页面基类</h1>继承StatelessWidget，暴露viewModel的get接口，重写build方法<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseView</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BaseViewModel</span>&gt; <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> BaseView(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  T <span class="keyword">get</span> viewModel =&gt; GetInstance().find&lt;T&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="封装页面基类ViewModel"><a href="#封装页面基类ViewModel" class="headerlink" title="封装页面基类ViewModel"></a>封装页面基类ViewModel</h1></li>
</ul>
<ol>
<li>引入GetX到pubspec.yaml</li>
<li>FullLifeCycleController的生命周期</li>
</ol>
<ul>
<li>onInit Controller初始化</li>
<li>onReady 处理异步事件，网络请求</li>
<li>onResumed 应用可见且页面回到前台</li>
<li>onInactive 应用在前台但页面不可见</li>
<li>onPaused 应用不可见且页面到后台</li>
<li>onDetach 页面视图销毁</li>
<li>onClose 关闭流对象，动画，释放内存，数据持久化</li>
</ul>
<ol start="3">
<li>继承FullLifeCycleController混入FullLifeCycleMixin重写生命周期方法，传入Repository的实现类定义Repository对象的具体类型，初始化数据埋点收集对象TrackPageViewHelper，通过桥调用native SDK中的API实现的，传入Repository对象，在生命周期做数据埋点，onInit和onResumed调用数据埋点的onPageShow，onInactive和onClose调用数据埋点的onPageHide<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseViewModel</span>&lt;<span class="title">Repository</span> <span class="keyword">extends</span> <span class="title">BaseRepository</span>?&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">FullLifeCycleController</span> <span class="title">with</span> <span class="title">FullLifeCycleMixin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Repository? repository;</span><br><span class="line"></span><br><span class="line">  BaseViewModel(&#123;<span class="keyword">this</span>.repository&#125;);</span><br><span class="line"></span><br><span class="line">  TrackPageViewHelper? trackPageViewHelper;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> pageId() =&gt; <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="meta">@mustCallSuper</span></span><br><span class="line">  <span class="keyword">void</span> onInit() &#123;</span><br><span class="line">    <span class="keyword">if</span> (pageId().isNotEmpty) &#123;</span><br><span class="line">      trackPageViewHelper = TrackPageViewHelper(pageId());</span><br><span class="line">      trackPageViewHelper?.onPageShow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/// viewModel的初始化工作，例如一些成员属性的初始化</span></span></span><br><span class="line">    <span class="keyword">super</span>.onInit();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onReady() &#123;</span><br><span class="line">    <span class="comment"><span class="markdown">/// 处理异步事件，比如网络请求</span></span></span><br><span class="line">    <span class="keyword">super</span>.onReady();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="meta">@mustCallSuper</span></span><br><span class="line">  <span class="keyword">void</span> onClose() &#123;</span><br><span class="line">    <span class="keyword">if</span> (pageId().isNotEmpty) &#123;</span><br><span class="line">      trackPageViewHelper?.onPageHide();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>.onClose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="meta">@mustCallSuper</span></span><br><span class="line">  <span class="keyword">void</span> onResumed() &#123;</span><br><span class="line">    <span class="keyword">if</span> (pageId().isNotEmpty) &#123;</span><br><span class="line">      trackPageViewHelper?.onPageShow();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="meta">@mustCallSuper</span></span><br><span class="line">  <span class="keyword">void</span> onInactive() &#123;</span><br><span class="line">    <span class="keyword">if</span> (pageId().isNotEmpty) &#123;</span><br><span class="line">      trackPageViewHelper?.onPageHide();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onPaused() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onDetached() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="通用页面基类"><a href="#通用页面基类" class="headerlink" title="通用页面基类"></a>通用页面基类</h1>根据当前封装的页面基类和ViewModel基类封装普通/列表/下拉刷新列表页，分别封装它们对应的UIState/Page/ViewModel<h2 id="普通页基类"><a href="#普通页基类" class="headerlink" title="普通页基类"></a>普通页基类</h2><h3 id="封装UIState"><a href="#封装UIState" class="headerlink" title="封装UIState"></a>封装UIState</h3>UIState只定义与UI刷新相关的变量，结合GetX的Obx机制刷新使用obs变量，普通页的UIState封装内容View的显示状态，根据当前的几个状态加载中/空页面/错误页来展示页面当前View<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只定义UI显示所需要的state，其他和界面显示无关的state，请放在ViewModel</span></span><br><span class="line"><span class="comment">// 普通页面UIState</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePageUIState</span> </span>&#123;</span><br><span class="line">  <span class="built_in">bool</span> isLoading = <span class="keyword">true</span>;</span><br><span class="line">  <span class="built_in">bool</span> isEmpty = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">bool</span> isError = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装ViewModel"><a href="#封装ViewModel" class="headerlink" title="封装ViewModel"></a>封装ViewModel</h3>传入UIState的实例化对象和Repository的实例化对象，继承自前面封装的基类ViewModel，暴露状态传入的接口并利用GetX的GetBuilder刷新状态视图<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePageViewModel</span>&lt;<span class="title">UIState</span> <span class="keyword">extends</span> <span class="title">BasePageUIState</span>,</span></span><br><span class="line"><span class="class">    <span class="title">Repository</span> <span class="keyword">extends</span> <span class="title">BaseRepository</span>?&gt; <span class="keyword">extends</span> <span class="title">BaseViewModel</span>&lt;<span class="title">Repository</span>?&gt; </span>&#123;</span><br><span class="line">  BasePageViewModel(&#123;Repository? repository, required <span class="keyword">this</span>.uiState&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(repository: repository);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> UIState uiState;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> activeStatus(</span><br><span class="line">      &#123;<span class="built_in">bool</span> isLoading = <span class="keyword">false</span>, <span class="built_in">bool</span> isEmpty = <span class="keyword">false</span>, <span class="built_in">bool</span> isError = <span class="keyword">false</span>&#125;) &#123;</span><br><span class="line">    uiState.isLoading = isLoading;</span><br><span class="line">    uiState.isEmpty = isEmpty;</span><br><span class="line">    uiState.isError = isError;</span><br><span class="line">    update([<span class="string">'status'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装普通页面"><a href="#封装普通页面" class="headerlink" title="封装普通页面"></a>封装普通页面</h3></li>
</ol>
<ul>
<li>定义页面背景色，appBar背景色</li>
<li>重写build方法，设置页面背景色和appBar背景色</li>
<li>标题居中，设置左侧返回按钮，右侧操作按钮</li>
<li>暴露标题设置，左侧/右侧按钮设置，空界面，网络错误界面，重试，点击返回，内容界面绘制接口<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePage</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BasePageViewModel</span>&gt; <span class="keyword">extends</span> <span class="title">BaseView</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> BasePage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  Color <span class="keyword">get</span> backgroundColor =&gt; ColorConfig.background;</span><br><span class="line"></span><br><span class="line">  Color <span class="keyword">get</span> appBarBackgroundColor =&gt; ColorConfig.background;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: backgroundColor,</span><br><span class="line">      resizeToAvoidBottomInset: <span class="keyword">false</span>,</span><br><span class="line">      appBar: appbar(context),</span><br><span class="line">      body: body(context),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  PreferredSizeWidget? appbar(BuildContext buildContext) &#123;</span><br><span class="line">    <span class="keyword">return</span> AppBar(</span><br><span class="line">      brightness: Global.isDark! ? Brightness.dark : Brightness.light,</span><br><span class="line">      backgroundColor: appBarBackgroundColor,</span><br><span class="line">      elevation: <span class="number">0</span>,</span><br><span class="line">      centerTitle: <span class="keyword">true</span>,</span><br><span class="line">      leading: leading(buildContext),</span><br><span class="line">      title: title(),</span><br><span class="line">      actions: actions(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// 返回按钮</span></span></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  Widget? leading(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> IconButton(</span><br><span class="line">      splashColor: Colors.transparent,</span><br><span class="line">      highlightColor: Colors.transparent,</span><br><span class="line">      icon: Image.asset(</span><br><span class="line">        <span class="string">'resource/images/icon_back.png'</span>,</span><br><span class="line">        width: <span class="number">24</span>,</span><br><span class="line">        height: <span class="number">24</span>,</span><br><span class="line">        color: ColorConfig.emphasis,</span><br><span class="line">      ),</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        onBackClick(context);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// 标题字符串</span></span></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="built_in">String</span> titleString() =&gt; <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// 标题</span></span></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  Widget? title() &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      padding: EdgeInsetsDirectional.only(bottom: <span class="number">5</span>),</span><br><span class="line">      child: Text(</span><br><span class="line">        titleString(),</span><br><span class="line">        overflow: TextOverflow.ellipsis,</span><br><span class="line">        style: TextStyle(</span><br><span class="line">          color: ColorConfig.emphasis,</span><br><span class="line">          fontSize: <span class="number">18</span>,</span><br><span class="line">        ),</span><br><span class="line">        textAlign: TextAlign.center,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt;? actions() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget body(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> GetBuilder&lt;T&gt;(</span><br><span class="line">        id: <span class="string">'status'</span>,</span><br><span class="line">        builder: (viewModel) &#123;</span><br><span class="line">          <span class="keyword">if</span> (viewModel.uiState.isLoading) &#123;</span><br><span class="line">            <span class="keyword">return</span> loading();</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (viewModel.uiState.isEmpty) &#123;</span><br><span class="line">            <span class="keyword">return</span> empty();</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (viewModel.uiState.isError) &#123;</span><br><span class="line">            <span class="keyword">return</span> networkError();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> content(context);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// 子类实现该方法，创建自己的UI</span></span></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  Widget content(BuildContext context);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  Widget loading() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> PageLoading();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  Widget empty() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> Padding(</span><br><span class="line">      padding: EdgeInsetsDirectional.only(</span><br><span class="line">        top: <span class="number">152</span>,</span><br><span class="line">      ),</span><br><span class="line">      child: PageEmpty(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  Widget networkError() &#123;</span><br><span class="line">    <span class="keyword">return</span> PageNetworkError(</span><br><span class="line">      onRetry: onRetry,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// 点击重试时回调</span></span></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="keyword">void</span> onRetry() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="keyword">void</span> onBackClick(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">if</span> (Navigator.canPop(context)) &#123;</span><br><span class="line">      Navigator.pop(context);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Global.bridge.pop();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="列表页基类"><a href="#列表页基类" class="headerlink" title="列表页基类"></a>列表页基类</h2><h3 id="封装列表UIState"><a href="#封装列表UIState" class="headerlink" title="封装列表UIState"></a>封装列表UIState</h3>继承普通页的UIState增加dataList变量<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>普通列表UIState</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseListPageUIState</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">BasePageUIState</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;T&gt; dataList = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装列表ViewModel"><a href="#封装列表ViewModel" class="headerlink" title="封装列表ViewModel"></a>封装列表ViewModel</h3>传入列表UIState实现类，列表Repository实现类，重写onReady方法调数据刷新接口<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseListPageViewModel</span>&lt;<span class="title">UIState</span> <span class="keyword">extends</span> <span class="title">BaseListPageUIState</span>,</span></span><br><span class="line"><span class="class">        <span class="title">Repository</span> <span class="keyword">extends</span> <span class="title">BaseRepository</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">BasePageViewModel</span>&lt;<span class="title">UIState</span>, <span class="title">Repository</span>&gt; </span>&#123;</span><br><span class="line">  BaseListPageViewModel(</span><br><span class="line">      &#123;required Repository repository, required UIState uiState&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(repository: repository, uiState: uiState);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onReady() &#123;</span><br><span class="line">    refreshData(isFirstLoading: <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">super</span>.onReady();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; refreshData(&#123;<span class="built_in">bool</span> isFirstLoading = <span class="keyword">false</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装列表页"><a href="#封装列表页" class="headerlink" title="封装列表页"></a>封装列表页</h3>继承普通页面基类，传入列表ViewModel，重写content方法返回带下拉刷新的listview，暴露itemExtent接口设置固定的高度重写可提升性能，设置itemCount为viewModel内置UIState中的dataList的数据长度，暴露listview的item接口给外部定义视图<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseListPage</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BaseListPageViewModel</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">BasePage</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> BaseListPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget content(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> GetBuilder&lt;T&gt;(</span><br><span class="line">        id: <span class="string">'listview'</span>,</span><br><span class="line">        builder: (viewModel) &#123;</span><br><span class="line">          <span class="keyword">return</span> EasyRefresh(</span><br><span class="line">            onRefresh: () <span class="keyword">async</span> &#123;</span><br><span class="line">              <span class="keyword">await</span> viewModel.refreshData();</span><br><span class="line">            &#125;,</span><br><span class="line">            child: ListView.builder(</span><br><span class="line">              scrollDirection: Axis.vertical,</span><br><span class="line">              itemExtent: itemExtent(),</span><br><span class="line">              itemCount: itemCount(),</span><br><span class="line">              shrinkWrap: <span class="keyword">true</span>,</span><br><span class="line">              itemBuilder: (BuildContext context, <span class="built_in">int</span> index) &#123;</span><br><span class="line">                <span class="keyword">return</span> item(context, index);</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          );</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/// 已知item固定高度时设置itemExtent值，提升列表滚动性能</span></span></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="built_in">double</span>? itemExtent() =&gt; <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="built_in">int</span>? itemCount() =&gt; viewModel.uiState.dataList.length;</span><br><span class="line"></span><br><span class="line">  Widget item(BuildContext context, <span class="built_in">int</span> index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="下拉刷新列表页基类"><a href="#下拉刷新列表页基类" class="headerlink" title="下拉刷新列表页基类"></a>下拉刷新列表页基类</h2><h3 id="封装UIState-1"><a href="#封装UIState-1" class="headerlink" title="封装UIState"></a>封装UIState</h3>继承列表UIState增加isEmptyList变量用于控制是否展示空列表视图<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseLoadMoreListPageUIState</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">BaseListPageUIState</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">bool</span> isEmptyList = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装ViewModel-1"><a href="#封装ViewModel-1" class="headerlink" title="封装ViewModel"></a>封装ViewModel</h3>继承列表ViewModel传入列表UIState实现类，列表Repository实现类，定义EasyRefreshController对象并在onInit中初始化，定义当前页数和是否有下一页变量支持分页加载，暴露加载下一页数据和刷新列表的接口<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseLoadMoreListViewModel</span>&lt;</span></span><br><span class="line"><span class="class">        <span class="title">UIState</span> <span class="keyword">extends</span> <span class="title">BaseLoadMoreListPageUIState</span>,</span></span><br><span class="line"><span class="class">        <span class="title">Repository</span> <span class="keyword">extends</span> <span class="title">BaseRepository</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">BaseListPageViewModel</span>&lt;<span class="title">UIState</span>, <span class="title">Repository</span>&gt; </span>&#123;</span><br><span class="line">  late <span class="keyword">final</span> EasyRefreshController controller;</span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="built_in">int</span> currentPage = <span class="number">1</span>;</span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  <span class="built_in">bool</span> hasNext = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  BaseLoadMoreListViewModel(</span><br><span class="line">      &#123;required Repository repository, required UIState uiState&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(repository: repository, uiState: uiState);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onInit() &#123;</span><br><span class="line">    controller = EasyRefreshController();</span><br><span class="line">    <span class="keyword">super</span>.onInit();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载下一页数据时，后端某些分页api采用偏移量计算下一页数据；某些是currentPage自增；</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; loadNextPageData();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onClose() &#123;</span><br><span class="line">    controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.onClose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> updatePageList() &#123;</span><br><span class="line">    update([<span class="string">'listView'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装加载更多列表页"><a href="#封装加载更多列表页" class="headerlink" title="封装加载更多列表页"></a>封装加载更多列表页</h3>继承列表页基类，传入加载更多列表的ViewModel，重写content方法，利用GetX的GetBuilder设置列表的id，设置列表的下拉刷新和加载更多回调，根据UIState的isEmptyList设置通用空白页面的显示，设置列表的通用底部视图，如果列表不为空加载下一页否则不加载数据<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseLoadMoreListPage</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BaseLoadMoreListViewModel</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">BaseListPage</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> BaseLoadMoreListPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget content(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> GetBuilder&lt;T&gt;(</span><br><span class="line">      id: <span class="string">'listView'</span>,</span><br><span class="line">      builder: (viewModel) &#123;</span><br><span class="line">        <span class="keyword">return</span> createContentWidget(viewModel);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@protected</span></span><br><span class="line">  Widget createContentWidget(viewModel) &#123;</span><br><span class="line">    <span class="keyword">return</span> EasyRefresh(</span><br><span class="line">      enableControlFinishLoad: <span class="keyword">false</span>,</span><br><span class="line">      enableControlFinishRefresh: <span class="keyword">false</span>,</span><br><span class="line">      taskIndependence: <span class="keyword">true</span>,</span><br><span class="line">      topBouncing: <span class="keyword">false</span>,</span><br><span class="line">      behavior: <span class="keyword">null</span>,</span><br><span class="line">      bottomBouncing: <span class="keyword">false</span>,</span><br><span class="line">      footer: PageFooter(),</span><br><span class="line">      controller: viewModel.controller,</span><br><span class="line">      emptyWidget: viewModel.uiState.isEmptyList ? empty() : <span class="keyword">null</span>,</span><br><span class="line">      onRefresh: () <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> viewModel.refreshData();</span><br><span class="line">      &#125;,</span><br><span class="line">      onLoad:</span><br><span class="line">          viewModel.uiState.isEmptyList || viewModel.uiState.dataList.isEmpty</span><br><span class="line">              ? <span class="keyword">null</span></span><br><span class="line">              : () <span class="keyword">async</span> &#123;</span><br><span class="line">                  <span class="keyword">await</span> viewModel.loadNextPageData();</span><br><span class="line">                &#125;,</span><br><span class="line">      child: ListView.builder(</span><br><span class="line">        scrollDirection: Axis.vertical,</span><br><span class="line">        itemExtent: itemExtent(),</span><br><span class="line">        itemCount: itemCount(),</span><br><span class="line">        shrinkWrap: <span class="keyword">true</span>,</span><br><span class="line">        itemBuilder: (BuildContext context, <span class="built_in">int</span> index) &#123;</span><br><span class="line">          <span class="keyword">return</span> item(context, index);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget empty() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> Padding(</span><br><span class="line">      padding: EdgeInsetsDirectional.only(</span><br><span class="line">        top: <span class="number">40</span>,</span><br><span class="line">      ),</span><br><span class="line">      child: PageEmpty(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="封装通用视图"><a href="#封装通用视图" class="headerlink" title="封装通用视图"></a>封装通用视图</h1><h2 id="空界面"><a href="#空界面" class="headerlink" title="空界面"></a>空界面</h2>通用的空界面视图，中间展示图标和文本，适配黑白模式<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageEmpty</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> PageEmpty(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      alignment: Alignment.topCenter,</span><br><span class="line">      child: Column(</span><br><span class="line">        mainAxisSize: MainAxisSize.min,</span><br><span class="line">        crossAxisAlignment: CrossAxisAlignment.center,</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Image.asset(</span><br><span class="line">            _provideImagePath(),</span><br><span class="line">            width: <span class="number">180</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">          ),</span><br><span class="line">          <span class="keyword">const</span> Padding(</span><br><span class="line">            padding: EdgeInsetsDirectional.only(top: <span class="number">12</span>),</span><br><span class="line">          ),</span><br><span class="line">          Text(</span><br><span class="line">            <span class="string">'empty'</span>,</span><br><span class="line">            style: TextStyle(</span><br><span class="line">              fontSize: <span class="number">14</span>,</span><br><span class="line">              color: ColorConfig.emphasis60,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> _provideImagePath() &#123;</span><br><span class="line">    <span class="built_in">bool</span> isDark = Global.isDark ?? <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (isDark) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"resource/images/ic_no_record_dark.png"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"resource/images/ic_no_record.png"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="列表底部视图"><a href="#列表底部视图" class="headerlink" title="列表底部视图"></a>列表底部视图</h2>通用的列表底部视图，居中展示文本<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageFooter</span> <span class="keyword">extends</span> <span class="title">Footer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> LinkFooterNotifier linkNotifier = LinkFooterNotifier();</span><br><span class="line">  PageFooter(&#123;<span class="built_in">bool</span> safeArea = <span class="keyword">true</span>&#125;) : <span class="keyword">super</span>(safeArea: safeArea);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget contentBuilder(</span><br><span class="line">      BuildContext context,</span><br><span class="line">      LoadMode loadState,</span><br><span class="line">      <span class="built_in">double</span> pulledExtent,</span><br><span class="line">      <span class="built_in">double</span> loadTriggerPullDistance,</span><br><span class="line">      <span class="built_in">double</span> loadIndicatorExtent,</span><br><span class="line">      AxisDirection axisDirection,</span><br><span class="line">      <span class="built_in">bool</span> float,</span><br><span class="line">      <span class="built_in">Duration</span>? completeDuration,</span><br><span class="line">      <span class="built_in">bool</span> enableInfiniteLoad,</span><br><span class="line">      <span class="built_in">bool</span> success,</span><br><span class="line">      <span class="built_in">bool</span> noMore) &#123;</span><br><span class="line">    linkNotifier.contentBuilder(</span><br><span class="line">        context,</span><br><span class="line">        loadState,</span><br><span class="line">        pulledExtent,</span><br><span class="line">        loadTriggerPullDistance,</span><br><span class="line">        loadIndicatorExtent,</span><br><span class="line">        axisDirection,</span><br><span class="line">        float,</span><br><span class="line">        completeDuration,</span><br><span class="line">        enableInfiniteLoad,</span><br><span class="line">        success,</span><br><span class="line">        noMore);</span><br><span class="line">    <span class="keyword">return</span> SafeArea(</span><br><span class="line">      child: Container(</span><br><span class="line">        height: <span class="number">32</span>,</span><br><span class="line">        child: Center(</span><br><span class="line">          child: Text(</span><br><span class="line">            noMore ? <span class="string">'no_more_data'</span> : <span class="string">'loading'</span>,</span><br><span class="line">            textAlign: TextAlign.center,</span><br><span class="line">            style: TextStyle(fontSize: <span class="number">12</span>, color: ColorConfig.emphasis40),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="加载视图"><a href="#加载视图" class="headerlink" title="加载视图"></a>加载视图</h2><h3 id="封装LoadingView"><a href="#封装LoadingView" class="headerlink" title="封装LoadingView"></a>封装LoadingView</h3>引入Lottie到pubspec.yaml，传入文本并展示加载图标<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoadingView</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> tips;</span><br><span class="line">  <span class="keyword">final</span> Size size;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> LoadingView(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">this</span>.tips = <span class="string">''</span>,</span><br><span class="line">    <span class="keyword">this</span>.size = <span class="keyword">const</span> Size.square(<span class="number">32</span>),</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;LoadingView&gt; createState() =&gt; _LoadingViewState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LoadingViewState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LoadingView</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> UnconstrainedBox(</span><br><span class="line">      child: Column(</span><br><span class="line">        children: [</span><br><span class="line">          Container(</span><br><span class="line">            alignment: Alignment.center,</span><br><span class="line">            width: widget.size.width,</span><br><span class="line">            height: widget.size.height,</span><br><span class="line">            child: Lottie.asset(</span><br><span class="line">              <span class="string">'resource/lottie/loading.json'</span>,</span><br><span class="line">              animate: <span class="keyword">true</span>,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          widget.tips.isEmpty</span><br><span class="line">              ? SizedBox()</span><br><span class="line">              : Text(</span><br><span class="line">                  widget.tips,</span><br><span class="line">                  textAlign: TextAlign.center,</span><br><span class="line">                  style: TextStyle(</span><br><span class="line">                    fontSize: <span class="number">12</span>,</span><br><span class="line">                    fontFamily: <span class="string">'URWDIN'</span>,</span><br><span class="line">                    fontWeight: FontWeight.w400,</span><br><span class="line">                    color: ColorConfig.emphasis,</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
通用的加载视图，中间展示LoadingView<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageLoading</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> PageLoading(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> Center(child: LoadingView(size: Size.square(<span class="number">50</span>)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="网络错误视图"><a href="#网络错误视图" class="headerlink" title="网络错误视图"></a>网络错误视图</h2>通用的网络错误，中间展示图标和文字暴露重试接口<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageNetworkError</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> OnRetry? onRetry;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> PageNetworkError(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">this</span>.onRetry,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">      child: Container(</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        margin: EdgeInsetsDirectional.only(top: <span class="number">50</span>),</span><br><span class="line">        child: Column(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Image.asset(</span><br><span class="line">              <span class="string">'resource/images/candy_net_error.png'</span>,</span><br><span class="line">              width: <span class="number">250</span>,</span><br><span class="line">              height: <span class="number">100</span>,</span><br><span class="line">            ),</span><br><span class="line">            Text(</span><br><span class="line">              <span class="string">'network_error'</span>,</span><br><span class="line">              style: TextStyle(fontSize: <span class="number">14</span>, color: ColorConfig.emphasis60),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      onTap: () =&gt; onRetry,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> OnRetry = <span class="keyword">void</span> <span class="built_in">Function</span>();</span><br></pre></td></tr></table></figure>
<h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><h2 id="普通页面-登录页面"><a href="#普通页面-登录页面" class="headerlink" title="普通页面-登录页面"></a>普通页面-登录页面</h2>这里用wanandroid的api来举例<h3 id="登录页面LoginApi"><a href="#登录页面LoginApi" class="headerlink" title="登录页面LoginApi"></a>登录页面LoginApi</h3>返回登录和注册的url<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginApi</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> LoginApi? _instance;</span><br><span class="line"></span><br><span class="line">  LoginApi._internal();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> LoginApi.getInstance() &#123;</span><br><span class="line">    _instance ??= LoginApi._internal();</span><br><span class="line">    <span class="keyword">return</span> _instance!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> getLoginUrl() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"/user/login"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> getRegisterUrl() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"/user/register"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接口返回的bean类"><a href="#接口返回的bean类" class="headerlink" title="接口返回的bean类"></a>接口返回的bean类</h3>所有字段均可空，实现fromJson方法接收map实例返回实例和toJson方法返回序列化后的map对象，可以用插件JsonToDart也可以用在线转换[0][传送门]再拷贝过来<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginBean</span> </span>&#123;</span><br><span class="line">  LoginBean(&#123;</span><br><span class="line">    <span class="keyword">this</span>.admin,</span><br><span class="line">    <span class="keyword">this</span>.chapterTops,</span><br><span class="line">    <span class="keyword">this</span>.coinCount,</span><br><span class="line">    <span class="keyword">this</span>.collectIds,</span><br><span class="line">    <span class="keyword">this</span>.email,</span><br><span class="line">    <span class="keyword">this</span>.icon,</span><br><span class="line">    <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">this</span>.nickname,</span><br><span class="line">    <span class="keyword">this</span>.password,</span><br><span class="line">    <span class="keyword">this</span>.publicName,</span><br><span class="line">    <span class="keyword">this</span>.token,</span><br><span class="line">    <span class="keyword">this</span>.type,</span><br><span class="line">    <span class="keyword">this</span>.username,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> LoginBean.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; json) &#123;</span><br><span class="line">    <span class="keyword">return</span> LoginBean(</span><br><span class="line">        admin: json[<span class="string">'admin'</span>],</span><br><span class="line">        chapterTops:</span><br><span class="line">            (json[<span class="string">'chapterTops'</span>] <span class="keyword">as</span> <span class="built_in">List</span>?)?.map((e) =&gt; e <span class="keyword">as</span> <span class="built_in">String</span>).toList(),</span><br><span class="line">        coinCount: json[<span class="string">'coinCount'</span>],</span><br><span class="line">        collectIds: (json[<span class="string">'collectIds'</span>] <span class="keyword">as</span> <span class="built_in">List</span>?)?.map((e) =&gt; e <span class="keyword">as</span> <span class="built_in">int</span>).toList(),</span><br><span class="line">        email: json[<span class="string">'email'</span>],</span><br><span class="line">        icon: json[<span class="string">'icon'</span>],</span><br><span class="line">        id: json[<span class="string">'id'</span>],</span><br><span class="line">        nickname: json[<span class="string">'nickname'</span>],</span><br><span class="line">        password: json[<span class="string">'password'</span>],</span><br><span class="line">        publicName: json[<span class="string">'publicName'</span>],</span><br><span class="line">        token: json[<span class="string">'token'</span>],</span><br><span class="line">        type: json[<span class="string">'type'</span>],</span><br><span class="line">        username: json[<span class="string">'username'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span>? admin;</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="keyword">dynamic</span>&gt;? chapterTops;</span><br><span class="line">  <span class="built_in">int</span>? coinCount;</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="keyword">dynamic</span>&gt;? collectIds;</span><br><span class="line">  <span class="built_in">String</span>? email;</span><br><span class="line">  <span class="built_in">String</span>? icon;</span><br><span class="line">  <span class="built_in">int</span>? id;</span><br><span class="line">  <span class="built_in">String</span>? nickname;</span><br><span class="line">  <span class="built_in">String</span>? password;</span><br><span class="line">  <span class="built_in">String</span>? publicName;</span><br><span class="line">  <span class="built_in">String</span>? token;</span><br><span class="line">  <span class="built_in">int</span>? type;</span><br><span class="line">  <span class="built_in">String</span>? username;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; toJson() &#123;</span><br><span class="line">    <span class="keyword">final</span> map = &lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt;&#123;&#125;;</span><br><span class="line">    map[<span class="string">'admin'</span>] = admin;</span><br><span class="line">    <span class="keyword">if</span> (chapterTops != <span class="keyword">null</span>) &#123;</span><br><span class="line">      map[<span class="string">'chapterTops'</span>] = chapterTops?.map((v) =&gt; v.toJson()).toList();</span><br><span class="line">    &#125;</span><br><span class="line">    map[<span class="string">'coinCount'</span>] = coinCount;</span><br><span class="line">    map[<span class="string">'collectIds'</span>] = collectIds?.map((v) =&gt; v.toJson()).toList();</span><br><span class="line">    map[<span class="string">'email'</span>] = email;</span><br><span class="line">    map[<span class="string">'icon'</span>] = icon;</span><br><span class="line">    map[<span class="string">'id'</span>] = id;</span><br><span class="line">    map[<span class="string">'nickname'</span>] = nickname;</span><br><span class="line">    map[<span class="string">'password'</span>] = password;</span><br><span class="line">    map[<span class="string">'publicName'</span>] = publicName;</span><br><span class="line">    map[<span class="string">'token'</span>] = token;</span><br><span class="line">    map[<span class="string">'type'</span>] = type;</span><br><span class="line">    map[<span class="string">'username'</span>] = username;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义BasePageViewModel实现类LoginLogic"><a href="#定义BasePageViewModel实现类LoginLogic" class="headerlink" title="定义BasePageViewModel实现类LoginLogic"></a>定义BasePageViewModel实现类LoginLogic</h3>调用LoginRepository的login方法发起登录请求，onReady方法中可执行loadData执行请求任务列表<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginLogic</span> <span class="keyword">extends</span> <span class="title">BasePageViewModel</span>&lt;<span class="title">LoginUIState</span>, <span class="title">LoginRepository</span>&gt; </span>&#123;</span><br><span class="line">  LoginLogic(&#123;required <span class="keyword">super</span>.uiState, required <span class="keyword">super</span>.repository&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> pageId() =&gt; LoginTrack.pageIdLogin;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onReady() &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement onReady</span></span><br><span class="line">    <span class="keyword">super</span>.onReady();</span><br><span class="line">    loadData();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> loadData() <span class="keyword">async</span> &#123;</span><br><span class="line">    activeStatus(isLoading: <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">await</span> Future.wait&lt;<span class="keyword">dynamic</span>&gt;([]);</span><br><span class="line">    activeStatus(isLoading: <span class="keyword">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> login(<span class="built_in">String</span> username, <span class="built_in">String</span> password) <span class="keyword">async</span> &#123;</span><br><span class="line">    LoginBean? loginBean = <span class="keyword">await</span> repository?.login(username, password);</span><br><span class="line">    showToast(loginBean != <span class="keyword">null</span> ? <span class="string">'登录成功'</span> : <span class="string">'登录失败'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义BaseBinding实现类LoginBinding"><a href="#定义BaseBinding实现类LoginBinding" class="headerlink" title="定义BaseBinding实现类LoginBinding"></a>定义BaseBinding实现类LoginBinding</h3>初始化LoginRemoteDataSource实例，重写provideRepository方法注入LoginRepositoryImpl的实例和LoginUIState的实例<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginLogicBinding</span> <span class="keyword">extends</span> <span class="title">BaseBinding</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dependencies() &#123;</span><br><span class="line">    Get.lazyPut&lt;LoginLogic&gt;(() =&gt;</span><br><span class="line">        LoginLogic(repository: provideRepository(), uiState: LoginUIState()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  LoginRepository provideRepository() =&gt; LoginRepositoryImpl.getInstance(LoginRemoteDataSource.getInstance());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义UIState实现类LoginUIState"><a href="#定义UIState实现类LoginUIState" class="headerlink" title="定义UIState实现类LoginUIState"></a>定义UIState实现类LoginUIState</h3>定义UI相关的变量，是否展示输入密码交互，当前是否可以登录<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginUIState</span> <span class="keyword">extends</span> <span class="title">BasePageUIState</span> </span>&#123;</span><br><span class="line">  RxBool protect = <span class="keyword">false</span>.obs;</span><br><span class="line">  RxBool loginEnable = <span class="keyword">false</span>.obs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义RemoteDataSource实现类LoginRemoteDataSource"><a href="#定义RemoteDataSource实现类LoginRemoteDataSource" class="headerlink" title="定义RemoteDataSource实现类LoginRemoteDataSource"></a>定义RemoteDataSource实现类LoginRemoteDataSource</h3>继承BaseRemoteDataSource，实现调用服务端login接口的方法并实现单例，利用封装的DioManager发起post请求<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginRemoteDataSource</span> <span class="keyword">extends</span> <span class="title">BaseRemoteDataSource</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> LoginRemoteDataSource? _instance;</span><br><span class="line"></span><br><span class="line">  LoginRemoteDataSource._internal();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> LoginRemoteDataSource.getInstance() &#123;</span><br><span class="line">    _instance ??= LoginRemoteDataSource._internal();</span><br><span class="line">    <span class="keyword">return</span> _instance!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;LoginBean?&gt; login(<span class="built_in">String</span> username, <span class="built_in">String</span> password) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> requestParams = &#123;</span><br><span class="line">      <span class="string">'username'</span>: username,</span><br><span class="line">      <span class="string">'password'</span>: password</span><br><span class="line">    &#125;;</span><br><span class="line">    BaseResult result = <span class="keyword">await</span> dioManager.postRequest(</span><br><span class="line">        LoginApi.getInstance().getLoginUrl(),</span><br><span class="line">        params: requestParams,</span><br><span class="line">        isForm: <span class="keyword">true</span>);</span><br><span class="line">    logPrint(LoginApi.getInstance().getLoginUrl(), result);</span><br><span class="line">    <span class="keyword">return</span> result.data == <span class="keyword">null</span> ? <span class="keyword">null</span> : LoginBean.fromJson(result.data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义BaseRepository子类LoginRepository"><a href="#定义BaseRepository子类LoginRepository" class="headerlink" title="定义BaseRepository子类LoginRepository"></a>定义BaseRepository子类LoginRepository</h3>定义登录接口<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginRepository</span> <span class="keyword">extends</span> <span class="title">BaseRepository</span> </span>&#123;</span><br><span class="line">  Future&lt;LoginBean?&gt; login(<span class="built_in">String</span> username, <span class="built_in">String</span> password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义RepositoryImpl子类LoginRepositoryImpl"><a href="#定义RepositoryImpl子类LoginRepositoryImpl" class="headerlink" title="定义RepositoryImpl子类LoginRepositoryImpl"></a>定义RepositoryImpl子类LoginRepositoryImpl</h3>实现LoginRepository接口的登录方法调用服务端数据处理对象请求接口，传入LoginRemoteDataSource服务端数据处理对象类型<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginRepositoryImpl</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">BaseRepositoryImp</span>&lt;<span class="title">BaseLocalDataSource</span>, <span class="title">LoginRemoteDataSource</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">LoginRepository</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> LoginRepositoryImpl? _instance;</span><br><span class="line"></span><br><span class="line">  LoginRepositoryImpl._internal(&#123;required <span class="keyword">super</span>.remoteDataSource&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> LoginRepositoryImpl.getInstance(</span><br><span class="line">      LoginRemoteDataSource loginRemoteDataSource) &#123;</span><br><span class="line">    _instance ??=</span><br><span class="line">        LoginRepositoryImpl._internal(remoteDataSource: loginRemoteDataSource);</span><br><span class="line">    <span class="keyword">return</span> _instance!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;LoginBean?&gt; login(<span class="built_in">String</span> username, <span class="built_in">String</span> password) =&gt; remoteDataSource.login(username, password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义BasePage的子类LoginPage"><a href="#定义BasePage的子类LoginPage" class="headerlink" title="定义BasePage的子类LoginPage"></a>定义BasePage的子类LoginPage</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginPage</span> <span class="keyword">extends</span> <span class="title">BasePage</span>&lt;<span class="title">LoginLogic</span>&gt; </span>&#123;</span><br><span class="line">  LoginLogic? loginLogic;</span><br><span class="line">  <span class="built_in">String</span>? username;</span><br><span class="line">  <span class="built_in">String</span>? password;</span><br><span class="line"></span><br><span class="line">  LoginPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key) &#123;</span><br><span class="line">    loginLogic = GetInstance().find&lt;LoginLogic&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> titleString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"登录"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  PreferredSizeWidget? appbar(BuildContext buildContext) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement appbar</span></span><br><span class="line">    <span class="keyword">return</span> AppBar(</span><br><span class="line">      brightness: Global.isDark! ? Brightness.dark : Brightness.light,</span><br><span class="line">      backgroundColor: appBarBackgroundColor,</span><br><span class="line">      elevation: <span class="number">0</span>,</span><br><span class="line">      centerTitle: <span class="keyword">true</span>,</span><br><span class="line">      titleSpacing: <span class="number">0</span>,</span><br><span class="line">      leading: leading(buildContext),</span><br><span class="line">      title: title(),</span><br><span class="line">      actions: actions(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt;? actions() &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      GestureDetector(</span><br><span class="line">        child: Container(</span><br><span class="line">          height: <span class="number">44</span>,</span><br><span class="line">          margin: EdgeInsetsDirectional.only(start: <span class="number">12</span>, end: <span class="number">12</span>),</span><br><span class="line">          padding: EdgeInsetsDirectional.only(bottom: <span class="number">5</span>),</span><br><span class="line">          alignment: AlignmentDirectional.center,</span><br><span class="line">          child: Image.asset(<span class="string">'resource/images/newcomer_home_rule.png'</span>,</span><br><span class="line">              width: <span class="number">24</span>, height: <span class="number">24</span>, color: ColorConfig.emphasis),</span><br><span class="line">        ),</span><br><span class="line">        onTap: () &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">'explainIcon'</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget content(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      child: ListView(</span><br><span class="line">        children: [</span><br><span class="line">          Obx(() =&gt; LoginEffect(protect: viewModel.uiState.protect.value)),</span><br><span class="line">          LoginInput(<span class="string">'用户名'</span>, <span class="string">'请输入用户名'</span>, onChanged: (text) &#123;</span><br><span class="line">            username = text;</span><br><span class="line">            checkInput();</span><br><span class="line">          &#125;),</span><br><span class="line">          LoginInput(</span><br><span class="line">            <span class="string">'密码'</span>,</span><br><span class="line">            <span class="string">'请输入密码'</span>,</span><br><span class="line">            obscureText: <span class="keyword">true</span>,</span><br><span class="line">            onChanged: (text) &#123;</span><br><span class="line">              password = text;</span><br><span class="line">              checkInput();</span><br><span class="line">            &#125;,</span><br><span class="line">            focusChanged: (focus) &#123;</span><br><span class="line">              viewModel.uiState.protect.value = focus;</span><br><span class="line">            &#125;,</span><br><span class="line">          ),</span><br><span class="line">          Obx(() =&gt; Padding(</span><br><span class="line">                padding: EdgeInsets.only(left: <span class="number">20</span>, right: <span class="number">20</span>, top: <span class="number">10</span>),</span><br><span class="line">                child: LoginButton(</span><br><span class="line">                  <span class="string">'登录'</span>,</span><br><span class="line">                  enable: viewModel.uiState.loginEnable.value,</span><br><span class="line">                  onPressed: send,</span><br><span class="line">                ),</span><br><span class="line">              ))</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> checkInput() &#123;</span><br><span class="line">    <span class="built_in">bool</span> enable;</span><br><span class="line">    <span class="keyword">if</span> (username?.isNotEmpty == <span class="keyword">true</span> &amp;&amp; password?.isNotEmpty == <span class="keyword">true</span>) &#123;</span><br><span class="line">      enable = <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      enable = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    viewModel.uiState.loginEnable.value = enable;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> send() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (username != <span class="keyword">null</span> &amp;&amp; password != <span class="keyword">null</span>) &#123;</span><br><span class="line">      loginLogic?.login(username!, password!);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装登录按钮"><a href="#封装登录按钮" class="headerlink" title="封装登录按钮"></a>封装登录按钮</h3>封装编辑框下面的圆角登录按钮<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginButton</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> enable;</span><br><span class="line">  <span class="keyword">final</span> VoidCallback? onPressed;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> LoginButton(<span class="keyword">this</span>.title, &#123;Key? key, <span class="keyword">this</span>.enable = <span class="keyword">true</span>, <span class="keyword">this</span>.onPressed&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> FractionallySizedBox(</span><br><span class="line">      widthFactor: <span class="number">1</span>,</span><br><span class="line">      child: MaterialButton(</span><br><span class="line">        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(<span class="number">6</span>)),</span><br><span class="line">        height: <span class="number">45</span>,</span><br><span class="line">        onPressed: enable ? onPressed : <span class="keyword">null</span>,</span><br><span class="line">        disabledColor: ColorConfig.primary60,</span><br><span class="line">        color: ColorConfig.primary,</span><br><span class="line">        child: Text(title, style: TextStyle(color: Colors.white, fontSize: <span class="number">16</span>)),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装登录页面顶部交互头"><a href="#封装登录页面顶部交互头" class="headerlink" title="封装登录页面顶部交互头"></a>封装登录页面顶部交互头</h3>传入密码输入时是否展示遮挡交互的标记<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginEffect</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> protect;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> LoginEffect(&#123;Key? key, required <span class="keyword">this</span>.protect&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;LoginEffect&gt; createState() =&gt; _LoginEffectState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LoginEffectState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LoginEffect</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      padding: EdgeInsets.only(top: <span class="number">10</span>),</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        color: Colors.grey[<span class="number">100</span>],</span><br><span class="line">        border: Border(bottom: BorderSide(color: Colors.grey[<span class="number">300</span>]!)),</span><br><span class="line">      ),</span><br><span class="line">      child: Row(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">        children: [</span><br><span class="line">          image(<span class="keyword">true</span>),</span><br><span class="line">          Image(</span><br><span class="line">            height: <span class="number">90</span>,</span><br><span class="line">            width: <span class="number">90</span>,</span><br><span class="line">            image: AssetImage(<span class="string">'resource/images/logo.png'</span>),</span><br><span class="line">          ),</span><br><span class="line">          image(<span class="keyword">false</span>)</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">   * </span>密码保护的交互图片</span></span></span><br><span class="line"><span class="comment"><span class="markdown">   */</span></span></span><br><span class="line">  image(<span class="built_in">bool</span> left) &#123;</span><br><span class="line">    <span class="keyword">var</span> leftImg = widget.protect</span><br><span class="line">        ? <span class="string">'resource/images/head_left_protect.png'</span></span><br><span class="line">        : <span class="string">'resource/images/head_left.png'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rightImg = widget.protect</span><br><span class="line">        ? <span class="string">'resource/images/head_right_protect.png'</span></span><br><span class="line">        : <span class="string">'resource/images/head_right.png'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Image(height: <span class="number">90</span>, image: AssetImage(left ? leftImg : rightImg));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装登录用户名密码编辑框"><a href="#封装登录用户名密码编辑框" class="headerlink" title="封装登录用户名密码编辑框"></a>封装登录用户名密码编辑框</h3>传入标题和提示文本，暴露文字/焦点改变的回调，是否有左边距，传入密码是否模糊<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginInput</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> hint;</span><br><span class="line">  <span class="keyword">final</span> ValueChanged&lt;<span class="built_in">String</span>&gt;? onChanged;</span><br><span class="line">  <span class="keyword">final</span> ValueChanged&lt;<span class="built_in">bool</span>&gt;? focusChanged;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> lineStretch;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> obscureText;</span><br><span class="line">  <span class="keyword">final</span> TextInputType? keyboardType;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> LoginInput(<span class="keyword">this</span>.title, <span class="keyword">this</span>.hint,</span><br><span class="line">      &#123;Key? key,</span><br><span class="line">      <span class="keyword">this</span>.onChanged,</span><br><span class="line">      <span class="keyword">this</span>.focusChanged,</span><br><span class="line">      <span class="keyword">this</span>.lineStretch = <span class="keyword">false</span>,</span><br><span class="line">      <span class="keyword">this</span>.obscureText = <span class="keyword">false</span>,</span><br><span class="line">      <span class="keyword">this</span>.keyboardType&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;LoginInput&gt; createState() =&gt; _LoginInputState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LoginInputState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LoginInput</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> focusNode = FocusNode();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    focusNode.addListener(() &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'Has focus: <span class="subst">$&#123;focusNode.hasFocus&#125;</span>'</span>);</span><br><span class="line">      <span class="keyword">if</span> (widget.focusChanged != <span class="keyword">null</span>) &#123;</span><br><span class="line">        widget.focusChanged!(focusNode.hasFocus);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    focusNode.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: [</span><br><span class="line">        Row(</span><br><span class="line">          children: [</span><br><span class="line">            Container(</span><br><span class="line">              padding: EdgeInsets.only(left: <span class="number">15</span>),</span><br><span class="line">              width: <span class="number">100</span>,</span><br><span class="line">              child: Text(</span><br><span class="line">                widget.title,</span><br><span class="line">                style: TextStyle(fontSize: <span class="number">16</span>),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            input()</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">        Padding(</span><br><span class="line">            padding: EdgeInsets.only(left: !widget.lineStretch ? <span class="number">15</span> : <span class="number">0</span>),</span><br><span class="line">            child: Divider(</span><br><span class="line">              height: <span class="number">1</span>,</span><br><span class="line">              thickness: <span class="number">0.5</span>,</span><br><span class="line">            )),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  input() &#123;</span><br><span class="line">    <span class="keyword">return</span> Expanded(</span><br><span class="line">        child: TextField(</span><br><span class="line">      focusNode: focusNode,</span><br><span class="line">      onChanged: widget.onChanged,</span><br><span class="line">      obscureText: widget.obscureText,</span><br><span class="line">      keyboardType: widget.keyboardType,</span><br><span class="line">      autofocus: !widget.obscureText,</span><br><span class="line">      cursorColor: ColorConfig.primary,</span><br><span class="line">      style: TextStyle(fontSize: <span class="number">16</span>, fontWeight: FontWeight.w300),</span><br><span class="line">      decoration: InputDecoration(</span><br><span class="line">          contentPadding: EdgeInsets.only(left: <span class="number">20</span>, right: <span class="number">20</span>),</span><br><span class="line">          border: InputBorder.none,</span><br><span class="line">          hintText: widget.hint,</span><br><span class="line">          hintStyle: TextStyle(fontSize: <span class="number">15</span>, color: Colors.grey)),</span><br><span class="line">    ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="加载更多列表页面-WanAndroid"><a href="#加载更多列表页面-WanAndroid" class="headerlink" title="加载更多列表页面-WanAndroid"></a>加载更多列表页面-WanAndroid</h2><h3 id="首页HomeApi"><a href="#首页HomeApi" class="headerlink" title="首页HomeApi"></a>首页HomeApi</h3>返回获取文章列表的url<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeApi</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> HomeApi? _instance;</span><br><span class="line">  HomeApi._internal();</span><br><span class="line">  <span class="keyword">factory</span> HomeApi.getInstance() &#123;</span><br><span class="line">    _instance ??= HomeApi._internal();</span><br><span class="line">    <span class="keyword">return</span> _instance!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> getArticleList(<span class="built_in">int</span> currentPage) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/article/list/<span class="subst">$currentPage</span>/json'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BaseLoadMoreListPageUIState的子类HomeUIState"><a href="#BaseLoadMoreListPageUIState的子类HomeUIState" class="headerlink" title="BaseLoadMoreListPageUIState的子类HomeUIState"></a>BaseLoadMoreListPageUIState的子类HomeUIState</h3>暂时没用到与UI显示有关的变量<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeUIState</span> <span class="keyword">extends</span> <span class="title">BaseLoadMoreListPageUIState</span>&lt;<span class="title">ArticleBean</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BaseBinding的实现类首页Binding"><a href="#BaseBinding的实现类首页Binding" class="headerlink" title="BaseBinding的实现类首页Binding"></a>BaseBinding的实现类首页Binding</h3>初始化HomeRemoteDataSource的实例，重写provideRepository方法，注入HomeRepositoryImpl的实例和HomeUIState的实例<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeBinding</span> <span class="keyword">extends</span> <span class="title">BaseBinding</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dependencies() &#123;</span><br><span class="line">    Get.lazyPut&lt;HomeLogic&gt;(() =&gt;</span><br><span class="line">        HomeLogic(repository: provideRepository(), uiState: HomeUIState()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  HomeRepository provideRepository() =&gt; HomeRepositoryImpl.getInstance(HomeRemoteDataSource.getInstance());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BaseLoadMoreListViewModel的实现类HomeLogic"><a href="#BaseLoadMoreListViewModel的实现类HomeLogic" class="headerlink" title="BaseLoadMoreListViewModel的实现类HomeLogic"></a>BaseLoadMoreListViewModel的实现类HomeLogic</h3>重写loadData方法调用repository的获取文章列表接口添加到BaseListPageUIState的dataList中，刷新是否有下一页标记，刷新下一次请求的页数<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeLogic</span> <span class="keyword">extends</span> <span class="title">BaseLoadMoreListViewModel</span>&lt;<span class="title">HomeUIState</span>, <span class="title">HomeRepository</span>&gt; </span>&#123;</span><br><span class="line">  HomeLogic(&#123;required <span class="keyword">super</span>.repository, required <span class="keyword">super</span>.uiState&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;<span class="built_in">bool</span>&gt; loadData(<span class="built_in">bool</span> isRefresh) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> repository?.getArticleList(currentPage);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isRefresh) &#123;</span><br><span class="line">      uiState.dataList.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    currentPage = result.curPage ?? <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (result.articles != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> list = result.articles?.map((e) =&gt; e <span class="keyword">as</span> ArticleBean).toList();</span><br><span class="line">      uiState.dataList.addAll(list ?? []);</span><br><span class="line">    &#125;</span><br><span class="line">    hasNext = result.curPage != result.pageCount;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BaseRemoteDataSource的实现类HomeRemoteDataSource"><a href="#BaseRemoteDataSource的实现类HomeRemoteDataSource" class="headerlink" title="BaseRemoteDataSource的实现类HomeRemoteDataSource"></a>BaseRemoteDataSource的实现类HomeRemoteDataSource</h3>调用dioManager对象发起get请求获取文章列表<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeRemoteDataSource</span> <span class="keyword">extends</span> <span class="title">BaseRemoteDataSource</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> HomeRemoteDataSource? _instance;</span><br><span class="line">  HomeRemoteDataSource._internal();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> HomeRemoteDataSource.getInstance()&#123;</span><br><span class="line">    _instance ??= HomeRemoteDataSource._internal();</span><br><span class="line">    <span class="keyword">return</span> _instance!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;ArticleList?&gt; getArticleList(<span class="built_in">int</span> currentPage) <span class="keyword">async</span>&#123;</span><br><span class="line">    <span class="built_in">String</span> requestUrl = HomeApi.getInstance().getArticleList(currentPage);</span><br><span class="line">    BaseResult result = <span class="keyword">await</span> dioManager.getRequest(requestUrl);</span><br><span class="line">    logPrint(requestUrl, result);</span><br><span class="line">    <span class="keyword">return</span> result.data == <span class="keyword">null</span> ? <span class="keyword">null</span> : ArticleList.fromJson(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  logPrint(<span class="built_in">String</span> api, BaseResult result)&#123;</span><br><span class="line">    <span class="keyword">if</span> (Global.isDebug) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"Login &gt;&gt; <span class="subst">$api</span> \n <span class="subst">$&#123;jsonEncode(result)&#125;</span>"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BaseRepository的子类HomeRepository"><a href="#BaseRepository的子类HomeRepository" class="headerlink" title="BaseRepository的子类HomeRepository"></a>BaseRepository的子类HomeRepository</h3>定义获取文章列表接口<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeRepository</span> <span class="keyword">extends</span> <span class="title">BaseRepository</span></span>&#123;</span><br><span class="line">   Future&lt;ArticleList?&gt; getArticleList(<span class="built_in">int</span> currentPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BaseRepositoryImp的子类HomeRepositoryImpl实现HomeRepository接口"><a href="#BaseRepositoryImp的子类HomeRepositoryImpl实现HomeRepository接口" class="headerlink" title="BaseRepositoryImp的子类HomeRepositoryImpl实现HomeRepository接口"></a>BaseRepositoryImp的子类HomeRepositoryImpl实现HomeRepository接口</h3>重写getArticleList方法调用服务端数据处理对象请求文章列表接口，传入HomeRemoteDataSource服务端数据处理对象类型<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeRepositoryImpl</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">BaseRepositoryImp</span>&lt;<span class="title">BaseLocalDataSource</span>, <span class="title">HomeRemoteDataSource</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">HomeRepository</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> HomeRepositoryImpl? _instance;</span><br><span class="line"></span><br><span class="line">  HomeRepositoryImpl._internal(&#123;required <span class="keyword">super</span>.remoteDataSource&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> HomeRepositoryImpl.getInstance(</span><br><span class="line">      HomeRemoteDataSource homeRemoteDataSource) &#123;</span><br><span class="line">    _instance ??=</span><br><span class="line">        HomeRepositoryImpl._internal(remoteDataSource: homeRemoteDataSource);</span><br><span class="line">    <span class="keyword">return</span> _instance!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future&lt;ArticleList?&gt; getArticleList(<span class="built_in">int</span> currentPage) =&gt;</span><br><span class="line">      remoteDataSource.getArticleList(currentPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装文章列表的Bean对象"><a href="#封装文章列表的Bean对象" class="headerlink" title="封装文章列表的Bean对象"></a>封装文章列表的Bean对象</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleList</span> </span>&#123;</span><br><span class="line">  ArticleList(&#123;</span><br><span class="line">    <span class="keyword">this</span>.curPage,</span><br><span class="line">    <span class="keyword">this</span>.articles,</span><br><span class="line">    <span class="keyword">this</span>.offset,</span><br><span class="line">    <span class="keyword">this</span>.over,</span><br><span class="line">    <span class="keyword">this</span>.pageCount,</span><br><span class="line">    <span class="keyword">this</span>.size,</span><br><span class="line">    <span class="keyword">this</span>.total,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> ArticleList.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; json) &#123;</span><br><span class="line">    <span class="keyword">return</span> ArticleList(</span><br><span class="line">        curPage: json[<span class="string">'curPage'</span>],</span><br><span class="line">        articles: (json[<span class="string">'datas'</span>] <span class="keyword">as</span> <span class="built_in">List</span>?)?</span><br><span class="line">            .map((e) =&gt; ArticleBean.fromJson(e))</span><br><span class="line">            .toList(),</span><br><span class="line">        offset: json[<span class="string">'offset'</span>],</span><br><span class="line">        over: json[<span class="string">'over'</span>],</span><br><span class="line">        pageCount: json[<span class="string">'pageCount'</span>],</span><br><span class="line">        size: json[<span class="string">'size'</span>],</span><br><span class="line">        total: json[<span class="string">'total'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span>? curPage;</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="keyword">dynamic</span>&gt;? articles;</span><br><span class="line">  <span class="built_in">int</span>? offset;</span><br><span class="line">  <span class="built_in">bool</span>? over;</span><br><span class="line">  <span class="built_in">int</span>? pageCount;</span><br><span class="line">  <span class="built_in">int</span>? size;</span><br><span class="line">  <span class="built_in">int</span>? total;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; toJson() &#123;</span><br><span class="line">    <span class="keyword">final</span> map = &lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt;&#123;&#125;;</span><br><span class="line">    map[<span class="string">'curPage'</span>] = curPage;</span><br><span class="line">    <span class="keyword">if</span> (articles != <span class="keyword">null</span>) &#123;</span><br><span class="line">      map[<span class="string">'datas'</span>] = articles?.map((v) =&gt; v.toJson()).toList();</span><br><span class="line">    &#125;</span><br><span class="line">    map[<span class="string">'offset'</span>] = offset;</span><br><span class="line">    map[<span class="string">'over'</span>] = over;</span><br><span class="line">    map[<span class="string">'pageCount'</span>] = pageCount;</span><br><span class="line">    map[<span class="string">'size'</span>] = size;</span><br><span class="line">    map[<span class="string">'total'</span>] = total;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleBean</span> </span>&#123;</span><br><span class="line">  ArticleBean(&#123;</span><br><span class="line">    <span class="keyword">this</span>.adminAdd,</span><br><span class="line">    <span class="keyword">this</span>.apkLink,</span><br><span class="line">    <span class="keyword">this</span>.audit,</span><br><span class="line">    <span class="keyword">this</span>.author,</span><br><span class="line">    <span class="keyword">this</span>.canEdit,</span><br><span class="line">    <span class="keyword">this</span>.chapterId,</span><br><span class="line">    <span class="keyword">this</span>.chapterName,</span><br><span class="line">    <span class="keyword">this</span>.collect,</span><br><span class="line">    <span class="keyword">this</span>.courseId,</span><br><span class="line">    <span class="keyword">this</span>.desc,</span><br><span class="line">    <span class="keyword">this</span>.descMd,</span><br><span class="line">    <span class="keyword">this</span>.envelopePic,</span><br><span class="line">    <span class="keyword">this</span>.fresh,</span><br><span class="line">    <span class="keyword">this</span>.host,</span><br><span class="line">    <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">this</span>.isAdminAdd,</span><br><span class="line">    <span class="keyword">this</span>.link,</span><br><span class="line">    <span class="keyword">this</span>.niceDate,</span><br><span class="line">    <span class="keyword">this</span>.niceShareDate,</span><br><span class="line">    <span class="keyword">this</span>.origin,</span><br><span class="line">    <span class="keyword">this</span>.prefix,</span><br><span class="line">    <span class="keyword">this</span>.projectLink,</span><br><span class="line">    <span class="keyword">this</span>.publishTime,</span><br><span class="line">    <span class="keyword">this</span>.realSuperChapterId,</span><br><span class="line">    <span class="keyword">this</span>.selfVisible,</span><br><span class="line">    <span class="keyword">this</span>.shareDate,</span><br><span class="line">    <span class="keyword">this</span>.shareUser,</span><br><span class="line">    <span class="keyword">this</span>.superChapterId,</span><br><span class="line">    <span class="keyword">this</span>.superChapterName,</span><br><span class="line">    <span class="keyword">this</span>.tags,</span><br><span class="line">    <span class="keyword">this</span>.title,</span><br><span class="line">    <span class="keyword">this</span>.type,</span><br><span class="line">    <span class="keyword">this</span>.userId,</span><br><span class="line">    <span class="keyword">this</span>.visible,</span><br><span class="line">    <span class="keyword">this</span>.zan,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> ArticleBean.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; json) &#123;</span><br><span class="line">    <span class="keyword">return</span> ArticleBean(</span><br><span class="line">        adminAdd: json[<span class="string">'adminAdd'</span>],</span><br><span class="line">        apkLink: json[<span class="string">'apkLink'</span>],</span><br><span class="line">        audit: json[<span class="string">'audit'</span>],</span><br><span class="line">        author: json[<span class="string">'author'</span>],</span><br><span class="line">        canEdit: json[<span class="string">'canEdit'</span>],</span><br><span class="line">        chapterId: json[<span class="string">'chapterId'</span>],</span><br><span class="line">        chapterName: json[<span class="string">'chapterName'</span>],</span><br><span class="line">        collect: json[<span class="string">'collect'</span>],</span><br><span class="line">        courseId: json[<span class="string">'courseId'</span>],</span><br><span class="line">        desc: json[<span class="string">'desc'</span>],</span><br><span class="line">        descMd: json[<span class="string">'descMd'</span>],</span><br><span class="line">        envelopePic: json[<span class="string">'envelopePic'</span>],</span><br><span class="line">        fresh: json[<span class="string">'fresh'</span>],</span><br><span class="line">        host: json[<span class="string">'host'</span>],</span><br><span class="line">        id: json[<span class="string">'id'</span>],</span><br><span class="line">        isAdminAdd: json[<span class="string">'isAdminAdd'</span>],</span><br><span class="line">        link: json[<span class="string">'link'</span>],</span><br><span class="line">        niceDate: json[<span class="string">'niceDate'</span>],</span><br><span class="line">        niceShareDate: json[<span class="string">'niceShareDate'</span>],</span><br><span class="line">        origin: json[<span class="string">'origin'</span>],</span><br><span class="line">        prefix: json[<span class="string">'prefix'</span>],</span><br><span class="line">        projectLink: json[<span class="string">'projectLink'</span>],</span><br><span class="line">        publishTime: json[<span class="string">'publishTime'</span>],</span><br><span class="line">        realSuperChapterId: json[<span class="string">'realSuperChapterId'</span>],</span><br><span class="line">        selfVisible: json[<span class="string">'selfVisible'</span>],</span><br><span class="line">        shareDate: json[<span class="string">'shareDate'</span>],</span><br><span class="line">        shareUser: json[<span class="string">'shareUser'</span>],</span><br><span class="line">        superChapterId: json[<span class="string">'superChapterId'</span>],</span><br><span class="line">        superChapterName: json[<span class="string">'superChapterName'</span>],</span><br><span class="line">        tags: (json[<span class="string">'tags'</span>] <span class="keyword">as</span> <span class="built_in">List</span>?)?.map((e) =&gt; Tag.fromJson(e)).toList(),</span><br><span class="line">        title: json[<span class="string">'title'</span>],</span><br><span class="line">        type: json[<span class="string">'type'</span>],</span><br><span class="line">        userId: json[<span class="string">'userId'</span>],</span><br><span class="line">        visible: json[<span class="string">'visible'</span>],</span><br><span class="line">        zan: json[<span class="string">'zan'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span>? adminAdd;</span><br><span class="line">  <span class="built_in">String</span>? apkLink;</span><br><span class="line">  <span class="built_in">int</span>? audit;</span><br><span class="line">  <span class="built_in">String</span>? author;</span><br><span class="line">  <span class="built_in">bool</span>? canEdit;</span><br><span class="line">  <span class="built_in">int</span>? chapterId;</span><br><span class="line">  <span class="built_in">String</span>? chapterName;</span><br><span class="line">  <span class="built_in">bool</span>? collect;</span><br><span class="line">  <span class="built_in">int</span>? courseId;</span><br><span class="line">  <span class="built_in">String</span>? desc;</span><br><span class="line">  <span class="built_in">String</span>? descMd;</span><br><span class="line">  <span class="built_in">String</span>? envelopePic;</span><br><span class="line">  <span class="built_in">bool</span>? fresh;</span><br><span class="line">  <span class="built_in">String</span>? host;</span><br><span class="line">  <span class="built_in">int</span>? id;</span><br><span class="line">  <span class="built_in">bool</span>? isAdminAdd;</span><br><span class="line">  <span class="built_in">String</span>? link;</span><br><span class="line">  <span class="built_in">String</span>? niceDate;</span><br><span class="line">  <span class="built_in">String</span>? niceShareDate;</span><br><span class="line">  <span class="built_in">String</span>? origin;</span><br><span class="line">  <span class="built_in">String</span>? prefix;</span><br><span class="line">  <span class="built_in">String</span>? projectLink;</span><br><span class="line">  <span class="built_in">int</span>? publishTime;</span><br><span class="line">  <span class="built_in">int</span>? realSuperChapterId;</span><br><span class="line">  <span class="built_in">int</span>? selfVisible;</span><br><span class="line">  <span class="keyword">dynamic</span> shareDate;</span><br><span class="line">  <span class="built_in">String</span>? shareUser;</span><br><span class="line">  <span class="built_in">int</span>? superChapterId;</span><br><span class="line">  <span class="built_in">String</span>? superChapterName;</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="keyword">dynamic</span>&gt;? tags;</span><br><span class="line">  <span class="built_in">String</span>? title;</span><br><span class="line">  <span class="built_in">int</span>? type;</span><br><span class="line">  <span class="built_in">int</span>? userId;</span><br><span class="line">  <span class="built_in">int</span>? visible;</span><br><span class="line">  <span class="built_in">int</span>? zan;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; toJson() &#123;</span><br><span class="line">    <span class="keyword">final</span> map = &lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt;&#123;&#125;;</span><br><span class="line">    map[<span class="string">'adminAdd'</span>] = adminAdd;</span><br><span class="line">    map[<span class="string">'apkLink'</span>] = apkLink;</span><br><span class="line">    map[<span class="string">'audit'</span>] = audit;</span><br><span class="line">    map[<span class="string">'author'</span>] = author;</span><br><span class="line">    map[<span class="string">'canEdit'</span>] = canEdit;</span><br><span class="line">    map[<span class="string">'chapterId'</span>] = chapterId;</span><br><span class="line">    map[<span class="string">'chapterName'</span>] = chapterName;</span><br><span class="line">    map[<span class="string">'collect'</span>] = collect;</span><br><span class="line">    map[<span class="string">'courseId'</span>] = courseId;</span><br><span class="line">    map[<span class="string">'desc'</span>] = desc;</span><br><span class="line">    map[<span class="string">'descMd'</span>] = descMd;</span><br><span class="line">    map[<span class="string">'envelopePic'</span>] = envelopePic;</span><br><span class="line">    map[<span class="string">'fresh'</span>] = fresh;</span><br><span class="line">    map[<span class="string">'host'</span>] = host;</span><br><span class="line">    map[<span class="string">'id'</span>] = id;</span><br><span class="line">    map[<span class="string">'isAdminAdd'</span>] = isAdminAdd;</span><br><span class="line">    map[<span class="string">'link'</span>] = link;</span><br><span class="line">    map[<span class="string">'niceDate'</span>] = niceDate;</span><br><span class="line">    map[<span class="string">'niceShareDate'</span>] = niceShareDate;</span><br><span class="line">    map[<span class="string">'origin'</span>] = origin;</span><br><span class="line">    map[<span class="string">'prefix'</span>] = prefix;</span><br><span class="line">    map[<span class="string">'projectLink'</span>] = projectLink;</span><br><span class="line">    map[<span class="string">'publishTime'</span>] = publishTime;</span><br><span class="line">    map[<span class="string">'realSuperChapterId'</span>] = realSuperChapterId;</span><br><span class="line">    map[<span class="string">'selfVisible'</span>] = selfVisible;</span><br><span class="line">    map[<span class="string">'shareDate'</span>] = shareDate;</span><br><span class="line">    map[<span class="string">'shareUser'</span>] = shareUser;</span><br><span class="line">    map[<span class="string">'superChapterId'</span>] = superChapterId;</span><br><span class="line">    map[<span class="string">'superChapterName'</span>] = superChapterName;</span><br><span class="line">    <span class="keyword">if</span> (tags != <span class="keyword">null</span>) &#123;</span><br><span class="line">      map[<span class="string">'tags'</span>] = tags?.map((v) =&gt; v.toJson()).toList();</span><br><span class="line">    &#125;</span><br><span class="line">    map[<span class="string">'title'</span>] = title;</span><br><span class="line">    map[<span class="string">'type'</span>] = type;</span><br><span class="line">    map[<span class="string">'userId'</span>] = userId;</span><br><span class="line">    map[<span class="string">'visible'</span>] = visible;</span><br><span class="line">    map[<span class="string">'zan'</span>] = zan;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span> </span>&#123;</span><br><span class="line">  Tag(&#123;</span><br><span class="line">    <span class="keyword">this</span>.name,</span><br><span class="line">    <span class="keyword">this</span>.url,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Tag.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; json) &#123;</span><br><span class="line">    <span class="keyword">return</span> Tag(name: json[<span class="string">'name'</span>], url: json[<span class="string">'url'</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span>? name;</span><br><span class="line">  <span class="built_in">String</span>? url;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; toJson() &#123;</span><br><span class="line">    <span class="keyword">final</span> map = &lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt;&#123;&#125;;</span><br><span class="line">    map[<span class="string">'name'</span>] = name;</span><br><span class="line">    map[<span class="string">'url'</span>] = url;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BasePage的实现类HomePage"><a href="#BasePage的实现类HomePage" class="headerlink" title="BasePage的实现类HomePage"></a>BasePage的实现类HomePage</h3>重写首页展示标题，重写item方法返回列表项视图<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">BaseLoadMoreListPage</span>&lt;<span class="title">HomeLogic</span>&gt; </span>&#123;</span><br><span class="line">  HomeLogic? homeLogic;</span><br><span class="line"></span><br><span class="line">  HomePage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key) &#123;</span><br><span class="line">    homeLogic = GetInstance().find&lt;HomeLogic&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> titleString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'首页'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget item(BuildContext context, <span class="built_in">int</span> index) &#123;</span><br><span class="line">    <span class="keyword">return</span> ArticleItemView(</span><br><span class="line">        articleBean: viewModel.uiState.dataList[index],</span><br><span class="line">        onClickCollect: (collect) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">'click collect'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="封装文章列表项"><a href="#封装文章列表项" class="headerlink" title="封装文章列表项"></a>封装文章列表项</h3>外部Widget传入ViewModel中的UIState中的dataList中的某条ArticleBean数据项，传入回调方法onClickCollect，定义collect通过GetX的Obx机制结合obs变量刷新局部视图<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleItemView</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> ArticleBean articleBean;</span><br><span class="line">  <span class="keyword">final</span> OnClickCollect onClickCollect;</span><br><span class="line">  RxBool collect = <span class="keyword">false</span>.obs;</span><br><span class="line"></span><br><span class="line">  ArticleItemView(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    required <span class="keyword">this</span>.articleBean,</span><br><span class="line">    required <span class="keyword">this</span>.onClickCollect,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;ArticleItemView&gt; createState() =&gt; _ArticleItemViewState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ArticleItemViewState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">ArticleItemView</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> itemClick(ArticleBean articleBean) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> itemCollect(ArticleBean articleBean) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">String</span> authorTitle;</span><br><span class="line">    <span class="built_in">String</span> author;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (widget.articleBean.author == <span class="keyword">null</span> ||</span><br><span class="line">        widget.articleBean.author!.isEmpty) &#123;</span><br><span class="line">      authorTitle = <span class="string">"分享人:"</span>;</span><br><span class="line">      author = widget.articleBean.shareUser ?? <span class="string">""</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      authorTitle = <span class="string">"作者:"</span>;</span><br><span class="line">      author = widget.articleBean.author ?? <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Row row = Row(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Expanded(</span><br><span class="line">            child: Text(</span><br><span class="line">          <span class="string">"<span class="subst">$authorTitle</span><span class="subst">$author</span>"</span>,</span><br><span class="line">          style: TextStyle(color: ColorConfig.emphasis, fontSize: <span class="number">13</span>),</span><br><span class="line">        )),</span><br><span class="line">        Text(</span><br><span class="line">          widget.articleBean.niceDate ?? <span class="string">""</span>,</span><br><span class="line">          style: TextStyle(color: ColorConfig.emphasis, fontSize: <span class="number">13</span>),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">    Row title = Row(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Expanded(</span><br><span class="line">            child: Text.rich(</span><br><span class="line">          TextSpan(text: widget.articleBean.title ?? <span class="string">""</span>),</span><br><span class="line">          softWrap: <span class="keyword">true</span>,</span><br><span class="line">          style: TextStyle(fontSize: <span class="number">16.0</span>, color: ColorConfig.emphasis),</span><br><span class="line">          textAlign: TextAlign.left,</span><br><span class="line">        )),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">    Row chapterName = Row(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">      children: [</span><br><span class="line">        Container(</span><br><span class="line">          padding: EdgeInsets.only(left: <span class="number">4</span>, right: <span class="number">4</span>, top: <span class="number">1</span>, bottom: <span class="number">2</span>),</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">              color: ColorConfig.darkOverLay,</span><br><span class="line">              borderRadius: BorderRadius.circular(<span class="number">2</span>)),</span><br><span class="line">          child: Text(</span><br><span class="line">            widget.articleBean.chapterName ?? <span class="string">""</span>,</span><br><span class="line">            softWrap: <span class="keyword">true</span>,</span><br><span class="line">            style: TextStyle(color: ColorConfig.emphasis60, fontSize: <span class="number">12</span>),</span><br><span class="line">            textAlign: TextAlign.left,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        Obx(() =&gt; GestureDetector(</span><br><span class="line">              child: Icon(</span><br><span class="line">                widget.collect.value ? Icons.favorite : Icons.favorite_border,</span><br><span class="line">                color: widget.collect.value ? Colors.red : <span class="keyword">null</span>,</span><br><span class="line">              ),</span><br><span class="line">              onTap: () &#123;</span><br><span class="line">                widget.articleBean.collect =</span><br><span class="line">                    !widget.articleBean.collect.notNull();</span><br><span class="line">                widget.collect.value = widget.articleBean.collect.notNull();</span><br><span class="line">                widget.onClickCollect</span><br><span class="line">                    .call(widget.articleBean.collect.notNull());</span><br><span class="line">              &#125;,</span><br><span class="line">            ))</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    Column column = Column(</span><br><span class="line">      children: [</span><br><span class="line">        title,</span><br><span class="line">        SizedBox(</span><br><span class="line">          height: <span class="number">5</span>,</span><br><span class="line">        ),</span><br><span class="line">        row,</span><br><span class="line">        SizedBox(</span><br><span class="line">          height: <span class="number">5</span>,</span><br><span class="line">        ),</span><br><span class="line">        chapterName</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> InkWell(</span><br><span class="line">        onTap: () &#123;</span><br><span class="line">          itemClick(widget.articleBean);</span><br><span class="line">        &#125;,</span><br><span class="line">        child: Container(</span><br><span class="line">          padding: EdgeInsets.symmetric(vertical: <span class="number">8</span>, horizontal: <span class="number">12</span>),</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">            color: Colors.white,</span><br><span class="line">            borderRadius: BorderRadius.circular(<span class="number">4</span>),</span><br><span class="line">          ),</span><br><span class="line">          margin: EdgeInsets.all(<span class="number">4</span>),</span><br><span class="line">          child: column,</span><br><span class="line">        ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> OnClickCollect = <span class="keyword">void</span> <span class="built_in">Function</span>(<span class="built_in">bool</span> collect);</span><br></pre></td></tr></table></figure>

</li>
</ul>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Architecture/" rel="tag"># Architecture</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2022/07/24/PasswordView/" rel="next" title="六位密码输入框">
                  <i class="fa fa-chevron-left"></i> 六位密码输入框
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2022/10/03/Dio-IOWebSocketChannel/" rel="prev" title="flutter封装网络层（http和WebSocket请求）">
                  flutter封装网络层（http和WebSocket请求） <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#架构图"><span class="nav-number">1.</span> <span class="nav-text">架构图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Repository"><span class="nav-number">2.</span> <span class="nav-text">Repository</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LocalDataSource本地存储"><span class="nav-number">2.1.</span> <span class="nav-text">LocalDataSource本地存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#工具类封装"><span class="nav-number">2.1.1.</span> <span class="nav-text">工具类封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本地存储基类"><span class="nav-number">2.1.2.</span> <span class="nav-text">本地存储基类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络请求基类"><span class="nav-number">2.1.3.</span> <span class="nav-text">网络请求基类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Repository基类"><span class="nav-number">2.1.4.</span> <span class="nav-text">Repository基类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Repository基础实现类"><span class="nav-number">2.1.5.</span> <span class="nav-text">Repository基础实现类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Binding基类"><span class="nav-number">3.</span> <span class="nav-text">Binding基类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#封装页面基类"><span class="nav-number">4.</span> <span class="nav-text">封装页面基类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#封装页面基类ViewModel"><span class="nav-number">5.</span> <span class="nav-text">封装页面基类ViewModel</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#通用页面基类"><span class="nav-number">6.</span> <span class="nav-text">通用页面基类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#普通页基类"><span class="nav-number">6.1.</span> <span class="nav-text">普通页基类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#封装UIState"><span class="nav-number">6.1.1.</span> <span class="nav-text">封装UIState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装ViewModel"><span class="nav-number">6.1.2.</span> <span class="nav-text">封装ViewModel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装普通页面"><span class="nav-number">6.1.3.</span> <span class="nav-text">封装普通页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列表页基类"><span class="nav-number">6.2.</span> <span class="nav-text">列表页基类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#封装列表UIState"><span class="nav-number">6.2.1.</span> <span class="nav-text">封装列表UIState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装列表ViewModel"><span class="nav-number">6.2.2.</span> <span class="nav-text">封装列表ViewModel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装列表页"><span class="nav-number">6.2.3.</span> <span class="nav-text">封装列表页</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下拉刷新列表页基类"><span class="nav-number">6.3.</span> <span class="nav-text">下拉刷新列表页基类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#封装UIState-1"><span class="nav-number">6.3.1.</span> <span class="nav-text">封装UIState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装ViewModel-1"><span class="nav-number">6.3.2.</span> <span class="nav-text">封装ViewModel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装加载更多列表页"><span class="nav-number">6.3.3.</span> <span class="nav-text">封装加载更多列表页</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#封装通用视图"><span class="nav-number">7.</span> <span class="nav-text">封装通用视图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#空界面"><span class="nav-number">7.1.</span> <span class="nav-text">空界面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列表底部视图"><span class="nav-number">7.2.</span> <span class="nav-text">列表底部视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加载视图"><span class="nav-number">7.3.</span> <span class="nav-text">加载视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#封装LoadingView"><span class="nav-number">7.3.1.</span> <span class="nav-text">封装LoadingView</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络错误视图"><span class="nav-number">7.4.</span> <span class="nav-text">网络错误视图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#应用场景"><span class="nav-number">8.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#普通页面-登录页面"><span class="nav-number">8.1.</span> <span class="nav-text">普通页面-登录页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#登录页面LoginApi"><span class="nav-number">8.1.1.</span> <span class="nav-text">登录页面LoginApi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接口返回的bean类"><span class="nav-number">8.1.2.</span> <span class="nav-text">接口返回的bean类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义BasePageViewModel实现类LoginLogic"><span class="nav-number">8.1.3.</span> <span class="nav-text">定义BasePageViewModel实现类LoginLogic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义BaseBinding实现类LoginBinding"><span class="nav-number">8.1.4.</span> <span class="nav-text">定义BaseBinding实现类LoginBinding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义UIState实现类LoginUIState"><span class="nav-number">8.1.5.</span> <span class="nav-text">定义UIState实现类LoginUIState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义RemoteDataSource实现类LoginRemoteDataSource"><span class="nav-number">8.1.6.</span> <span class="nav-text">定义RemoteDataSource实现类LoginRemoteDataSource</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义BaseRepository子类LoginRepository"><span class="nav-number">8.1.7.</span> <span class="nav-text">定义BaseRepository子类LoginRepository</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义RepositoryImpl子类LoginRepositoryImpl"><span class="nav-number">8.1.8.</span> <span class="nav-text">定义RepositoryImpl子类LoginRepositoryImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义BasePage的子类LoginPage"><span class="nav-number">8.1.9.</span> <span class="nav-text">定义BasePage的子类LoginPage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装登录按钮"><span class="nav-number">8.1.10.</span> <span class="nav-text">封装登录按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装登录页面顶部交互头"><span class="nav-number">8.1.11.</span> <span class="nav-text">封装登录页面顶部交互头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装登录用户名密码编辑框"><span class="nav-number">8.1.12.</span> <span class="nav-text">封装登录用户名密码编辑框</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加载更多列表页面-WanAndroid"><span class="nav-number">8.2.</span> <span class="nav-text">加载更多列表页面-WanAndroid</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#首页HomeApi"><span class="nav-number">8.2.1.</span> <span class="nav-text">首页HomeApi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseLoadMoreListPageUIState的子类HomeUIState"><span class="nav-number">8.2.2.</span> <span class="nav-text">BaseLoadMoreListPageUIState的子类HomeUIState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseBinding的实现类首页Binding"><span class="nav-number">8.2.3.</span> <span class="nav-text">BaseBinding的实现类首页Binding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseLoadMoreListViewModel的实现类HomeLogic"><span class="nav-number">8.2.4.</span> <span class="nav-text">BaseLoadMoreListViewModel的实现类HomeLogic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseRemoteDataSource的实现类HomeRemoteDataSource"><span class="nav-number">8.2.5.</span> <span class="nav-text">BaseRemoteDataSource的实现类HomeRemoteDataSource</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseRepository的子类HomeRepository"><span class="nav-number">8.2.6.</span> <span class="nav-text">BaseRepository的子类HomeRepository</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseRepositoryImp的子类HomeRepositoryImpl实现HomeRepository接口"><span class="nav-number">8.2.7.</span> <span class="nav-text">BaseRepositoryImp的子类HomeRepositoryImpl实现HomeRepository接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装文章列表的Bean对象"><span class="nav-number">8.2.8.</span> <span class="nav-text">封装文章列表的Bean对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BasePage的实现类HomePage"><span class="nav-number">8.2.9.</span> <span class="nav-text">BasePage的实现类HomePage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装文章列表项"><span class="nav-number">8.2.10.</span> <span class="nav-text">封装文章列表项</span></a></li></ol></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jessie Kate</p>
  <div class="site-description" itemprop="description">程序的世界，比你牛逼的人更比你努力。<br /> hello，I'm an Android developer～ <br /> My hobbies tag &#58; <br /> - Coding  <br /> - Sports   <br /> - Game</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jessie Kate</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">
      
    Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.1
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>
<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'aedb4031c50b7b9201d6',
      clientSecret: 'f77b152663ed74c8570f87e2483c2eb12cdd252c',
      repo: 'jessieeeee.github.io',
      owner: 'jessieeeee',
      admin: ['jessieeeee'],
      id: '9e04979a5a58ad252d023ce97122e951',
        language: window.navigator.language || window.navigator.userLanguage,
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
