<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="ç¨‹åºçš„ä¸–ç•Œï¼Œæ¯”ä½ ç‰›é€¼çš„äººæ›´æ¯”ä½ åŠªåŠ›ã€‚ helloï¼ŒI&apos;m an Android developerï½  My hobbies tag &amp;#58;  - Coding   - Sports    - Game">
<meta property="og:type" content="website">
<meta property="og:title" content="JessieK&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="JessieK&#39;s blog">
<meta property="og:description" content="ç¨‹åºçš„ä¸–ç•Œï¼Œæ¯”ä½ ç‰›é€¼çš„äººæ›´æ¯”ä½ åŠªåŠ›ã€‚ helloï¼ŒI&apos;m an Android developerï½  My hobbies tag &amp;#58;  - Coding   - Sports    - Game">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JessieK&#39;s blog">
<meta name="twitter:description" content="ç¨‹åºçš„ä¸–ç•Œï¼Œæ¯”ä½ ç‰›é€¼çš„äººæ›´æ¯”ä½ åŠªåŠ›ã€‚ helloï¼ŒI&apos;m an Android developerï½  My hobbies tag &amp;#58;  - Coding   - Sports    - Game">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>JessieK's blog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JessieK's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">My Technical sharing</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/16/IjkplayerSo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/16/IjkplayerSo/" itemprop="url">ijkplayerç¼–è¯‘soæ–‡ä»¶æ”¯æŒæ›´å¤šæ ¼å¼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-02-16T21:50:54+08:00">
                2019-02-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/16/IjkplayerSo/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/02/16/IjkplayerSo/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/16/IjkplayerSo/" class="leancloud_visitors" data-flag-title="ijkplayerç¼–è¯‘soæ–‡ä»¶æ”¯æŒæ›´å¤šæ ¼å¼">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>bilibiliå¤§åé¼é¼çš„ijkplayerå¼€æºæ’­æ”¾å™¨ï¼Œæœ‰æ”¯æŒffmpegæ‹“å±•ï¼Œå¯æ‹“å±•æ€§é«˜ï¼Œä½“ç§¯å°çš„ä¼˜ç‚¹ï¼Œæˆä¸ºå¾ˆå¤šå…¬å¸çš„é¦–é€‰æ’­æ”¾å™¨ï¼Œä½†å®˜æ–¹ç»™çš„demoåªæ”¯æŒmp4æ ¼å¼ï¼Œæƒ³è¦æ”¯æŒæ¨ªå¤šçš„è§†é¢‘æ ¼å¼éœ€è¦è‡ªå·±ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡æ–°ç¼–è¯‘å‡ºsoæ–‡ä»¶æ‰èƒ½å®ç°ï¼Œä¹‹å‰æŠ˜è…¾äº†å¾ˆä¹…ï¼Œä¸€ç›´æ˜¯å¾ªç¯ç¼–è¯‘ï¼Œæœ€åç¼–è¯‘å¤±è´¥ã€‚å‘¨æœ«é—²æ¥ä¸‹äº†ï¼Œç»§ç»­æŠ˜è…¾ç»ˆäºç¼–è¯‘æˆåŠŸï¼Œä¸‹é¢å¯¹ijkplayerçš„é…ç½®ä¿®æ”¹å’Œç¼–è¯‘åšä¸€ä¸ªè¯¦ç»†è®°å½•ï¼Œæ–¹ä¾¿ä»¥åæŸ¥é˜…ã€‚</p>
<p>ç¼–è¯‘å‰æï¼šåœ¨linuxæˆ–è€…macå¼€å‘ç¯å¢ƒä¸‹ï¼Œé…ç½®å¥½JDK,SDK,NDKçš„ç¯å¢ƒå˜é‡</p>
<p>ç¼–è¯‘æ­¥éª¤ï¼š</p>
<ol>
<li>git clone ijkplayerçš„æºç </li>
<li>é€šè¿‡init-android.shè„šæœ¬æŠŠijkplayerçš„jniæºç å’Œffmepgçš„æºç æ‹‰ä¸‹æ¥</li>
<li>å¦‚æœè¦æ”¯æŒhttpsï¼Œé€šè¿‡init-android-openssl.shæŠŠopensslçš„ä»£ç æ‹‰ä¸‹æ¥</li>
<li>ç”¨è„šæœ¬compile-openssl.shç¼–è¯‘openssl</li>
<li>é€‰æ‹©ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®</li>
<li>ç”¨è„šæœ¬compile-ffmpeg.shç¼–è¯‘ffmpeg</li>
<li>ç”¨è„šæœ¬compile-ijk.shç¼–è¯‘ijkplayerçš„jniæºç </li>
</ol>
<p>ä¸‹é¢æ˜¯å…·ä½“çš„æ“ä½œè¿‡ç¨‹ï¼š</p>
<ol>
<li><p>æ‹‰ijkplayerçš„æºç </p>
<p><code>git clone https://github.com/bilibili/ijkplayer</code></p>
</li>
<li><p>åˆ‡æ¢ç›®å½•ï¼ŒæŠŠijkplayerçš„jniæºç å’Œffmepgçš„æºç æ‹‰ä¸‹æ¥</p>
<p><code>cd ijkplayer</code></p>
<p><code>./init-android.sh</code></p>
</li>
<li><p>æŠŠopensslçš„ä»£ç æ‹‰ä¸‹æ¥</p>
<p><code>./init-android-openssl.sh</code></p>
</li>
<li><p>åˆ‡æ¢ç›®å½•ï¼Œç¼–è¯‘openssl</p>
<p><code>cd android/contrib</code></p>
<p><code>./compile-openssl.sh clean</code></p>
<p><code>./compile-openssl.sh all</code></p>
</li>
<li><p>åˆ‡æ¢ç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œåˆ é™¤ä¹‹å‰çš„é…ç½®æ–‡ä»¶è½¯é“¾æ¥ï¼Œå¹¶é‡æ–°è®¾ç½®ä¸€ä¸ªé…ç½®æ–‡ä»¶çš„è½¯é“¾æ¥</p>
<p><code>cd ../../</code></p>
<p><code>cd config</code></p>
<p><code>rm module.sh</code></p>
<p><code>ln -s module-default.sh module.sh</code></p>
<p>æ³¨æ„module-lite.shæ˜¯ç²¾ç®€äº†æ”¯æŒæ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œmodule-default.shè¿™ä¸ªæ˜¯æ”¯æŒæ ¼å¼è¾ƒå¤šçš„é…ç½®æ–‡ä»¶</p>
<p>è¿™ä¸€æ­¥ï¼Œé‡åˆ°äº†ä¸€ä¸ªé”™è¯¯<code>linux/perf_event.h: No such file</code>ï¼Œå½“æ‰§è¡Œffmpegçš„ç¼–è¯‘æ“ä½œï¼Œ<code>./compile-ffmpeg.sh all</code>æ‰ä¼šæç¤ºã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>å…ˆåˆ é™¤ä¹‹å‰çš„è½¯é“¾æ¥æ–‡ä»¶<code>rm module.sh</code></p>
<p>æ”¹ä¸€ä¸‹module-default.shé…ç½®æ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ 2è¡Œä»£ç ï¼š</p>
   <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export COMMON_FF_CFG_FLAGS="$COMMON_FF_CFG_FLAGS --disable-linux-perf"</div><div class="line">export COMMON_FF_CFG_FLAGS="$COMMON_FF_CFG_FLAGS --disable-bzlib"</div></pre></td></tr></table></figure>
<p>å†åˆ›å»ºè½¯é“¾æ¥<code>ln -s module-default.sh module.sh</code></p>
</li>
<li><p>åˆ‡æ¢ç›®å½•ï¼Œç¼–è¯‘ffmpeg</p>
<p><code>cd ..</code></p>
<p><code>cd android/contrib</code></p>
<p><code>./compile-ffmpeg.sh clean</code></p>
<p><code>./compile-ffmpeg.sh all</code></p>
<p>è¿™ä¸€æ­¥ï¼Œé‡åˆ°äº†ä¸€ä¸ªé”™è¯¯<code>nasm/yasm not found or too old. Use --disable-x86asm for a crippled build</code></p>
<p> æç¤ºæ±‡ç¼–å·¥å…·æ²¡æœ‰å®‰è£…ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>å¯ä»¥å®‰è£…yasmï¼Œæˆ–è€…æŒ‰ç…§æç¤ºæ‰§è¡Œ./configure â€“disable-x86asmï¼Œç”±äºyasmæš‚æ—¶ç”¨ä¸ä¸Šï¼Œé‚£ä¹ˆå°±æ‰§è¡Œ./configure â€“disable-x86asmæ¥è§£å†³ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ç¼–è¯‘ffmpegæ˜¯é€šè¿‡shellè„šæœ¬ï¼Œæ‰€ä»¥åªèƒ½å»æ”¹è„šæœ¬ã€‚</p>
<p>æˆ‘ä»¬æ‰“å¼€compile-ffmpeg.shè¿™ä¸ªè„šæœ¬å‘ç°å®ƒå…¶å®æ˜¯åœ¨æ‰§è¡Œtools/do-compile-ffmpeg.shè¿™ä¸ªè„šæœ¬ï¼Œå†æ‰“å¼€do-compile-ffmpeg.shï¼Œæœç´¢æ˜¯å¦æœ‰<code>./configure</code>è¿™ä¸ªå‘½ä»¤ï¼Œæœç„¶åœ¨305è¡Œï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ç›¸å…³ä»£ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">./configure $FF_CFG_FLAGS \</div><div class="line">       --extra-cflags="$FF_CFLAGS $FF_EXTRA_CFLAGS" \</div><div class="line">       --extra-ldflags="$FF_DEP_LIBS $FF_EXTRA_LDFLAGS"</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå…³æ³¨ä¸€ä¸‹FF_CFG_FLAGSè¿™ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®ƒåé¢è¿½åŠ <code>--disable-x86asm</code>è¿™ä¸ªå‚æ•°å‘½ä»¤</p>
<p>ä¿®æ”¹FF_CFG_FLAGSå˜é‡åº”è¯¥åœ¨è°ƒç”¨<code>./configure</code>å‘½ä»¤ä¹‹å‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ ä¸€å¥ä»£ç åœ¨294è¡Œï¼š</p>
<p><code>FF_CFG_FLAGS=&quot;$FF_CFG_FLAGS --disable-x86asm&quot;</code>ï¼Œå…ˆæ¸…é™¤ä¹‹å‰ç¼–è¯‘çš„æ–‡ä»¶<code>./compile-ffmpeg.sh clean</code>ï¼Œå†ç¼–è¯‘ä¸€æ¬¡<code>./compile-ffmpeg.sh all</code>è¿™ä¸ªé”™è¯¯å°±è§£å†³äº†ã€‚</p>
</li>
<li><p>åˆ‡æ¢ç›®å½•ï¼Œç¼–è¯‘ijkplayerçš„jniæºç </p>
<p><code>cd ..</code></p>
<p><code>./compile-ijk.sh all</code></p>
<p>ç¼–è¯‘å®Œæˆï¼Œsoæ–‡ä»¶ä¸€èˆ¬ä¿ç•™arm-v7açš„å°±å¯ä»¥äº†ï¼Œè·¯å¾„æ˜¯<code>/ijkplayer/android/ijkplayer/ijkplayer-armv7a/src/main/libs/armeabi-v7a</code>æ¯”è¾ƒmodule-default.shå’Œmodule-lite.shç¼–è¯‘å‡ºæ¥çš„soæ–‡ä»¶ï¼Œå‰é¢ä¸€ä¸ªæ˜æ˜¾å¤§ä¸€äº›ã€‚</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/04/RaspberryStart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/04/RaspberryStart/" itemprop="url">æ ‘è“æ´¾æŠ˜è…¾è®°å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-02-04T23:54:18+08:00">
                2019-02-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/04/RaspberryStart/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/02/04/RaspberryStart/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/04/RaspberryStart/" class="leancloud_visitors" data-flag-title="æ ‘è“æ´¾æŠ˜è…¾è®°å½•">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>æ”¾å‡å‰åœ¨å…¬å¸çœ‹åˆ°æœ‰åŒäº‹åœ¨ç©æ ‘è“æ´¾ï¼Œè§‰å¾—æŒºæœ‰æ„æ€ï¼Œä¹‹å‰ä¹Ÿæ›¾ç»äº†è§£è¿‡ï¼Œä½†æ˜¯ä¸€ç›´éƒ½æ²¡æœ‰ä¸‹å®šå†³å®šä¹°ä¸€ä¸ªç©ç©ï¼Œè¿™æ¬¡ä¹Ÿç®—æ˜¯è¢«åŒäº‹æ‹‰ä¸‹æ°´å§ï¼Œè¶ç€è¿™æ¬¡æ”¾å‡çš„æœºä¼šï¼Œåœ¨æ·˜å®ä¸Šä¹°äº†ä¸ªæœ€æ–°çš„æ ‘è“æ´¾3B+ æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œä»å°ç™½å¼€å§‹æ ‘è“æ´¾çš„æŠ˜è…¾ä¹‹æ—…ã€‚æƒ³åˆ°è‡ªå·±æœ‰linuxçš„åŸºç¡€åº”è¯¥ä¸Šæ‰‹ä¸ä¼šå¤ªéš¾ï¼Œæ²¡æƒ³åˆ°è¿˜æ˜¯è¸©äº†ä¸å°‘çš„å‘ï¼Œåœ¨è´­ä¹°çš„æ—¶å€™æ·˜å®åº—å®¶è¯´ä¼šæœ‰æŠ€æœ¯æ”¯æŒï¼Œç»“æœæ”¾å‡äº†å®Œå…¨ä¸å›æ¶ˆæ¯ğŸ˜”ï¼Œä¸è¿‡é‡åˆ°çš„é—®é¢˜è¿˜æ˜¯è‡ªå·±æ…¢æ…¢è¸©å‘çˆ¬å‡ºæ¥äº†ï¼Œåœ¨è¿™é‡Œåšä¸ªç®€å•çš„è®°å½•ã€‚</p>
<hr>
<h1 id="æŠ˜è…¾æ ‘è“æ´¾çš„å‡†å¤‡å·¥ä½œ"><a href="#æŠ˜è…¾æ ‘è“æ´¾çš„å‡†å¤‡å·¥ä½œ" class="headerlink" title="æŠ˜è…¾æ ‘è“æ´¾çš„å‡†å¤‡å·¥ä½œ"></a>æŠ˜è…¾æ ‘è“æ´¾çš„å‡†å¤‡å·¥ä½œ</h1><h2 id="è´´æ•£çƒ­è´´"><a href="#è´´æ•£çƒ­è´´" class="headerlink" title="è´´æ•£çƒ­è´´"></a>è´´æ•£çƒ­è´´</h2><p>æ‹¿åˆ°æ ‘è“æ´¾çš„ä¸»æ¿åï¼Œå…ˆè´´å¥½æ•£çƒ­è´´ï¼Œæ€»å…±3ä¸ªæ•£çƒ­è´´ï¼Œæœ‰2ä¸ªå¸¦è„šçš„æ•£çƒ­è´´å’Œ1ä¸ªä¸å¸¦è„šå¹¶æœ‰æ ‘è“æ ‡å¿—çš„æ•£çƒ­è´´ï¼Œä¸»è¦æ˜¯3ä¸ªåœ°æ–¹ï¼ŒCPUï¼ŒGPUå’Œå†…å­˜ï¼Œå…¶ä¸­CPUå’ŒGPUåœ¨ä¸»æ¿çš„æ­£é¢ï¼Œè´´ä¸¤ä¸ªå¸¦è„šçš„æ•£çƒ­ç‰‡ï¼Œæ­£ä¸­æœ‰ä¸¤ä¸ªè¿‘ä¼¼äºæ­£æ–¹å½¢çš„æ–¹å—ï¼Œå¤§çš„æ˜¯CPUï¼Œå°çš„æ˜¯GPUï¼Œè€Œå†…å­˜åœ¨ä¸»æ¿çš„èƒŒé¢ï¼Œè´´ä¸å¸¦è„šå¹¶æœ‰æ ‘è“æ ‡å¿—çš„æ•£çƒ­è´´ã€‚</p>
<h2 id="è¿æ¥é£æ‰‡"><a href="#è¿æ¥é£æ‰‡" class="headerlink" title="è¿æ¥é£æ‰‡"></a>è¿æ¥é£æ‰‡</h2><p>æ ‘è“æ´¾çš„é£æ‰‡ä¸»è¦æœ‰2æ ¹è¿æ¥çº¿ï¼Œçº¢è‰²å’Œé»‘è‰²ï¼Œçº¢è‰²æ¥4é’ˆè„šï¼Œé»‘è‰²æ¥6é’ˆè„šï¼Œå¯¹åº”æ ‘è“æ´¾ä¸Šçš„ä¸¤åˆ—é’ˆè„šåŒºåŸŸï¼Œç¬¬äºŒåˆ—çš„ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªé’ˆè„šã€‚å¦‚æœæ ‘è“æ´¾é€šç”µï¼Œæ¥å…¥åé£æ‰‡å°±å¯ä»¥é©¬ä¸Šè½¬èµ·æ¥ã€‚</p>
<h2 id="å®‰è£…ç³»ç»Ÿ"><a href="#å®‰è£…ç³»ç»Ÿ" class="headerlink" title="å®‰è£…ç³»ç»Ÿ"></a>å®‰è£…ç³»ç»Ÿ</h2><p>å°†SDå¡æ’å…¥è¯»å¡å™¨ï¼Œç”¨ç³»ç»Ÿçƒ§å½•å·¥å…·ï¼ŒMacä¸ºbalenaEtcherï¼Œä¸‹è½½å¥½å®˜ç½‘çš„debianç³»ç»Ÿçš„zipæ–‡ä»¶ï¼Œç„¶åçƒ§å½•åˆ°SDå¡ä¸­ã€‚ç„¶åæŠŠSDå¡æ’å…¥æ ‘è“æ´¾çš„SDå¡æ§½ï¼Œå°†æ ‘è“æ´¾æ¥ä¸Šç”µæºï¼Œè¿™æ—¶çº¢è‰²ç¯å…‰å¸¸é‡ï¼Œä»£è¡¨ç”µæºæ¥é€šæ­£å¸¸ã€‚æ ‘è“æ´¾è¯»å–SDå¡ï¼Œè‡ªåŠ¨å¯åŠ¨ç³»ç»Ÿï¼Œç³»ç»Ÿå¯åŠ¨å¥½åç»¿è‰²ç¯å…‰é—ªçƒï¼Œä»£è¡¨ç³»ç»Ÿå·²ç»å¯åŠ¨å®Œæ¯•ã€‚</p>
<h2 id="æ¥å…¥å±€åŸŸç½‘"><a href="#æ¥å…¥å±€åŸŸç½‘" class="headerlink" title="æ¥å…¥å±€åŸŸç½‘"></a>æ¥å…¥å±€åŸŸç½‘</h2><p>ç”±äºmacæ— æ³•æ’å…¥ç½‘çº¿ç›´æ¥è®¿é—®æ ‘è“æ´¾ï¼Œå¯ä»¥æŠŠæ ‘è“æ´¾çš„ç½‘çº¿æ’å…¥åˆ°è·¯ç”±å™¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è·¯ç”±å™¨çš„è®¾å¤‡ç®¡ç†ç•Œé¢çœ‹åˆ°æ ‘è“æ´¾çš„IPåœ°å€ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç”¨å‘½ä»¤è¡Œå·¥å…·sshæˆ–è€…å›¾å½¢åŒ–ç•Œé¢vncè¿œç¨‹è®¿é—®åˆ°æˆ‘ä»¬çš„æ ‘è“æ´¾ã€‚</p>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>ä½œä¸ºå°ç™½ï¼Œåœ¨å‰æœŸçš„å‡†å¤‡å·¥ä½œä¹Ÿé‡åˆ°äº†å‘ğŸ˜”ï¼Œç”±äºç³»ç»Ÿä¸‹é”™äº†ï¼Œä¸‹æˆäº†è™šæ‹Ÿæœºçš„æ ‘è“æ´¾é•œåƒæ–‡ä»¶ï¼ˆè¿™æ˜¯ä¸ªISOæ–‡ä»¶ï¼‰æ— è¯­çš„æ˜¯balenaEtcherçƒ§å½•ç³»ç»Ÿåˆ°SDå¡çš„æ—¶å€™ä¹Ÿæ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼Œå¯¼è‡´SDå¡æ’å…¥åˆ°SDå¡æ§½åæ— æ³•æ­£å¸¸å¯åŠ¨ç³»ç»Ÿï¼ˆç„¶è€Œæˆ‘å½“æ—¶å¹¶ä¸çŸ¥é“ï¼‰ï¼Œæ‰€ä»¥æ¥å…¥åˆ°å±€åŸŸç½‘ä¸­å‘ç°è·¯ç”±å™¨çš„è®¾å¤‡ç®¡ç†ç•Œé¢æ ¹æœ¬æ²¡æœ‰çœ‹åˆ°æ ‘è“æ´¾è¿™ä¸ªè®¾å¤‡ã€‚åé¢çœ‹åˆ°æ ‘è“æ´¾æŒ‡ç¤ºç¯ç›¸å…³çš„å†…å®¹åï¼Œæ‰æ˜ç™½åŸæ¥ç³»ç»Ÿéƒ½æ²¡è·‘èµ·æ¥ã€‚è¿™é‡Œæ¨èä½¿ç”¨Raspbian Stretch Liteç‰ˆçš„ç³»ç»Ÿï¼Œæ¯”è¾ƒç¨³å®šï¼Œæ²¡æœ‰å¤šä½™çš„åŠŸèƒ½ï¼Œçº¯å‘½ä»¤è¡Œçš„ç³»ç»Ÿï¼ˆä¹‹å‰å®‰è£…è¿‡å¸¦å›¾å½¢ç•Œé¢çš„ï¼Œå‘ç°ä¸å¤ªå¥½ç”¨ï¼Œç”¨åˆ°çš„ä¹Ÿå°‘ï¼Œå› ä¸ºå¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯å‘½ä»¤è¡Œä¸‹å®ç°çš„ï¼‰ã€‚å¦‚æœä½ å‘ç°æ’å…¥SDå¡åªæœ‰çº¢è‰²ç¯äº®ï¼Œä¸æ˜¯æ²¡æœ‰è¯»åˆ°SDå¡ï¼Œå°±æ˜¯ç³»ç»Ÿå¯åŠ¨å¤±è´¥ï¼ŒåŒæ ·å…³æœºæ—¶æ‰§è¡Œå…³æœºå‘½ä»¤åï¼Œç­‰åˆ°ç»¿è‰²ç¯ç†„ç­æ‰æ˜¯ç³»ç»Ÿæ­£å¸¸å…³é—­ï¼Œå†æ‹”æ‰ç”µæºã€‚ä¸‹é¢å¯¹å¸¸ç”¨çš„æ ‘è“æ´¾æŒ‡ç¤ºç¯å«ä¹‰åšä¸€ä¸ªæ€»ç»“ï¼š</p>
<ol>
<li>ç»¿è‰²ç¯é—ªçƒï¼Œè¯»å–åˆ°äº†SDå¡å¹¶ä¸”ä¹Ÿæ­£å¸¸å¯åŠ¨äº†ç³»ç»Ÿ</li>
<li>çº¢è‰²ç¯å¸¸äº®ï¼Œç”µæºæ¥å…¥æ­£å¸¸</li>
<li>æ©™è‰²ç¯äº®å…¨åŒå·¥çŠ¶æ€ï¼Œä¸äº®åŠåŒå·¥çŠ¶æ€</li>
</ol>
<h1 id="shadowsocksé…ç½®"><a href="#shadowsocksé…ç½®" class="headerlink" title="shadowsocksé…ç½®"></a>shadowsocksé…ç½®</h1><ol>
<li>å®‰è£…pythonçš„ä¾èµ–åº“<br><code>sudo apt-get install python-pip python-gevent python-m2crypto</code></li>
<li>åˆ©ç”¨pythonå®‰è£…shadowsocksï¼Œæ³¨æ„åˆ«å¿˜è®°sudoï¼Œå¦åˆ™å¯èƒ½é€ æˆå®‰è£…è·¯å¾„æœ‰é—®é¢˜è€Œæ— æ³•ä½¿ç”¨sslocalçš„å‘½ä»¤<br>i</li>
<li>ä¿®æ”¹/usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.pyï¼Œå°†æ­¤æ–‡ä»¶ä¸­çš„52è¡Œå’Œ111è¡Œä¸­çš„cleanupæ›¿æ¢ä¸ºresetï¼Œå¦åˆ™å¯èƒ½æ‰§è¡Œå¯åŠ¨å‘½ä»¤æŠ¥é”™</li>
<li><p>åˆ›å»ºshadowsocksçš„é…ç½®æ–‡ä»¶ss_conf.jsonï¼Œéœ€æ ¹æ®shadowsocksæœåŠ¡å™¨çš„ä¿¡æ¯æ›¿æ¢ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"><span class="attr">"server"</span>:<span class="string">"server_ip"</span>,</div><div class="line"><span class="attr">"server_port"</span>:server_port,</div><div class="line"><span class="attr">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</div><div class="line"><span class="attr">"local_port"</span>:<span class="number">1080</span>,</div><div class="line"><span class="attr">"password"</span>:<span class="string">"password"</span>,</div><div class="line"><span class="attr">"timeout"</span>:<span class="number">600</span>,</div><div class="line"><span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>æœ€åæ‰§è¡Œå¯åŠ¨å‘½ä»¤<br><code>sudo sslocal -c ./ss_conf.json -d start</code></p>
<h1 id="privoxyé…ç½®"><a href="#privoxyé…ç½®" class="headerlink" title="privoxyé…ç½®"></a>privoxyé…ç½®</h1><p>åœ¨æ ‘è“æ´¾ä¸‹å‘½ä»¤è¡Œæ¢¯å­æ˜¯ååˆ†æœ‰å¿…è¦çš„ï¼Œç»™http,httpsè®¾ç½®ä»£ç†ä½¿ç”¨privoxyã€‚</p>
</li>
<li>å®‰è£…privoxy<br><code>sudo apt install privoxy</code></li>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶<br><code>sudo vi /etc/privoxy/config</code><br>783è¡Œï¼Œå»æ‰æ³¨é‡Š<br><code>listen-address 127.0.0.1:8118</code><br>1336è¡Œï¼Œå»æ‰æ³¨é‡Šï¼Œæ³¨æ„ä¸ssåœ°å€ç«¯å£å·ä¿æŒä¸€è‡´<br><code>forward-socks5t / 127.0.0.1:1080</code></li>
<li>é…ç½®å¼€æœºå¯åŠ¨<br><code>sudo vi /etc/profile</code><br><code>export https_proxy=http://127.0.0.1:8118</code><br><code>export http_proxy=http://127.0.0.1:8118</code></li>
<li>é‡å¯<br><code>sudo systemctl restart privoxy</code><h1 id="å¼€æœºå¯åŠ¨è®¾ç½®"><a href="#å¼€æœºå¯åŠ¨è®¾ç½®" class="headerlink" title="å¼€æœºå¯åŠ¨è®¾ç½®"></a>å¼€æœºå¯åŠ¨è®¾ç½®</h1>è¿™ä¸ªæ­¥éª¤ä¼°è®¡æ˜¯æˆ‘çˆ¬å‘æ—¶é—´æœ€é•¿çš„åœ°æ–¹ï¼Œå†™å…¥å‘½ä»¤åˆ°rc.localé…ç½®æ–‡ä»¶ä¸­å³å¯å®ç°å¼€æœºå¯åŠ¨çš„åŠŸèƒ½ï¼Œç„¶è€Œåˆ°æ ‘è“æ´¾ä¸Šå§‹ç»ˆæ— æ³•å®ç°ã€‚<br><code>sudo systemctl status rc-local</code>å¯ä»¥æŸ¥çœ‹å¼€æœºå¯åŠ¨å¤±è´¥çš„åŸå› <br>åŸå› åœ¨äºdebianç³»ç»Ÿä¸­rc.localé»˜è®¤æ‰§è¡Œçš„æ˜¯dashè„šæœ¬ï¼Œä¸bashå­˜åœ¨å·®å¼‚å¯¼è‡´æ— æ³•è¿è¡Œã€‚<br><code>ls -l /bin/sh</code>æŸ¥çœ‹å½“å‰ç³»ç»Ÿè¿è¡Œçš„è„šæœ¬ç±»å‹ã€‚<br><code>sudo dpkg-reconfigure dash</code>é€‰æ‹©NOï¼Œä¸ä½¿ç”¨Dash Shellã€‚<br><code>chmod +x /etc/rc.local</code> æ·»åŠ æ‰§è¡Œæƒé™<h1 id="ä¿®æ”¹aptæº"><a href="#ä¿®æ”¹aptæº" class="headerlink" title="ä¿®æ”¹aptæº"></a>ä¿®æ”¹aptæº</h1>æ ‘è“æ´¾é»˜è®¤çš„aptæºåœ¨è‹±å›½ï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼Œå³ä½¿æˆ‘é…ç½®äº†é¦™æ¸¯çš„httpä»£ç†ï¼Œè¿˜æ˜¯å¾ˆæ…¢ï¼Œæ¢æˆäº†é˜¿é‡Œçš„æºé€Ÿåº¦è¿˜ä¸é”™ã€‚<br>ä¿®æ”¹aptæºçš„é…ç½®æ–‡ä»¶<br><code>sudo vi /etc/apt/sources.list</code><br>æ³¨é‡Šæ‰åŸæ¥çš„æºï¼Œæ·»åŠ <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">deb http://mirrors.aliyun.com/raspbian/raspbian/ jessie main non-free contrib rpi</div><div class="line">deb-src http://mirrors.aliyun.com/raspbian/raspbian/ jessie main non-free contrib rpi</div></pre></td></tr></table></figure>
</li>
</ol>
<p>æ›´æ–°ç´¢å¼•æ¸…å•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div></pre></td></tr></table></figure></p>
<p>æ›´æ–°ä¾èµ–åº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get upgrade -y</div></pre></td></tr></table></figure></p>
<h1 id="Uç›˜æŒ‚è½½å’Œå¸è½½"><a href="#Uç›˜æŒ‚è½½å’Œå¸è½½" class="headerlink" title="Uç›˜æŒ‚è½½å’Œå¸è½½"></a>Uç›˜æŒ‚è½½å’Œå¸è½½</h1><h2 id="æŒ‚è½½uç›˜"><a href="#æŒ‚è½½uç›˜" class="headerlink" title="æŒ‚è½½uç›˜"></a>æŒ‚è½½uç›˜</h2><p><code>sudo mount -o umask=0000 /dev/sda1 ~/Downloads</code><br>-o é…ç½®æŒ‚è½½å¯é€‰é¡¹ï¼Œumask=0000å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½å¯è¯»å¯å†™å¯æ‰§è¡Œ<br>/dev/sda1 usbåˆ†åŒºè·¯å¾„<br><code>fdisk -l</code>å¯æŸ¥çœ‹åˆ†åŒº<br>~/Downloads è¦æŒ‚è½½çš„æ–‡ä»¶å¤¹è·¯å¾„</p>
<h2 id="å¸è½½uç›˜"><a href="#å¸è½½uç›˜" class="headerlink" title="å¸è½½uç›˜"></a>å¸è½½uç›˜</h2><p><code>sudo umount -l ~/Downloads</code><br>-l å¼ºåˆ¶å¸è½½ï¼Œé¿å…busyçš„é”™è¯¯æç¤º</p>
<h1 id="dlnaæœåŠ¡å™¨æ­å»º"><a href="#dlnaæœåŠ¡å™¨æ­å»º" class="headerlink" title="dlnaæœåŠ¡å™¨æ­å»º"></a>dlnaæœåŠ¡å™¨æ­å»º</h1><ol>
<li>å®‰è£…dlna<br><code>apt-get install minidlna</code></li>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶<br><code>sudo vi /etc/minidlna.conf</code><br><code>media_dir=/home/pi/Downloads</code><br>ä¿®æ”¹media_dirçš„å˜é‡æŒ‡å‘èµ„æºè·¯å¾„ï¼Œè¿™é‡Œæˆ‘æ˜¯æŒ‚è½½Uç›˜ä¸Šçš„èµ„æºï¼Œé‡åˆ°äº†ä¸€ä¸ªå‘ï¼Œéœ€è¦åˆ·æ–°èµ„æºç´¢å¼•ï¼Œè€—äº†å¾ˆé•¿æ—¶é—´ï¼Œç½‘ä¸Šå¾ˆå¤šè¯´dlnaåˆ·æ–°å‘½ä»¤æ˜¯<code>sudo service minidlna force-reload</code>æˆ‘å‘ç°å¹¶æ²¡æœ‰ä½œç”¨ï¼Œä»¥ä¸ºæ˜¯é…ç½®æ–‡ä»¶çš„é—®é¢˜æ”¹äº†å¾ˆå¤šæ¬¡ï¼Œè¿˜æ˜¯ä¸èµ·ä½œç”¨ï¼Œåæ¥å‘ç°èµ„æºåˆ·æ–°çš„æ­£ç¡®å§¿åŠ¿æ˜¯è¿™æ ·ï¼š<br><code>sudo minidlna -R</code><br>ç„¶åé‡å¯æœåŠ¡ï¼š<br><code>sudo service minidlna restart</code><br>è®¾ç½®å¼€æœºå¯åŠ¨<br><code>sudo update-rc.d minidlna defaults</code><br>è®¿é—®<code>http://æ ‘è“æ´¾ipåœ°å€:8200</code>æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸Šçš„èµ„æºç±»å‹å’Œæ•°é‡<h1 id="smabaæœåŠ¡å™¨æ­å»º"><a href="#smabaæœåŠ¡å™¨æ­å»º" class="headerlink" title="smabaæœåŠ¡å™¨æ­å»º"></a>smabaæœåŠ¡å™¨æ­å»º</h1></li>
<li>å®‰è£…smaba<br><code>sudo apt-get install samba samba-common-bin</code><br>ç¬¬äºŒä¸ªå‘½ä»¤ä¹Ÿé‡åˆ°è¿‡ä¸€ä¸ªå‘ï¼Œå°±æ˜¯smabaçš„éƒ¨åˆ†ä¾èµ–åº“å·²ç»å®‰è£…ï¼Œä¸”ç‰ˆæœ¬é«˜äºsmabaä¾èµ–çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ—¶å€™å‘½ä»¤è¡Œæ˜¯ä¸ä¼šå®‰è£…smabaçš„ï¼Œéœ€è¦æŠŠè¿™äº›å·²ç»å®‰è£…çš„ä¾èµ–åº“å¸è½½æ‰é‡æ–°å®‰è£…ã€‚</li>
<li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<br><code>sudo vi /etc/samba/smb.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[share]           #å…±äº«æ–‡ä»¶çš„åç§°ï¼Œ å°†åœ¨ç½‘ç»œä¸Šä»¥æ­¤åç§°æ˜¾ç¤º</div><div class="line">path = /share         #å…±äº«æ–‡ä»¶çš„è·¯å¾„</div><div class="line">valid users = pi        #å…è®¸è®¿é—®çš„ç”¨æˆ·</div><div class="line">browseable = yes        #å…è®¸æµè§ˆ</div><div class="line">public = yes        #å…±äº«å¼€æ”¾</div><div class="line">writable = yes        #å¯å†™</div></pre></td></tr></table></figure>
</li>
<li><p>é‡å¯smaba<br><code>sudo /etc/init.d/samba restart</code></p>
<h1 id="ftpæœåŠ¡å™¨æ­å»º"><a href="#ftpæœåŠ¡å™¨æ­å»º" class="headerlink" title="ftpæœåŠ¡å™¨æ­å»º"></a>ftpæœåŠ¡å™¨æ­å»º</h1><p>ftpæ–¹ä¾¿æ–‡ä»¶ä¼ è¾“ï¼Œè€Œä¸”vsftpdæ­å»ºæœåŠ¡å™¨åªæœ‰400k</p>
</li>
<li>å®‰è£…sftp<br><code>sudo apt-get install vsftpd</code></li>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶<br><code>sudo vim /etc/vsftpd.conf</code><br>é…ç½®å¯é€‰é¡¹å¦‚ä¸‹ï¼š<br>ç¦æ­¢åŒ¿åç”¨æˆ·ç™»å½•ï¼šanonymous_enable=NO<br>é…ç½®ç”¨æˆ·å¯ä»¥å†™æƒé™ï¼šwrite_enable=YES<br>é…ç½®uMaskï¼šlocal_umask=022ï¼ˆ077ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œä¿®æ”¹ä¸º022ï¼‰</li>
<li>é‡å¯<br><code>sudo service vsftpd restart</code><h1 id="æŠ˜è…¾æ‘„åƒå¤´"><a href="#æŠ˜è…¾æ‘„åƒå¤´" class="headerlink" title="æŠ˜è…¾æ‘„åƒå¤´"></a>æŠ˜è…¾æ‘„åƒå¤´</h1>æˆ‘åœ¨è´­ä¹°æ ‘è“æ´¾ä¸»æ¿çš„æ—¶å€™ï¼Œä¹Ÿè´­ä¹°äº†å®˜æ–¹çš„æ‘„åƒå¤´ï¼Œå®ƒæ˜¯usbæ¥å£ï¼Œæ’å…¥æ ‘è“æ´¾çš„usbæ¥å£åï¼Œè¾“å…¥å‘½ä»¤ï¼š<code>ls /dev</code>å¦‚æœæ­¤æ—¶èƒ½è¯†åˆ«åˆ°video0çš„è®¾å¤‡æ—¶ï¼Œä»£è¡¨æ ‘è“æ´¾å·²è¯†åˆ«ã€‚<br>æ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨<code>lsusb</code>å‘½ä»¤åŒæ ·å¯ä»¥æŸ¥çœ‹è¿™ä¸ªè®¾å¤‡çš„idVendorå’ŒidProduct<h2 id="æ‹æ‘„ç…§ç‰‡"><a href="#æ‹æ‘„ç…§ç‰‡" class="headerlink" title="æ‹æ‘„ç…§ç‰‡"></a>æ‹æ‘„ç…§ç‰‡</h2>æ‹æ‘„ä¸€å¼ ç…§ç‰‡<br><code>sudo fswebcam image.jpg</code><br>é¢„è§ˆ<br><code>gpicview image.jpg</code><h2 id="æ­å»ºè§†é¢‘æµæœåŠ¡å™¨"><a href="#æ­å»ºè§†é¢‘æµæœåŠ¡å™¨" class="headerlink" title="æ­å»ºè§†é¢‘æµæœåŠ¡å™¨"></a>æ­å»ºè§†é¢‘æµæœåŠ¡å™¨</h2><h3 id="å®‰è£…ä¾èµ–åº“å’Œç¼–è¯‘åº“"><a href="#å®‰è£…ä¾èµ–åº“å’Œç¼–è¯‘åº“" class="headerlink" title="å®‰è£…ä¾èµ–åº“å’Œç¼–è¯‘åº“"></a>å®‰è£…ä¾èµ–åº“å’Œç¼–è¯‘åº“</h3><code>sudo apt install libjpeg8-dev</code><br><code>sudo apt install imagemagic</code><br><code>sudo apt install libv4l-dev</code><br><code>sudo apt install cmake</code><h3 id="å®‰è£…mjpg-streamer"><a href="#å®‰è£…mjpg-streamer" class="headerlink" title="å®‰è£…mjpg-streamer"></a>å®‰è£…mjpg-streamer</h3>å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°å¹¶ç¼–è¯‘<br><code>sudo git clone https://github.com/jacksonliam/mjpg-streamer.git</code><br><code>cd mjpg-streamer/mjpg-streamer-experimental</code><br><code>make all</code><br><code>sudo make install</code><br>å¯åŠ¨æµæœåŠ¡å™¨<br><code>./mjpg_streamer -i &quot;./input_uvc.so&quot; -o &quot;./output_http.so -w ./www&quot;</code><br>æ­¤æ—¶æŠ¥é”™ï¼Œæ ‘è“æ´¾å®˜æ–¹çš„æ‘„åƒå¤´ä¸æ”¯æŒv4lçš„é©±åŠ¨ï¼Œéœ€å®‰è£…UV4Lå…¼å®¹é©±åŠ¨ï¼Œè§£å†³æ–¹æ³•æ˜¯<br>æ·»åŠ è½¯ä»¶æº<br><code>curl https://www.linux-projects.org/listing/uv4l_repo/lrkey.asc | sudo apt-key add -</code><br>ä¿®æ”¹apt-getçš„æºåˆ—è¡¨æ–‡ä»¶<code>/etc/apt/sources.list</code>ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ <br><code>deb https://www.linux-projects.org/listing/uv4l_repo/raspbian/ wheezy main</code><br>å†å®‰è£…å…¼å®¹é©±åŠ¨<br><code>sudo rpi-update</code><br><code>sudo apt-get update</code><br><code>sudo apt-get install uv4l uv4l-raspicam</code><br><code>sudo service uv4l_raspicam restart</code><br><code>sudo pkill uv4l</code><br><code>sudo apt-get update</code><br><code>sudo apt install uv4l-uvc</code><br><code>sudo apt install uv4l-xscreen</code><br><code>sudo apt install uv4l-mjpegstream</code><br>å¯åŠ¨æµæœåŠ¡å™¨<br><code>./mjpg_streamer -i &quot;./input_uvc.so&quot; -o &quot;./output_http.so -w ./www&quot;</code><br>å‘ç°ä»ç„¶æŠ¥é”™<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Unable to set format: 1196444237 res: 640x480</div><div class="line">Init v4L2 failed !! exit fatal</div></pre></td></tr></table></figure>
</li>
</ol>
<p>mjpg-streamæ”¯æŒJPEGå’ŒYUVä¸¤ç§æ ¼å¼ï¼Œé»˜è®¤é‡‡ç”¨JPEGï¼Œè¿™é‡Œæ˜¯å› ä¸ºæ ‘è“æ´¾å®˜æ–¹çš„æ‘„åƒå¤´ä¸æ”¯æŒJPEG<br>è§£å†³æ–¹æ¡ˆ1:<br><code>cd mjpg-streamer-experimental/plugins/input_uvc/</code><br><code>sudo vi input_uvc.c</code><br>å°†<code>format = V4L2_PIX_FMT_MJPEG</code>æ”¹ä¸º<code>format = V4L2_PIX_FMT_YUYV</code><br>è§£å†³æ–¹æ¡ˆ2:<br>ç”¨å‘½ä»¤å‚æ•°-yä½¿ç”¨YUVç¼–ç <br><code>./mjpg_streamer -i &quot;./input_uvc.so -y&quot; -o &quot;./output_http.so -w ./www&quot;</code><br>æ­¤æ—¶çœ‹åˆ°å¯åŠ¨ä¿¡æ¯å·²ç»å¯åŠ¨ï¼Œä½†æ˜¯æœ‰ä¸€å †error<br>ç”¨å‘½ä»¤å‚æ•°-næ¥æ¶ˆé™¤error<br><code>./mjpg_streamer -i &quot;./input_uvc.so -y -n&quot; -o &quot;./output_http.so -w ./www&quot;</code></p>
<p>è®¿é—®æ ‘è“æ´¾çš„ip:8080å°±å¯ä»¥çœ‹åˆ°é‡‡é›†çš„è§†é¢‘äº†</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/27/ScrollPage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/27/ScrollPage/" itemprop="url">window.scrollToå¤±æ•ˆäº†æ€ä¹ˆåŠï¼Ÿä½¿ç”¨puppeteerå®ç°å±å¹•æ»‘åŠ¨æ•ˆæœ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-01-27T14:56:38+08:00">
                2019-01-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/27/ScrollPage/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/01/27/ScrollPage/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/01/27/ScrollPage/" class="leancloud_visitors" data-flag-title="window.scrollToå¤±æ•ˆäº†æ€ä¹ˆåŠï¼Ÿä½¿ç”¨puppeteerå®ç°å±å¹•æ»‘åŠ¨æ•ˆæœ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>åˆæ˜¯å¾ˆä¹…æ²¡æœ‰å†™åšå®¢äº†ï¼Œæœ€è¿‘åœ¨ææ¼«ç”»çˆ¬è™«é¡¹ç›®æ—¶å‘ç°æŸäº›ç½‘ç«™æŠŠwindow.scrollToæ–¹æ³•éƒ½å±è”½äº†ï¼Œç”±äºå¤§å¤šæ•°æ¼«ç”»ç½‘ç«™éƒ½æ˜¯åœ¨ç½‘é¡µæ»šåŠ¨æ—¶åŠ¨æ€åŠ è½½ï¼Œæ‰€ä»¥å¦‚æœæ— æ³•å®ç°ç½‘é¡µæ»šåŠ¨æ˜¯æ²¡åŠæ³•çˆ¬å–åˆ°æ‰€æœ‰æ¼«ç”»çš„ï¼Œå¹¸å¥½è¿˜å¥½æœ‰googleçˆ¸çˆ¸ç»´æŠ¤çš„puppeteerçˆ¬è™«æ¡†æ¶ï¼Œè¿™ä¸ªå¼ºå¤§çš„æ¡†æ¶å½“ç„¶æ˜¯æ— è§†è¿™äº›æ–¹æ³•å±è”½çš„ï¼Œå®ƒå¯ä»¥å®ç°é¼ æ ‡æŒ‰ä¸‹ï¼Œæ»‘åŠ¨ï¼Œå¼¹èµ·ç­‰ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–æ“ä½œï¼Œé‚£ä¹ˆåˆ©ç”¨è¿™äº›æ–¹æ³•æˆ‘ä»¬å°±å¯ä»¥å®ç°ç½‘é¡µæ»‘åŠ¨äº†ï¼Œåœ¨æ­¤ï¼Œé’ˆå¯¹åŸç”Ÿæ»‘åŠ¨æ–¹æ³•éƒ½è¢«å±è”½çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨puppeteerå®ç°ç½‘é¡µæ»‘åŠ¨åšä¸€ä¸ªè®°å½•ã€‚å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•çš„å°ä¼™ä¼´æ¬¢è¿ä¸€èµ·äº¤æµè®¨è®ºã€‚</p>
<hr>
<p>å‰å‡ å¤©æˆ‘ç»´æŠ¤ä»£ç çš„æ—¶å€™ï¼Œçªç„¶å‘ç°çˆ¬è™«ä»£ç æŠ¥é”™äº†ğŸ˜‚</p>
<p>æ‰“å¼€è¯¥ç½‘ç«™çš„æ§åˆ¶å°è°ƒè¯•ï¼Œè¾“å…¥<code>window.scrollTo(0, 800);</code></p>
<p>æ§åˆ¶å°è¾“å‡ºç»“æœä¸ºï¼š<code>Uncaught TypeError: window.scrollTo is not a function</code></p>
<p>ç„¶åå†æ‰“å°ä¸€ä¸‹windowè¿™ä¸ªå®ä¾‹ï¼š<code>console.log(window)</code></p>
<p>å¯ä»¥çœ‹åˆ°<code>scrollTo: null</code></p>
<p>ä¼°è®¡æ˜¯ç½‘ç«™ä¸ºäº†åçˆ¬å–è€Œé‡‡ç”¨çš„æªæ–½ï¼Œç›´æ¥æŠŠwindow.scrollToç­‰åŸç”Ÿæ–¹æ³•èµ‹å€¼ä¸ºç©ºã€‚</p>
<h1 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h1><h2 id="è·å–æµè§ˆå™¨é¡µé¢å®ä¾‹"><a href="#è·å–æµè§ˆå™¨é¡µé¢å®ä¾‹" class="headerlink" title="è·å–æµè§ˆå™¨é¡µé¢å®ä¾‹"></a>è·å–æµè§ˆå™¨é¡µé¢å®ä¾‹</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">true</span> &#125;)</div><div class="line"><span class="keyword">let</span> page =<span class="keyword">await</span> browser.newPage()</div></pre></td></tr></table></figure>
<h2 id="æ¨¡æ‹ŸPCçš„å°ºå¯¸å’ŒUA"><a href="#æ¨¡æ‹ŸPCçš„å°ºå¯¸å’ŒUA" class="headerlink" title="æ¨¡æ‹ŸPCçš„å°ºå¯¸å’ŒUA"></a>æ¨¡æ‹ŸPCçš„å°ºå¯¸å’ŒUA</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * æ¨¡æ‹Ÿpcè®¾å¤‡mac</div><div class="line"> */</div><div class="line">exports.viewPort = &#123;</div><div class="line">    <span class="attr">width</span>: <span class="number">1080</span>,</div><div class="line">    <span class="attr">height</span>: <span class="number">1920</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> userAgent = <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* è®¾ç½®å±å¹•å°ºå¯¸å’ŒUA</div><div class="line">*/</div><div class="line"><span class="keyword">await</span> page.setViewport(viewPort);</div><div class="line"><span class="keyword">await</span> page.setUserAgent(userAgent);</div></pre></td></tr></table></figure>
<h1 id="å®ç°ç½‘é¡µæ»‘åŠ¨"><a href="#å®ç°ç½‘é¡µæ»‘åŠ¨" class="headerlink" title="å®ç°ç½‘é¡µæ»‘åŠ¨"></a>å®ç°ç½‘é¡µæ»‘åŠ¨</h1><h2 id="åˆ©ç”¨é¼ æ ‡åŠ¨ä½œç»„åˆ"><a href="#åˆ©ç”¨é¼ æ ‡åŠ¨ä½œç»„åˆ" class="headerlink" title="åˆ©ç”¨é¼ æ ‡åŠ¨ä½œç»„åˆ"></a>åˆ©ç”¨é¼ æ ‡åŠ¨ä½œç»„åˆ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">exports.scrollPage = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">distance</span>) </span>&#123;</div><div class="line">    <span class="keyword">await</span> page.mouse.move(Spider.viewPort.width/<span class="number">2</span>, Spider.viewPort.height * <span class="number">0.9</span>, &#123;<span class="attr">steps</span>: <span class="number">10</span>&#125;)</div><div class="line">    <span class="keyword">await</span> page.mouse.down(Spider.viewPort.width/<span class="number">2</span>, Spider.viewPort.height * <span class="number">0.9</span>)</div><div class="line">    <span class="keyword">if</span> (Spider.viewPort.height * <span class="number">0.9</span> - distance &gt; Spider.viewPort.height * <span class="number">0.05</span>)&#123;</div><div class="line">        <span class="keyword">await</span> page.mouse.move(Spider.viewPort.width/<span class="number">2</span>, Spider.viewPort.height * <span class="number">0.9</span> - distance, &#123;<span class="attr">steps</span>: <span class="number">10</span>&#125;)</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">await</span> page.mouse.move(Spider.viewPort.width/<span class="number">2</span>, Spider.viewPort.height * <span class="number">0.05</span>, &#123;<span class="attr">steps</span>: <span class="number">10</span>&#125;)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">await</span> page.mouse.up()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>distanceæ˜¯yè½´æ»‘åŠ¨çš„å‚ç›´è·ç¦»ï¼Œæ ¹æ®å±å¹•å°ºå¯¸è®¡ç®—å‡ºé¼ æ ‡æ»‘åŠ¨åˆ°çš„ç»„åˆæ“ä½œçš„èµ·å§‹ä½ç½®xå’Œyçš„åæ ‡ç‚¹ï¼Œç„¶åæ¨¡æ‹Ÿé¼ æ ‡æŒ‰ä¸‹æ“ä½œã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦çˆ¬å–çš„ç½‘é¡µï¼Œå±å¹•é«˜åº¦çš„5%æ˜¯é¡¶éƒ¨å›ºå®šçš„å¯¼èˆªæ ï¼Œæ‰€ä»¥ç»“æŸä½ç½®çš„yè½´åæ ‡åº”è¯¥å¤§äºå±å¹•é«˜åº¦çš„5%ã€‚ç”±äºæˆ‘ä»¬çš„ç½‘é¡µæ»‘åŠ¨æ“ä½œæ™®éæ˜¯é¼ æ ‡ç”±ä¸‹å¾€ä¸Šæ»‘åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸‹åŠ¨ä½œå½“å‰çš„èµ·å§‹ä½ç½®çš„yè½´åæ ‡å‡å»æ»‘åŠ¨çš„å‚ç›´è·ç¦»åçš„yè½´åæ ‡å€¼æ˜¯å¦å¤§äºå±å¹•é«˜åº¦çš„5%ï¼Œå¦‚æœæ˜¯ï¼Œç»“æŸä½ç½®çš„yè½´åæ ‡ä¸ºé¼ æ ‡æŒ‰ä¸‹æ“ä½œçš„yè½´åæ ‡å‡å»æ»‘åŠ¨çš„å‚ç›´è·ç¦»ï¼Œå¦åˆ™ç»“æŸä½ç½®çš„yè½´åæ ‡å³ä¸ºå±å¹•é«˜åº¦çš„5%ã€‚å°†window.scrollToæ–¹æ³•æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„scrollPageæ–¹æ³•ï¼Œä¼ å…¥æ»‘åŠ¨çš„å‚ç›´è·ç¦»å³å¯ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/13/Jenkins-Build/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/Jenkins-Build/" itemprop="url">æ­å»ºJenkinsè‡ªåŠ¨åŒ–æ„å»ºç¯å¢ƒ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-01-13T22:20:20+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Util/" itemprop="url" rel="index">
                    <span itemprop="name">Util</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/13/Jenkins-Build/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/01/13/Jenkins-Build/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/01/13/Jenkins-Build/" class="leancloud_visitors" data-flag-title="æ­å»ºJenkinsè‡ªåŠ¨åŒ–æ„å»ºç¯å¢ƒ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>æœ€è¿‘å…¬å¸æƒ³æ­å»ºè‡ªåŠ¨åŒ–æ„å»ºå¹³å°ï¼Œç”±äºä»¥å‰è‡ªå·±åœ¨ç©ºé—²æ—¶é—´æŠ˜è…¾è¿‡jenkinsæ­å»ºç›¸å…³çš„ä¸œè¥¿ï¼Œé¢†å¯¼å°±æŠŠè¿™ä¸ªä»»åŠ¡äº¤ç»™äº†æˆ‘ï¼Œè™½ç„¶ä»¥å‰åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šæ­å»ºè¿‡ï¼Œç”±äºæ—¶é—´è¿‡å»å¤ªä¹…äº†ï¼Œå½“æ—¶åˆæ²¡åšè®°å½•ï¼Œæ­å»ºçš„æ—¶å€™è¿˜æ˜¯è¸©äº†ä¸å°‘å‘ï¼Œä¸è¿‡åœ¨googleçˆ¸çˆ¸çš„å¸®åŠ©ä¸‹ï¼Œç¿»é˜…å„ç§èµ„æ–™ï¼Œæœ€åéƒ½çˆ¬å‘è§£å†³ï¼Œæ‰€ä»¥è¿™é‡Œå¯¹å†æ­¤æ­å»ºåšä¸€ä¸ªè®°å½•ï¼Œé¿å…ä»¥åé—å¿˜ã€‚</p>
<hr>
<h1 id="è¿æ¥è¿œç¨‹æœåŠ¡å™¨"><a href="#è¿æ¥è¿œç¨‹æœåŠ¡å™¨" class="headerlink" title="è¿æ¥è¿œç¨‹æœåŠ¡å™¨"></a>è¿æ¥è¿œç¨‹æœåŠ¡å™¨</h1><ol>
<li>ssh -p ç«¯å£å· æœåŠ¡å™¨ç”¨æˆ·å@ip</li>
<li>è¾“å…¥å¯†ç <h1 id="å®‰è£…jenkinsç›¸å…³ä¾èµ–åŒ…"><a href="#å®‰è£…jenkinsç›¸å…³ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…jenkinsç›¸å…³ä¾èµ–åŒ…"></a>å®‰è£…jenkinsç›¸å…³ä¾èµ–åŒ…</h1><h2 id="å®‰è£…java"><a href="#å®‰è£…java" class="headerlink" title="å®‰è£…java"></a>å®‰è£…java</h2></li>
</ol>
<ul>
<li><code>java -version</code></li>
<li>å¦‚æœæ²¡æœ‰æ˜¾ç¤ºç‰ˆæœ¬å·åˆ™éœ€è¦å®‰è£…ï¼Œå®‰è£…å‘½ä»¤<code>sudo yum install java</code><h2 id="å®‰è£…jenkins"><a href="#å®‰è£…jenkins" class="headerlink" title="å®‰è£…jenkins"></a>å®‰è£…jenkins</h2></li>
<li>æ·»åŠ å®‰è£…æº<br><code>sudo wget -O /etc/yum.repos.d/jenkins.repo http://jenkins-ci.org/redhat/jenkins.repo</code><br><code>sudo rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key</code></li>
<li>å®‰è£…<br><code>yum install jenkins</code><h3 id="jenkinså®‰è£…ç›®å½•"><a href="#jenkinså®‰è£…ç›®å½•" class="headerlink" title="jenkinså®‰è£…ç›®å½•"></a>jenkinså®‰è£…ç›®å½•</h3><code>/var/lib/jenkins/</code><h3 id="jenkinsé…ç½®æ–‡ä»¶ç›®å½•"><a href="#jenkinsé…ç½®æ–‡ä»¶ç›®å½•" class="headerlink" title="jenkinsé…ç½®æ–‡ä»¶ç›®å½•"></a>jenkinsé…ç½®æ–‡ä»¶ç›®å½•</h3><code>/etc/sysconfig/jenkins</code></li>
<li>ä¸»è¦å‚æ•°ï¼š</li>
<li>JENKINS_HOME:Jenkinsçš„ä¸»ç›®å½•ï¼ŒJenkinså·¥ä½œç›®å½•,å‚¨å­˜æ–‡ä»¶çš„åœ°å€,Jenkinsçš„æ’ä»¶,ç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹</li>
<li>JENKINS_USER:Jenkinsçš„ç”¨æˆ·ï¼Œæ‹¥æœ‰$JENKINS_HOMEå’Œ/var/log/jenkinsçš„æƒé™</li>
<li>JENKINS_PORT:Jenkinsçš„ç«¯å£ï¼Œé»˜è®¤ç«¯å£æ˜¯8080<h2 id="å¯åŠ¨jenkinsæœåŠ¡"><a href="#å¯åŠ¨jenkinsæœåŠ¡" class="headerlink" title="å¯åŠ¨jenkinsæœåŠ¡"></a>å¯åŠ¨jenkinsæœåŠ¡</h2><code>sudo service jenkins start</code></li>
<li>æ­¤æ—¶åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp://&lt;æœåŠ¡å™¨ip&gt;:8080/ å°±å¯ä»¥è¿›å…¥Jenkinsç•Œé¢ï¼Œ8080æ˜¯é»˜è®¤ç«¯å£å·<h2 id="åœæ­¢jenkinsæœåŠ¡"><a href="#åœæ­¢jenkinsæœåŠ¡" class="headerlink" title="åœæ­¢jenkinsæœåŠ¡"></a>åœæ­¢jenkinsæœåŠ¡</h2><code>sudo service jenkins stop</code><h1 id="åˆ›å»ºé¡¹ç›®å¹¶é…ç½®"><a href="#åˆ›å»ºé¡¹ç›®å¹¶é…ç½®" class="headerlink" title="åˆ›å»ºé¡¹ç›®å¹¶é…ç½®"></a>åˆ›å»ºé¡¹ç›®å¹¶é…ç½®</h1><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylbbjevj9j31fa0mwwhn.jpg" alt=""></li>
</ul>
<ol>
<li>é€‰æ‹©Newä»»åŠ¡ï¼Œæ–°å»ºä¸€ä¸ªé¡¹ç›®<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylbq5m1vej31ev0qc43p.jpg" alt=""></li>
<li>è¾“å…¥ä¸€ä¸ªé¡¹ç›®åç§°</li>
<li>é€‰æ‹©æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„ok<br><img src="https://ww1.sinaimg.cn/large/006LWy2zgy1fylbswx4j0j316r0n076c.jpg" alt=""></li>
<li>è¾“å…¥é¡¹ç›®çš„æ–‡å­—æè¿°<br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fyld7gm55jj30xx09f751.jpg" alt=""></li>
<li>å‹¾é€‰ä¸¢å¼ƒæ—§çš„æ„å»ºï¼Œè®¾ç½®ä¿ç•™çš„æ„å»ºå¤©æ•°å’Œä¿ç•™çš„æœ€å¤§æ„å»ºæ•°<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fyldeclw5pj30yg0fhdi3.jpg" alt=""><br>6.å‹¾é€‰å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ï¼Œæ·»åŠ ä¸åŒç±»å‹çš„å‚æ•°<br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fyle0kgb04j30qk09st98.jpg" alt=""></li>
</ol>
<ul>
<li>å¸ƒå°”å€¼å‚æ•°<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fyle6utuc8j30rc0cgdg8.jpg" alt=""></li>
<li>æ–‡æœ¬å‚æ•°<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fz5bbqc12yj31g40om14f.jpg" alt=""><br><img src="https://ww1.sinaimg.cn/large/006LWy2zgy1fyle1gna1kj30q30caaaw.jpg" alt=""></li>
<li>é€‰é¡¹å‚æ•°<br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fyle4hao7oj30pz0b0q3i.jpg" alt=""></li>
<li>git Parameter<br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fyle3q6ydhj30q50fydgg.jpg" alt=""></li>
<li>dynamic Parameter<br>æ‰“åŒ…å‰ï¼Œè¦é…ç½®è¿™äº›å‚æ•°ï¼Œé…ç½®ç•Œé¢å±•ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fz5b4jiontj31al0u0tsk.jpg" alt=""><br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fz5b2jvit9j31vm0tu7n3.jpg" alt=""><br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fz5b9rum2oj31v80egjyz.jpg" alt=""></li>
</ul>
<ol>
<li>Source Code Managementé…ç½®gitè¿œç¨‹ä»£ç ä»“åº“</li>
</ol>
<ul>
<li>å¤åˆ¶é¡¹ç›®åœ°å€å¹¶å¡«å…¥Repository URL</li>
<li>Credentialsï¼Œç‚¹å‡»addï¼Œé€‰æ‹©jenkinsè´¦æˆ·ï¼ˆjenkinsç»Ÿä¸€ç”¨è¿™ä¸ªï¼‰ï¼Œè¯¥è´¦æˆ·éœ€åŠ å…¥é¡¹ç›®ï¼Œæ‹¥æœ‰ä»£ç æ‹‰å–æƒé™</li>
<li>é…ç½®æˆåŠŸåä¸ä¼šæœ‰çº¢å­—é”™è¯¯æç¤º</li>
<li>æœ‰çš„é¡¹ç›®å…‹éš†æ¯”è¾ƒæ…¢ï¼Œå¯èƒ½ä¼šæœ‰å…‹éš†è¶…æ—¶å¯¼è‡´æ„å»ºå¤±è´¥çš„é—®é¢˜ï¼Œå¯ä»¥æŠŠè¿™ä¸ªè¶…æ—¶æ—¶é—´æ”¹å¤§ä¸€ç‚¹ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªé…ç½®<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fz5bfpllo7j31fx0u017x.jpg" alt=""></li>
<li>Additional Behavioursç‚¹å‡»Add<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylhl1bp5oj30os0lo77e.jpg" alt=""></li>
<li>é€‰æ‹©Advanced clone behaviours<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylhm54mjyj30x40cgq3t.jpg" alt=""></li>
<li>ä¿®æ”¹Timeout (in minutes) for clone and fetch operationsçš„å€¼ï¼Œæ”¹å¤§ä¸€ç‚¹60</li>
</ul>
<ol>
<li>Build Triggersé…ç½®è½®è¯¢æ„å»ºå’Œå®šæ—¶æ„å»º<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylczte35hj30y906xq3a.jpg" alt=""><br>å®šæ—¶æ„å»ºï¼š æ— è®ºgitä¸­æœ‰æ— æäº¤ï¼Œå‡æ‰§è¡Œå®šæ—¶åŒ–çš„æ„å»ºä»»åŠ¡<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fyld1v9z9pj30y406sjrq.jpg" alt=""><br>è½®è¯¢æ„å»ºï¼š æŸ¥çœ‹gitä¸­æ˜¯å¦æœ‰æäº¤ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æ‰§è¡Œæ„å»ºä»»åŠ¡<br>æ¯éš”5åˆ†é’Ÿæ„å»ºä¸€æ¬¡<br><code>H/5 * * * *</code><br>æ¯ä¸¤å°æ—¶æ„å»ºä¸€æ¬¡<br><code>H H/2 * * *</code><br>æ¯å¤©ä¸­åˆä¸‹ç­å‰å®šæ—¶æ„å»ºä¸€æ¬¡<br><code>0 12 * * *</code><br>æ¯å¤©ä¸‹åˆä¸‹ç­å‰å®šæ—¶æ„å»ºä¸€æ¬¡<br><code>0 18 * * *</code></li>
<li>Build Environmentè®¾ç½®æ„å»ºåç§°<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylelvfn79j30y503vglr.jpg" alt=""></li>
</ol>
<ul>
<li>å‹¾é€‰Set Build Nameï¼Œè¿™é‡Œå¡«å†™çš„å‚æ•°å¯¹åº”ä¸Šé¢è®¾ç½®çš„å‚æ•°ï¼Œä¿æŒåç§°ä¸€è‡´<br>æ‰“åŒ…åå±•ç¤ºçš„æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fyleg0e2cwj30co0i8myu.jpg" alt=""></li>
</ul>
<ol>
<li>Buildæ„å»ºæ–¹å¼ï¼ˆAndroidä»¥gradleä¸ºä¾‹ï¼‰<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fyleoramsuj30ek0bfwex.jpg" alt=""></li>
</ol>
<ul>
<li>ç‚¹å‡»add build stepï¼Œé€‰æ‹©Invoke Gradle script<br>å‹¾é€‰Invoke Gradleï¼Œé€‰æ‹©Gradle Versionä¸ºgradle4.6<br><img src="https://ww1.sinaimg.cn/large/006LWy2zgy1fyletf9rdbj30y40c2aao.jpg" alt=""></li>
<li>å¡«å†™taskï¼Œé…ç½®gradleæ‰“åŒ…å‘½ä»¤<code>clean assemble${BUILD_TYPE} --stacktrace</code>ï¼Œè¿™é‡Œçš„BUILD_TYPEå¼•ç”¨å‰é¢é…ç½®çš„</li>
<li>ç‚¹å‡»Advancedé€‰é¡¹ï¼Œå‹¾é€‰Pass all job parameters as Project propertiesï¼Œå°†ä¸Šé¢çš„é…ç½®å‚æ•°å…¨éƒ¨ä¼ å…¥gradle.propertiesé…ç½®æ–‡ä»¶ä¸­ï¼Œå®ç°å‚æ•°åŒ–æ‰“åŒ…<br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fylfq19zwfj30wr0ji3zl.jpg" alt=""></li>
</ul>
<ol>
<li>Post-build Actions</li>
</ol>
<ul>
<li>ç‚¹å‡»add Post-build Actionsï¼Œé€‰æ‹©å½’æ¡£æˆå“ï¼Œæå–æ‰“åŒ…åçš„apkæ–‡ä»¶<br><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fylezsvjylj30cj0b9aar.jpg" alt=""></li>
<li>Files to archiveå¡«å…¥è¿‡æ»¤è§„åˆ™<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fylf2ur67hj30yb0853yw.jpg" alt=""></li>
<li>åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­è¿‡æ»¤apkæ–‡ä»¶</li>
<li>ç‚¹å‡»add Post-build Actionsï¼Œé…ç½®æ‰“åŒ…åçš„é‚®ç®±é€šçŸ¥<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fylf58asykj30cr0bpmxv.jpg" alt=""><br>ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤é…ç½®å°±å¯ä»¥ï¼Œç›´æ¥å¼•ç”¨å…¨å±€é…ç½®ä¸­å·²ç»é…ç½®è¿‡çš„å‚æ•°ã€‚<br><img src="https://ww1.sinaimg.cn/large/006LWy2zgy1fz5b5jxygej31te0940vr.jpg" alt=""><br>å¦‚æœè¦ä¿®æ”¹æ¥æ”¶äººé‚®ç®±ï¼Œç¼–è¾‘Project Recipient Listï¼Œå¤šä¸ªé‚®ç®±åœ°å€ï¼Œç©ºæ ¼éš”å¼€<br>å¦‚æœè¦ä¿®æ”¹å‘é€é‚®ä»¶çš„å†…å®¹ï¼Œå¯ç¼–è¾‘ä»¥ä¸‹å‡ é¡¹</li>
<li>Content Type æ–‡æœ¬ç±»å‹ï¼Œå¯é…ç½®htmlã€çº¯æ–‡æœ¬ã€çº¯æ–‡æœ¬å’Œhtml</li>
<li>Default Subject é‚®ä»¶æ ‡é¢˜</li>
<li>Default Content é‚®ä»¶å†…å®¹<br>æ‰“åŒ…æ—¥å¿—å‹ç¼©å¹¶æ·»åŠ é™„ä»¶ï¼ŒAttach Build Logé€‰æ‹©Compress and Attach Build Log<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylfn7t6jcj30vi0ic3zs.jpg" alt=""><br>é‚®ä»¶å‘é€è§¦å‘å™¨é…ç½®ï¼Œç‚¹å‡»Advancedé€‰é¡¹ï¼Œç¼–è¾‘Triggersé€‰é¡¹ï¼Œç‚¹å‡»Add Triggerï¼Œå¯ä»¥é€‰æ‹©è§¦å‘å™¨ç±»å‹ï¼Œä¸ç®¡æ„å»ºæˆåŠŸå¤±è´¥æ€»æ˜¯è§¦å‘ï¼ˆé»˜è®¤ï¼‰ï¼ŒæˆåŠŸæ—¶è§¦å‘ï¼Œå¤±è´¥æ—¶è§¦å‘</li>
<li>æ­¤æ—¶é¡¹ç›®é…ç½®å®Œæ¯•<h1 id="æ‰“åŒ…æµç¨‹"><a href="#æ‰“åŒ…æµç¨‹" class="headerlink" title="æ‰“åŒ…æµç¨‹"></a>æ‰“åŒ…æµç¨‹</h1><img src="https://ww4.sinaimg.cn/large/006LWy2zgy1fylg0gxdazj31fg0gc0vm.jpg" alt=""></li>
</ul>
<ol>
<li>é€‰æ‹©è¦æ‰“åŒ…çš„é¡¹ç›®<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fylfvilxs2j31fg0mltba.jpg" alt=""></li>
<li>ç‚¹å‡»Build with Parametersï¼Œè¿›å…¥æ‰“åŒ…å‰çš„å‚æ•°é…ç½®æµç¨‹<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fz5b89vbakj31eh0u0tv5.jpg" alt=""></li>
<li>é…ç½®å¥½æ‰“åŒ…çš„å‚æ•°ï¼Œç‚¹å‡»buildå¼€å§‹æ‰“åŒ…<br><img src="https://ww3.sinaimg.cn/large/006LWy2zgy1fylhe643yxj30d206pmxf.jpg" alt=""></li>
<li>ç‚¹å‡»æ‰“åŒ…è¿›ç¨‹å¯æŸ¥çœ‹ç›¸å…³ä¿¡æ¯<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fylh9s1hnmj30a909zt97.jpg" alt=""></li>
<li>ç‚¹å‡»Console Outputå¯æŸ¥çœ‹æ‰“åŒ…æ—¥å¿—<br><img src="https://ww2.sinaimg.cn/large/006LWy2zgy1fz5b1ybg63j310n0u01kx.jpg" alt=""></li>
<li>å¦‚æœé…ç½®äº†é‚®ä»¶é€šçŸ¥ï¼Œæ‰“åŒ…å®Œæˆåé‚®ç®±ä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/18/SocketioRn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/18/SocketioRn/" itemprop="url">socket.io+nodejs+mongodb+reactnative å®ç°ç®€æ˜“èŠå¤©å®¤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-11-18T19:22:41+08:00">
                2018-11-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/18/SocketioRn/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/11/18/SocketioRn/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/11/18/SocketioRn/" class="leancloud_visitors" data-flag-title="socket.io+nodejs+mongodb+reactnative å®ç°ç®€æ˜“èŠå¤©å®¤">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>æœ€è¿‘å…¬å¸éå¸¸å¿™ï¼Œåˆæ˜¯å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰å†™åšå®¢äº†ï¼Œè™½ç„¶å…¬å¸çš„é¡¹ç›®ä½¿ç”¨ä¸åˆ°ReactNativeå’Œnodejsç›¸å…³çš„çŸ¥è¯†ï¼Œä½†æˆ‘ä»ç„¶çœ‹å¥½è·¨å¹³å°æŠ€æœ¯ï¼Œæ¯•ç«Ÿä»¥åæ˜¯å¤§å‰ç«¯çš„å‘å±•è¶‹åŠ¿ã€‚æ‰€ä»¥ä¾æ—§ä¸èƒ½åœä¸‹å­¦ä¹ çš„è„šæ­¥ï¼Œå¤šåšæŠ€æœ¯å‚¨å¤‡ï¼Œæå‡æ ¸å¿ƒç«äº‰åŠ›ï¼Œç»§ç»­æŒ–å…¨æ ˆçš„å‘ï¼Œæ‹“å±•è‡ªå·±çš„æŠ€æœ¯æ ˆã€‚æ¯•ç«Ÿæœ‰çš„æ—¶å€™ç«™åœ¨ä¸€ä¸ªä¸åŒçš„è§’åº¦ï¼Œå¯èƒ½æœ‰ä¸åŒçš„çœ‹æ³•ã€‚ä¹‹å‰åšäº†ä¸€ä¸ªè·å–ç½‘æ˜“è…¾è®¯å…è´¹æ¼«ç”»çš„appï¼Œåå°ç”¨nodejs+mongodb+koaæ­å»ºï¼Œåœ¨å±•ç¤ºæ¼«ç”»å¼¹å¹•çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ°é•¿é“¾æ¥å®æ—¶å±•ç¤ºå½“å‰æœ€æ–°çš„å¼¹å¹•å†…å®¹ã€‚ä¹‹å‰å¯¹socket.ioåœ¨react-nativeä¸Šçš„ä½¿ç”¨ä¸å¤ªäº†è§£ï¼Œå€Ÿæ­¤æœºä¼šå­¦ä¹ ä¸€ä¸‹ç›¸å…³çš„çŸ¥è¯†å¹¶åšä¸€ä¸ªæ€»ç»“å’Œè®°å½•ã€‚</p>
<hr>
<p>æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/images/socketio_rn.gif" alt="æ•ˆæœgif"></p>
<h1 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h1><h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install socket.io</div><div class="line">npm install mongoose</div></pre></td></tr></table></figure>
<h2 id="å¼•å…¥socket-ioå¯¹è±¡"><a href="#å¼•å…¥socket-ioå¯¹è±¡" class="headerlink" title="å¼•å…¥socket.ioå¯¹è±¡"></a>å¼•å…¥socket.ioå¯¹è±¡</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Socketio = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)</div></pre></td></tr></table></figure>
<h2 id="å¼•å…¥mongooseå¯¹è±¡"><a href="#å¼•å…¥mongooseå¯¹è±¡" class="headerlink" title="å¼•å…¥mongooseå¯¹è±¡"></a>å¼•å…¥mongooseå¯¹è±¡</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div></pre></td></tr></table></figure>
<h2 id="åˆ›å»ºå’Œå¼•å…¥mongooseçš„æ•°æ®åº“è¡¨å¯¹è±¡"><a href="#åˆ›å»ºå’Œå¼•å…¥mongooseçš„æ•°æ®åº“è¡¨å¯¹è±¡" class="headerlink" title="åˆ›å»ºå’Œå¼•å…¥mongooseçš„æ•°æ®åº“è¡¨å¯¹è±¡"></a>åˆ›å»ºå’Œå¼•å…¥mongooseçš„æ•°æ®åº“è¡¨å¯¹è±¡</h2><ul>
<li><p>åˆ›å»ºusersè¡¨</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"><span class="keyword">var</span> UsersSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="built_in">String</span>,</div><div class="line">    <span class="attr">createdAt</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">Date</span>,</div><div class="line">        <span class="attr">default</span>: <span class="built_in">Date</span>.now()</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">updateAt</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">Date</span>,</div><div class="line">        <span class="attr">default</span>: <span class="built_in">Date</span>.now()</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">UsersSchema.pre(<span class="string">'save'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isNew) &#123; <span class="comment">// å¦‚æœè¿™æ˜¯ä¸ªæ–°çš„æ•°æ®</span></div><div class="line">        <span class="keyword">this</span>.createdAt = <span class="keyword">this</span>.updateAt = <span class="built_in">Date</span>.now() <span class="comment">// è®¾ç½®å½“å‰æ—¶é—´</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">this</span>.updateAt = <span class="built_in">Date</span>.now() <span class="comment">// å¦åˆ™åˆ·æ–°æ›´æ–°æ—¶é—´</span></div><div class="line">    &#125;</div><div class="line">    next()</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.export = mongoose.model(<span class="string">'users'</span>, UsersSchema)</div></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºmessagesè¡¨</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> MessagesSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">text</span>: <span class="built_in">String</span>,</div><div class="line">    <span class="attr">user</span>: <span class="built_in">Object</span>,</div><div class="line">    <span class="attr">chatId</span>: <span class="built_in">String</span>,</div><div class="line">    <span class="attr">createdAt</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">Date</span>,</div><div class="line">        <span class="attr">default</span>:<span class="built_in">Date</span>.now()</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">updateAt</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">Date</span>,</div><div class="line">        <span class="attr">default</span>:<span class="built_in">Date</span>.now()</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">MessagesSchema.pre(<span class="string">'save'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.isNew)&#123; <span class="comment">// å¦‚æœè¿™æ˜¯ä¸ªæ–°çš„æ•°æ®</span></div><div class="line">        <span class="keyword">this</span>.createAt = <span class="keyword">this</span>.updateAt = <span class="built_in">Date</span>.now() <span class="comment">// è®¾ç½®å½“å‰æ—¶é—´</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">this</span>.updateAt = <span class="built_in">Date</span>.now() <span class="comment">// å¦åˆ™åˆ·æ–°æ›´æ–°æ—¶é—´</span></div><div class="line">    &#125;</div><div class="line">    next()</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> MessageModel = mongoose.model(<span class="string">'messages'</span>, MessagesSchema)</div><div class="line"><span class="built_in">module</span>.export = MessageModel</div></pre></td></tr></table></figure>
</li>
<li><p>å¼•å…¥è¡¨å¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Users = mongoose.model(<span class="string">'users'</span>)</div><div class="line"><span class="keyword">var</span> Messages = mongoose.model(<span class="string">'messages'</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>åˆå§‹åŒ–</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> users = &#123;&#125;; <span class="comment">// å®¢æˆ·ç«¯ç”¨æˆ·idå’Œsocket idæ˜ å°„è¡¨</span></div><div class="line"><span class="keyword">var</span> chatId = <span class="number">1</span>; <span class="comment">// èŠå¤©å®¤id</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ä½¿ç”¨socket-ioé€šä¿¡"><a href="#ä½¿ç”¨socket-ioé€šä¿¡" class="headerlink" title="ä½¿ç”¨socket.ioé€šä¿¡"></a>ä½¿ç”¨socket.ioé€šä¿¡</h2><ul>
<li><p>ç›‘å¬connectionæ¶ˆæ¯ï¼Œä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> websocket = Socketio(server)</div><div class="line">websocket.on(<span class="string">'connection'</span>,(socket) =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'è¿ä¸Šäº†'</span>)</div><div class="line">    socket.on(<span class="string">'userJoined'</span>, (userId) =&gt; onUserJoined(userId, socket));</div><div class="line">    socket.on(<span class="string">'message'</span>, (message) =&gt; onMessageReceived(message, socket));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>ç›‘å¬userJoinedæ¶ˆæ¯ï¼Œç”¨æˆ·è¿›å…¥èŠå¤©å®¤è§¦å‘ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€userJoinedæ¶ˆæ¯ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥çš„ç”¨æˆ·ï¼Œå®¢æˆ·ç«¯å‘é€çš„ç”¨æˆ·idä¸ºç©ºï¼ŒæœåŠ¡ç«¯åœ¨å›è°ƒä¸­è·å¾—ç”¨æˆ·idå’Œå®¢æˆ·ç«¯çš„socketå¯¹è±¡ï¼Œå¦‚æœç”¨æˆ·idä¸ºç©ºï¼Œæ’å…¥æ•°æ®åº“ï¼Œå–å¾—ç”¨æˆ·idï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€ç”¨æˆ·idï¼Œå®¢æˆ·ç«¯å°†è¿™ä¸ªç”¨æˆ·idä¿å­˜ä¸‹æ¥ï¼Œä¸‹ä¸€æ¬¡å‘é€è¿™ä¸ªidã€‚æœåŠ¡ç«¯åˆ·æ–°ç”¨æˆ·æ•°ç»„ä¸­è¯¥å®¢æˆ·ç«¯å¯¹åº”çš„ç”¨æˆ·idï¼Œå¦‚æœç”¨æˆ·idä¸ä¸ºç©ºç›´æ¥æ‰§è¡Œè¿™ä¸€æ­¥ï¼Œæœ€åå‘é€æ•°æ®åº“ä¸­ä¿å­˜çš„è¯¥èŠå¤©å®¤å‘é€è¿‡çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">onUserJoined</span>(<span class="params">userId, socket</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'æœ‰ç”¨æˆ·è¿›æ¥äº†'</span> + userId)</div><div class="line">    <span class="comment">// æ–°ç”¨æˆ·userIdä¸ºç©ºï¼Œå‘æ•°æ®åº“usersè¡¨æ’å…¥id</span></div><div class="line">    <span class="keyword">if</span> (!userId) &#123;</div><div class="line">        <span class="keyword">var</span> userData = <span class="keyword">new</span> Users(&#123;&#125;)</div><div class="line">        <span class="keyword">let</span> user = <span class="keyword">await</span> userData.save()</div><div class="line">        socket.emit(<span class="string">'userJoined'</span>, user._id);</div><div class="line">        users[socket.id] = user._id;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//å¦åˆ™åˆ·æ–°ç”¨æˆ·id</span></div><div class="line">        users[socket.id] = userId;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å‘é€ä¹‹å‰çš„æ¶ˆæ¯</span></div><div class="line">    <span class="keyword">await</span> sendExistingMessages(socket);</div><div class="line">&#125;</div><div class="line"><span class="comment">// å‘é€ä¹‹å‰çš„æ¶ˆæ¯</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sendExistingMessages</span>(<span class="params">socket</span>) </span>&#123;</div><div class="line">    <span class="comment">// æŸ¥æ•°æ®</span></div><div class="line">    <span class="keyword">await</span> Messages.find(&#123;</div><div class="line">        <span class="attr">chatId</span>: chatId</div><div class="line">    &#125;).sort(&#123;<span class="attr">createdAt</span>:<span class="number">1</span>&#125;).exec(<span class="function">(<span class="params">err, messages</span>) =&gt;</span> &#123;</div><div class="line">        <span class="comment">//ã€€å¦‚æœæ²¡æœ‰ä»»ä½•æ¶ˆæ¯ï¼Œç›´æ¥è¿”å›</span></div><div class="line">        <span class="keyword">if</span> (!messages.length)&#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        socket.emit(<span class="string">'message'</span>, messages.reverse());</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ç›‘å¬messageæ¶ˆæ¯ï¼Œåœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯æ—¶è§¦å‘ï¼ŒæœåŠ¡ç«¯åœ¨å›è°ƒä¸­è·å¾—æ¶ˆæ¯å’Œå‘é€çš„socketå¯¹è±¡ï¼Œä»ç”¨æˆ·æ•°ç»„ä¸­å–å¾—è¯¥socketå¯¹è±¡å¯¹åº”çš„å®¢æˆ·ç«¯çš„ç”¨æˆ·idï¼Œç”¨æˆ·idä¸ºç©ºæ—¶å¯èƒ½å› æœåŠ¡ç«¯é‡å¯é€ æˆç”¨æˆ·æ•°ç»„çš„æ•°æ®ä¸¢å¤±ï¼Œç›´æ¥è¿”å›ä¸å¤„ç†ï¼Œæœ€åä¿å­˜è¿™æ¡æ¶ˆæ¯åˆ°æ•°æ®åº“ï¼Œå‘é€è¿™æ¡æ¶ˆæ¯ç»™é™¤äº†å½“å‰å®¢æˆ·ç«¯ç”¨æˆ·çš„æ‰€æœ‰ç”¨æˆ·</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç”¨æˆ·æ¥æ”¶åˆ°æ¶ˆæ¯</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">onMessageReceived</span>(<span class="params">message, socket</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(message.text)</div><div class="line">    <span class="keyword">var</span> userId = users[socket.id];</div><div class="line">    <span class="comment">// ç”¨æˆ·idä¸ºç©ºè¿”å›</span></div><div class="line">    <span class="keyword">if</span> (!userId) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'æ²¡æœ‰è¿™ä¸ªç”¨æˆ·å•¦'</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">ã€€ã€€ <span class="comment">// ä¿å­˜æ¶ˆæ¯å¹¶å‘é€</span></div><div class="line">    <span class="keyword">await</span> sendAndSaveMessage(message, socket);</div><div class="line">&#125;</div><div class="line"><span class="comment">// ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®ï¼Œå‘é€æ¶ˆæ¯ç»™é™¤äº†å½“å‰ç”¨æˆ·çš„æ‰€æœ‰çš„ç”¨æˆ·</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sendAndSaveMessage</span>(<span class="params">message, socket</span>) </span>&#123;</div><div class="line">    <span class="comment">//ã€€åˆ›å»ºæ¶ˆæ¯æ•°æ®</span></div><div class="line">    <span class="keyword">var</span> messageData = <span class="keyword">new</span> Messages(&#123;</div><div class="line">        <span class="attr">text</span>: message.text,</div><div class="line">        <span class="attr">user</span>: message.user,</div><div class="line">        <span class="attr">createdAt</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(message.createdAt),</div><div class="line">        <span class="attr">chatId</span>: chatId</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> message = <span class="keyword">await</span> messageData.save()</div><div class="line">    <span class="comment">// å‘é€æ¶ˆæ¯ç»™é™¤äº†å½“å‰ç”¨æˆ·çš„æ‰€æœ‰çš„ç”¨æˆ·</span></div><div class="line">    socket.broadcast.emit(<span class="string">'message'</span>, message);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="koaä¸­é›†æˆsocket-io"><a href="#koaä¸­é›†æˆsocket-io" class="headerlink" title="koaä¸­é›†æˆsocket.io"></a>koaä¸­é›†æˆsocket.io</h2><p>å¦‚æœæœåŠ¡ç«¯å·²ç»é›†æˆäº†koaéœ€è¦å†é›†æˆsocket.io<br>ä¼ å…¥koaçš„serverå¯¹è±¡ï¼Œå¤–é¢åŒ…ä¸€å±‚Socketioå¯¹è±¡å¯¼å‡ºï¼Œå†æ³¨å†Œç›‘å¬ç«¯å£<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">server</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> websocket = Socketio(server)</div><div class="line">    websocket.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</div><div class="line">        clients[socket.id] = socket;<span class="comment">//ä¿å­˜å®¢æˆ·ç«¯å¯¹è±¡åˆ°åˆ—è¡¨</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'è¿ä¸Šäº†'</span>)</div><div class="line">        socket.on(<span class="string">'userJoined'</span>, (userId) =&gt; onUserJoined(userId, socket));</div><div class="line">        socket.on(<span class="string">'message'</span>, (message) =&gt; onMessageReceived(message, socket));</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">// xxxä¸ºsocketioçš„moduleè·¯å¾„</span></div><div class="line">server.listen(<span class="number">1234</span>)</div><div class="line"><span class="built_in">require</span>(<span class="string">'xxx'</span>)(server)</div></pre></td></tr></table></figure></p>
<h1 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h1><p>è¿™é‡Œä»¥react-nativeä¸¾ä¾‹</p>
<h2 id="å¼•å…¥socket-io"><a href="#å¼•å…¥socket-io" class="headerlink" title="å¼•å…¥socket.io"></a>å¼•å…¥socket.io</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> SocketIOClient <span class="keyword">from</span> <span class="string">'socket.io-client'</span>;</div></pre></td></tr></table></figure>
<h2 id="åˆå§‹åŒ–socket-io"><a href="#åˆå§‹åŒ–socket-io" class="headerlink" title="åˆå§‹åŒ–socket.io"></a>åˆå§‹åŒ–socket.io</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.socket = SocketIOClient(<span class="string">'http://localhost:3000'</span>); <span class="comment">// è®¾ç½®æœåŠ¡ç«¯çš„åœ°å€å’Œç«¯å£å·</span></div></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨socket-ioé€šä¿¡-1"><a href="#ä½¿ç”¨socket-ioé€šä¿¡-1" class="headerlink" title="ä½¿ç”¨socket.ioé€šä¿¡"></a>ä½¿ç”¨socket.ioé€šä¿¡</h2><p>ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶å‘é€ç©ºçš„ç”¨æˆ·idç»™æœåŠ¡ç«¯ï¼Œç›‘å¬userJoinedæ¶ˆæ¯ï¼Œä¿å­˜æœåŠ¡ç«¯ç»™çš„ç”¨æˆ·idï¼Œç¬¬äºŒæ¬¡å‘é€æœ¬åœ°ä¿å­˜çš„ç”¨æˆ·idç»™æœåŠ¡ç«¯</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">AsyncStorage.getItem(USER_ID)</div><div class="line">      .then(<span class="function">(<span class="params">userId</span>) =&gt;</span> &#123;</div><div class="line">        <span class="comment">// æœ¬åœ°æ²¡æœ‰ç”¨æˆ·id</span></div><div class="line">        <span class="keyword">if</span> (!userId) &#123;</div><div class="line">          <span class="comment">// å‘é€ç©ºçš„ç”¨æˆ·id</span></div><div class="line">          <span class="keyword">this</span>.socket.emit(<span class="string">'userJoined'</span>, <span class="literal">null</span>);</div><div class="line">          <span class="comment">// ç›‘å¬userJoinedæ¶ˆæ¯ï¼Œä¿å­˜æœåŠ¡ç«¯ç»™çš„ç”¨æˆ·id</span></div><div class="line">          <span class="keyword">this</span>.socket.on(<span class="string">'userJoined'</span>, (userId) =&gt; &#123;</div><div class="line">            AsyncStorage.setItem(USER_ID, userId);</div><div class="line">            <span class="keyword">this</span>.setState(&#123; userId &#125;);</div><div class="line">          &#125;);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="comment">// å‘é€æœ¬åœ°ä¿å­˜çš„ç”¨æˆ·id</span></div><div class="line">          <span class="keyword">this</span>.socket.emit(<span class="string">'userJoined'</span>, userId);</div><div class="line">          <span class="keyword">this</span>.setState(&#123; userId &#125;);</div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">      .catch(<span class="function">(<span class="params">e</span>) =&gt;</span> alert(e));</div></pre></td></tr></table></figure>
<p>ç›‘å¬æœåŠ¡ç«¯å‘é€çš„messageæ¶ˆæ¯å¹¶åˆ·æ–°</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.socket.on(<span class="string">'message'</span>, <span class="keyword">this</span>.storeMessages); <span class="comment">//ç›‘å¬messageæ¶ˆæ¯</span></div><div class="line">storeMessages(messages) &#123;</div><div class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">previousState</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">messages</span>: <span class="keyword">this</span>.msgs.append(previousState.messages, messages),</div><div class="line">      &#125;;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç‚¹å‡»å‘é€æŒ‰é’®ï¼Œå‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">onSend(message) &#123;</div><div class="line">    <span class="keyword">this</span>.socket.emit(<span class="string">'message'</span>, message);</div><div class="line">    <span class="keyword">this</span>.storeMessages(messages);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯çš„uiç”¨äº†ä¸€ä¸ªå°è£…çš„åº“GiftedChatæ¥ç®€å•å±•ç¤ºä¸€ä¸‹ã€‚demoå·²æ‰“åŒ…ä¸Šä¼ ï¼Œæœ€åè´´ä¸€ä¸ª<a href="https://github.com/jessieeeee/SocketioRn/" target="_blank" rel="external">ä¼ é€é—¨</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/21/Presentation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/21/Presentation/" itemprop="url">Presentationå®ç°åŒå±å¼‚æ˜¾</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-21T21:06:44+08:00">
                2018-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/21/Presentation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/10/21/Presentation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/10/21/Presentation/" class="leancloud_visitors" data-flag-title="Presentationå®ç°åŒå±å¼‚æ˜¾">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>ç”±äºå…¬å¸çš„é¡¹ç›®éœ€æ±‚ï¼Œéœ€è¦åœ¨ä¸€å°æ­è½½Androidç³»ç»Ÿçš„æ˜¾ç¤ºè®¾å¤‡çš„ä¸¤å—å±å¹•ä¸Šæ˜¾ç¤ºä¸åŒçš„å†…å®¹ï¼Œè¯¥è®¾å¤‡æ‹¥æœ‰ä¸€å—ä¸»å±å’Œä¸€å—è¾…å±ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨åŒå±å¼‚æ˜¾çš„æŠ€æœ¯ï¼Œä»¥å‰æ²¡æœ‰æ¥è§¦è¿‡è¿™ä¸€å—çš„çŸ¥è¯†ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„ç†Ÿæ‚‰åé¡ºåˆ©å®ç°åŒå±å¼‚æ˜¾ï¼Œå…¶å®Androidå®ç°åŒå±å¼‚æ˜¾å¹¶ä¸éš¾è€Œä¸”Googleæä¾›äº†ç°æˆçš„APIï¼Œç”¨Presentationè¿™ä¸ªç±»å»å®ç°ï¼Œåªä¸è¿‡æ²¡æ¥è§¦è¿‡çš„æ—¶å€™è§‰å¾—æŒºé«˜å¤§ä¸Šçš„ï¼Œåœ¨æ­¤åšä¸€ä¸ªç®€å•çš„è®°å½•ã€‚</p>
<hr>
<p>Presentationæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„dialogï¼Œå¯ä»¥åœ¨è¾…å±ä¸Šæ˜¾ç¤ºä¸ä¸»å±ä¸ä¸€æ ·çš„å†…å®¹ï¼Œè®¾ç½®é‡Œé¢ä¹Ÿå¯ä»¥æŠŠâ€œæ¨¡æ‹Ÿç¬¬äºŒå±â€çš„åŠŸèƒ½æ‰“å¼€ï¼Œè¿è¡Œçš„æ—¶å€™ä¼šåœ¨å·¦ä¸Šè§’æ˜¾ç¤ºä¸€ä¸ªå°çª—å£æ¥æ˜¾ç¤ºç¬¬äºŒå±çš„æ˜¾ç¤ºå†…å®¹ï¼ŒPresentationåœ¨åˆ›å»ºçš„æ—¶å€™éœ€è¦å’ŒDisplayå¯¹è±¡ç›¸å…³è”ï¼Œå…³è”ä¹‹å‰éœ€è¦å…ˆè·å–æ˜¾ç¤ºè®¾å¤‡ï¼ŒDisplayManageræˆ–MediaRouteréƒ½å¯ä»¥æ¥è·å–æ˜¾ç¤ºè®¾å¤‡ã€‚ä¸‹é¢ç”¨æœ€ç®€å•çš„ä¸¤ä¸ªä¾‹å­æ¥ä»‹ç»ï¼Œåœ¨ä¸»å±å’Œè¾…å±ä¸Šéƒ½æ˜¾ç¤ºä¸€ä¸ªä¸åŒå†…å®¹çš„TextViewæ–‡æœ¬ã€‚</p>
<h1 id="è®¾ç½®æƒé™"><a href="#è®¾ç½®æƒé™" class="headerlink" title="è®¾ç½®æƒé™"></a>è®¾ç½®æƒé™</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.SYSTEM_ALERT_WINDOW"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.SYSTEM_OVERLAY_WINDOW"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h1 id="DisplayManagerå®ç°"><a href="#DisplayManagerå®ç°" class="headerlink" title="DisplayManagerå®ç°"></a>DisplayManagerå®ç°</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPresentation</span> <span class="keyword">extends</span> <span class="title">Presentation</span> </span>&#123;</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="title">MyPresentation</span><span class="params">(Context outerContext, Display display)</span> </span>&#123;</div><div class="line">           <span class="keyword">super</span>(outerContext,display);</div><div class="line"></div><div class="line">       &#125;</div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">           <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">           setContentView(R.layout.second_screen);</div><div class="line"></div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> MyPresentation myPresentation;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        DisplayManager manager = (DisplayManager) getSystemService(Context.DISPLAY_SERVICE);</div><div class="line">        Display[] displays = manager.getDisplays();</div><div class="line">        <span class="keyword">if</span> (presentationDisplays.length &gt; <span class="number">1</span>) &#123;</div><div class="line">            <span class="comment">// displays[0] ä¸»å± displays[1] è¾…å±</span></div><div class="line">            myPresentation = <span class="keyword">new</span> MyPresentation(<span class="keyword">this</span>,displays[<span class="number">1</span>]);</div><div class="line">            myPresentation.getWindow().setType(</div><div class="line">                    WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);</div><div class="line">            myPresentation.show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">        onDestroy();</div><div class="line">        <span class="comment">//å®Œå…¨é€€å‡ºåº”ç”¨ï¼Œå–æ¶ˆåŒå±å¼‚æ˜¾</span></div><div class="line">        Intent startMain = <span class="keyword">new</span> Intent(Intent.ACTION_MAIN);</div><div class="line">        startMain.addCategory(Intent.CATEGORY_HOME);</div><div class="line">        startMain.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</div><div class="line">        startActivity(startMain);</div><div class="line">        System.exit(<span class="number">0</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„activity_mainå’Œsecond_screenå°±æ˜¯ä¸€ä¸ªxmlå¸ƒå±€ï¼Œæ”¾äº†ä¸€ä¸ªä¸åŒå†…å®¹çš„TextViewæ–‡æœ¬ï¼Œä»£ç å°±ä¸è´´äº†ï¼Œå¯ä»¥çœ‹åˆ°DisplayManagerçš„getDisplaysæ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªå¯æ˜¾ç¤ºçš„Displayæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å½“å‰å¯ä»¥è¿æ¥çš„å±å¹•åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸»å±çš„Displayå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯è¾…å±çš„Displayå¯¹è±¡ï¼Œç„¶åæŠŠè¾…å±çš„Displayå¯¹è±¡ä¼ å…¥åˆ°Presentationçš„æ„é€ å‡½æ•°ä¸­ç»‘å®šï¼Œè®¾ç½®çª—å£ç±»å‹å°±å¯ä»¥å±•ç¤ºäº†ã€‚</p>
<h1 id="MediaRouterå®ç°"><a href="#MediaRouterå®ç°" class="headerlink" title="MediaRouterå®ç°"></a>MediaRouterå®ç°</h1><p>è¿™é‡Œå°±åªè´´è¾…å±çš„Displayå¯¹è±¡è·å–å¹¶ä¼ å…¥åˆ°Presentationçš„æ„é€ å‡½æ•°ä¸­ç»‘å®šçš„ä»£ç ï¼Œå› ä¸ºå…¶ä½™éƒ¨åˆ†éƒ½æ˜¯ä¸€æ ·çš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">MediaRouter mediaRouter = (MediaRouter) getSystemService(Context.MEDIA_ROUTER_SERVICE);</div><div class="line">MediaRouter.RouteInfo route = mediaRouter.getSelectedRoute(MediaRouter.ROUTE_TYPE_LIVE_VIDEO);</div><div class="line"><span class="keyword">if</span>(route != <span class="keyword">null</span>) &#123;</div><div class="line">    Display display = route.getPresentationDisplay();</div><div class="line">    <span class="keyword">if</span> (display != <span class="keyword">null</span>) &#123;</div><div class="line">        myPresentation = <span class="keyword">new</span> MyPresentation(<span class="keyword">this</span>, display);</div><div class="line">        myPresentation.getWindow().setType(</div><div class="line">                    WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);</div><div class="line">        myPresentation.show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>MediaRouterä¸DisplayManagerä¸åŒçš„æ˜¯MediaRouterä¼šç›´æ¥ç»‘å®šå‘¨å›´æœ€åˆé€‚çš„è®¾å¤‡ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªAPIå®ç°çš„æ€è·¯å¤§è‡´ç›¸åŒï¼Œéƒ½æ˜¯è¦è‡ªå®šä¹‰Presentationï¼Œè·å–åˆ°ä¸€ä¸ªè¾…å±çš„Displayå¯¹è±¡ä¼ å…¥åˆ°Presentationçš„æ„é€ å‡½æ•°ä¸­è¿›è¡Œç»‘å®šï¼ŒPresentationåˆå§‹åŒ–å®Œæˆåè®¾ç½®çª—å£ç±»å‹ç„¶åå±•ç¤ºã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/25/PuppeteerStart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/25/PuppeteerStart/" itemprop="url">nodejsçˆ¬è™«-puppeteerå…¥é—¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-25T14:33:58+08:00">
                2018-08-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/25/PuppeteerStart/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/08/25/PuppeteerStart/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/08/25/PuppeteerStart/" class="leancloud_visitors" data-flag-title="nodejsçˆ¬è™«-puppeteerå…¥é—¨">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>åˆæ˜¯å¾ˆä¹…æ²¡æœ‰å†™åšå®¢äº†ï¼Œæœ€è¿‘å¿™ç€ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œåšä¸€ä¸ªå…è´¹æ¼«ç”»appï¼ŒæŠ“å–ç½‘æ˜“å’Œè…¾è®¯æ¼«ç”»çš„webæ•°æ®ï¼Œç”¨nodejs+koa+mongoose+socket.ioæ­å»ºè¿™ä¸ªappçš„åç«¯æœåŠ¡ï¼Œå®¢æˆ·ç«¯ç”¨react-nativeç¼–å†™ï¼ŒåŒæ—¶é€‚é…ioså’ŒAndroidã€‚æœ¬äººæ˜¯åšAndroidå¼€å‘çš„ï¼Œæƒ³å€Ÿæ­¤æœºä¼šæ‰“å¼€å…¨æ ˆæŠ€æœ¯çš„å¤§é—¨ï¼Œç»™è‡ªå·±çš„æŠ€æœ¯æ ˆå¢åŠ ä¸€äº›å¹¿åº¦ã€‚å¯¹äºä¸€ä¸ªappå¼€å‘è€…æ¥è¯´ï¼Œappçš„æ•°æ®æºæ€»æ˜¯ä¸€ä¸ªå¾ˆå¤´ç–¼çš„é—®é¢˜ï¼Œè™½ç„¶ç°åœ¨å…è´¹çš„apiæ¥å£æœ‰å¾ˆå¤šï¼Œä½†æ˜¯ç±»å‹å°±é‚£ä¹ˆå‡ ç§ï¼Œæƒ³åšä¸€äº›æ„Ÿå…´è¶£çš„appä½†æ˜¯è‹¦äºæ‰¾ä¸åˆ°æ•°æ®æºã€‚ä¹‹å‰å­¦react-nativeçš„æ—¶å€™ä¹Ÿåšè¿‡ä¸€ä¸ªå¼€æºé¡¹ç›®é«˜ä»¿éŸ©å¯’çš„oneä¸€ä¸ª<a href="https://github.com/jessieeeee/SimpleOne" target="_blank" rel="external">SimpleOneä¼ é€é—¨</a>ï¼Œè¿™ä¸ªappçš„æ•°æ®å…¨æ˜¯é€šè¿‡æŠ“åŒ…å·¥å…·æŠ“å–å®˜æ–¹appçš„æ¥å£åœ°å€ï¼ˆç”¨charlesæˆ–fidderå³å¯ï¼‰ï¼Œåˆ†ææ•°æ®è·å¾—ï¼Œç”±äºæ•°æ®æ²¡æœ‰åšåŠ å¯†ï¼Œæ‰€ä»¥æ²¡æœ‰èŠ±å¤ªå¤šçš„æˆæœ¬ã€‚ä½†æ˜¯æ¯•ç«Ÿæ˜¯åˆ«äººçš„æ¥å£ï¼Œå‡ºç°é—®é¢˜ä¸æ˜¯è‡ªå·±å¯æ§çš„ã€‚åæ¥äº†è§£åˆ°googleçš„ä¸€ä¸ªwebè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶puppeteerï¼Œè§£æhtmlæŠ“å–domèŠ‚ç‚¹ï¼Œè¿™ä¸‹å°±å¯ä»¥é€šè¿‡æœåŠ¡ç«¯è®¿é—®webï¼ŒæŠ“å–æ•°æ®ï¼Œæä¾›æ¥å£å°†æŠ“å–åˆ°çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œåšè‡ªå·±æ„Ÿå…´è¶£çš„åº”ç”¨äº†ã€‚è€Œä¸”è‡ªå·±æœ¬æ¥å¯¹æœåŠ¡ç«¯çš„æŠ€æœ¯ä¹Ÿæ„Ÿå…´è¶£ï¼Œç´¢æ€§å€Ÿæ­¤æœºä¼šå­¦ä¸‹nodejsç›¸å…³çš„æœåŠ¡ç«¯æŠ€æœ¯ã€‚ä¸‹é¢å°±å¯¹puppeteerè¿™ä¸ªè‡ªåŠ¨åŒ–æ¡†æ¶çˆ¬è™«åšä¸€ä¸ªå…¥é—¨æ€»ç»“ï¼Œæ¥è§¦ä¸ä¹…ï¼Œå¦‚æœ‰ä¸å¯¹çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ã€‚</p>
<hr>
<h1 id="puppeteeræ¡†æ¶èƒŒæ™¯"><a href="#puppeteeræ¡†æ¶èƒŒæ™¯" class="headerlink" title="puppeteeræ¡†æ¶èƒŒæ™¯"></a>puppeteeræ¡†æ¶èƒŒæ™¯</h1><p>puppeteeræ˜¯ Google Chrome å›¢é˜Ÿå®˜æ–¹çš„æ— ç•Œé¢ï¼ˆHeadlessï¼‰Chrome å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ª Node åº“ï¼Œ web åº”ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œæä¾›äº†ä¸€äº›é«˜çº§çš„ API æ¥æ§åˆ¶Chromeæµè§ˆå™¨ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¼€å¯æµè§ˆå™¨ï¼Œå®æ—¶æŸ¥çœ‹è¿è¡Œè¿‡ç¨‹æ–¹ä¾¿è°ƒè¯•ã€‚é‚£å®ƒå¯ä»¥åšå†™ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>ç”Ÿæˆé¡µé¢çš„æˆªå›¾å’ŒPDFã€‚</li>
<li>æŠ“å–SPAå¹¶ç”Ÿæˆé¢„å…ˆå‘ˆç°çš„å†…å®¹ï¼ˆå³â€œSSRâ€ï¼‰ã€‚</li>
<li>ä»ç½‘ç«™æŠ“å–ä½ éœ€è¦çš„å†…å®¹ã€‚</li>
<li>è‡ªåŠ¨è¡¨å•æäº¤ï¼ŒUIæµ‹è¯•ï¼Œé”®ç›˜è¾“å…¥ç­‰</li>
<li>åˆ›å»ºä¸€ä¸ªæœ€æ–°çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒã€‚ä½¿ç”¨æœ€æ–°çš„JavaScriptå’Œæµè§ˆå™¨åŠŸèƒ½ï¼Œç›´æ¥åœ¨æœ€æ–°ç‰ˆæœ¬çš„Chromeä¸­è¿è¡Œæµ‹è¯•ã€‚</li>
<li>æ•è·æ‚¨çš„ç½‘ç«™çš„æ—¶é—´çº¿è·Ÿè¸ªï¼Œä»¥å¸®åŠ©è¯Šæ–­æ€§èƒ½é—®é¢˜ã€‚</li>
</ul>
<h1 id="ä¸ºä»€ä¹ˆè¦é€‰æ‹©puppeteerï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦é€‰æ‹©puppeteerï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é€‰æ‹©puppeteerï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦é€‰æ‹©puppeteerï¼Ÿ</h1><p>nodejsçš„çˆ¬è™«æ¡†æ¶æœ‰å¾ˆå¤šï¼Œè¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡è¿›è¡Œé€‰æ‹©ï¼Œæ¯”å¦‚è¯´cheerioä¸€ç±»çš„é™æ€ç½‘é¡µçˆ¬è™«æ¡†æ¶å°±åªèƒ½çˆ¬å–æœåŠ¡ç«¯æ¸²æŸ“çš„ç½‘é¡µï¼Œä¸èƒ½çˆ¬å–JavaScriptè¿è¡Œåçš„æ•°æ®ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦çˆ¬å–çš„æ˜¯åŠ¨æ€ç½‘é¡µï¼Œè€Œpuppeteerå¯ä»¥å®Œæ•´çš„æ¨¡æ‹Ÿæµè§ˆå™¨è·å–ç½‘é¡µï¼Œè®¿é—®domï¼Œä¸”æ¡†æ¶çš„è¿è¡Œæ•ˆç‡ä¹Ÿå¾ˆä¸é”™ï¼Œ<br>æ”¯æŒè°ƒç”¨Chromeçš„APIæ¥æ“çºµWebï¼Œç›¸æ¯”è¾ƒSeleniumæˆ–æ˜¯PhantomJsï¼Œå®ƒæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å®ƒçš„æ“ä½œDomå¯ä»¥å®Œå…¨åœ¨å†…å­˜ä¸­è¿›è¡Œæ¨¡æ‹Ÿæ—¢åœ¨V8å¼•æ“ä¸­å¤„ç†è€Œä¸æ‰“å¼€æµè§ˆå™¨ï¼Œæ˜¯Chromeå›¢é˜Ÿåœ¨ç»´æŠ¤ï¼Œæ‹¥æœ‰æ›´å¥½çš„å…¼å®¹æ€§å’Œå‰æ™¯ã€‚</p>
<h1 id="puppeteerå¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#puppeteerå¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="puppeteerå¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>puppeteerå¦‚ä½•ä½¿ç”¨ï¼Ÿ</h1><h2 id="å®‰è£…puppeteer"><a href="#å®‰è£…puppeteer" class="headerlink" title="å®‰è£…puppeteer"></a>å®‰è£…puppeteer</h2><p>è¿™é‡Œæœ‰ä¸ªå®‰è£…çš„å‘ï¼Œåˆ«çœ‹puppeteerçš„å®‰è£…åªæœ‰<code>npm i puppeteer</code>è¿™ä¹ˆä¸€æ¡ç®€å•çš„å‘½ä»¤ï¼Œä½†æ˜¯åœ¨å›½å†…å®‰è£…èµ·æ¥ä¹Ÿä¸æ˜¯è¿™ä¹ˆå®¹æ˜“çš„ï¼Œå› ä¸ºå®ƒé»˜è®¤ä¼šå»ä¸‹è½½Chromiumä½œä¸ºæŠ“å–æ•°æ®çš„å®¢æˆ·ç«¯ï¼Œå›½å†…åŸºæœ¬ä¸‹è½½ä¸ä¸‹æ¥ï¼Œå®‰è£…ä¼šå¤±è´¥ã€‚å³ä½¿æˆ‘å¼€ç€ssï¼Œä»ç„¶å¤±è´¥äº†ï¼ŒOrzâ€¦.æ¯”å¦‚è¯´åƒä¸‹é¢è¿™æ ·æŠ¥é”™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ERROR: Failed to download Chromium r515411! Set &quot;PUPPETEER_SKIP_CHROMIUM_DOWNLOA</div><div class="line">D&quot; env variable to skip download.</div></pre></td></tr></table></figure></p>
<p>æˆ‘å‘ç°ä»æœ€æ–°çš„1.7çš„ç‰ˆæœ¬å¼€å§‹åˆ†ç¦»å‡ºä¸€ä¸ªè½»é‡ç‰ˆçš„puppeteeræ ¸å¿ƒåº“ï¼Œé»˜è®¤ä¸å»ä¸‹è½½Chromiumã€‚<br>å½“ç„¶ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹è¯´å…ˆå¿½ç•¥è·³è¿‡ï¼Œå†å»æ‰‹åŠ¨ä¸‹è½½Chromiumï¼Œåé¢å¯èƒ½è¿˜æœ‰ä¸€äº›å‘è¦è·³ï¼Œä¸ªäººæ„Ÿè§‰æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ–¹ä¾¿å¿«æ·çš„åŠæ³•ã€‚æ— æ„ä¸­å‘ç°ä¸€ä¸ªåº“<a href="https://github.com/valleykid/puppeteer-cn" target="_blank" rel="external">puppeteer-cnä¼ é€é—¨</a>ï¼Œå’Œpuppeteerå®Œå…¨ä¸€æ ·ï¼Œä½ å®Œå…¨å¯ä»¥ç”¨puppeteer-cnä»£æ›¿ä¹‹ã€‚è¿™ä¸ªåŒ…ä¼šå…ˆå»æ£€æµ‹æœ¬åœ°Chromeç‰ˆæœ¬æ˜¯å¦å¤§äº59ï¼Œå†å†³å®šæ˜¯å¦é€šè¿‡ä¸€ä¸ªå›½å†…æºä¸‹è½½Chromiumã€‚è¿™ä¸ªåº“ä¸‹è½½é€Ÿåº¦å¾ˆå¿«ï¼Œç›´æ¥å°±å®‰è£…å¥½äº†Chromiumã€‚</p>
<h2 id="ä½¿ç”¨puppeteer"><a href="#ä½¿ç”¨puppeteer" class="headerlink" title="ä½¿ç”¨puppeteer"></a>ä½¿ç”¨puppeteer</h2><p>è¿™ä¸ªæ— éæ˜¯ä¸€äº›å¸¸è§„çš„APIè°ƒç”¨ï¼Œå¯ä»¥æŸ¥é˜…<a href="https://github.com/GoogleChrome/puppeteer/blob/v1.7.0/docs/api.md" target="_blank" rel="external">å®˜æ–¹çš„æ–‡æ¡£</a>æ¥å®ç°ä¸€äº›è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªå¿«é€Ÿä¸Šæ‰‹çš„å°ä¾‹å­ã€‚ç”±äºæˆ‘çš„appæ˜¯æŠ“å–å…è´¹æ¼«ç”»ï¼Œä¸‹é¢å°±ç»™å‡ºæŠ“å–ç½‘æ˜“å…è´¹æ¼«ç”»çš„ä¾‹å­</p>
<ol>
<li><p>å¼•å…¥puppeteerå·¥å…·ç±»</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer-cn'</span>)ã€€<span class="comment">//æŠ“å–å·¥å…·ç±»</span></div></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½®æ¨¡æ‹Ÿçš„pcè®¾å¤‡<br>è®¾ç½®æµè§ˆå™¨çš„å°ºå¯¸å’ŒuserAgent</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * æ¨¡æ‹Ÿpcè®¾å¤‡mac</div><div class="line"> */</div><div class="line"><span class="keyword">const</span> viewPort = &#123;</div><div class="line">    <span class="attr">width</span>: <span class="number">1920</span>,</div><div class="line">    <span class="attr">height</span>: <span class="number">1080</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> userAgent = <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'</span></div><div class="line"><span class="keyword">await</span> page.setViewport(viewPort);</div><div class="line"><span class="keyword">await</span> page.setUserAgent(userAgent);</div></pre></td></tr></table></figure>
</li>
<li><p>åˆå§‹åŒ–è¯·æ±‚å®¢æˆ·ç«¯</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å¯åŠ¨äº†ä¸€ä¸ªChromeå®ä¾‹</span></div><div class="line"><span class="keyword">let</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">true</span> &#125;)</div><div class="line"><span class="comment">// æµè§ˆå™¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„é¡µé¢</span></div><div class="line"><span class="keyword">await</span> browser.newPage()</div></pre></td></tr></table></figure>
</li>
</ol>
<p>headless è®¾ç½®ä¸ºtrueï¼Œåˆ™ä¸å±•ç¤ºChromiumçš„è®¿é—®ç•Œé¢ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œæœ€å¥½è®¾ç½®æˆfalseï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹è¿è¡Œè¿‡ç¨‹ã€‚</p>
<ol>
<li>è·³è½¬åˆ°ç›®æ ‡ç½‘ç«™<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> url = <span class="string">'https://manhua.163.com/category?sort=2&amp;sf=1'</span></div><div class="line"><span class="comment">// è·³è½¬åˆ°ç›®æ ‡ç½‘ç«™</span></div><div class="line"><span class="keyword">await</span> page.goto(url)</div><div class="line"><span class="comment">// ç­‰å¾…æ—¶é•¿</span></div><div class="line"><span class="keyword">await</span> page.waitFor(<span class="number">200</span>)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>è¿™ä¸ªåœ°å€æ­£å¥½æ˜¯ç½‘æ˜“æ¼«ç”»çš„å®˜æ–¹åœ°å€åœ¨æ¼«ç”»åˆ—è¡¨ä¸­è¿‡æ»¤å‡ºå…è´¹æ¼«ç”»</p>
<ol>
<li>æŠ“å–æ•°æ®ï¼Œå¹¶è¿”å›</li>
</ol>
<ul>
<li>é¦–å…ˆåˆ†ææŠ“å–åˆ°çš„é¡µé¢æ•°æ®ï¼Œæ‰¾å‡ºç›®æ ‡domèŠ‚ç‚¹ï¼Œ<br>å¯ä»¥åœ¨è°ƒè¯•çš„Chromiumä¸­æˆ–è€…åœ¨è‡ªå·±æ‰“å¼€ä¸€ä¸ªchromeæµè§ˆå™¨ä¸­æŒ‰ä¸‹æŸ¥çœ‹ç½‘é¡µä»£ç ã€‚<br>è°ƒå‡ºå®¡æŸ¥å…ƒç´ ç•Œé¢<br>Macï¼šcommand+option+I<br>windows/linuxï¼šctrl+shift+I<br><img src="/images/PuppeteerStart.png" alt="å›¾"><br>ä»ç½‘é¡µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾å‡ºç›®æ ‡æ•°æ®å’Œç›¸å…³çš„domèŠ‚ç‚¹ã€‚å¸¦æœ‰<code>comic-item</code>ç±»é€‰æ‹©å™¨çš„divå°±æ˜¯æ¼«ç”»åˆ—è¡¨çš„æ¯ä¸€ä¸ªæ•°æ®é¡¹ï¼Œå…¶ä¸­å­èŠ‚ç‚¹<code>cover</code>ç±»é€‰æ‹©å™¨divå°±æ˜¯æ•°æ®é¡¹çš„å›¾ç‰‡ä¿¡æ¯éƒ¨åˆ†ï¼Œé‡Œé¢çš„å­å…ƒç´ imgæ ‡ç­¾çš„srcå±æ€§å°±æ˜¯æ¼«ç”»å°é¢çš„å›¾ç‰‡åœ°å€ã€‚è€Œ<code>comic-info</code>ç±»é€‰æ‹©å™¨çš„divå°±æ˜¯æ•°æ®é¡¹çš„æ–‡å­—ä¿¡æ¯éƒ¨åˆ†ï¼Œé‡Œé¢çš„å­å…ƒç´ <code>.title</code>ç±»é€‰æ‹©å™¨çš„divä¸­åŒ…å«çš„æ–‡å­—å°±æ˜¯æ ‡é¢˜ï¼Œ<code>span</code>æ ‡ç­¾ä¸­åŒ…å«çš„æ–‡å­—å°±æ˜¯å½“å‰ç« èŠ‚ï¼Œ<code>.muted</code>ç±»é€‰æ‹©å™¨divä¸­çš„æ–‡å­—å°±æ˜¯ç‚¹å‡»é‡ï¼Œæ¼«ç”»çš„è·³è½¬é“¾æ¥åœ¨<code>a</code>æ ‡ç­¾ä¸­çš„<code>href</code>å±æ€§ä¸­ï¼Œå¾—åˆ°å®Œæ•´çš„åœ°å€éœ€è¦åšä¸€ä¸ªæ‹¼æ¥ã€‚<br>puppeteeræ˜¯é€šè¿‡seletoré€‰æ‹©å™¨å»è·å–å…ƒç´ çš„ï¼Œäº†è§£ä¸€éƒ¨åˆ†å‰ç«¯çŸ¥è¯†çš„äººæ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œä¹Ÿæ²¡ä»€ä¹ˆéš¾åº¦ã€‚åˆ†æå®Œäº†ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»ç›®æ ‡domä¸­æå–åˆ°æƒ³è¦è¿”å›çš„æ•°æ®ã€‚<br>æ‰€ä»¥æœ€åçš„æŠ“å–ä»£ç å¦‚ä¸‹:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> targetUrl = <span class="string">'https://manhua.163.com'</span></div><div class="line"><span class="keyword">return</span> <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">targetUrl</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">let</span> data = []</div><div class="line">    <span class="keyword">let</span> elements = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.comic-item'</span>) <span class="comment">// è·å–æ‰€æœ‰æ¼«ç”»å…ƒç´ </span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> element <span class="keyword">of</span> elements) &#123; <span class="comment">// å¾ªç¯</span></div><div class="line">        <span class="keyword">let</span> title = element.querySelector(<span class="string">'.comic-info .title'</span>).innerText <span class="comment">// è·å–æ ‡é¢˜</span></div><div class="line">        <span class="keyword">let</span> chapter = element.querySelector(<span class="string">'.comic-info span'</span>).innerTextã€€<span class="comment">// è·å–ç« èŠ‚</span></div><div class="line">        <span class="keyword">let</span> clickNum = element.querySelector(<span class="string">'.comic-info div.muted'</span>).innerText <span class="comment">//ã€€è·å–ç‚¹å‡»é‡</span></div><div class="line">        <span class="keyword">let</span> link = element.querySelector(<span class="string">'.comic-info a'</span>).getAttribute(<span class="string">'href'</span>)</div><div class="line">        link = targetUrl + link</div><div class="line">        <span class="keyword">let</span> cover = element.querySelector(<span class="string">'.cover img'</span>).getAttribute(<span class="string">'src'</span>)</div><div class="line">        <span class="comment">// let id = link.replace('https://manhua.163.com/source/','')</span></div><div class="line">        <span class="keyword">let</span> id = link.substring(link.lastIndexOf(<span class="string">'/'</span>)+<span class="number">1</span>,link.length)</div><div class="line">        data.push(&#123; id, title, chapter, clickNum, link, cover &#125;) <span class="comment">// å­˜å…¥æ•°ç»„</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> data</div><div class="line">&#125;, targetUrl)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>é€šè¿‡seletoré€‰æ‹©å™¨å»è·å–å…ƒç´ ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è·å–ç›®æ ‡èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡page.evaluateè¿™ä¸ªapiè·å–åˆ°htmlå†…å®¹åï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­è°ƒç”¨domèŠ‚ç‚¹é€‰æ‹©å™¨ç›¸å…³apiè·å–ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æ— æ³•æ‰“å°logï¼Œæ— æ³•å†…éƒ¨æ–­ç‚¹ï¼Œä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¤–éƒ¨çš„å˜é‡ï¼Œéœ€è¦é€šè¿‡apiæœ€åä¸€ä¸ªå‚æ•°è¿›è¡Œä¼ å‚è®¿é—®ï¼Œæœ€åè¿”å›ä¸€ä¸ªæ“ä½œç»“æœã€‚å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯é€šè¿‡puppeteerçš„é€‰æ‹©å™¨ç›¸å…³apiç›´æ¥è·å–ã€‚<br>æ¯”å¦‚è¯´è¿™æ ·ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è·å–åŒ¹é…é€‰æ‹©å™¨'div.portrait-player .img-box'ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹</span></div><div class="line"><span class="keyword">let</span> imgs = <span class="keyword">await</span> page.$$(<span class="string">'div.portrait-player .img-box'</span>)</div><div class="line"><span class="comment">// è·å–åŒ¹é…é€‰æ‹©å™¨'div.portrait-player .img-box'ä¸‹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></div><div class="line"><span class="keyword">let</span> img = <span class="keyword">await</span> page.$$(<span class="string">'div.portrait-player .img-box'</span>)</div><div class="line"><span class="comment">// è·å–åŒ¹é…é€‰æ‹©å™¨'div.portrait-player .img-box'ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹å¹¶è¿”å›æ•°é‡</span></div><div class="line"><span class="keyword">let</span> imagesLen = <span class="keyword">await</span> page.$$<span class="built_in">eval</span>(<span class="string">'div.portrait-player .img-box'</span>, imgs =&gt; imgs.length)</div><div class="line"><span class="comment">// è·å–åŒ¹é…é€‰æ‹©å™¨'div.portrait-player .img-box'ä¸‹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿”å›èŠ‚ç‚¹çš„styleå±æ€§ä¸­çš„é«˜åº¦å€¼å¹¶å»æ‰'px'å•ä½å­—ç¬¦ä¸²</span></div><div class="line"><span class="keyword">let</span> imgHeight =<span class="keyword">await</span> page.$<span class="built_in">eval</span>(<span class="string">'div.portrait-player .img-box'</span>, img =&gt; img.style.height.replace(<span class="string">'px'</span>,<span class="string">''</span>))</div></pre></td></tr></table></figure></p>
<p><code>page.$$</code> æŠ“å–è¯¥é€‰æ‹©å™¨åŒ¹é…çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¯¹åº”domè·å–èŠ‚ç‚¹querySelectorAllè¿™ä¸ªapiï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„è¿”å›null<br><code>page.$</code> æŠ“å–è¯¥é€‰æ‹©å™¨åŒ¹é…çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿”å›ç»™å›è°ƒå‡½æ•°ï¼Œå¯¹åº”domè·å–èŠ‚ç‚¹querySelectorè¿™ä¸ªapiï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„è¿”å›nullï¼Œ<br><code>page.$$eval</code> æ¯”èµ·<code>page.$$</code>å¤šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°è¿›è¡ŒæŠ“å–åçš„æ“ä½œï¼ŒæŠ“å–è¯¥é€‰æ‹©å™¨åŒ¹é…çš„æ‰€æœ‰èŠ‚ç‚¹å¹¶è¿”å›ç»™å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ•°æ®è½¬æ¢æ“ä½œåå†è¿”å›å‡½æ•°ç»“æœï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„æ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸<br><code>page.$eval</code> æ¯”èµ·<code>page.$</code>å¤šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°è¿›è¡ŒæŠ“å–åçš„æ“ä½œï¼ŒæŠ“å–è¯¥é€‰æ‹©å™¨åŒ¹é…çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿”å›ç»™å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ•°æ®è½¬æ¢æ“ä½œåå†è¿”å›å‡½æ•°ç»“æœï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„æ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</p>
<p>å½“ç„¶ï¼Œpuppeteeræä¾›çš„apiæ“ä½œè¿œä¸æ­¢è¿™äº›ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå¿«é€Ÿä¸Šæ‰‹çš„å°ä¾‹å­ï¼Œæ›´å¤šæœ‰è¶£çš„ç©æ³•ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/RN-CallNative-Android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/RN-CallNative-Android/" itemprop="url">react-nativeè°ƒandroidåŸç”Ÿ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-20T11:03:00+08:00">
                2018-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ReactNative/" itemprop="url" rel="index">
                    <span itemprop="name">ReactNative</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/20/RN-CallNative-Android/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/07/20/RN-CallNative-Android/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/20/RN-CallNative-Android/" class="leancloud_visitors" data-flag-title="react-nativeè°ƒandroidåŸç”Ÿ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>æˆ‘çš„å¼€æºé¡¹ç›®é«˜ä»¿éŸ©å¯’çš„oneä¸€ä¸ªï¼Œæ‰“ç®—é•¿æœŸç»´æŠ¤å¹¶å€Ÿæ­¤æœºä¼šå­¦ä¹ react-nativeç›¸å…³çš„æŠ€æœ¯ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥<a href="https://github.com/jessieeeee/SimpleOne" target="_blank" rel="external">æˆ³è¿™é‡Œ</a>ï¼Œæ­¤é¡¹ç›®ä¸æ˜¯æ ‡å‡†çš„react-nativeé¡¹ç›®ç»“æ„ï¼Œè€Œæ˜¯åœ¨android studioå·¥ç¨‹é¡¹ç›®ä¸‹å¼•å…¥react-nativeçš„æ··åˆå¼å¼€å‘ç»“æ„ï¼Œå…¶ä¸­ä¸å°‘åœ°æ–¹è°ƒç”¨äº†åŸç”Ÿçš„æ¨¡å—å’ŒåŸç”Ÿå°è£…çš„uiç»„ä»¶ï¼Œç›¸ä¿¡åœ¨react-nativeè·¨å¹³å°è¿˜ä¸æˆç†Ÿçš„é˜¶æ®µï¼Œè°ƒç”¨åŸç”Ÿå®Œæˆå¼€å‘éœ€æ±‚æ˜¯ä¸å¯é¿å…çš„ï¼Œæ‰“ç®—åœ¨è¿™é‡Œå¯¹react-nativeè°ƒç”¨åŸç”Ÿçš„ç›¸å…³æŠ€æœ¯åšä¸€ä¸ªæ€»ç»“ï¼å¦‚æœæœ‰ä¸æ­£ç¡®çš„åœ°æ–¹è¿˜æœ›æŒ‡æ­£ï¼Œæˆ–è€…æ‚¨æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆä¹Ÿæ¬¢è¿æå‡ºä¸€èµ·è®¨è®º</p>
<hr>
<h1 id="è°ƒç”¨åŸç”Ÿæ¨¡å—"><a href="#è°ƒç”¨åŸç”Ÿæ¨¡å—" class="headerlink" title="è°ƒç”¨åŸç”Ÿæ¨¡å—"></a>è°ƒç”¨åŸç”Ÿæ¨¡å—</h1><p>react-nativeè°ƒç”¨åŸç”Ÿæ¨¡å—åº”è¯¥æ˜¯ç»å¸¸ä¼šç”¨åˆ°çš„ï¼Œæˆ‘ä»¬åœ¨android studioé¡¹ç›®ä¸­å¼•å…¥react-nativeå®è´¨ä¸Šå°±æ˜¯è®¾ç½®ReactRootViewä¸ºactivityçš„å¸ƒå±€è§†å›¾ï¼Œåˆå§‹åŒ–mReactInstanceManagerè¿›è¡Œreact-nativeçš„ç›¸å…³é…ç½®ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„åŸç”Ÿç»„ä»¶åŒ…ï¼ŒMainReactPackageä¸»ç»„ä»¶åŒ…ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤æ·»åŠ çš„ï¼Œåœ¨activityçš„ç”Ÿå‘½å‘¨æœŸä¸­å¯¹react-nativeåšç›¸å…³é…ç½®ï¼ŒåŒæ—¶ç»§æ‰¿DefaultHardwareBackBtnHandleræ¥å£ï¼Œè¿™ä¸ªæ¥å£åªæœ‰invokeDefaultOnBackPressedçš„æ–¹æ³•ï¼Œå¯¹äºandroid backæŒ‰é”®ï¼Œæ˜¯åœ¨onBackPressedä¸­ï¼ŒæŠŠæ‰€æœ‰çš„backäº‹ä»¶éƒ½å‘åˆ°jsç«¯ï¼Œå¦‚æœjsç«¯æ²¡ç›‘å¬ï¼Œæˆ–è€…ç›‘å¬éƒ½è¿”å›äº†falseï¼Œé‚£ä¹ˆå°±ä¼šå›åˆ°invokeDefaultOnBackPressedçš„Activityå¤„ç†ã€‚</p>
<h2 id="è°ƒç”¨åŸç”Ÿçš„åœºæ™¯"><a href="#è°ƒç”¨åŸç”Ÿçš„åœºæ™¯" class="headerlink" title="è°ƒç”¨åŸç”Ÿçš„åœºæ™¯"></a>è°ƒç”¨åŸç”Ÿçš„åœºæ™¯</h2><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨react-native çš„uiä¸­åŠ å…¥toastæç¤ºï¼Œè°ƒç”¨éŸ³ä¹æ’­æ”¾ç­‰å¤šåª’ä½“ç›¸å…³çš„ç³»ç»Ÿapiæ”¯æŒï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹åˆ†äº«å’Œç™»å½•æˆæƒâ€¦â€¦ä¸å¯é¿å…çš„è¦è°ƒç”¨åŸç”Ÿä»£ç ï¼Œæ¥ä¸‹æ¥è¯¦ç»†è®°å½•react-native jsç«¯ä¸åŸç”Ÿandroidç«¯ä¹‹é—´çš„é€šä¿¡æ–¹å¼</p>
<h2 id="react-nativeè°ƒç”¨androidåŸç”Ÿ"><a href="#react-nativeè°ƒç”¨androidåŸç”Ÿ" class="headerlink" title="react-nativeè°ƒç”¨androidåŸç”Ÿ"></a>react-nativeè°ƒç”¨androidåŸç”Ÿ</h2><p>ä»¥åŠ å…¥toastæç¤ºä¸ºä¾‹ï¼š</p>
<h3 id="å…ˆå®šä¹‰ä¸€ä¸ªReactContextBaseJavaModule"><a href="#å…ˆå®šä¹‰ä¸€ä¸ªReactContextBaseJavaModule" class="headerlink" title="å…ˆå®šä¹‰ä¸€ä¸ªReactContextBaseJavaModule"></a>å…ˆå®šä¹‰ä¸€ä¸ªReactContextBaseJavaModule</h3><p>è‡ªå®šä¹‰ä¸€ä¸ªToastModuleç»§æ‰¿ReactContextBaseJavaModuleï¼Œé‡å†™å…¶ä¸­çš„getNameæ–¹æ³•ï¼Œè¿”å›react-nativeä¸­è°ƒç”¨æ—¶çš„ç»„ä»¶åï¼Œé‡å†™getConstantsæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå¸¸é‡mapï¼Œå®šä¹‰å¸¸é‡å€¼çš„keyï¼Œå°†æ‰€æœ‰å¯ä¾›è°ƒç”¨çš„å¸¸é‡å€¼putè¿›å»ï¼Œé€šè¿‡å¯¹è±¡.å¸¸é‡å€¼keyä½¿ç”¨æ¨¡å—å¸¸é‡ï¼Œä½¿ç”¨ï½€@ReactMethodï½€æ³¨è§£å¯ä¾›react-nativeè°ƒç”¨çš„æ–¹æ³•ï¼Œ@ReactMethodæ³¨è§£çš„æ–¹æ³•è¿”å›ç±»å‹ä¸€å®šæ˜¯voidï¼Œè¿™é‡Œçš„å›è°ƒå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼Œç¬¬ä¸€ç§æ˜¯callbackçš„æ–¹å¼ï¼Œç¬¬äºŒç§æ˜¯promiseçš„æ–¹å¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToastModule</span> <span class="keyword">extends</span> <span class="title">ReactContextBaseJavaModule</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DURATION_SHORT_KEY = <span class="string">"SHORT"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DURATION_LONG_KEY = <span class="string">"LONG"</span>;</div><div class="line">    <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</div><div class="line">    <span class="keyword">int</span> count=<span class="number">100000</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ToastModule</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(reactContext);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// å¤å†™æ–¹æ³•ï¼Œè¿”å›react-nativeä¸­è°ƒç”¨çš„ç»„ä»¶å</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"ToastNative"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// å¤å†™æ–¹æ³•ï¼Œè¿”å›å¸¸é‡</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getConstants</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> Map&lt;String, Object&gt; constants = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">        constants.put(DURATION_SHORT_KEY, Toast.LENGTH_SHORT);</div><div class="line">        constants.put(DURATION_LONG_KEY, Toast.LENGTH_LONG);</div><div class="line">        <span class="keyword">return</span> constants;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ä½¿ç”¨ @ReactMethodæ³¨è§£è¿”å›react-nativeä¸­å¯è°ƒç”¨çš„æ–¹æ³•ï¼ˆä½¿ç”¨callbackçš„æ–¹å¼ï¼‰</span></div><div class="line">    <span class="meta">@ReactMethod</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String message, <span class="keyword">int</span> duration ,Callback successCallback, Callback errorCallback)</span> </span>&#123;</div><div class="line">        Toast.makeText(getReactApplicationContext(), message, duration).show();</div><div class="line">        <span class="comment">// é€šè¿‡invokeè°ƒç”¨ï¼Œéšä¾¿ä½ ä¼ å‚</span></div><div class="line">        <span class="keyword">if</span>(flag) &#123;</div><div class="line">            successCallback.invoke(<span class="string">"success"</span>, ++count);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            errorCallback.invoke(<span class="string">"error"</span>, ++count);</div><div class="line">        &#125;</div><div class="line">        flag = !flag;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">ã€€  <span class="comment">//  ä½¿ç”¨ @ReactMethodæ³¨è§£è¿”å›react-nativeä¸­å¯è°ƒç”¨çš„æ–¹æ³•ï¼ˆä½¿ç”¨promiseçš„æ–¹å¼ï¼‰</span></div><div class="line">    <span class="meta">@ReactMethod</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMsg</span><span class="params">(String msg, Promise promise)</span> </span>&#123;</div><div class="line">        String result = <span class="string">"å¤„ç†ç»“æœï¼š"</span> + msg;</div><div class="line">        Toast.makeText(getReactApplicationContext(), result, Toast.LENGTH_SHORT).show();</div><div class="line">        promise.resolve(result);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ä½¿ç”¨ @ReactMethodæ³¨è§£è¿”å›react-nativeä¸­å¯è°ƒç”¨çš„ æ–¹æ³•</span></div><div class="line">    <span class="meta">@ReactMethod</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMsg</span><span class="params">(String message, <span class="keyword">int</span> duration)</span> </span>&#123;</div><div class="line">        Toast.makeText(getReactApplicationContext(), message, duration).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">ã€€</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="æ³¨å†ŒReactContextBaseJavaModule"><a href="#æ³¨å†ŒReactContextBaseJavaModule" class="headerlink" title="æ³¨å†ŒReactContextBaseJavaModule"></a>æ³¨å†ŒReactContextBaseJavaModule</h3><p>åœ¨è‡ªå®šä¹‰çš„ç»„ä»¶åŒ…ä¸­MyReactPackageæ³¨å†Œè¿™ä¸ªReactContextBaseJavaModule,å…¶ä¸­createViewManagersæ–¹æ³•ç”¨äºæ³¨å†ŒåŸç”Ÿuiç»„ä»¶ï¼Œè€ŒcreateNativeModulesæ–¹æ³•ç”¨äºæ³¨å†ŒåŸç”Ÿæ¨¡å—<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReactPackage</span> <span class="keyword">implements</span> <span class="title">ReactPackage</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å¼•å…¥åŸç”Ÿçš„æ¨¡å—</div><div class="line">     * <span class="doctag">@param</span> reactContext</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;NativeModule&gt; <span class="title">createNativeModules</span><span class="params">(</span></span></div><div class="line">            ReactApplicationContext reactContext) &#123;</div><div class="line">        List&lt;NativeModule&gt; modules = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        modules.add(<span class="keyword">new</span> UShareModule(reactContext));</div><div class="line">        modules.add(<span class="keyword">new</span> ULoginModule(reactContext));</div><div class="line">        modules.add(<span class="keyword">new</span> ToastModule(reactContext));</div><div class="line">        modules.add(<span class="keyword">new</span> MediaPlayerModule(reactContext));</div><div class="line">        <span class="keyword">return</span> modules;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªMyReactPackageæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç»„ä»¶åŒ…ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ åˆ°é…ç½®ä¸­</p>
<h3 id="åœ¨react-nativeå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage"><a href="#åœ¨react-nativeå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage" class="headerlink" title="åœ¨react-nativeå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage"></a>åœ¨react-nativeå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage</h3><p>ä¿®æ”¹androidå·¥ç¨‹ä¸­çš„Applicationç±»ï¼Œé‡å†™ReactNativeHostä¸­çš„getPackagesæ–¹æ³•ï¼Œåœ¨è¿”å›çš„æ•°ç»„ä¸­æ·»åŠ è‡ªå®šä¹‰çš„ç»„ä»¶åŒ…å¯¹è±¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> <span class="keyword">implements</span> <span class="title">ReactApplication</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MyReactPackage myReactPackage=<span class="keyword">new</span> MyReactPackage();</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReactNativeHost mReactNativeHost = <span class="keyword">new</span> ReactNativeHost(<span class="keyword">this</span>) &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getUseDeveloperSupport</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> BuildConfig.DEBUG;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> List&lt;ReactPackage&gt; <span class="title">getPackages</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(</div><div class="line">                    <span class="keyword">new</span> MainReactPackage(),</div><div class="line">                    myReactPackage</div><div class="line">            );</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ReactNativeHost <span class="title">getReactNativeHost</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mReactNativeHost;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="åœ¨android-studioå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage"><a href="#åœ¨android-studioå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage" class="headerlink" title="åœ¨android studioå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage"></a>åœ¨android studioå·¥ç¨‹ç»“æ„ä¸‹æ·»åŠ è‡ªå®šä¹‰çš„ReactPackage</h3><p>æ‰¾åˆ°ReactActivityæˆ–è€…ç»§æ‰¿DefaultHardwareBackBtnHandleræ¥å£çš„activityä¸­çš„mReactInstanceManagerï¼Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶åŒ…<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> ReactRootView mReactRootView;</div><div class="line"><span class="keyword">private</span> ReactInstanceManager mReactInstanceManager;</div><div class="line"> <span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    ...</div><div class="line">    mReactRootView = <span class="keyword">new</span> ReactRootView(<span class="keyword">this</span>);</div><div class="line">    mReactInstanceManager = ReactInstanceManager.builder()</div><div class="line">            .setApplication(getApplication())</div><div class="line">            .setBundleAssetName(<span class="string">"index.android.bundle"</span>)</div><div class="line">            .setJSMainModuleName(<span class="string">"index.android"</span>)</div><div class="line">            .addPackage(<span class="keyword">new</span> MainReactPackage())</div><div class="line">            .addPackage(<span class="keyword">new</span> MyReactPackage())</div><div class="line">            .addPackage(<span class="keyword">new</span> ImagePickerPackage())</div><div class="line">            .setUseDeveloperSupport(BuildConfig.DEBUG)</div><div class="line">            .setInitialLifecycleState(mLifecycleState)</div><div class="line">            .build();</div><div class="line">    mReactRootView.startReactApplication(mReactInstanceManager,</div><div class="line">            <span class="string">"SimpleOne"</span>, <span class="keyword">null</span>);</div><div class="line">    mReactInstanceManager.getDevSupportManager().showDevOptionsDialog();</div><div class="line">    setContentView(mReactRootView);</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥åªè¦å®ç°äº†ReactPackageå’ŒReactContextBaseJavaModuleï¼Œå°†å®ƒæ³¨å†Œåˆ°ReactNativeHostæˆ–è€…ReactInstanceManagerï¼Œå°±å¯ä»¥åœ¨React Nativeä¸­è°ƒç”¨åŸç”Ÿæ¨¡å—äº†ã€‚</p>
<h3 id="åœ¨react-nativeä¸­ä½¿ç”¨"><a href="#åœ¨react-nativeä¸­ä½¿ç”¨" class="headerlink" title="åœ¨react-nativeä¸­ä½¿ç”¨"></a>åœ¨react-nativeä¸­ä½¿ç”¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; NativeModules &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div><div class="line"><span class="keyword">let</span> toast = NativeModules.ToastNative;</div><div class="line">toast.show(<span class="string">'Toast message'</span>,toast.SHORT,(message,count)=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"success"</span>,message,count)&#125;,(message,count)=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"error"</span>,message,count)&#125;)</div><div class="line">toast.showMsg(<span class="string">'ä»Šæ™š22:30ä¸»æ’­åœ¨è¿™é‡Œç­‰ä½ '</span>,toast.SHORT);</div></pre></td></tr></table></figure>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcallbackï¼promise åœ¨æ‰§è¡Œinvokeï¼ï¼ˆrejectã€resolveï¼‰ä¹‹åï¼Œéƒ½ä¼šåœ¨jsçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¢«é”€æ¯ã€‚callbackï¼promiseåªèƒ½ç”¨äºä¸€æ¬¡è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½å¤šæ¬¡è°ƒç”¨callbackï¼promiseæ¥ä¸react-nativeçš„ç»„ä»¶è¿›è¡Œé€šä¿¡ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸‹è¿™ç§callbackï¼promiseçš„é€šä¿¡æ–¹å¼æ˜¯ä¸å®ç”¨çš„ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è°ƒç”¨androidç³»ç»Ÿapiæ¥æ’­æ”¾éŸ³ä¹ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬éŸ³ä¹çš„æ’­æ”¾çŠ¶æ€å’Œè¿›åº¦ï¼Œè¿™é‡Œéœ€è¦åŸç”Ÿæ¨¡å—ä¸»åŠ¨ä¸react-nativeé€šä¿¡è€Œä¸”æ˜¯å¤šæ¬¡é€šä¿¡ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨å¦ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œå°±æ˜¯emitï¼Œæœ‰ç‚¹ç±»ä¼¼androidçš„å¹¿æ’­ï¼Œå‘é€ä¸€æ¡æ¶ˆæ¯ç»™jsç«¯ï¼Œjsç«¯æ³¨å†Œç›‘å¬æ¥æ”¶è¿™æ¡æ¶ˆæ¯</p>
<h1 id="AndroidåŸç”Ÿè°ƒreact-native"><a href="#AndroidåŸç”Ÿè°ƒreact-native" class="headerlink" title="AndroidåŸç”Ÿè°ƒreact-native"></a>AndroidåŸç”Ÿè°ƒreact-native</h1><p>ä»¥å®ç°æ’­æ”¾éŸ³ä¹ï¼Œç›‘å¬éŸ³ä¹çš„æ’­æ”¾çŠ¶æ€å’Œè¿›åº¦ä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦è®©androidä¸»åŠ¨å‘react-nativeå¤šæ¬¡å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦å®šä¹‰ä¸€ä¸ªReactContextBaseJavaModuleï¼Œå¹¶ä¸”åœ¨è‡ªå®šä¹‰çš„ç»„ä»¶åŒ…MyReactPackageä¸­çš„createNativeModulesæ–¹æ³•é‡Œæ³¨å†Œï¼Œè·Ÿå‰é¢çš„åšæ³•å®Œå…¨ä¸€æ ·å°±ä¸å†èµ˜è¿°äº†ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å…³å¿ƒçš„æ˜¯å¦‚ä½•ä¸»åŠ¨å‘é€æ¶ˆæ¯</p>
<h2 id="Androidç«¯ä¸»åŠ¨å‘æ¶ˆæ¯"><a href="#Androidç«¯ä¸»åŠ¨å‘æ¶ˆæ¯" class="headerlink" title="Androidç«¯ä¸»åŠ¨å‘æ¶ˆæ¯"></a>Androidç«¯ä¸»åŠ¨å‘æ¶ˆæ¯</h2><p>reactContextåœ¨æˆ‘ä»¬æ³¨å†ŒReactContextBaseJavaModuleçš„æ—¶å€™ç”±MyReactPackageä¸­çš„createNativeModulesæ–¹æ³•ä¼ å…¥ï¼Œé€šè¿‡reactContextå¾—åˆ°å½“å‰çš„JSModuleè°ƒç”¨å®ƒçš„emitæ–¹æ³•ï¼Œå¯ä»¥ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªäº‹ä»¶åç§°å’Œä¸€ä¸ªWritableMapå¯¹è±¡ï¼Œäº‹ä»¶åç§°éœ€è¦ä¸react-nativeæ³¨å†Œç›‘å¬çš„äº‹ä»¶åç§°å‚æ•°å¯¹åº”èµ·æ¥ï¼Œè€Œè¿™ä¸ªWritableMapå¯¹è±¡å­˜æ”¾çš„å°±æ˜¯æ‰€æœ‰éœ€è¦ä¼ é€’çš„å‚æ•°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendEvent</span><span class="params">(ReactContext reactContext, String eventName, WritableMap map)</span></span></div><div class="line">&#123;</div><div class="line">    System.out.println(<span class="string">"reactContext="</span>+reactContext);</div><div class="line">    reactContext</div><div class="line">                .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)</div><div class="line">                .emit(eventName,map);</div><div class="line">&#125;</div><div class="line">WritableMap map=Arguments.createMap();</div><div class="line">map.putString(<span class="string">"state"</span>,LOADING_MEDIA_SUCCESS);</div><div class="line">sendEvent(mContext,PLAY_STATE,map);</div></pre></td></tr></table></figure></p>
<h2 id="react-nativeæ³¨å†Œç›‘å¬æ¥æ”¶æ¶ˆæ¯"><a href="#react-nativeæ³¨å†Œç›‘å¬æ¥æ”¶æ¶ˆæ¯" class="headerlink" title="react-nativeæ³¨å†Œç›‘å¬æ¥æ”¶æ¶ˆæ¯"></a>react-nativeæ³¨å†Œç›‘å¬æ¥æ”¶æ¶ˆæ¯</h2><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å¯¹å‘é€çš„äº‹ä»¶åç§°æ³¨å†Œç›‘å¬ï¼Œä¸å‘é€æ¶ˆæ¯æ—¶äº‹ä»¶åç§°çš„ä¼ å‚ä¿æŒä¸€è‡´ï¼Œåœ¨å›è°ƒä¸­å¤„ç†æ¥æ”¶åˆ°æ¶ˆæ¯ä»¥åçš„é€»è¾‘<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.listener = <span class="function">(<span class="params">reminder</span>) =&gt;</span> &#123;</div><div class="line">           <span class="built_in">console</span>.log(<span class="string">'å½“å‰çŠ¶æ€'</span> + reminder.state);</div><div class="line">           <span class="keyword">if</span>(<span class="keyword">this</span>.props.isVisible)&#123;</div><div class="line">               <span class="keyword">if</span> (reminder.state === constants.STOP_PLAY_MEDIA || reminder.state === constants.PLAY_EXCEPTION || reminder.state == constants.PLAY_COMPLETE) &#123;</div><div class="line">                   <span class="keyword">this</span>.setState(&#123;</div><div class="line">                       <span class="attr">isPlay</span>: <span class="literal">false</span>,</div><div class="line">                   &#125;);</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">DeviceEventEmitter.addListener(constants.PLAY_STATE, <span class="keyword">this</span>.listener)</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä½ åœ¨è¿™ä¸ªå›è°ƒé€»è¾‘ä¸­åˆ·æ–°äº†uiï¼Œç„¶è€Œè¿™ä¸ªé¡µé¢å½“å‰å¹¶æ²¡ç»˜åˆ¶ï¼Œreact-nativeä¼šå‘å‡ºè­¦å‘Šï¼Œå¯¹åº”çš„è¿˜æœ‰å–æ¶ˆç›‘å¬çš„æ–¹æ³•<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">DeviceEventEmitter.removeAllListeners(constants.PLAY_STATE);ã€€<span class="comment">//ç§»é™¤è¯¥äº‹ä»¶æ‰€æœ‰ç›‘å¬</span></div><div class="line">DeviceEventEmitter.removeListener(constants.PLAY_STATE,listener); <span class="comment">//ç§»é™¤è¯¥äº‹ä»¶çš„æŒ‡å®šç›‘å¬</span></div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ä¸€æ—¦è°ƒç”¨äº†DeviceEventEmitter.removeAllListenersæ–¹æ³•ï¼Œå½±å“çš„ä¸åªæœ‰å½“å‰é¡µé¢çš„ç›‘å¬ï¼Œæ‰€æœ‰é¡µé¢çš„ç›‘å¬éƒ½è¢«ç§»é™¤äº†ï¼Œç§»é™¤å½“å‰é¡µé¢çš„ç›‘å¬æ˜¯ç¬¬äºŒä¸ª</p>
<h1 id="è°ƒåŸç”Ÿuiç»„ä»¶"><a href="#è°ƒåŸç”Ÿuiç»„ä»¶" class="headerlink" title="è°ƒåŸç”Ÿuiç»„ä»¶"></a>è°ƒåŸç”Ÿuiç»„ä»¶</h1><p>ç”±äºreact-nativeå®˜æ–¹æä¾›çš„æ»šè½®ç»„ä»¶å¯å®šåˆ¶æ€§æ¯”è¾ƒä½ï¼ŒDatePickerIOSå’ŒDatePickerAndroidï¼Œè°ƒç”¨çš„éƒ½æ˜¯åŸç”Ÿçš„æ—¥æœŸæ»šè½®é€‰æ‹©å™¨ï¼Œä¹Ÿæ²¡æ‰¾åˆ°åˆé€‚çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ— æ³•è¾¾åˆ°è®¾è®¡çš„æ•ˆæœï¼Œæ‰€ä»¥é‡‡ç”¨äº†è‡ªå®šä¹‰åŸç”Ÿuiç»„ä»¶çš„æ–¹æ¡ˆï¼Œç»™react-nativeæš´éœ²æ¥å£ï¼Œè®©react-nativeè°ƒç”¨åŸç”Ÿçš„uiç»„ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©æ»šè½®ä¸ºä¾‹ï¼Œè®°å½•ä¸€ä¸‹react-nativeè°ƒç”¨åŸç”Ÿuiç»„ä»¶çš„è¿‡ç¨‹ã€‚</p>
<h2 id="å°è£…ç»„ä»¶"><a href="#å°è£…ç»„ä»¶" class="headerlink" title="å°è£…ç»„ä»¶"></a>å°è£…ç»„ä»¶</h2><h3 id="ç»˜åˆ¶å•ä¸ªæ»šè½®"><a href="#ç»˜åˆ¶å•ä¸ªæ»šè½®" class="headerlink" title="ç»˜åˆ¶å•ä¸ªæ»šè½®"></a>ç»˜åˆ¶å•ä¸ªæ»šè½®</h3><p>å¸¸è§„æ–¹å¼ç»§æ‰¿Viewï¼Œåœ¨onDrawä¸­ç”¨canvasç›´æ¥ç»˜åˆ¶ï¼Œç›‘å¬æ‰‹åŠ¿ï¼Œæ ¹æ®æ‰‹æŒ‡æ»‘åŠ¨çš„è·ç¦»å¯¹å½“å‰æ»šè½®é€‰é¡¹è¿›è¡Œåˆ·æ–°ã€‚æ³¨æ„ä¸€ä¸‹è¾¹ç•Œåˆ¤æ–­ï¼Œå½“å‰é€‰æ‹©é¡¹ä¸‹æ ‡å°äº0æ—¶ï¼Œé€‰æ‹©æœ€åä¸€é¡¹ï¼Œå½“å‰é¡¹ä¸‹æ ‡å¤§äºæœ€åä¸€é¡¹ä¸‹æ ‡ï¼Œé€‰æ‹©ç¬¬ä¸€é¡¹ã€‚æ‰‹æŒ‡æŠ¬èµ·æ—¶æ»šåŠ¨åˆ°å½“å‰é€‰æ‹©é¡¹çš„ä¸­é—´ä½ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WheelView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"WheelView"</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è‡ªåŠ¨å›æ»šåˆ°ä¸­é—´çš„é€Ÿåº¦</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> SPEED = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * é™¤é€‰ä¸­itemå¤–ï¼Œä¸Šä¸‹å„éœ€è¦æ˜¾ç¤ºçš„å¤‡é€‰é¡¹æ•°ç›®</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_SIZE = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context context;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; itemList;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> itemCount;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * itemé«˜åº¦</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> itemHeight = <span class="number">50</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * é€‰ä¸­çš„ä½ç½®ï¼Œè¿™ä¸ªä½ç½®æ˜¯mDataListçš„ä¸­å¿ƒä½ç½®ï¼Œä¸€ç›´ä¸å˜</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentItem;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint selectPaint;</div><div class="line">    <span class="keyword">private</span> Paint mPaint;</div><div class="line">    <span class="comment">// ç”»èƒŒæ™¯å›¾ä¸­å•ç‹¬çš„ç”»ç¬”</span></div><div class="line">    <span class="keyword">private</span> Paint centerLinePaint;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> centerY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> centerX;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mLastDownY;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * æ»‘åŠ¨çš„è·ç¦»</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mMoveLen = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isInit = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">private</span> SelectListener mSelectListener;</div><div class="line">    <span class="keyword">private</span> Timer timer;</div><div class="line">    <span class="keyword">private</span> MyTimerTask mTask;</div><div class="line"></div><div class="line">    Handler updateHandler = <span class="keyword">new</span> Handler() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (Math.abs(mMoveLen) &lt; SPEED) &#123;</div><div class="line">                <span class="comment">// å¦‚æœåç§»é‡å°‘äºæœ€å°‘åç§»é‡</span></div><div class="line">                mMoveLen = <span class="number">0</span>;</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> != timer) &#123;</div><div class="line">                    timer.cancel();</div><div class="line">                    timer.purge();</div><div class="line">                    timer = <span class="keyword">null</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (mTask != <span class="keyword">null</span>) &#123;</div><div class="line">                    mTask.cancel();</div><div class="line">                    mTask = <span class="keyword">null</span>;</div><div class="line">                    performSelect();</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// è¿™é‡ŒmMoveLen / Math.abs(mMoveLen)æ˜¯ä¸ºäº†ä¿æœ‰mMoveLençš„æ­£è´Ÿå·ï¼Œä»¥å®ç°ä¸Šæ»šæˆ–ä¸‹æ»š</span></div><div class="line">                mMoveLen = mMoveLen - mMoveLen / Math.abs(mMoveLen) * SPEED;</div><div class="line">            &#125;</div><div class="line">            invalidate();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WheelView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WheelView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnSelectListener</span><span class="params">(SelectListener listener)</span> </span>&#123;</div><div class="line">        mSelectListener = listener;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWheelStyle</span><span class="params">(<span class="keyword">int</span> style)</span> </span>&#123;</div><div class="line">        itemList = WheelStyle.getItemList(context, style);</div><div class="line">        <span class="keyword">if</span> (itemList != <span class="keyword">null</span>) &#123;</div><div class="line">            itemCount = itemList.size();</div><div class="line">            resetCurrentSelect();</div><div class="line">            invalidate();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Log.i(TAG, <span class="string">"item is null"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWheelItemList</span><span class="params">(List&lt;String&gt; itemList)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.itemList = itemList;</div><div class="line">        <span class="keyword">if</span> (itemList != <span class="keyword">null</span>) &#123;</div><div class="line">            itemCount = itemList.size();</div><div class="line">            resetCurrentSelect();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Log.i(TAG, <span class="string">"item is null"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resetCurrentSelect</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (currentItem &lt; <span class="number">0</span>) &#123;</div><div class="line">            currentItem = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> (currentItem &gt;= itemCount) &#123;</div><div class="line">            currentItem--;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (currentItem &gt;= <span class="number">0</span> &amp;&amp; currentItem &lt; itemCount) &#123;</div><div class="line">            invalidate();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Log.i(TAG, <span class="string">"current item is invalid"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> itemCount;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * é€‰æ‹©é€‰ä¸­çš„itemçš„index</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentItem</span><span class="params">(String selected)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;itemList.size();i++)&#123;</div><div class="line">            String item=itemList.get(i);</div><div class="line">            <span class="keyword">if</span>(item.equals(selected))&#123;</div><div class="line">                currentItem = i;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        resetCurrentSelect();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCurrentItem</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> currentItem;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> mViewHeight = getMeasuredHeight();</div><div class="line">        <span class="keyword">int</span> mViewWidth = getMeasuredWidth();</div><div class="line">        centerX = (<span class="keyword">float</span>) (mViewWidth / <span class="number">2.0</span>);</div><div class="line">        centerY = (<span class="keyword">float</span>) (mViewHeight / <span class="number">2.0</span>);</div><div class="line"></div><div class="line">        isInit = <span class="keyword">true</span>;</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.context = context;</div><div class="line"></div><div class="line">        timer = <span class="keyword">new</span> Timer();</div><div class="line">        itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">        mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mPaint.setStyle(Style.FILL);</div><div class="line">        mPaint.setTextAlign(Align.CENTER);</div><div class="line">        mPaint.setColor(getResources().getColor(R.color.wheel_unselect_text));</div><div class="line">        mPaint.setTextSize(SizeConvertUtil.spTopx(context, <span class="number">15</span>));</div><div class="line"></div><div class="line">        selectPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        selectPaint.setStyle(Style.FILL);</div><div class="line">        selectPaint.setTextAlign(Align.CENTER);</div><div class="line">        selectPaint.setColor(getResources().getColor(R.color.wheel_select));</div><div class="line">        selectPaint.setTextSize(SizeConvertUtil.spTopx(context, <span class="number">17</span>));</div><div class="line"></div><div class="line">        centerLinePaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        centerLinePaint.setStyle(Style.FILL);</div><div class="line">        centerLinePaint.setTextAlign(Align.CENTER);</div><div class="line">        centerLinePaint.setColor(getResources().getColor(R.color.wheel_unselect_text));</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        <span class="keyword">if</span> (isInit) &#123;</div><div class="line">            drawData(canvas);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawData</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="comment">// å…ˆç»˜åˆ¶é€‰ä¸­çš„textå†å¾€ä¸Šå¾€ä¸‹ç»˜åˆ¶å…¶ä½™çš„text</span></div><div class="line">        <span class="keyword">if</span> (!itemList.isEmpty()) &#123;</div><div class="line">            <span class="comment">// ç»˜åˆ¶ä¸­é—´data</span></div><div class="line">            drawCenterText(canvas);</div><div class="line">            <span class="comment">// ç»˜åˆ¶ä¸Šæ–¹data</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SHOW_SIZE + <span class="number">1</span>; i++) &#123;</div><div class="line">                drawOtherText(canvas, i, -<span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// ç»˜åˆ¶ä¸‹æ–¹data</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SHOW_SIZE + <span class="number">1</span>; i++) &#123;</div><div class="line">                drawOtherText(canvas, i, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawCenterText</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="comment">// textå±…ä¸­ç»˜åˆ¶ï¼Œæ³¨æ„baselineçš„è®¡ç®—æ‰èƒ½è¾¾åˆ°å±…ä¸­ï¼Œyå€¼æ˜¯textä¸­å¿ƒåæ ‡</span></div><div class="line">        <span class="keyword">float</span> y = centerY + mMoveLen;</div><div class="line">        FontMetricsInt fmi = selectPaint.getFontMetricsInt();</div><div class="line">        <span class="keyword">float</span> baseline = (<span class="keyword">float</span>) (y - (fmi.bottom / <span class="number">2.0</span> + fmi.top / <span class="number">2.0</span>));</div><div class="line">        canvas.drawText(itemList.get(currentItem), centerX, baseline, selectPaint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@param</span> canvas   ç”»å¸ƒ</div><div class="line">     * <span class="doctag">@param</span> position è·ç¦»mCurrentSelectedçš„å·®å€¼</div><div class="line">     * <span class="doctag">@param</span> type     1è¡¨ç¤ºå‘ä¸‹ç»˜åˆ¶ï¼Œ-1è¡¨ç¤ºå‘ä¸Šç»˜åˆ¶</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawOtherText</span><span class="params">(Canvas canvas, <span class="keyword">int</span> position, <span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> index = currentItem + type * position;</div><div class="line">        <span class="keyword">if</span> (index &gt;= itemCount) &#123;</div><div class="line">            index = index - itemCount;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</div><div class="line">            index = index + itemCount;</div><div class="line">        &#125;</div><div class="line">        String text = itemList.get(index);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> itemHeight = getHeight() / (SHOW_SIZE * <span class="number">2</span> + <span class="number">1</span>);</div><div class="line">        <span class="keyword">float</span> d = itemHeight * position + type * mMoveLen;</div><div class="line">        <span class="keyword">float</span> y = centerY + type * d;</div><div class="line"></div><div class="line">        FontMetricsInt fmi = mPaint.getFontMetricsInt();</div><div class="line">        <span class="keyword">float</span> baseline = (<span class="keyword">float</span>) (y - (fmi.bottom / <span class="number">2.0</span> + fmi.top / <span class="number">2.0</span>));</div><div class="line">        canvas.drawText(text, centerX, baseline, mPaint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlpha</span><span class="params">(<span class="keyword">int</span> alpha)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColorFilter</span><span class="params">(ColorFilter cf)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOpacity</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">super</span>.setBackground(background);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.getActionMasked()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                doDown(event);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                doMove(event);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                doUp();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doDown</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mTask != <span class="keyword">null</span>) &#123;</div><div class="line">            mTask.cancel();</div><div class="line">            mTask = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        mLastDownY = event.getY();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doMove</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line"></div><div class="line">        mMoveLen += (event.getY() - mLastDownY);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mMoveLen &gt; itemHeight / <span class="number">2</span>) &#123;</div><div class="line">            <span class="comment">// å¾€ä¸‹æ»‘è¶…è¿‡ç¦»å¼€è·ç¦»</span></div><div class="line">            mMoveLen = mMoveLen - itemHeight;</div><div class="line">            currentItem--;</div><div class="line">            <span class="keyword">if</span> (currentItem &lt; <span class="number">0</span>) &#123;</div><div class="line">                currentItem = itemCount - <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mMoveLen &lt; -itemHeight / <span class="number">2</span>) &#123;</div><div class="line">            <span class="comment">// å¾€ä¸Šæ»‘è¶…è¿‡ç¦»å¼€è·ç¦»</span></div><div class="line">            mMoveLen = mMoveLen + itemHeight;</div><div class="line">            currentItem++;</div><div class="line">            <span class="keyword">if</span> (currentItem &gt;= itemCount) &#123;</div><div class="line">                currentItem = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mLastDownY = event.getY();</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doUp</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// æŠ¬èµ·æ‰‹åmCurrentSelectedçš„ä½ç½®ç”±å½“å‰ä½ç½®moveåˆ°ä¸­é—´é€‰ä¸­ä½ç½®</span></div><div class="line">        <span class="keyword">if</span> (Math.abs(mMoveLen) &lt; <span class="number">0.0001</span>) &#123;</div><div class="line">            mMoveLen = <span class="number">0</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (mTask != <span class="keyword">null</span>) &#123;</div><div class="line">            mTask.cancel();</div><div class="line">            mTask = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == timer) &#123;</div><div class="line">            timer = <span class="keyword">new</span> Timer();</div><div class="line">        &#125;</div><div class="line">        mTask = <span class="keyword">new</span> MyTimerTask(updateHandler);</div><div class="line">        timer.schedule(mTask, <span class="number">0</span>, <span class="number">10</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyTimerTask</span> <span class="keyword">extends</span> <span class="title">TimerTask</span> </span>&#123;</div><div class="line">        Handler handler;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyTimerTask</span><span class="params">(Handler handler)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.handler = handler;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            handler.sendMessage(handler.obtainMessage());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">performSelect</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mSelectListener != <span class="keyword">null</span>) &#123;</div><div class="line">            mSelectListener.onSelect(currentItem, itemList.get(currentItem));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Log.i(TAG, <span class="string">"null listener"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SelectListener</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onSelect</span><span class="params">(<span class="keyword">int</span> index, String text)</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆæ—¥æœŸæ•°æ®æº"><a href="#ç”Ÿæˆæ—¥æœŸæ•°æ®æº" class="headerlink" title="ç”Ÿæˆæ—¥æœŸæ•°æ®æº"></a>ç”Ÿæˆæ—¥æœŸæ•°æ®æº</h3><p>å°è£…ä¸€ä¸ªå·¥å…·ç±»ç”¨äºç”Ÿæˆæ—¥æœŸæ»šè½®é€‰æ‹©å™¨çš„æ•°æ®æº<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WheelStyle</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> minYear = <span class="number">1980</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> maxYear = <span class="number">2020</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Wheel Style Hour</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_HOUR = <span class="number">1</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Wheel Style Minute</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_MINUTE = <span class="number">2</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Wheel Style Year</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_YEAR = <span class="number">3</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Wheel Style Month</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_MONTH = <span class="number">4</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Wheel Style Day</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_DAY = <span class="number">5</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Wheel Style Light Time</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STYLE_LIGHT_TIME = <span class="number">7</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">WheelStyle</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getItemList</span><span class="params">(Context context, <span class="keyword">int</span> Style)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (Style == STYLE_HOUR) &#123;</div><div class="line">            <span class="keyword">return</span> createHourString();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_MINUTE) &#123;</div><div class="line">            <span class="keyword">return</span> createMinuteString();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_YEAR) &#123;</div><div class="line">            <span class="keyword">return</span> createYearString();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_MONTH) &#123;</div><div class="line">            <span class="keyword">return</span> createMonthString();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_DAY) &#123;</div><div class="line">            <span class="keyword">return</span> createDayString();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Style == STYLE_LIGHT_TIME) &#123;</div><div class="line">            <span class="keyword">return</span> createWeekString(context);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"style is illegal"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createHourString</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</div><div class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wheelString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createMinuteString</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">60</span>; i++) &#123;</div><div class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wheelString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createYearString</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = minYear; i &lt;= maxYear; i++) &#123;</div><div class="line">            wheelString.add(Integer.toString(i)+<span class="string">'å¹´'</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wheelString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createMonthString</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; i++) &#123;</div><div class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i)+<span class="string">'æœˆ'</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wheelString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createDayString</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">31</span>; i++) &#123;</div><div class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wheelString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createWeekString</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        String[] timeString = context.getResources().getStringArray(R.array.weeks);</div><div class="line">        <span class="keyword">for</span> (String week : timeString) &#123;</div><div class="line">            wheelString.add(week);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wheelString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">createDayString</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month)</span> </span>&#123;</div><div class="line">        List&lt;String&gt; wheelString = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">int</span> size;</div><div class="line">        <span class="keyword">if</span> (isLeapMonth(month)) &#123;</div><div class="line">            size = <span class="number">31</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (month == <span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (isLeapYear(year)) &#123;</div><div class="line">                size = <span class="number">29</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                size = <span class="number">28</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            size = <span class="number">30</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= size; i++) &#123;</div><div class="line">            wheelString.add(String.format(<span class="string">"%02d"</span>, i));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wheelString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è®¡ç®—é—°æœˆ</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> month</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isLeapMonth</span><span class="params">(<span class="keyword">int</span> month)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> month == <span class="number">1</span> || month == <span class="number">3</span> || month == <span class="number">5</span> || month == <span class="number">7</span></div><div class="line">                || month == <span class="number">8</span> || month == <span class="number">10</span> || month == <span class="number">12</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è®¡ç®—é—°å¹´</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> year</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isLeapYear</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (year % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; year % <span class="number">100</span> != <span class="number">0</span>) || year % <span class="number">400</span> == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="è‡ªå®šä¹‰LinearLayoutç»˜åˆ¶æ•´ä¸ªæ»šè½®è§†å›¾"><a href="#è‡ªå®šä¹‰LinearLayoutç»˜åˆ¶æ•´ä¸ªæ»šè½®è§†å›¾" class="headerlink" title="è‡ªå®šä¹‰LinearLayoutç»˜åˆ¶æ•´ä¸ªæ»šè½®è§†å›¾"></a>è‡ªå®šä¹‰LinearLayoutç»˜åˆ¶æ•´ä¸ªæ»šè½®è§†å›¾</h3><p>ç”±2ä¸ªæ»šè½®ç»„æˆçš„æ»šè½®è§†å›¾<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PickDateView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"PickDateViewåŸç”ŸTag"</span>;</div><div class="line">    CallBack callBack;</div><div class="line">    WheelView yearWheel;</div><div class="line">    WheelView monthWheel;</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CallBack</span></span>&#123;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">changeYear</span><span class="params">(<span class="keyword">int</span> year)</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">changeMonth</span><span class="params">(<span class="keyword">int</span> month)</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onSure</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">long</span> time)</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallBack</span><span class="params">(CallBack callBack)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.callBack = callBack;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PickDateView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">       addCustomLayout(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setYear</span><span class="params">(String year)</span></span>&#123;</div><div class="line">        yearWheel.setCurrentItem(year);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMonth</span><span class="params">(String month)</span></span>&#123;</div><div class="line">        monthWheel.setCurrentItem(month);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addCustomLayout</span><span class="params">(Context context)</span></span>&#123;</div><div class="line">        LayoutInflater mInflater = LayoutInflater.from(context);</div><div class="line">        View contentView = mInflater.inflate(R.layout.wheel_select_date, <span class="keyword">null</span>);</div><div class="line">        yearWheel = (WheelView) contentView.findViewById(R.id.select_date_wheel_year_wheel);</div><div class="line">        monthWheel = (WheelView) contentView.findViewById(R.id.select_date_month_wheel);</div><div class="line"></div><div class="line">        yearWheel.setWheelStyle(WheelStyle.STYLE_YEAR);</div><div class="line">        yearWheel.setOnSelectListener(<span class="keyword">new</span> WheelView.SelectListener() &#123;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSelect</span><span class="params">(<span class="keyword">int</span> index, String text)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> selectYear = index + WheelStyle.minYear;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (callBack != <span class="keyword">null</span>) &#123;</div><div class="line">                    callBack.changeYear(selectYear);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        monthWheel.setWheelStyle(WheelStyle.STYLE_MONTH);</div><div class="line">        monthWheel.setOnSelectListener(<span class="keyword">new</span> WheelView.SelectListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSelect</span><span class="params">(<span class="keyword">int</span> index, String text)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> selectMonth = index + <span class="number">1</span>;</div><div class="line">                <span class="keyword">if</span> (callBack != <span class="keyword">null</span>) &#123;</div><div class="line">                    callBack.changeMonth(selectMonth);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line"></div><div class="line">        Button sureBt = (Button) contentView.findViewById(R.id.select_date_sure);</div><div class="line">        sureBt.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> year = yearWheel.getCurrentItem() + WheelStyle.minYear;</div><div class="line">                <span class="keyword">int</span> month = monthWheel.getCurrentItem();</div><div class="line"></div><div class="line">                Calendar calendar = Calendar.getInstance();</div><div class="line">                calendar.set(Calendar.YEAR, year);</div><div class="line">                calendar.set(Calendar.MONTH, month);</div><div class="line"></div><div class="line">                <span class="keyword">long</span> setTime = calendar.getTimeInMillis();</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (callBack != <span class="keyword">null</span>) &#123;</div><div class="line">                    callBack.onSure(year, month, setTime);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        addView(contentView);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ç»™react-nativeæš´éœ²æ¥å£"><a href="#ç»™react-nativeæš´éœ²æ¥å£" class="headerlink" title="ç»™react-nativeæš´éœ²æ¥å£"></a>ç»™react-nativeæš´éœ²æ¥å£</h3><p>è‡ªå®šä¹‰ViewManagerï¼Œç»§æ‰¿SimpleViewManagerè®¾ç½®éœ€è¦æš´éœ²çš„uiç»„ä»¶ç±»PickDateViewï¼Œé‡å†™å®ä¾‹åŒ–æ–¹æ³•createViewInstanceåœ¨æ–¹æ³•å†…å®ä¾‹åŒ–uiç»„ä»¶ç±»ï¼ŒåŒæ—¶åœ¨å›è°ƒè¢«è°ƒç”¨æ—¶é€šçŸ¥jsç«¯ï¼Œå‘é€äº‹ä»¶æ¶ˆæ¯ï¼Œä¹Ÿæ˜¯é€šè¿‡WritableMapä¼ é€’å‚æ•°åˆ—è¡¨ï¼Œç”¨<code>@ReactProp</code>æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•åœ¨react-nativeä¸­ä½œä¸ºå±æ€§ä¼ å…¥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PickDateViewManager</span> <span class="keyword">extends</span> <span class="title">SimpleViewManager</span>&lt;<span class="title">PickDateView</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REACT_CLASS = <span class="string">"PickDateView"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"PickDateViewMangeråŸç”ŸTag"</span>;</div><div class="line">    <span class="keyword">private</span> PickDateView pickDateView;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> REACT_CLASS;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> PickDateView <span class="title">createViewInstance</span><span class="params">(<span class="keyword">final</span> ThemedReactContext reactContext)</span> </span>&#123;</div><div class="line">        pickDateView=<span class="keyword">new</span> PickDateView(reactContext);</div><div class="line">        pickDateView.setCallBack(<span class="keyword">new</span> PickDateView.CallBack() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeYear</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</div><div class="line">                WritableMap map = Arguments.createMap();</div><div class="line">                map.putInt(<span class="string">"target"</span>, pickDateView.getId());</div><div class="line">                map.putString(<span class="string">"msg"</span>, <span class="string">"year: "</span> + year);</div><div class="line">                reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(</div><div class="line">                        pickDateView.getId(), <span class="string">"topChange"</span>, map</div><div class="line">                );</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeMonth</span><span class="params">(<span class="keyword">int</span> month)</span> </span>&#123;</div><div class="line">                WritableMap map = Arguments.createMap();</div><div class="line">                map.putInt(<span class="string">"target"</span>, pickDateView.getId());</div><div class="line">                map.putString(<span class="string">"msg"</span>, <span class="string">"month: "</span> + month);</div><div class="line">                reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(</div><div class="line">                        pickDateView.getId(), <span class="string">"topChange"</span>, map</div><div class="line">                );</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSure</span><span class="params">(<span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">long</span> time)</span> </span>&#123;</div><div class="line">                WritableMap map = Arguments.createMap();</div><div class="line">                map.putInt(<span class="string">"target"</span>, pickDateView.getId());</div><div class="line"></div><div class="line">                WritableMap params=Arguments.createMap();</div><div class="line">                params.putInt(<span class="string">"year"</span>,year);</div><div class="line">                params.putInt(<span class="string">"month"</span>,month);</div><div class="line">                params.putString(<span class="string">"time"</span>,time+<span class="string">""</span>);</div><div class="line"></div><div class="line"><span class="comment">//                String paramsStr=jsonEnclose(params).toString();</span></div><div class="line">                map.putMap(<span class="string">"msg"</span>, params);</div><div class="line">                reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(</div><div class="line">                        pickDateView.getId(), <span class="string">"topChange"</span>, map</div><div class="line">                );</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> pickDateView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ReactProp</span>(name = <span class="string">"setYear"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setYear</span><span class="params">(PickDateView pickDateView,String year)</span> </span>&#123;</div><div class="line">        pickDateView.setYear(year);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@ReactProp</span>(name = <span class="string">"setMonth"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMonth</span><span class="params">(PickDateView pickDateView,String month)</span> </span>&#123;</div><div class="line">        pickDateView.setMonth(month);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="æ³¨å†Œè‡ªå®šä¹‰çš„ViewManager"><a href="#æ³¨å†Œè‡ªå®šä¹‰çš„ViewManager" class="headerlink" title="æ³¨å†Œè‡ªå®šä¹‰çš„ViewManager"></a>æ³¨å†Œè‡ªå®šä¹‰çš„ViewManager</h3><p>åŒæ ·éœ€è¦åœ¨è‡ªå®šä¹‰çš„ç»„ä»¶åŒ…MyReactPackageçš„createViewManagersæ–¹æ³•ä¸­æ³¨å†Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReactPackage</span> <span class="keyword">implements</span> <span class="title">ReactPackage</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å¼•å…¥åŸç”Ÿçš„view</div><div class="line">     * <span class="doctag">@param</span> reactContext</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;ViewManager&gt; <span class="title">createViewManagers</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">        List&lt;ViewManager&gt; viewManagers=<span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        viewManagers.add(<span class="keyword">new</span> PickDateViewManager());</div><div class="line">        viewManagers.add(<span class="keyword">new</span> ShowPlayViewManager());</div><div class="line">        <span class="keyword">return</span> viewManagers;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="åœ¨react-nativeä¸­ä½¿ç”¨-1"><a href="#åœ¨react-nativeä¸­ä½¿ç”¨-1" class="headerlink" title="åœ¨react-nativeä¸­ä½¿ç”¨"></a>åœ¨react-nativeä¸­ä½¿ç”¨</h3><h4 id="åœ¨react-nativeä¸­å£°æ˜åŸç”Ÿç»„ä»¶"><a href="#åœ¨react-nativeä¸­å£°æ˜åŸç”Ÿç»„ä»¶" class="headerlink" title="åœ¨react-nativeä¸­å£°æ˜åŸç”Ÿç»„ä»¶"></a>åœ¨react-nativeä¸­å£°æ˜åŸç”Ÿç»„ä»¶</h4><p>å®šä¹‰åŸç”Ÿä¸­ä¹Ÿå£°æ˜äº†çš„ç»„ä»¶å±æ€§å’Œç»Ÿä¸€æ¥æ”¶å›è°ƒæ¶ˆæ¯çš„onChangeæ–¹æ³•<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</div><div class="line"><span class="keyword">import</span> &#123;requireNativeComponent, View&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">let</span> iface = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'PickDateView'</span>,</div><div class="line">    <span class="attr">propTypes</span>: &#123;</div><div class="line">        <span class="attr">setYear</span>: PropTypes.string,</div><div class="line">        <span class="attr">setMonth</span>: PropTypes.string,</div><div class="line">        <span class="comment">//å›è°ƒ</span></div><div class="line">        onChange: PropTypes.func,</div><div class="line">        ...View.propTypes  <span class="comment">//æ”¯æŒViewç»„ä»¶çš„æ‰€æœ‰å±æ€§</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> RCTPickDateView = requireNativeComponent(<span class="string">'PickDateView'</span>, iface);</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> RCTPickDateView;</div></pre></td></tr></table></figure></p>
<h4 id="åœ¨react-nativeä¸­ä½¿ç”¨åŸç”Ÿç»„ä»¶"><a href="#åœ¨react-nativeä¸­ä½¿ç”¨åŸç”Ÿç»„ä»¶" class="headerlink" title="åœ¨react-nativeä¸­ä½¿ç”¨åŸç”Ÿç»„ä»¶"></a>åœ¨react-nativeä¸­ä½¿ç”¨åŸç”Ÿç»„ä»¶</h4><p>ç»˜åˆ¶ä¸€ä¸ªå¼¹çª—ï¼Œå¼¹çª—å†…éƒ¨ä½¿ç”¨åŸç”Ÿçš„æ—¥æœŸæ»šè½®é€‰æ‹©å™¨ï¼Œåœ¨å¼¹çª—å¼¹å‡ºæ—¶åŠ å…¥ä¸€ä¸ªå±•å¼€åŠ¨ç”»ï¼Œåœ¨onChangeæ–¹æ³•ä¸­æ¥æ”¶å‚æ•°obj.nativeEvent.å‚æ•°å<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    AppRegistry,</div><div class="line">    StyleSheet,</div><div class="line">    Text,</div><div class="line">    View,</div><div class="line">    Modal,</div><div class="line">    Animated,</div><div class="line">    TouchableOpacity</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div><div class="line"><span class="keyword">import</span> PickDateView <span class="keyword">from</span> <span class="string">'../view/PickDate'</span>;</div><div class="line"><span class="keyword">import</span> constants <span class="keyword">from</span> <span class="string">'../Constants'</span>;</div><div class="line"><span class="keyword">let</span> &#123;width, height&#125; = constants.ScreenWH;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PullPickDate</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(props)&#123;</div><div class="line">        <span class="keyword">super</span>(props);</div><div class="line">        <span class="keyword">this</span>.onLayout=<span class="keyword">this</span>.onLayout.bind(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.state=&#123;</div><div class="line">            <span class="attr">expanded</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">animation</span> : <span class="keyword">new</span> Animated.Value()</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">    showAnimation(height)&#123;</div><div class="line">        <span class="keyword">let</span> maxHeight=height;</div><div class="line">        <span class="keyword">let</span> minHeight=<span class="number">0</span>;</div><div class="line">        <span class="keyword">let</span> initialValue = <span class="keyword">this</span>.state.expanded ? maxHeight + minHeight : minHeight,</div><div class="line">            finalValue= <span class="keyword">this</span>.state.expanded ? minHeight : maxHeight + minHeight;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">expanded</span>: !<span class="keyword">this</span>.state.expanded <span class="comment">//Step 2</span></div><div class="line">        &#125;);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'æœ€å¤§é«˜åº¦'</span>+maxHeight);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'åˆå§‹å€¼'</span>+initialValue+<span class="string">'æœ€ç»ˆå€¼'</span>+finalValue);</div><div class="line">        <span class="keyword">this</span>.state.animation.setValue(initialValue); <span class="comment">//Step 3</span></div><div class="line"></div><div class="line">        <span class="keyword">this</span>.timer = setTimeout(</div><div class="line">            <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">                <span class="keyword">this</span>.toggle(finalValue);</div><div class="line">            &#125;,</div><div class="line">            <span class="number">5000</span></div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    toggle(finalValue) &#123;</div><div class="line">        Animated.spring(</div><div class="line">            <span class="keyword">this</span>.state.animation,</div><div class="line">            &#123;</div><div class="line">                <span class="attr">toValue</span>: finalValue</div><div class="line">            &#125;</div><div class="line">        ).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;Modal</div><div class="line">                animationType=&#123;'none'&#125;</div><div class="line">                transparent=&#123;true&#125;</div><div class="line">                visible=&#123;this.props.onShow&#125;</div><div class="line">                onRequestClose=&#123;() =&gt; &#123;</div><div class="line">                    this.props.onCancel();</div><div class="line">                &#125;&#125;&gt;</div><div class="line"></div><div class="line">                &lt;View style=&#123;&#123;width: width, flex: 1, marginTop: height * 0.08 + 0.12 * width,backgroundColor: 'rgba(0, 0, 0, 0.7)'&#125;&#125;&gt;</div><div class="line">                    &lt;PickDateView</div><div class="line">                        setYear=&#123;this.props.year&#125;</div><div class="line">                        setMonth=&#123;this.props.month&#125;</div><div class="line">                        onLayout=&#123;this.onLayout&#125;</div><div class="line">                        onChange=&#123;(obj) =&gt; &#123;</div><div class="line">                            console.log('onSureæ”¶åˆ°äº‹ä»¶' + obj.nativeEvent.msg + "ç›®æ ‡id" + obj.nativeEvent.msg.year);</div><div class="line">                            //å½“æ­¤å›è°ƒè¢«onSureè°ƒç”¨æ—¶</div><div class="line">                            let year = obj.nativeEvent.msg.year + '';</div><div class="line">                            let month = obj.nativeEvent.msg.month + '';</div><div class="line">                            let time= obj.nativeEvent.msg.time + '';</div><div class="line">                            if (year !== 'undefined' &amp;&amp; month !== 'undefined') &#123;</div><div class="line">                                this.props.onCancel();</div><div class="line">                            &#125;else&#123;</div><div class="line">                                this.props.onSure(year,month,time);</div><div class="line">                            &#125;</div><div class="line"></div><div class="line">                        &#125;&#125;</div><div class="line">                        style=&#123;&#123;width: '100%', flex: 0.42,&#125;&#125;/&gt;</div><div class="line">                    &lt;TouchableOpacity style=&#123;&#123;flex:0.58&#125;&#125; onPress=&#123;() =&gt; this.props.onCancel()&#125;/&gt;</div><div class="line">                &lt;/View&gt;</div><div class="line">            &lt;/Modal&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    onLayout(event)&#123;</div><div class="line">        this.showAnimation(event.nativeEvent.layout.height);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default PullPickDate;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/09/RN-NumberScroll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/09/RN-NumberScroll/" itemprop="url">react-native å®ç°æ•°å­—æ»šåŠ¨åŠ¨ç”»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-09T11:11:26+08:00">
                2018-07-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/09/RN-NumberScroll/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/07/09/RN-NumberScroll/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/09/RN-NumberScroll/" class="leancloud_visitors" data-flag-title="react-native å®ç°æ•°å­—æ»šåŠ¨åŠ¨ç”»">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>è‡ªä»åœ¨githubä¸Šå¼€æºäº†é«˜ä»¿éŸ©å¯’çš„oneä¸€ä¸ªé¡¹ç›®ä¹‹åï¼Œç©ºé—²æ—¶é—´ä»æ—§ä¿æŒé¡¹ç›®çš„æ›´æ–°å’Œç»´æŠ¤ï¼Œç›®å‰å…¬å¸æ²¡æœ‰react-nativeçš„é¡¹ç›®ï¼Œä½†æˆ‘ä¸€ç›´å¯¹react-nativeå¾ˆæœ‰å…´è¶£ï¼Œæ‰€ä»¥æ‰“ç®—ä¸€ç›´ç»´æŠ¤ä¸‹å»å¹¶å€Ÿæ­¤æœºä¼šå­¦ä¹ ç›¸å…³çš„æŠ€æœ¯ã€‚oneä¸€ä¸ªæ˜¯èµ„è®¯ç±»çš„appï¼Œä¸»ç•Œé¢æ˜¯ç”±3ä¸ªåˆ†é¡µç»„æˆçš„ï¼Œåº•éƒ¨æœ‰å¯¼èˆªæ ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§ä¼—åŒ–çš„å±•ç¤ºæ–¹å¼ï¼Œå…¶ä¸­oneåˆ†é¡µæ˜¯ç”¨æ—¥æœŸä½œä¸ºé¡¶éƒ¨æ ‡é¢˜ï¼Œæ‰‹æŒ‡æ¯å‘å·¦æ»‘åŠ¨ä¸€æ¬¡å°±å¾€å‰ç¿»é¡µï¼Œå‘å³æ»‘åŠ¨ä¸€æ¬¡å°±å¾€åç¿»é¡µï¼Œæ¯å¤©çš„å±•ç¤ºå†…å®¹å°±æ˜¯ä¸€é¡µåˆ—è¡¨ï¼Œæ ‡é¢˜å°±ä¼šéšç€æ‰‹æŒ‡çš„ç¿»é¡µè€Œåˆ·æ–°ï¼Œæ˜¾ç¤ºå½“å‰å±•ç¤ºå†…å®¹çš„å‘å¸ƒæ—¥æœŸï¼Œè¿™é‡Œçš„æ—¥æœŸåˆ·æ–°å°±æ˜¯ä¸€ä¸ªæ•°å­—æ»šåŠ¨çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<hr>
<p>å…ˆä¸Šæ•ˆæœå›¾ï¼š</p>
<p><img src="/images/react-native-number-scroll.gif" alt="æ•ˆæœå›¾"></p>
<h1 id="ç»˜åˆ¶æ€è·¯å¦‚ä¸‹ï¼š"><a href="#ç»˜åˆ¶æ€è·¯å¦‚ä¸‹ï¼š" class="headerlink" title="ç»˜åˆ¶æ€è·¯å¦‚ä¸‹ï¼š"></a>ç»˜åˆ¶æ€è·¯å¦‚ä¸‹ï¼š</h1><ol>
<li>è®¾ç½®è¡¨ç¤ºæ•°å­—èŒƒå›´çš„æ•°å­—æ•°ç»„</li>
<li>æµ‹é‡æ•°å­—çš„ç»˜åˆ¶é«˜åº¦ </li>
<li>å¯¹å½“å‰æ–‡æœ¬åšåˆ‡å‰²ï¼Œéå†æ¯ä¸ªå­—ç¬¦ï¼Œåˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯å¦æ˜¯æ•°å­—ï¼Œå¦‚æœæ˜¯æ•°å­—ï¼Œæ ¹æ®ç›®æ ‡æ•°å­—åœ¨æ•°å­—æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œå’Œå½“å‰æ•°å­—åœ¨æ•°å­—æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œä»¥åŠæ•°å­—ç»˜åˆ¶çš„é«˜åº¦ï¼Œè®¡ç®—å‡ºå‚ç›´æ–¹å‘yä¸Šéœ€è¦å¹³ç§»çš„è·ç¦»ï¼Œæ‰§è¡Œå¹³ç§»åŠ¨ç”»ã€‚å¦‚æœä¸æ˜¯æ•°å­—ï¼Œç›´æ¥ç»˜åˆ¶è¿™ä¸ªå­—ç¬¦æ–‡æœ¬</li>
<li>æ–‡æœ¬ç”±çˆ¶ç»„ä»¶é€šè¿‡propsä¼ é€’ï¼Œæ³¨æ„propså€¼å˜åŒ–æ—¶é‡ç½®åŠ¨ç”»å±æ€§å€¼ï¼Œåˆ·æ–°æ–‡æœ¬å†…å®¹<h1 id="å®šä¹‰æ•°å­—å¸ƒå±€æ ·å¼"><a href="#å®šä¹‰æ•°å­—å¸ƒå±€æ ·å¼" class="headerlink" title="å®šä¹‰æ•°å­—å¸ƒå±€æ ·å¼"></a>å®šä¹‰æ•°å­—å¸ƒå±€æ ·å¼</h1>æ•°å­—æ°´å¹³æ’åˆ—ï¼Œéœ€è¦å…ˆæ”¾ç½®ä¸€ä¸ªéšè—çš„textæµ‹é‡æ•°å­—çš„é«˜åº¦<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</div><div class="line">    <span class="comment">// æ•°å­—æ°´å¹³æµ®åŠ¨æ’åˆ—</span></div><div class="line">    row: &#123;</div><div class="line">        <span class="attr">flexDirection</span>: <span class="string">'row'</span>,</div><div class="line">        <span class="attr">overflow</span>: <span class="string">'hidden'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// éšè—</span></div><div class="line">    hide: &#123;</div><div class="line">        <span class="attr">position</span>: <span class="string">'absolute'</span>,</div><div class="line">        <span class="attr">left</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">right</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">opacity</span>: <span class="number">0</span>,</div><div class="line">    &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="çˆ¶ç»„ä»¶éœ€è¦ä¼ å…¥çš„å‚æ•°"><a href="#çˆ¶ç»„ä»¶éœ€è¦ä¼ å…¥çš„å‚æ•°" class="headerlink" title="çˆ¶ç»„ä»¶éœ€è¦ä¼ å…¥çš„å‚æ•°"></a>çˆ¶ç»„ä»¶éœ€è¦ä¼ å…¥çš„å‚æ•°</h1><p>æ–‡æœ¬å†…å®¹,æ ·å¼,æ»šåŠ¨æ—¶é•¿<br>å…¶ä¸­æ–‡æœ¬å†…å®¹å¯ä»¥æœ‰ä¸¤ç§ä¼ é€’æ–¹å¼ï¼š</p>
<ol>
<li>é€šè¿‡props.textè¿›è¡Œä¼ é€’</li>
<li>é€šè¿‡å­ç»„ä»¶è®¾ç½®æˆæ–‡æœ¬å†…å®¹ç›´æ¥ä¼ é€’<h1 id="è®¾ç½®æ•°å­—èŒƒå›´"><a href="#è®¾ç½®æ•°å­—èŒƒå›´" class="headerlink" title="è®¾ç½®æ•°å­—èŒƒå›´"></a>è®¾ç½®æ•°å­—èŒƒå›´</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æŒ‡å®šèŒƒå›´åˆ›å»ºæ•°ç»„</span></div><div class="line"><span class="keyword">const</span> range = <span class="function"><span class="params">length</span> =&gt;</span> <span class="built_in">Array</span>.from(&#123; length &#125;, (x, i) =&gt; i);</div><div class="line"><span class="comment">// åˆ›å»º"0","1","2","3","4"..."9"çš„æ•°ç»„,é»˜è®¤ç»˜åˆ¶æ•°æ®</span></div><div class="line"><span class="keyword">const</span> numberRange = range(<span class="number">10</span>).map(<span class="function"><span class="params">p</span> =&gt;</span> p + <span class="string">""</span>);</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="å®šä¹‰æ•°å­—æ»šåŠ¨åŠ¨ç”»ç»„ä»¶"><a href="#å®šä¹‰æ•°å­—æ»šåŠ¨åŠ¨ç”»ç»„ä»¶" class="headerlink" title="å®šä¹‰æ•°å­—æ»šåŠ¨åŠ¨ç”»ç»„ä»¶"></a>å®šä¹‰æ•°å­—æ»šåŠ¨åŠ¨ç”»ç»„ä»¶</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticker</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// å®šä¹‰å±æ€§ç±»å‹</span></div><div class="line">    <span class="keyword">static</span> propTypes = &#123;</div><div class="line">        <span class="attr">text</span>: PropTypes.string,</div><div class="line">        <span class="attr">textStyle</span>: PropTypes.oneOfType([PropTypes.number, PropTypes.object, PropTypes.array]),</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// å®šä¹‰é»˜è®¤å±æ€§å€¼</span></div><div class="line">    <span class="keyword">static</span> defaultProps = &#123;</div><div class="line">        <span class="attr">rotateTime</span>: <span class="number">250</span>, <span class="comment">// é»˜è®¤æ»šåŠ¨æ—¶é—´</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    state = &#123;</div><div class="line">        <span class="attr">measured</span>: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦å·²æµ‹é‡</span></div><div class="line">        height: <span class="number">0</span>, <span class="comment">// é«˜åº¦</span></div><div class="line">        fontSize: StyleSheet.flatten(<span class="keyword">this</span>.props.textStyle).fontSize, <span class="comment">// è·å–propsä¸­çš„å­—ä½“å¤§å°</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// propså˜åŠ¨æ—¶å›è°ƒ</span></div><div class="line">    componentWillReceiveProps(nextProps) &#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">fontSize</span>: StyleSheet.flatten(nextProps.textStyle).fontSize,</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    handleMeasure = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">measured</span>: <span class="literal">true</span>, <span class="comment">// ä¿®æ”¹flagä¸ºå·²æµ‹é‡</span></div><div class="line">            height: e.nativeEvent.layout.height, <span class="comment">//æµ‹é‡é«˜åº¦</span></div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * æ¸²æŸ“</div><div class="line">     * @returns &#123;*&#125;</div><div class="line">     */</div><div class="line">    render() &#123;</div><div class="line">        <span class="comment">// è·å–æ–‡æœ¬å†…å®¹,å­ç»„ä»¶,æ ·å¼,æ»šåŠ¨æ—¶é•¿</span></div><div class="line">        <span class="keyword">const</span> &#123; text, children, textStyle, style, rotateTime &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="comment">// è·å–é«˜åº¦, æ˜¯å¦æµ‹é‡æ ‡è®°</span></div><div class="line">        <span class="keyword">const</span> &#123; height, measured &#125; = <span class="keyword">this</span>.state;</div><div class="line">        <span class="comment">// å¦‚æœæœªæµ‹é‡åˆ™é€æ˜</span></div><div class="line">        <span class="keyword">const</span> opacity = measured ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">        <span class="comment">// æ–‡æœ¬å†…å®¹è·å–,è¯»å–textæˆ–å­ç»„ä»¶å†…å®¹,ä¸¤ç§æ–¹å¼é…ç½®æ–‡æœ¬å†…å®¹</span></div><div class="line">        <span class="keyword">const</span> childs = text || children;</div><div class="line">        <span class="comment">// å¦‚æœå­ç»„ä»¶æ˜¯å­—ç¬¦ä¸²,å­—ç¬¦ä¸²æ¸²æŸ“,å¦åˆ™å­ç»„ä»¶æ¸²æŸ“</span></div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;[styles.row,</span> &#123; <span class="attr">height</span>, <span class="attr">opacity</span> &#125;, <span class="attr">style</span>]&#125;&gt;</span></span></div><div class="line">                &#123;/*æ¸²æŸ“é€»è¾‘*/&#125;</div><div class="line">                &#123;numberRenderer(&#123;</div><div class="line">                    children: childs,</div><div class="line">                    textStyle,</div><div class="line">                    height,</div><div class="line">                    rotateTime,</div><div class="line">                    rotateItems: numberRange,</div><div class="line">                &#125;)&#125;</div><div class="line">                &#123;/*æµ‹é‡texté«˜åº¦,ä¸æ˜¾ç¤ºè¯¥ç»„ä»¶*/&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;[textStyle,</span> <span class="attr">styles.hide</span>]&#125; <span class="attr">onLayout</span>=<span class="string">&#123;this.handleMeasure&#125;</span> <span class="attr">pointerEvents</span>=<span class="string">"none"</span>&gt;</span></div><div class="line">                    0</div><div class="line">                <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨renderæ–¹æ³•ä¸­ï¼Œç»˜åˆ¶äº†ä¸€ä¸ªéšè—çš„textç»„ä»¶ï¼Œæ˜¯ä¸ºäº†æµ‹é‡åœ¨å½“å‰æ ·å¼ä¸‹ï¼Œç»˜åˆ¶å‡ºçš„æ•°å­—é«˜åº¦å€¼<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="comment">/*æµ‹é‡texté«˜åº¦,ä¸æ˜¾ç¤ºè¯¥ç»„ä»¶*/</span>&#125;</div><div class="line">               &lt;Text style=&#123;[textStyle, styles.hide]&#125; onLayout=&#123;<span class="keyword">this</span>.handleMeasure&#125; pointerEvents=<span class="string">"none"</span>&gt;</div><div class="line">                   <span class="number">0</span></div><div class="line">               &lt;<span class="regexp">/Text&gt;</span></div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­viewä¸­çš„numberRendereræ˜¯æ•°å­—æ»šåŠ¨åŠ¨ç”»çš„æ¸²æŸ“é€»è¾‘ï¼Œè¿™ä¸ªviewæ˜¯åœ¨æµ‹é‡é«˜åº¦ä¹‹åå†æ˜¾ç¤ºçš„ã€‚<br>åœ¨numberRendererè¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å½“å‰çš„æ–‡æœ¬åšåˆ‡å‰²å¾—åˆ°åŒ…å«æ–‡æœ¬ä¸­æ¯ä¸ªå­—ç¬¦çš„å­—ç¬¦æ•°ç»„ï¼Œéå†åˆ‡å‰²åçš„å­—ç¬¦æ•°ç»„ï¼Œå–å‡ºæ¯ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯æ•°å­—ï¼Œä¸æ˜¯æ•°å­—å°±ç›´æ¥ç»˜åˆ¶æ–‡æœ¬ï¼ŒPieceæ˜¯å°è£…çš„ç›´æ¥ç”¨textè¿›è¡Œæ–‡æœ¬ç»˜åˆ¶çš„ç»„ä»¶ï¼Œå¦‚æœæ˜¯æ•°å­—å°±ç»˜åˆ¶æ•°å­—åŠ¨ç”»ç»„ä»¶ï¼ŒTickæ˜¯å°è£…çš„å•ä¸ªæ•°å­—åŠ¨ç”»ç»˜åˆ¶çš„ç»„ä»¶ã€‚<br>å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> numberRenderer = <span class="function">(<span class="params">&#123; children, textStyle, height, rotateTime, rotateItems &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// åˆ‡å‰²å­ç»„ä»¶æ–‡æœ¬å†…å®¹éå†</span></div><div class="line">    <span class="keyword">return</span> splitText(children).map(<span class="function">(<span class="params">piece, i</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">if</span> (!isNumber(piece)) &#123; <span class="comment">//å–å•ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯æ•°å­—,ç›´æ¥ç»˜åˆ¶æ–‡æœ¬</span></div><div class="line">            <span class="keyword">return</span> (</div><div class="line">                <span class="xml"><span class="tag">&lt;<span class="name">Piece</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height</span> &#125;&#125; <span class="attr">textStyle</span>=<span class="string">&#123;textStyle&#125;</span>&gt;</span></span></div><div class="line">                    &#123;piece&#125;</div><div class="line">                <span class="tag">&lt;/<span class="name">Piece</span>&gt;</span></div><div class="line">            );</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// å¦‚æœæ˜¯æ•°å­—ï¼Œç»˜åˆ¶å•ä¸ªæ•°å­—</span></div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Tick</span></span></span></div><div class="line">                <span class="attr">duration</span>=<span class="string">&#123;rotateTime&#125;</span></div><div class="line">                <span class="attr">key</span>=<span class="string">&#123;i&#125;</span></div><div class="line">                <span class="attr">text</span>=<span class="string">&#123;piece&#125;</span></div><div class="line">                <span class="attr">textStyle</span>=<span class="string">&#123;textStyle&#125;</span></div><div class="line">                <span class="attr">height</span>=<span class="string">&#123;height&#125;</span></div><div class="line">                <span class="attr">rotateItems</span>=<span class="string">&#123;rotateItems&#125;</span></div><div class="line">            /&gt;</div><div class="line">        );</div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>æ–‡æœ¬åˆ‡å‰²å’Œæ•°å­—åˆ¤æ–­æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ‡å‰²</span></div><div class="line"><span class="keyword">const</span> splitText = <span class="function">(<span class="params">text = <span class="string">""</span></span>) =&gt;</span> (text + <span class="string">""</span>).split(<span class="string">""</span>);</div><div class="line"><span class="comment">// æ˜¯åè¿›åˆ¶æ•°å­—åˆ¤æ–­</span></div><div class="line"><span class="keyword">const</span> isNumber = <span class="function">(<span class="params">text = <span class="string">""</span></span>) =&gt;</span> !<span class="built_in">isNaN</span>(<span class="built_in">parseInt</span>(text, <span class="number">10</span>));</div></pre></td></tr></table></figure></p>
<p>ç›´æ¥ç”¨textè¿›è¡Œæ–‡æœ¬ç»˜åˆ¶çš„ç»„ä»¶Pieceï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> *</div><div class="line"> * @param children å­ç»„ä»¶(æ–‡æœ¬å†…å®¹)</div><div class="line"> * @param style æ ·å¼</div><div class="line"> * @param height é«˜åº¦</div><div class="line"> * @param textStyle æ–‡æœ¬æ ·å¼</div><div class="line"> * @returns æ— åŠ¨ç”»ç»˜åˆ¶æ–‡æœ¬</div><div class="line"> * @constructor</div><div class="line"> */</div><div class="line"><span class="keyword">const</span> Piece = <span class="function">(<span class="params">&#123; children, style, height, textStyle &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">        <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></div><div class="line">            <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;[textStyle,</span> &#123; <span class="attr">height</span> &#125;]&#125;&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>å•ä¸ªæ•°å­—åŠ¨ç”»ç»˜åˆ¶çš„ç»„ä»¶ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tick</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * åˆ›å»ºåŠ¨ç”»åˆå§‹å€¼</div><div class="line">     * @type &#123;&#123;animation: Animated.Value&#125;&#125;</div><div class="line">     */</div><div class="line">    state = &#123;</div><div class="line">        <span class="attr">animation</span>: <span class="keyword">new</span> Animated.Value(</div><div class="line">            getPosition(&#123;</div><div class="line">                <span class="attr">text</span>: <span class="keyword">this</span>.props.text,</div><div class="line">                <span class="attr">items</span>: <span class="keyword">this</span>.props.rotateItems,</div><div class="line">                <span class="attr">height</span>: <span class="keyword">this</span>.props.height,</div><div class="line">            &#125;),</div><div class="line">        ),</div><div class="line">    &#125;;</div><div class="line">    componentDidMount() &#123;</div><div class="line">        <span class="comment">// å¦‚æœé«˜åº¦å·²æµ‹é‡,è®¾ç½®åŠ¨ç”»åˆå§‹å€¼</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.props.height !== <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">                <span class="attr">animation</span>: <span class="keyword">new</span> Animated.Value(</div><div class="line">                    getPosition(&#123;</div><div class="line">                        <span class="attr">text</span>: <span class="keyword">this</span>.props.text,</div><div class="line">                        <span class="attr">items</span>: <span class="keyword">this</span>.props.rotateItems,</div><div class="line">                        <span class="attr">height</span>: <span class="keyword">this</span>.props.height,</div><div class="line">                    &#125;),</div><div class="line">                ),</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    componentWillReceiveProps(nextProps) &#123;</div><div class="line">        <span class="comment">// é«˜åº¦å˜åŒ–,é‡ç½®åŠ¨ç”»åˆå§‹å€¼</span></div><div class="line">        <span class="keyword">if</span> (nextProps.height !== <span class="keyword">this</span>.props.height) &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">                <span class="attr">animation</span>: <span class="keyword">new</span> Animated.Value(</div><div class="line">                    getPosition(&#123;</div><div class="line">                        <span class="attr">text</span>: nextProps.text,</div><div class="line">                        <span class="attr">items</span>: nextProps.rotateItems,</div><div class="line">                        <span class="attr">height</span>: nextProps.height,</div><div class="line">                    &#125;),</div><div class="line">                ),</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    componentDidUpdate(prevProps) &#123;</div><div class="line">        <span class="keyword">const</span> &#123; height, duration, rotateItems, text &#125; = <span class="keyword">this</span>.props;</div><div class="line">        <span class="comment">// æ•°å­—å˜åŒ–,ç”¨å½“å‰åŠ¨ç”»å€¼å’Œå˜åŒ–åçš„åŠ¨ç”»å€¼è¿›è¡Œæ’å€¼,å¹¶å¯åŠ¨åŠ¨ç”»</span></div><div class="line">        <span class="keyword">if</span> (prevProps.text !== text) &#123;</div><div class="line">            Animated.timing(<span class="keyword">this</span>.state.animation, &#123;</div><div class="line">                <span class="attr">toValue</span>: getPosition(&#123;</div><div class="line">                    <span class="attr">text</span>: text,</div><div class="line">                    <span class="attr">items</span>: rotateItems,</div><div class="line">                    height,</div><div class="line">                &#125;),</div><div class="line">                duration,</div><div class="line">                <span class="attr">useNativeDriver</span>: <span class="literal">true</span>,</div><div class="line">            &#125;).start();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">const</span> &#123; animation &#125; = <span class="keyword">this</span>.state;</div><div class="line">        <span class="keyword">const</span> &#123; textStyle, height, rotateItems &#125; = <span class="keyword">this</span>.props;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height</span> &#125;&#125;&gt;</span></span></div><div class="line">                <span class="tag">&lt;<span class="name">Animated.View</span> <span class="attr">style</span>=<span class="string">&#123;getAnimationStyle(animation)&#125;</span>&gt;</span></div><div class="line">                    &#123;/*éå†æ•°å­—èŒƒå›´æ•°ç»„ç»˜åˆ¶æ•°å­—*/&#125;</div><div class="line">                    &#123;rotateItems.map(v =&gt; (</div><div class="line">                        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">key</span>=<span class="string">&#123;v&#125;</span> <span class="attr">style</span>=<span class="string">&#123;[textStyle,</span> &#123; <span class="attr">height</span> &#125;]&#125;&gt;</span></div><div class="line">                            &#123;v&#125;</div><div class="line">                        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">                    ))&#125;</div><div class="line">                <span class="tag">&lt;/<span class="name">Animated.View</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå°±å°è£…äº†ä¸€ä¸ªå¹³ç§»åŠ¨ç”»ï¼Œç»˜åˆ¶çš„æ—¶å€™æ˜¯ç»˜åˆ¶äº†æ•´ä¸ªèŒƒå›´çš„æ•°å­—ï¼ŒgetPositionè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥è®¡ç®—ç›®æ ‡æ•°å­—çš„yè½´åæ ‡å€¼ï¼Œæ ¹æ®å½“å‰æ•°å­—åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¹˜ä»¥æµ‹é‡å‡ºçš„æ•°å­—æ–‡æœ¬ç»˜åˆ¶é«˜åº¦å–è´Ÿå€¼ï¼Œå¾—å‡ºåæ ‡å€¼ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> getPosition = <span class="function">(<span class="params">&#123; text, items, height &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// è·å¾—æ–‡æœ¬åœ¨æ•°ç»„çš„ä¸‹æ ‡</span></div><div class="line">    <span class="keyword">const</span> index = items.findIndex(<span class="function"><span class="params">p</span> =&gt;</span> p === text);</div><div class="line">    <span class="comment">// è¿”å›æ–‡æœ¬ç»˜åˆ¶çš„yè½´åæ ‡</span></div><div class="line">    <span class="keyword">return</span> index * height * <span class="number">-1</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„æ•°å­—å˜åŒ–åçš„å¤„ç†ï¼Œä¸€æ—¦æ•°å­—å˜åŒ–ï¼Œå°±è§¦å‘åŠ¨ç”»ï¼Œå½“çˆ¶ç»„ä»¶ä¼ é€’çš„propsçš„å€¼å˜åŒ–äº†ï¼Œå°±ä¼šè°ƒç”¨å­ç»„ä»¶çš„componentDidUpdateæ–¹æ³•ï¼Œå¯ä»¥åœ¨componentDidUpdateæ–¹æ³•ä¸­å¯¹æ–‡æœ¬å†…å®¹åšæ¯”å¯¹ï¼Œå¦‚æœä¸ä¹‹å‰propsçš„textå€¼ä¸ä¸€è‡´ï¼Œè¡¨ç¤ºæ•°å­—å˜åŒ–ï¼Œæ ¹æ®ç›®æ ‡æ•°å­—è®¡ç®—ç›®æ ‡yå€¼ï¼Œæ‰§è¡Œå¹³ç§»åŠ¨ç”»ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">componentDidUpdate(prevProps) &#123;</div><div class="line">     <span class="keyword">const</span> &#123; height, duration, rotateItems, text &#125; = <span class="keyword">this</span>.props;</div><div class="line">     <span class="comment">// æ•°å­—å˜åŒ–,ç”¨å½“å‰åŠ¨ç”»å€¼å’Œå˜åŒ–åçš„åŠ¨ç”»å€¼è¿›è¡Œæ’å€¼,å¹¶å¯åŠ¨åŠ¨ç”»</span></div><div class="line">     <span class="keyword">if</span> (prevProps.text !== text) &#123;</div><div class="line">         Animated.timing(<span class="keyword">this</span>.state.animation, &#123;</div><div class="line">             <span class="attr">toValue</span>: getPosition(&#123;</div><div class="line">                 <span class="attr">text</span>: text,</div><div class="line">                 <span class="attr">items</span>: rotateItems,</div><div class="line">                 height,</div><div class="line">             &#125;),</div><div class="line">             duration,</div><div class="line">             <span class="attr">useNativeDriver</span>: <span class="literal">true</span>,</div><div class="line">         &#125;).start();</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>æ³¨æ„è§„é¿é«˜åº¦å˜åŒ–å¸¦æ¥çš„é—®é¢˜ï¼Œä¸€æ—¦é«˜åº¦å˜åŒ–ï¼Œé‡ç½®åŠ¨ç”»çš„åˆå§‹å€¼<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">componentWillReceiveProps(nextProps) &#123;</div><div class="line">        <span class="comment">// é«˜åº¦å˜åŒ–,é‡ç½®åŠ¨ç”»åˆå§‹å€¼</span></div><div class="line">        <span class="keyword">if</span> (nextProps.height !== <span class="keyword">this</span>.props.height) &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">                <span class="attr">animation</span>: <span class="keyword">new</span> Animated.Value(</div><div class="line">                    getPosition(&#123;</div><div class="line">                        <span class="attr">text</span>: nextProps.text,</div><div class="line">                        <span class="attr">items</span>: nextProps.rotateItems,</div><div class="line">                        <span class="attr">height</span>: nextProps.height,</div><div class="line">                    &#125;),</div><div class="line">                ),</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>å¯¼å‡ºå°è£…çš„ç»„ä»¶ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> &#123; Tick, numberRange &#125;; <span class="comment">// å•ä¸ªæ•°å­—åŠ¨ç”»ç»„ä»¶ï¼Œæ•°å­—èŒƒå›´</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> Ticker; <span class="comment">// æ•´ä¸ªæ•°å­—åŠ¨ç”»ç»„ä»¶</span></div></pre></td></tr></table></figure></p>
<p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå±•ç¤ºæ ¼å¼ä¸ºyyyy / MM / ddçš„æ—¥æœŸï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;Ticker text=&#123;<span class="keyword">this</span>.state.showDate === <span class="string">'0'</span> ? <span class="string">''</span> : <span class="keyword">this</span>.state.showDate.substring(<span class="number">0</span>, <span class="number">4</span>)&#125; textStyle=&#123;styles.dateText&#125; rotateTime=&#123;<span class="number">1000</span>&#125; /&gt;</div><div class="line"></div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.dividerText&#125;</span>&gt;</span>&#123;this.state.showDate === '0' ? '' : '    /    '&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></div><div class="line"></div><div class="line">&lt;Ticker text=&#123;<span class="keyword">this</span>.state.showDate === <span class="string">'0'</span> ? <span class="string">''</span> : <span class="keyword">this</span>.state.showDate.substring(<span class="number">5</span>, <span class="number">7</span>)&#125; textStyle=&#123;styles.dateText&#125; rotateTime=&#123;<span class="number">1000</span>&#125; /&gt;</div><div class="line">                       </div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.dividerText&#125;</span>&gt;</span>&#123;this.state.showDate === '0' ? '' : '    /    '&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></div><div class="line">                       </div><div class="line">&lt;Ticker text=&#123;<span class="keyword">this</span>.state.showDate === <span class="string">'0'</span> ? <span class="string">''</span> : <span class="keyword">this</span>.state.showDate.substring(<span class="number">8</span>, <span class="number">10</span>)&#125; textStyle=&#123;styles.dateText&#125; rotateTime=&#123;<span class="number">1000</span>&#125; /&gt;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/08/Ubuntu-start/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/08/Ubuntu-start/" itemprop="url">æ­å»ºUbuntuä¸‹çš„å¼€å‘ç¯å¢ƒ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-08T13:54:00+08:00">
                2018-07-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Util/" itemprop="url" rel="index">
                    <span itemprop="name">Util</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/08/Ubuntu-start/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/07/08/Ubuntu-start/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/08/Ubuntu-start/" class="leancloud_visitors" data-flag-title="æ­å»ºUbuntuä¸‹çš„å¼€å‘ç¯å¢ƒ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>æœ€è¿‘æœ‰ç‚¹é—²æš‡æ—¶é—´ï¼ŒåŒå€¦äº†windowså¼€å‘ç¯å¢ƒï¼Œæƒ³å°è¯•ä¸€ä¸‹ubuntuä¸‹çš„å¼€å‘ç¯å¢ƒã€‚æœ¬äººAndroidå¼€å‘è€…ï¼Œä¹Ÿå†™ä¸€ç‚¹å‰ç«¯ï¼Œä»¥å‰å®¶é‡Œæ˜¯macå¼€å‘ç¯å¢ƒï¼Œå…¬å¸æ˜¯windowså¼€å‘ç¯å¢ƒï¼Œç°åœ¨æ‰“ç®—æŠŠå…¬å¸çš„å¼€å‘ç¯å¢ƒæ”¹ä¸ºubuntuï¼Œä¹‹å‰ä¹Ÿçœ‹è¿‡ubuntuä¸‹æ­å»ºAndroidå¼€å‘ç¯å¢ƒçš„æ–‡ç« ï¼Œå³ä½¿è¿™æ ·ï¼Œä¹Ÿè¸©äº†ä¸å°‘çš„å‘ï¼ŒæŠ˜è…¾äº†å‡ å¤©ï¼Œæ€»ç®—æŠŠç¯å¢ƒæ­å»ºèµ·æ¥äº†ï¼ŒåŸºæœ¬ç¨³å®šã€‚æ€»çš„æ¥è¯´ubuntuä¸‹çš„å¼€å‘ç¯å¢ƒä¸åƒwindowså’Œmacé‚£ä¹ˆå¥½æ­å»ºï¼Œå‘ç‚¹ç•¥å¤šï¼Œä½†æ˜¯æ­å»ºæˆåŠŸåè¿è¡Œé€Ÿåº¦æ˜¯éå¸¸å¯è§‚çš„ï¼Œæ¯”èµ·windowså¿«äº†ä¸å°‘ï¼Œä¹Ÿä¸æ‰è´¹èŠ±äº†è¿™ä¹ˆå¤šæ—¶é—´ã€‚æ¥ä¸‹æ¥æ€»ç»“ä¸€ä¸‹ubuntuä¸‹å¼€å‘çš„å¸¸ç”¨è½¯ä»¶ï¼Œæ’ä»¶ï¼Œä»¥åŠå¯èƒ½é‡åˆ°çš„å‘ç‚¹ã€‚</p>
<hr>
<h1 id="å®‰è£…ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜"><a href="#å®‰è£…ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜" class="headerlink" title="å®‰è£…ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜"></a>å®‰è£…ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜</h1><p>å®‰è£…ç³»ç»Ÿæµç¨‹æ¯”è¾ƒæ™®é€šï¼Œåˆ†åŒºæ–¹æ¡ˆç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œä¸è¿‡è¦æ³¨æ„ä¸¤ç‚¹</p>
<h2 id="å®‰è£…è‹±æ–‡ç‰ˆçš„ç³»ç»Ÿ"><a href="#å®‰è£…è‹±æ–‡ç‰ˆçš„ç³»ç»Ÿ" class="headerlink" title="å®‰è£…è‹±æ–‡ç‰ˆçš„ç³»ç»Ÿ"></a>å®‰è£…è‹±æ–‡ç‰ˆçš„ç³»ç»Ÿ</h2><p>å³ä½¿ä¸ä¹ æƒ¯è‹±æ–‡ç³»ç»Ÿä¹Ÿåº”è¯¥åœ¨å®‰è£…ç³»ç»Ÿæ—¶é€‰æ‹©è‹±æ–‡ï¼Œå®‰è£…å®Œäº†å†æ”¹å›ä¸­æ–‡ï¼Œå› ä¸ºå¦‚æœæ˜¯å®‰è£…ä¸­æ–‡ç‰ˆçš„ç³»ç»Ÿï¼Œæ–‡ä»¶å¤¹çš„åç§°ä¼šå˜æˆä¸‹è½½ï¼Œæ–‡æ¡£ï¼ŒéŸ³ä¹ï¼Œå›¾ç‰‡ï¼ï¼ï¼ç”±äºubuntuå¾ˆå¤šæ—¶å€™ç”¨å‘½ä»¤è¡Œï¼Œå¯¼è‡´å‘½ä»¤è¡Œè¾“å…¥ç»å¸¸åˆ‡æ¢ä¸­æ–‡ä¸æ–¹ä¾¿ï¼Œæˆ‘ç¬¬ä¸€æ¬¡å®‰è£…çš„æ—¶å€™æ‰‹å¿«é€‰äº†ä¸­æ–‡ç‰ˆï¼Œä»¥ä¸ºåé¢å¯ä»¥æ”¹ï¼Œç„¶è€Œè¿™ä¸ªç›®å½•åæ˜¯å®‰è£…ç³»ç»Ÿçš„æ—¶å€™å°±å»ºå¥½äº†çš„ï¼Œç¬¬äºŒæ¬¡æœæ–­å®‰è£…è‹±æ–‡ç‰ˆ</p>
<h2 id="åˆ†åŒºçš„å‘"><a href="#åˆ†åŒºçš„å‘" class="headerlink" title="åˆ†åŒºçš„å‘"></a>åˆ†åŒºçš„å‘</h2><p>ubuntuè™½ç„¶å¯ä»¥æŒ‚è½½ntfsåˆ†åŒºï¼Œä½†æ˜¯ideåœ¨è¯»å–å·¥ç¨‹ç›®å½•çš„æ—¶å€™æ˜¯åªè¯»å–/ä¸‹é¢çš„ï¼Œæ‰€ä»¥æ ¹ç›®å½•çš„åˆ†åŒºä¸€å®šä¸èƒ½å°</p>
<h1 id="å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶"><a href="#å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶" class="headerlink" title="å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶"></a>å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶</h1><p>æœ‰äº›è½¯ä»¶ç³»ç»Ÿè‡ªå¸¦ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æˆ–è€…ä¸ä¼šç”¨åˆ°çš„å¯ä»¥å¸è½½æ‰<br>ä»¥ä¸‹æ˜¯å¸è½½æ¸…å•<br>libreoffice-common libreofficeï¼ˆå¯ä»¥æ¢ WPSï¼‰<br>unity-webapps-common Amazon é“¾æ¥<br>totem è‡ªå¸¦çš„æ’­æ”¾å™¨<br>rhythmbox è‡ªå¸¦çš„éŸ³ä¹æ’­æ”¾å™¨<br>empathy è‡ªå¸¦çš„å³æ—¶èŠå¤©åº”ç”¨<br>brasero è‡ªå¸¦çš„å…‰ç›˜åˆ»å½•å™¨<br>simple-scan æ‰«æä»ª<br>gnome-mahjongg å¯¹å¯¹ç¢°æ¸¸æˆ<br>aisleriot çº¸ç‰Œæ¸¸æˆ<br>gnome-mines æ‰«é›·æ¸¸æˆ<br>cheese webcam åº”ç”¨<br>gnome-sudoku æ•°ç‹¬æ¸¸æˆ<br>transmission-common BT å®¢æˆ·ç«¯<br>gnome-orca å±å¹•é˜…è¯»<br>webbrowser-app è‡ªå¸¦çš„æµè§ˆå™¨ï¼ˆè¿™ä¸ªå¤ªéš¾ç”¨äº†ï¼Œæœ‰chrome å’Œ Firefoxï¼‰<br>landscape-client-ui-install landscape è¿œç¨‹æ§åˆ¶è½¯ä»¶<br>deja-dup å¤‡ä»½<br>onboard å±å¹•é”®ç›˜</p>
<p>ä¸‹é¢æ˜¯å¯ä»¥æ‰¹é‡å¸è½½çš„å‘½ä»¤<br><code>sudo apt-get remove unity-webapps-common;sudo apt-get remove totem;sudo apt-get remove rhythmbox;sudo apt-get remove empathy;sudo apt-get remove brasero;sudo apt-get remove simple-scan;sudo apt-get remove gnome-mahjongg;sudo apt-get remove aisleriot;sudo apt-get remove gnome-mines;sudo apt-get remove cheese;sudo apt-get remove transmission-common;sudo apt-get remove gnome-orca;sudo apt-get remove webbrowser-app;sudo apt-get remove gnome-sudoku;sudo apt-get remove landscape-client-ui-install;sudo apt-get remove onboard;sudo apt-get remove deja-dup;sudo apt-get remove libreoffice-common</code></p>
<p>apt-get remove â€“purge xxx # ç§»é™¤åº”ç”¨åŠé…ç½®<br>apt-get autoremove # ç§»é™¤æ²¡ç”¨çš„åŒ…</p>
<h1 id="aptæ›¿æ¢é˜¿é‡Œæº"><a href="#aptæ›¿æ¢é˜¿é‡Œæº" class="headerlink" title="aptæ›¿æ¢é˜¿é‡Œæº"></a>aptæ›¿æ¢é˜¿é‡Œæº</h1><h2 id="å›¾å½¢ç•Œé¢é…ç½®"><a href="#å›¾å½¢ç•Œé¢é…ç½®" class="headerlink" title="å›¾å½¢ç•Œé¢é…ç½®"></a>å›¾å½¢ç•Œé¢é…ç½®</h2><p>æ–°æ‰‹æ¨èä½¿ç”¨å›¾å½¢ç•Œé¢é…ç½®ï¼š ç³»ç»Ÿè®¾ç½® -&gt; è½¯ä»¶å’Œæ›´æ–° é€‰æ‹©ä¸‹è½½æœåŠ¡å™¨ -&gt; â€œmirrors.aliyun.comâ€</p>
<h2 id="æ‰‹åŠ¨æ›´æ”¹"><a href="#æ‰‹åŠ¨æ›´æ”¹" class="headerlink" title="æ‰‹åŠ¨æ›´æ”¹"></a>æ‰‹åŠ¨æ›´æ”¹</h2><p>ç”¨ä½ ç†Ÿæ‚‰çš„ç¼–è¾‘å™¨æ‰“å¼€ï¼š<br>/etc/apt/sources.list<br>æ›¿æ¢é»˜è®¤çš„<br><a href="http://archive.ubuntu.com/ä¸ºmirrors.aliyun.com" target="_blank" rel="external">http://archive.ubuntu.com/ä¸ºmirrors.aliyun.com</a><br>ä»¥Ubuntu 14.04.5 LTSä¸ºä¾‹ï¼Œæœ€åçš„æ•ˆæœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">deb https://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse</div><div class="line">deb-src https://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse</div><div class="line">deb https://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse</div><div class="line">deb-src https://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse</div><div class="line"></div><div class="line">deb https://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse</div><div class="line">deb-src https://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse</div><div class="line"></div><div class="line">deb https://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse</div><div class="line">deb-src https://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse</div><div class="line">## Not recommended</div><div class="line"># deb https://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse</div><div class="line"># deb-src https://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse</div></pre></td></tr></table></figure></p>
<p>ubuntu 16.04 é…ç½®å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial main</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial main</div><div class="line"></div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main</div><div class="line"></div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial universe</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial universe</div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates universe</div><div class="line"></div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security main</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main</div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security universe</div></pre></td></tr></table></figure></p>
<p>ubuntu 18.04(bionic) é…ç½®å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</div><div class="line"></div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</div><div class="line"></div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</div><div class="line"></div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</div><div class="line"></div><div class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</div><div class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</div></pre></td></tr></table></figure></p>
<h1 id="è®¾ç½®ä¸­æ–‡è¾“å…¥æ³•"><a href="#è®¾ç½®ä¸­æ–‡è¾“å…¥æ³•" class="headerlink" title="è®¾ç½®ä¸­æ–‡è¾“å…¥æ³•"></a>è®¾ç½®ä¸­æ–‡è¾“å…¥æ³•</h1><p>sudo add-apt-repository ppa:fcitx-team/nightly<br>sudo apt-get update<br>å®‰è£…fcitx<br>sudo apt-get install fcitx<br>å®‰è£…fcitxçš„é…ç½®å·¥å…·<br>sudo apt-get install fcitx-config-gtk<br>å®‰è£…fcitxçš„table-allè½¯ä»¶åŒ…<br>sudo apt-get install fcitx-table-al l<br>å®‰è£…è¾“å…¥æ³•åˆ‡æ¢å·¥å…·<br>sudo apt-get install im-switch<br>è®¾ç½®è¯­è¨€é€‰é¡¹ï¼šå°†é”®ç›˜è¾“å…¥æ³•ç³»ç»Ÿç”±é»˜è®¤çš„iBusè®¾ç½®ä¸ºfcitx<br>å®‰è£…äº†æœç‹—è¾“å…¥æ³•åé¢‘ç¹å´©æºƒï¼Œç´¢æ€§å°±ç”¨fcitxè‡ªå¸¦çš„ï¼Œå¹¶æ²¡è§‰å¾—æœ‰ä»€ä¹ˆä¸åŒ</p>
<h1 id="å‘½ä»¤è¡Œç›¸å…³"><a href="#å‘½ä»¤è¡Œç›¸å…³" class="headerlink" title="å‘½ä»¤è¡Œç›¸å…³"></a>å‘½ä»¤è¡Œç›¸å…³</h1><p>bashå¯¹åº”é…ç½®æ–‡ä»¶ä¸º.bashrc<br>zshå¯¹åº”é…ç½®æ–‡ä»¶ä¸º.zshrc<br>oh-my-zshæ˜¯åŸºäºzshçš„åŠŸèƒ½åšäº†ä¸€ä¸ªæ‰©å±•ï¼Œæ–¹ä¾¿çš„æ’ä»¶ç®¡ç†ã€ä¸»é¢˜è‡ªå®šä¹‰ï¼Œä»¥åŠæ¼‚äº®çš„è‡ªåŠ¨å®Œæˆæ•ˆæœã€‚æ¯”é»˜è®¤çš„bashå¥½ç”¨</p>
<h2 id="å®‰è£…zsh"><a href="#å®‰è£…zsh" class="headerlink" title="å®‰è£…zsh"></a>å®‰è£…zsh</h2><p>sudo apt-get install zsh</p>
<h2 id="å®‰è£…ohmyzsh"><a href="#å®‰è£…ohmyzsh" class="headerlink" title="å®‰è£…ohmyzsh"></a>å®‰è£…ohmyzsh</h2><h3 id="gitæºç "><a href="#gitæºç " class="headerlink" title="gitæºç "></a>gitæºç </h3><p>git clone git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh<br>cd oh-my-zsh/tools<br>./install.sh</p>
<h3 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h3><p>sh -c â€œ$(curl -fsSL <a href="https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh" target="_blank" rel="external">https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh</a>)â€</p>
<h3 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h3><p>sh -c â€œ$(wget <a href="https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh" target="_blank" rel="external">https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh</a> -O -)â€</p>
<h2 id="ä¿®æ”¹é»˜è®¤shell"><a href="#ä¿®æ”¹é»˜è®¤shell" class="headerlink" title="ä¿®æ”¹é»˜è®¤shell"></a>ä¿®æ”¹é»˜è®¤shell</h2><p>ubuntuä¸‹é»˜è®¤çš„shellæ˜¯bashï¼Œä¿®æ”¹å®ƒä¸ºzsh&amp;ohmyzsh<br>chsh -s /bin/zsh</p>
<h2 id="é…ç½®ä¸»é¢˜"><a href="#é…ç½®ä¸»é¢˜" class="headerlink" title="é…ç½®ä¸»é¢˜"></a>é…ç½®ä¸»é¢˜</h2><p>ä¿®æ”¹~/.zshrcä¸­çš„ZSH_THEME</p>
<h2 id="é…ç½®æ’ä»¶"><a href="#é…ç½®æ’ä»¶" class="headerlink" title="é…ç½®æ’ä»¶"></a>é…ç½®æ’ä»¶</h2><p>ä¿®æ”¹~/.zshrcä¸­çš„plugins=(git bundler osx rake ruby)<br>å¸¸ç”¨æ’ä»¶<br>wd å¿«é€Ÿè¿›å…¥<br>zsh-syntax-highlighting è¯­æ³•é«˜äº®<br>zsh-autosuggestions å†å²è®°å½•æç¤º<br>svn<br>adb<br>yarn</p>
<h2 id="å›¾å½¢åŒ–svnä¸gitç®¡ç†å·¥å…·"><a href="#å›¾å½¢åŒ–svnä¸gitç®¡ç†å·¥å…·" class="headerlink" title="å›¾å½¢åŒ–svnä¸gitç®¡ç†å·¥å…·"></a>å›¾å½¢åŒ–svnä¸gitç®¡ç†å·¥å…·</h2><p>rabbitvcs</p>
<ol>
<li><p>æ·»åŠ PPAæº<br>sudo add-apt-repository ppa:rabbitvcs/ppa<br>å¦‚æœå¯¼å…¥å¯†é’¥å¤±è´¥ï¼Œåˆ™åœ¨ /etc/apt/sources.list æ–‡ä»¶ä¸­åŠ å…¥:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">deb http://ppa.launchpad.net/rabbitvcs/ppa/ubuntu **DISTRIBUTION** main</div></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°æº</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…ä¾èµ–</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install python-nautilus python-configobj python-gtk2 python-glade2 python-svn python-dbus python-dulwich subversion meld</div></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…RabbitVCS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install rabbitvcs-cli  rabbitvcs-core rabbitvcs-gedit rabbitvcs-nautilus</div></pre></td></tr></table></figure>
</li>
<li><p>é‡å¯æ–‡ä»¶æµè§ˆå™¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nautilus -q </div><div class="line">nautilus</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="shadowsocksç›¸å…³"><a href="#shadowsocksç›¸å…³" class="headerlink" title="shadowsocksç›¸å…³"></a>shadowsocksç›¸å…³</h1><p>ä½œä¸ºå¼€å‘è€…ssæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œç‰¹åˆ«æ˜¯ä¹ æƒ¯äº†googleçš„ï¼Œå®Œå…¨æ— æ³•å¿å—æ²¡æœ‰æ¢¯å­çš„æ—¥å­ï¼Œubuntuä¸‹é…ç½®shadowsocksç¨å¾®æœ‰äº›éº»çƒ¦ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦ä¸‹è½½shadowsocksçš„æ— å›¾å½¢ç•Œé¢ç‰ˆæœ¬ï¼Œæˆ‘ç”¨è¿‡å›¾å½¢ç•Œé¢ç‰ˆqt5ï¼Œå¤ªä¸ç¨³å®šäº†ã€‚<br>sudo apt update<br>sudo apt install python-gevent python-pip<br>pip install shadowsocks<br>ç¼–è¾‘é…ç½®æ–‡ä»¶<br>vim /etc/ss.json<br>server æœåŠ¡å™¨åœ°å€<br>server_port ç«¯å£<br>local_port æœ¬åœ°ç«¯å£<br>password å¯†ç <br>method åŠ å¯†æ–¹å¼ è·ŸæœåŠ¡å™¨ä¿æŒä¸€è‡´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123; </div><div class="line">&quot;server&quot;:&quot;server_ip&quot;,</div><div class="line">&quot;server_port&quot;:30696,</div><div class="line">&quot;local_port&quot;:1080,</div><div class="line">&quot;password&quot;:&quot;password&quot;,</div><div class="line">&quot;timeout&quot;:600,</div><div class="line">&quot;method&quot;:&quot;rc4-md5&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ubuntuè‡ªå¸¦å¼€æœºå¯åŠ¨é¡¹è®¾ç½®å·¥å…· startupapplicationsç‚¹å‡»addæ·»åŠ <br>nameå’Œcommentéšæ„å¡«å†™ï¼Œcommandå¡«å†™ä¸ºsudo sslocal -c /etc/ss.json -d start<br>é…ç½®å¥½äº†ä»¥åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹æœ¬æœºä»£ç†ï¼Œwindowsã€macéƒ½æ˜¯ä¸éœ€è¦çš„<br>è¿™é‡Œæœ‰ä¸€ä¸ªå‘ç‚¹ubuntu18ä¸Šå¯åŠ¨shadowsocksï¼Œopenssl.pyä¼šæŠ¥é”™ï¼Œå°†æ­¤æ–‡ä»¶ä¸­çš„52è¡Œå’Œ111è¡Œä¸­çš„cleanupæ›¿æ¢ä¸ºresetï¼Œå¦åˆ™å¯èƒ½æ‰§è¡Œå¯åŠ¨å‘½ä»¤æŠ¥é”™</p>
<h2 id="å…¨éƒ¨è¯·æ±‚ç”¨ä»£ç†"><a href="#å…¨éƒ¨è¯·æ±‚ç”¨ä»£ç†" class="headerlink" title="å…¨éƒ¨è¯·æ±‚ç”¨ä»£ç†"></a>å…¨éƒ¨è¯·æ±‚ç”¨ä»£ç†</h2><p>SystemSetting-&gt;Network-&gt;-&gt;NetworkProxy<br>Methodè®¾ç½®ä¸ºï¼­anual<br>sockshost 127.0.0.1 1080ï¼Œç„¶åApply System Wide</p>
<h2 id="æ·»åŠ è§„åˆ™ï¼Œéƒ¨åˆ†ä»£ç†"><a href="#æ·»åŠ è§„åˆ™ï¼Œéƒ¨åˆ†ä»£ç†" class="headerlink" title="æ·»åŠ è§„åˆ™ï¼Œéƒ¨åˆ†ä»£ç†"></a>æ·»åŠ è§„åˆ™ï¼Œéƒ¨åˆ†ä»£ç†</h2><p>å®‰è£…genpac<br>sudo apt-get install python-pip<br>sudo pip install genpac<br>ä½¿ç”¨genpacç”Ÿæˆautoproxy.pacè§„åˆ™æ–‡ä»¶<br>genpac -p â€œSOCKS5 127.0.0.1:1080â€ â€“output=â€autoproxy.pacâ€<br>è®©ç³»ç»Ÿåº”ç”¨è§„åˆ™<br>SystemSetting-&gt;Network-&gt;NetworkProxy<br>Methodè®¾ç½®ä¸ºAutomatic<br>Configuration Urlå¡«â€file:///home/xxx/autoproxy.pacâ€ï¼Œç„¶åApply System Wide<br>chromeå’Œfirefoxéƒ½è¦å®‰è£…Proxy SwitchyOmegaæ’ä»¶<br>æ–¹ä¾¿æˆ‘ä»¬è®¾ç½®è‡ªåŠ¨åˆ‡æ¢è§„åˆ™</p>
<h2 id="httpä»£ç†"><a href="#httpä»£ç†" class="headerlink" title="httpä»£ç†"></a>httpä»£ç†</h2><p>å¦‚æœæ˜¯å‘½ä»¤è¡Œï¼Œå¾ˆå¤šåªæ”¯æŒhttpåè®®çš„è½¯ä»¶æˆ–è€…å·¥å…·ï¼Œæˆ‘ä»¬å†é…ç½®ä¸€æ¬¡httpä»£ç†</p>
<h3 id="å®‰è£…privoxy"><a href="#å®‰è£…privoxy" class="headerlink" title="å®‰è£…privoxy"></a>å®‰è£…privoxy</h3><p>sudo apt-get install privoxy</p>
<h3 id="é…ç½®privoxy"><a href="#é…ç½®privoxy" class="headerlink" title="é…ç½®privoxy"></a>é…ç½®privoxy</h3><p>æ‰“å¼€/etc/privoxy/config<br>å–æ¶ˆlisten-address localhost:8118çš„ä»£ç æ³¨é‡Š<br>æ‰¾åˆ°5.2èŠ‚<br>åŠ å…¥ä¸€å¥<br>forward-socks5 / 127.0.0.1:1080 .<br>é‡å¯privoxyæœåŠ¡<br>sudo /etc/init.d/privoxy restart<br>å¼€æœºè‡ªå¯privoxyæœåŠ¡<br>sudo /etc/init.d/privoxy startåŠ å…¥åˆ°/etc/rc.localæ–‡ä»¶ä¸­çš„exit 0è¿™å¥ä¹‹å‰<br>åœ¨profileä¸­å†™å…¥httpä»£ç†<br>export http_proxy=â€127.0.0.1:8118â€<br>export https_proxy=â€127.0.0.1:8118â€</p>
<h1 id="Ubuntuè½¯ä»¶é›†åˆ"><a href="#Ubuntuè½¯ä»¶é›†åˆ" class="headerlink" title="Ubuntuè½¯ä»¶é›†åˆ"></a>Ubuntuè½¯ä»¶é›†åˆ</h1><p>chrome å¼€å‘è€…å¿…å¤‡æµè§ˆå™¨ï¼Œè‡ªå¸¦æœ‰firefox<br>Typora markdownç¼–è¾‘å™¨<br>Deepin Screenshotæ·±åº¦æˆªå›¾(Ubuntu Softwareä¸­å®‰è£…)<br>electronic wechat å¾®ä¿¡<br>å¿«é€Ÿå¯åŠ¨ULauncher<br>Redshift è‡ªåŠ¨è°ƒèŠ‚å±å¹•è‰²æ¸©<br>Android studio androidå¼€å‘è€…éƒ½æ‡‚<br>Webstorm å‰ç«¯å¼€å‘åˆ©å™¨<br>vscode å¾®è½¯å‡ºçš„å¼€å‘ç¥å™¨ï¼Œè½»é‡çº§<br>mpv æ’­æ”¾å™¨<br>angrySearchæ–‡ä»¶æœç´¢<br>ubuntu-tweak é›†æ¸…ç†ï¼Œä¸»é¢˜ç®¡ç†ï¼Œå­—ä½“ç®¡ç†ï¼Œçƒ­åŒºè‡ªå®šä¹‰äºä¸€ä½“çš„è½¯ä»¶ï¼Œå¯æ›¿ä»£ubuntu-tweak-toolï¼Œè¿™ä¸ªè½¯ä»¶ä¼šé»˜è®¤å®‰è£…ç³»ç»Ÿè‡ªå¸¦çš„æµè§ˆå™¨<br>(2018-5-31 æ–°ç‰ˆçš„ubuntu18ç§»é™¤äº†unityæ¡Œé¢,è¿™ä¸ªæ²¡å•¥ç”¨äº†,å¯æ¢æˆgnome-tweak-tool)</p>
<h2 id="ubuntu18-gnomeä¸»é¢˜å®šåˆ¶"><a href="#ubuntu18-gnomeä¸»é¢˜å®šåˆ¶" class="headerlink" title="ubuntu18 gnomeä¸»é¢˜å®šåˆ¶"></a>ubuntu18 gnomeä¸»é¢˜å®šåˆ¶</h2><p><a href="https://www.gnome-look.org/" target="_blank" rel="external">å®šåˆ¶èµ„æºä¸‹è½½</a><br>å…‰æ ‡: ä¸‹è½½è§£å‹åæ”¾åˆ°/usr/share/icons/ç›®å½•<br>GTKä¸»é¢˜: ä¸‹è½½è§£å‹åæ”¾åˆ°/usr/share/themes/ç›®å½•<br>å›¾æ ‡: ä¸‹è½½è§£å‹æ”¾åˆ°/usr/share/icons/ç›®å½•<br>shellä¸»é¢˜: ä¸‹è½½è§£å‹æ”¾åˆ°/usr/share/themes/ç›®å½• (éœ€è¦å®‰è£…gnome shell extension)<br>(ä½¿ç”¨gnome tweak tool-&gt;apperanceå‰é¢æŒ‰é’®å®‰è£…zip,ä¼šæ”¾åˆ°~/.local/share/themesä¸‹)<br>é‡å¯gnome tweak tool,æ‰å¯åœ¨gnome tweak toolä¸­æ‰¾åˆ°</p>
<h1 id="wps-é‡‘å±±wpsæœ‰linuxç‰ˆ"><a href="#wps-é‡‘å±±wpsæœ‰linuxç‰ˆ" class="headerlink" title="wps é‡‘å±±wpsæœ‰linuxç‰ˆ"></a>wps é‡‘å±±wpsæœ‰linuxç‰ˆ</h1><p>å®‰è£…åè¿›å…¥ï¼ŒæŠ¥å­—ä½“ç¼ºå¤±<br>ä¸‹è½½å­—ä½“åŒ…<br>ç™¾åº¦äº‘<a href="http://pan.baidu.com/s/1nuS5U5b" target="_blank" rel="external">http://pan.baidu.com/s/1nuS5U5b</a> å¯†ç ï¼šp4vz</p>
<ol>
<li>è§£å‹</li>
<li>æŠŠwps_symbol_fontsç›®å½•æ‹·è´åˆ° /usr/share/fonts/ ç›®å½•ä¸‹</li>
<li><p>æƒé™æ·»åŠ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span>cd /usr/share/fonts/</div><div class="line"><span class="meta">#</span>chmod 755 wps_symbol_fonts</div><div class="line"><span class="meta">#</span>cd /usr/share/fonts/wps_symbol_fonts</div><div class="line"><span class="meta">#</span>chmod 644 *</div></pre></td></tr></table></figure>
</li>
<li><p>ç”Ÿæˆç¼“å­˜é…ç½®ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span>cd /usr/share/fonts/wps_symbol_fonts</div><div class="line"><span class="meta">#</span>mkfontdir</div><div class="line"><span class="meta">#</span>mkfontscale</div><div class="line"><span class="meta">#</span>fc-cache</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="å°ç¨‹åºå¼€å‘å·¥å…·"><a href="#å°ç¨‹åºå¼€å‘å·¥å…·" class="headerlink" title="å°ç¨‹åºå¼€å‘å·¥å…·"></a>å°ç¨‹åºå¼€å‘å·¥å…·</h1><p>å¾®ä¿¡å¼€å‘è€…å·¥å…·(å¾®ä¿¡å°ç¨‹åº)linuxå®Œç¾æ”¯æŒ<br><a href="https://github.com/cytle/wechat_web_devtools" target="_blank" rel="external">https://github.com/cytle/wechat_web_devtools</a></p>
<h1 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h1><p>wireshark<br><a href="https://blog.csdn.net/xukai871105/article/details/31008635" target="_blank" rel="external">https://blog.csdn.net/xukai871105/article/details/31008635</a><br>charlesä¹Ÿæœ‰linuxç‰ˆ</p>
<h1 id="qq-è§£å†³æ–¹æ¡ˆ"><a href="#qq-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="qq è§£å†³æ–¹æ¡ˆ"></a>qq è§£å†³æ–¹æ¡ˆ</h1><p>ä¼˜éº’éºŸqqï¼Œè¡¨æƒ…æ˜¾ç¤ºä¸å‡ºæ¥ä¸”å‘é€é”™è¯¯ï¼Œç‰ˆæœ¬å¾ˆè€<br>Wine-QQ-TIMï¼Œä½¿ç”¨å‡ å¤©åå‡ºç°ç”µè„‘æ— æ•…å¡æ­»ï¼Œè¾“å…¥æ³•åˆ‡æ¢ä¸äº†ï¼Œæ— æ³•å¯åŠ¨ç­‰é—®é¢˜<br>WineçœŸçš„ä¸å¥½ç”¨ï¼Œè¿˜ä¸å¦‚è™šæ‹Ÿæœº<br>ä¸€ç•ªæŠ˜è…¾åï¼Œè¿˜æ˜¯å¸è½½äº†qqï¼Œççˆ±ç”Ÿå‘½ï¼Œè¿œç¦»qq</p>
<h1 id="å¾®ä¿¡-è§£å†³æ–¹æ¡ˆ-ï¼ˆ2019-4-15æ›´æ–°ï¼‰"><a href="#å¾®ä¿¡-è§£å†³æ–¹æ¡ˆ-ï¼ˆ2019-4-15æ›´æ–°ï¼‰" class="headerlink" title="å¾®ä¿¡ è§£å†³æ–¹æ¡ˆ ï¼ˆ2019.4.15æ›´æ–°ï¼‰"></a>å¾®ä¿¡ è§£å†³æ–¹æ¡ˆ ï¼ˆ2019.4.15æ›´æ–°ï¼‰</h1><ul>
<li>ç›®å‰å‘ç°electronic-wechatå°±æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ²¡æœ‰ä¹‹ä¸€ï¼ŒåŸºäºwebå¾®ä¿¡ç”¨Electronå°è£…å¹¶å¼€æº<br><a href="https://github.com/geeeeeeeeek/electronic-wechat" target="_blank" rel="external">ä¼ é€é—¨</a><h1 id="é’‰é’‰-è§£å†³æ–¹æ¡ˆ-ï¼ˆ2019-4-15æ›´æ–°ï¼‰"><a href="#é’‰é’‰-è§£å†³æ–¹æ¡ˆ-ï¼ˆ2019-4-15æ›´æ–°ï¼‰" class="headerlink" title="é’‰é’‰ è§£å†³æ–¹æ¡ˆ ï¼ˆ2019.4.15æ›´æ–°ï¼‰"></a>é’‰é’‰ è§£å†³æ–¹æ¡ˆ ï¼ˆ2019.4.15æ›´æ–°ï¼‰</h1></li>
<li>ç›®å‰å‘ç°dingtalkå°±æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ²¡æœ‰ä¹‹ä¸€ï¼ŒåŸºäºwebé’‰é’‰ç”¨Electronå°è£…å¹¶å¼€æº<br><a href="https://github.com/nashaofu/dingtalk" target="_blank" rel="external">ä¼ é€é—¨</a><h1 id="virtualbox-amp-genymotion"><a href="#virtualbox-amp-genymotion" class="headerlink" title="virtualbox&amp;genymotion"></a>virtualbox&amp;genymotion</h1>è™šæ‹Ÿæœºå’ŒAndroidæ¨¡æ‹Ÿå™¨<br>åœ¨virtualboxä¸‹å®‰è£…win7ï¼Œè§£å†³ubuntuä¸‹æ— æ³•è§£å†³çš„é—®é¢˜<br>å®‰è£…virtualboxæ—¶æ³¨æ„å®‰è£…ubuntuæœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœå¼€äº†intelè™šæ‹ŸæŠ€æœ¯ï¼Œè¿˜æ˜¯å¡å¼€æœºç•Œé¢ï¼Œå¯èƒ½æ˜¯å½“å‰æ˜¾å¡é©±åŠ¨é—®é¢˜ï¼Œä¸è¦é€‰æ‹©opensourceç‰ˆæœ¬çš„æ˜¾å¡é©±åŠ¨<br>genymotionå°½é‡é€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œæœ‰ä¸ªå‘ï¼Œå¦‚æœå¡æ­»ï¼Œå†…å­˜åˆ†é…å°½é‡å¤§ä¸€ç‚¹</li>
</ul>
<h1 id="æ‹¾è‰²å™¨"><a href="#æ‹¾è‰²å™¨" class="headerlink" title="æ‹¾è‰²å™¨"></a>æ‹¾è‰²å™¨</h1><p>å‰ç«¯å¼€å‘ï¼Œappå¼€å‘å¿…ä¸å¯å°‘çš„å·¥å…·<br>Deepin picker æ·±åº¦å–è‰²å™¨(Ubuntu Softwareä¸­å®‰è£…)<br>æ·»åŠ å¿«æ·é”®ï¼š<br>Settings -&gt; Devices -&gt; Keyboard commondä¸º:/usr/bin/deepin-picker<br>åŒç†ï¼Œæ·»åŠ æˆªå›¾çš„å¿«æ·é”®<br>Settings -&gt; Devices -&gt; Keyboard commondä¸º:/usr/bin/deepin-screenshot</p>
<h1 id="ç³»ç»Ÿå¤‡ä»½"><a href="#ç³»ç»Ÿå¤‡ä»½" class="headerlink" title="ç³»ç»Ÿå¤‡ä»½"></a>ç³»ç»Ÿå¤‡ä»½</h1><p>è¾›è‹¦æŠ˜è…¾çš„ç³»ç»Ÿæœ€å¥½åšä¸ªå¤‡ä»½ ,remastersysè¿™ä¸ªç³»ç»Ÿå¤‡ä»½å·¥å…·æ˜¯ä¸é”™ï¼Œä½†æ˜¯å¤‡ä»½æ–‡ä»¶å¤§äº4gå°±ä¼šå¤‡ä»½å¤±è´¥ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿè¯´äº†è¿™ä¸ªé—®é¢˜æ˜¯iso9660çš„é™åˆ¶ï¼Œç›®å‰æ— è§£ã€‚<br>åæ¥å‘ç°ä¸€ä¸ªæ›´å¥½ç”¨çš„å·¥å…·ï¼ŒTimeshiftç±»ä¼¼macä¸Šçš„TimeMachineï¼ŒæŒ‰å¤‡ä»½æ—¶é—´ç‚¹åˆ›å»ºå¿«ç…§ï¼Œå¯¹å¿«ç…§å¯è¿›è¡Œç®¡ç†ï¼Œæœ‰å¤‡ä»½è®¡åˆ’ç­‰åŠŸèƒ½ï¼Œå¯ä»¥å®ç°å¢å¼ºå¤‡ä»½å’Œå®Œæ•´å¤‡ä»½ã€‚</p>
<p>ç›®å‰å°±æ€»ç»“åˆ°è¿™é‡Œï¼Œåé¢å¦‚æœå‘ç°æ›´å¥½ç”¨çš„è½¯ä»¶ï¼Œæ’ä»¶ï¼Œå‘ç‚¹ä¼šæŒç»­æ›´æ–°ï½</p>
<ul>
<li>2018.11.11çˆ¬å‘<br>Android studioçœŸæœºè°ƒè¯•ä¼šæŠ¥ä¸€ä¸ªé”™ï¼Œå‘ç°è®¾å¤‡æ— æ³•è¢«è¯†åˆ«<br><code>error insufficient permissions for device user in plugdev group are your udev rules wrong</code><br>è§£å†³æ–¹æ¡ˆï¼š</li>
</ul>
<ol>
<li>lsusbå‘½ä»¤æŸ¥å‡ºæ‰€æœ‰é€šè¿‡usbè¿æ¥pcçš„è®¾å¤‡ï¼Œæ‰¾å‡ºé‚£ä¸ªæ­£åœ¨è°ƒè¯•çš„è¯»ä¸å‡ºå‹å·çš„è®¾å¤‡<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Bus 001 Device 004: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub</div><div class="line">Bus 001 Device 003: ID 1bcf:2984 Sunplus Innovation Technology Inc.</div><div class="line">Bus 001 Device 006: ID 2717:9039</div><div class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</div><div class="line">Bus 003 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</div><div class="line">Bus 002 Device 002: ID 046d:c077 Logitech, Inc.</div></pre></td></tr></table></figure>
</li>
</ol>
<p>æ³¨æ„IDåXXXX:XXXXçš„å‚æ•°ï¼Œå‰ä¸€ä¸ªæ˜¯idVendorï¼Œåä¸€ä¸ªæ˜¯idProduct</p>
<ol>
<li>åˆ›å»ºadb_usb.iniæ–‡ä»¶ï¼Œå†™å…¥idVendoråˆ°~/.android/adb_usb.iniï¼Œå†…å®¹æ ¼å¼ä¸º<code>0xidVendor</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo 0x2717&gt; ~/.android/adb_usb.ini</div></pre></td></tr></table></figure>
</li>
</ol>
<p>è¿™ä¸€æ­¥å®˜ç½‘ä¸Šæ²¡æœ‰æåˆ°ï¼Œå¯¼è‡´åé¢<code>android.rules</code>æ–‡ä»¶ä¸€ç›´æŠ¥<code>SUBSYSTEM==&quot;usb&quot;</code>æœ‰é”™</p>
<ul>
<li>ä»¥ä¸‹æ­¥éª¤å¯ä»¥è§£å†³Android studioæ— æ³•è¯†åˆ«è®¾å¤‡XXXX[null]çš„é—®é¢˜</li>
</ul>
<ol>
<li><p>æ·»åŠ Usbè®¾å¤‡é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/udev/rules.d/70-android.rules</div><div class="line">SUBSYSTEM==&quot;usb&quot;, ATTRS&#123;idVendor&#125;==&quot;2717&quot;, ATTRS&#123;idProduct&#125;==&quot;9039&quot;,MODE=&quot;0666&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>ç»™é…ç½®æ–‡ä»¶æ·»åŠ æƒé™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chmod a+rx /etc/udev/rules.d/70-android.rules</div></pre></td></tr></table></figure>
</li>
<li><p>é‡æ–°åŠ è½½usbé…ç½®è§„åˆ™æ–‡ä»¶ï¼Œé‡å¯adbæœåŠ¡å¹¶æŸ¥çœ‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo udevadm control --reload-rules &amp;&amp; sudo service udev restart &amp;&amp; sudo udevadm trigger</div><div class="line">adb kill-server &amp;&amp; adb start-server</div><div class="line">adb devices</div></pre></td></tr></table></figure>
</li>
</ol>
<p>æ­¤æ—¶è®¾å¤‡å·²ç»å¯ä»¥è¯†åˆ«äº†</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Jessie Kate" />
            
              <p class="site-author-name" itemprop="name">Jessie Kate</p>
              <p class="site-description motion-element" itemprop="description">ç¨‹åºçš„ä¸–ç•Œï¼Œæ¯”ä½ ç‰›é€¼çš„äººæ›´æ¯”ä½ åŠªåŠ›ã€‚<br /> helloï¼ŒI'm an Android developerï½ <br /> My hobbies tag &#58; <br /> - Coding  <br /> - Sports   <br /> - Game</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jessie Kate</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: '6LCVjBbx0bpqxaQGmw1hdaTw-gzGzoHsz',
        appKey: 'h0CQIfed08e67roNpfhTzHOH',
        placeholder: 'åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„è¯„è®ºå§ï½',
        avatar:'wavatar',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("6LCVjBbx0bpqxaQGmw1hdaTw-gzGzoHsz", "h0CQIfed08e67roNpfhTzHOH");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  

  

  
  

  

  

  

</body>
</html>
